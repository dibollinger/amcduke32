// *************************************************
// AMC TC ENEMY CODE
// *************************************************
defstate BODY_FALL_NOISES
ifonwater sound WATER_SPLASH
else ifrnd 42 sound BODY_DROP
else ifrnd 42 sound BODY_DROP2
else ifrnd 42 sound BODY_DROP3
else ifrnd 42 sound BODY_DROP4
else ifrnd 42 sound BODY_DROP5
else sound BODY_DROP6
ends

defstate BODY_FALL_NOISES_SOUNDONCE
ifonwater soundonce WATER_SPLASH
else ifrnd 42 soundonce BODY_DROP
else ifrnd 42 soundonce BODY_DROP2
else ifrnd 42 soundonce BODY_DROP3
else ifrnd 42 soundonce BODY_DROP4
else ifrnd 42 soundonce BODY_DROP5
else soundonce BODY_DROP6
ends

defstate spawned_by_choppers
ifspawnedby MI_24_HIND
	{
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 130 cstat 2
	ifg INTERNALCOUNT 260 cstat 514
	ifg INTERNALCOUNT 320 killit
	}
ends

defstate ENEMY_SHIELD_STUFF
		geta[].htextra TEMP
		ifg TEMP 0
		 ifg ENEMY_SHIELD 0
			{
			seta[].htextra -1
			seta[].htpicnum 0
			sound SOMETHINGHITFORCE
			spritepal 32
			shoot SPARK
			sub ENEMY_SHIELD TEMP
			ifl ENEMY_SHIELD 1
				{
				set ENEMY_SHIELD -310
				addlogvar ENEMY_SHIELD
				seta[].pal ENEMY_TYPE
				stopsound SOMETHINGHITFORCE
				screensound ENEMY_SH_BREAK
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				}
			resetcount
			}
	
	ifl ENEMY_SHIELD 0
		{
		ifdead break
		add ENEMY_SHIELD 1
		ifg ENEMY_SHIELD -10 
			{
			spritepal 97
			sound ESHIELD_RECHARGE
			set ENEMY_SHIELD 200
			}
		}
	ends

defstate correctcansee
                                  
                 geta[].z mz
                 sub mz 8192
                 seta[].z mz
				 geta[].xrepeat temp_size
				 seta[].xrepeat 200
                 ifcansee set sightvar YES else set sightvar NO
				 seta[].xrepeat temp_size
                 add mz 8192
                 seta[].z mz
                 
ends


defstate ENEMYKNOCKBACKS
geta[].htextra xvel 
ifg xvel 0
	{
	mulvar xvel ENEMYKNOCKBACK 
	geta[].htpicnum TEMP
	ife TEMP KNEE 
		{ 
		ifl ROUNDHOUSE_KICK 27 break
		ifl DROP_KICK 27 mulvar xvel 8 else
		mulvar xvel 4
		ifstrength 30 seta[].htactorstayput -1 
		}
	ife TEMP KICK_2 
		{ 
		mulvar xvel 4
		ifstrength 30 seta[].htactorstayput -1 
		}
	clamp xvel -800 0
	ife TEMP 4960 nullop else
	ife TEMP 4963 nullop else
	seta[].xvel xvel
	}
ends

defstate thegames_score
ifdead 
{
geta[].htowner TEMP4
geta[TEMP4].picnum TEMP5
ife TEMP5 1405
	{
	getactorvar[TEMP4].P_CREDITS TEMP6
	ifactor ZOMBIE add TEMP6 2
	else ifactor BOSS1 add TEMP6 30
	else ifactor BOSS2 add TEMP6 30
	else ifactor BOSS3 add TEMP6 30
	else ifactor BOSS4 add TEMP6 35
	else ifactor BOSS5 add TEMP6 40
	else ifactor HPOWERSUIT add TEMP6 40
	else ifactor CYBERDEMON add TEMP6 40
	else ifactor SPIDERDEMON add TEMP6 120
	else ifactor DARKAVATAR add TEMP6 80
	else ifactor SORCERER add TEMP6 15
	else ifactor LOST add TEMP6 20
	else ifactor FASCIST add TEMP6 7
	else ifactor MERC add TEMP6 5
	else ifactor LPOWERSUIT add TEMP6 8
	else ifactor BRUISER add TEMP6 20
	else ifactor CYBERTOUR add TEMP6 15
	else ifactor CULTIST 
		{
		ifspritepal 49 add TEMP6 15
		else ifspritepal 10 add TEMP6 10
		else ifspritepal 36 add TEMP6 8
		else add TEMP6 5
		}
	else ifactor NEWBEAST add TEMP6 14
	else ifactor COMMANDER add TEMP6 10
	else ifactor PITFIEND add TEMP6 10
	else ifactor OCTABRAIN add TEMP6 7
	else ifactor PIGCOP add TEMP6 6
	else ifactor EGG add TEMP6 1
	else add TEMP6 4
	setactorvar[TEMP4].P_CREDITS TEMP6
	ifactor ZOMBIE nullop else
		{
		getactorvar[TEMP4].kill_count TEMP8
		add TEMP8 1
		setactorvar[TEMP4].kill_count TEMP8
		}
	}

}
ends

defstate genericgrowcode
  ifcount 32
  {
    guts JIBS4 24
    guts JIBS6 28
    addkills 1
	state thegames_score
    state squish_sounds
    sound PIPEBOMB_EXPLODE
    hitradius 2048 60 70 80 90
    spawn BLOODPOOL
    spawn EXPLOSION2
    killit
  }
  else
  {
    ifactor COMMANDER
      sizeto 100 100
    else
      ifactor SHARK
        sizeto 84 84
    else
      sizeto MAXXSTRETCH MAXYSTRETCH
    break
  }
ends

// *************************************************
// BATTLE CODE - HUGE THANKS TO DEEPERTHOUGHT FOR HIS HELP HERE
// *************************************************

defstate calczdist

ife target -1 break

geta[].z z
ifactor BOSS1 sub z 4596

geta[target].z mz
set zdist mz
sub zdist z // zdist now holds how far up or down you would have to go from THISACTOR's position to get to target's position
geta[target].picnum TEMP

ifl zdist -8192 sub zdist 4096 // aim for the head when shooting up into windows

ends

defstate visibilitycheck // ALSO CHECKS FOR TRANSPARENT WALLS
ifn target -1 geta[target].statnum TEMP8
ife TEMP8 1024 set target -1

ifn THISACTOR -1 ifn target -1 ldist xydist THISACTOR target

state calczdist

geta[].x x
geta[].y y
geta[].z z
sub z 8192
geta[].sectnum mysector
geta[].ang ANGVAR
cos mycos ANGVAR
sin mysin ANGVAR
shiftvarl zdist 14

ife xydist 0 set xydist 1
divvarvar zdist xydist
hitscan x y z mysector mycos mysin zdist hitsector hitwall hitsprite hitx hity hitz 4294901808
getp[].i TEMP8

ife hitsprite target 
{
	set targetlock 26 
}
else set targetlock 26

add z 4096
hitscan x y z mysector mycos mysin zdist hitsector hitwall hitsprite hitx hity hitz 4294901808
ifvarvarn hitsprite target
{
	ifn targetlock 0 break
	set target -1
}

ends

defstate checksight
	geta[].z z
	sub z 8192
	seta[].z z
	geta[target].z mz
	sub mz 8192
	seta[target].z mz
	canseespr THISACTOR target TEMP2
	add z 8192
	seta[].z z
	add mz 8192
	seta[target].z mz
	ife TEMP2 0 { set target -1 break }
ends

defstate validatetarget


ifn target -1 
{
	geta[target].statnum TEMP8
	ife TEMP8 1024 set target -1

	state checksight
	
	ifn target -1
	{
		geta[target].x mx
		geta[target].y my
	}
	geta[].x x
	geta[].y y
	sub mx x
	sub my y
	getangle ANGVAR mx my
	seta[].ang ANGVAR

	state visibilitycheck
}
else break

ends

defstate shoot_target
ifn target -1
	{
	ldist TEMP THISACTOR target
	geta[].z TEMP2
	sub TEMP2 4096 // Offset the Z. Assumes the center of the actor is the same as the player
	geta[target].z TEMP3
	sub TEMP3 4096 // Offset the Z. assumes the center of the actor is the same as the player
	sub TEMP3 TEMP2
	shiftvarl TEMP3 8
	ifn TEMP3 0 ifn TEMP 0 divvarvar TEMP3 TEMP
	}
ends

defstate enemyfindtarget // find target only enemies shoot at
	set target -1
	
	findnearactorz SHOOTME2 2048 16384 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME2 4096 32768 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME2 8192 65536 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME2 12288 98304 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME2 18432 147456 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME2 32768 262144 target
	ifn target -1 state validatetarget
	ifn target -1 break
ends

defstate enemyfindtarget3 // find target only allies shoot at? this state might be unnecessary?
	set target -1
	findnearactorz SHOOTME 2048 16384 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME 4096 32768 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME 8192 65536 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME 12288 98304 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME 18432 147456 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME 32768 262144 target
	ifn target -1 state validatetarget
	ifn target -1 break
ends

defstate enemyfindtarget2 // find target "everbody" shoots at
	set target -1
	findnearactorz SHOOTME3 2048 16384 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME3 4096 32768 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME3 8192 65536 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME3 12288 98304 target
	ifn target -1 state validatetarget
	ifn target -1 break
	findnearactorz SHOOTME3 18432 147456 target
	ifn target -1 state validatetarget
	findnearactorz SHOOTME3 32768 262144 target
	ifn target -1 state validatetarget
ends


defstate enemyLocateAnyTarget // Find either an "enemy-only" target or an "everybody" target
	state enemyfindtarget
	// Didn't find one yet? Keep searching
	ife target -1
		state enemyfindtarget2
ends

/// <summary>
/// The enemy that calls this state will check what the ZVEL of any projectile they fire needs to be to hit a target.
/// <summary>
/// <params name="target">Should be the actor id of the target (no firing happens if set to -1)</params>
/// <params name="PROJECTILE_VEL">Should be set to the velocity of the projectile to fire.</params>
var PROJECTILE_VEL 0 2
defstate sang_getprojectilezvel // determine the Z velocity that should be passed to ezshoot for projectiles shot by the actor calling this state to go towards a target
	ifn target -1
	{
		ldist TEMP4 THISACTOR target
		
		ifn PROJECTILE_VEL 0
			divvarvar TEMP4 PROJECTILE_VEL // amount of tics it would take for projectile to reach the player
		
		ife TEMP4 0 // means instant hit (hitscan probably), set to 1 tic to not have divide by zero stuff
			set TEMP4 1
		
		// find Zdist
		geta[].z TEMP2
		geta[target].z TEMP3
		sub TEMP3 TEMP2 // TEMP3 = zdist
		
		ifn TEMP4 0
			divvarvar TEMP3 TEMP4 // zvel
	}
ends

/// <summary>
/// The enemy that calls this state will check if it can hit a target (based on SHOOTME stuff, this is not necessarily the player).
/// If so, it will shoot a projectile with the appropriate ZVEL and firing sound.
/// <summary>
/// <remarks>
/// Does NOT work for hardcoded projectiles (such as SPIT, CHAINGUN etc) or hitscan
/// <remarks>
/// <params name="PROJECTILE_TO_SHOOT">Should be set to the picnum of the projectile to shoot</params>
/// <params name="PROJECTILE_FIRING_SOUND">Should be set to the index of the sound to play when firing. Set to -1 for no sound.</params>
var PROJECTILE_TO_SHOOT 0 2
var PROJECTILE_FIRING_SOUND 0 2
defstate sang_enemyShootProjectile
	state enemyLocateAnyTarget // target == the sprite to shoot at

	ifn target -1
	{
		// Some projectiles are hardcoded, and won't be found via getprojectile. For those I looked up the hardcoded value.
		ife PROJECTILE_TO_SHOOT FIRELASER
			set PROJECTILE_VEL 840 // see player.cpp A_ShootHardcoded for where I got this value from 
		else 
			getprojectile[PROJECTILE_TO_SHOOT].vel PROJECTILE_VEL
			
		state sang_getprojectilezvel // TEMP3 == ZVEL
		
		ifn PROJECTILE_FIRING_SOUND -1
			sound PROJECTILE_FIRING_SOUND

		ezshoot TEMP3 PROJECTILE_TO_SHOOT
	}
ends 

/// <summary>
/// Acts like sang_enemyShootProjectile except this handles hitscanners specifically.
/// The state assumes a target check has been done, and the actor is angled properly to shoot at whatever.
/// <summary>
/// <params name="HITSCAN_TO_SHOOT">Should be set to the hitscan "projectile" to shoot</params>
/// <params name="HITSCAN_FIRING_SOUND">Should be set to the index of the sound to play when firing. Set to -1 for no sound.</params>
var HITSCAN_TO_SHOOT 0 2
var HITSCAN_FIRING_SOUND 0 2
var HITSCAN_SHOT_FIRED 0 2
defstate sang_enemyShootHitscanNoTargetSeek
	set HITSCAN_SHOT_FIRED 0

	set PROJECTILE_VEL 256
	state sang_getprojectilezvel // TEMP3 == ZVEL
	
	ifn HITSCAN_FIRING_SOUND -1
		sound HITSCAN_FIRING_SOUND

	// If there is a target, shoot with proper ZVEL and such, otherwise use normal shoot command
	// cause we can't calculate an appropriate ZVEL in that case and normal shoot is still better than zshoot 0
	ife target -1
		zshoot TEMP3 HITSCAN_TO_SHOOT
	else
		shoot HITSCAN_TO_SHOOT
		
	
	set HITSCAN_SHOT_FIRED 1
ends 

// Same as above except target check happens first
defstate sang_enemyShootHitscan
	state enemyLocateAnyTarget // target == the sprite to shoot at
	state sang_enemyShootHitscanNoTargetSeek
ends 


defstate shooting_settings
ifg SKILL_LEVEL 2 // if on expert or professional, always correct aim
	{
	state enemyfindtarget
	state enemyfindtarget2
	state shoot_target
	}
else
ifrnd 32 // otherwise, randomly look for target
	{
	state enemyfindtarget
	state enemyfindtarget2
	state shoot_target
	}
ends

defstate frozen_code
spritepal 1
move 0
cstat 257

    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick

 ifhitweapon
    {
      ifwasweapon FREEZEBLAST
        break

      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
	  set PLAYER_VOICEOVER 20
      addkills 1
	  state thegames_score
		ifactor BOSS1
			ifn XVELSAVED 0 
			{
			operateactivators XVELSAVED THISACTOR
			operatemasterswitches XVELSAVED
			operaterespawns XVELSAVED
			set XVELSAVED 0
			}
      killit
    }
ends

defstate genericshrunkcode
  ifcount 32
  {
    ifpdistl SQUISHABLEDISTANCE
	{
    pstomp
	ifactor BOSS1
	    ifn XVELSAVED 0 
		{
		operateactivators XVELSAVED THISACTOR
		operatemasterswitches XVELSAVED
		operaterespawns XVELSAVED
		set XVELSAVED 0
		}
	}
  }
  else
  {
    sizeto MINXSTRETCH MINYSTRETCH
    spawn FRAMEEFFECT1
  }
ends

spritenoshade 14040
spritenopal 14040

useractor notenemy 14040
ifaction 0
	{
	geta[].htflags TEMP2
	orvar TEMP2 2048
	seta[].htflags TEMP2
	seta[].blend 255
	ifspawnedby 7392 sizeat 12 12 else
	ifspawnedby 10078 sizeat 14 14 else
	ifspawnedby 11651 sizeat 14 14 else
	ifspawnedby 7936 sizeat 10 10 else
	sizeat 24 24
  ifrnd 128
    cstat 6
  else
    cstat 2
	action ZERO
	resetcount
	}
else
ifaction ZERO
	{
	ifspawnedby 7392
		{
		seta[].shade -127
		ifrnd 1 { espawn GUNSMOKE geta[RETURN].z TEMP sub TEMP 1024 seta[RETURN].z TEMP seta[RETURN].pal 2 }
		sizeto 10 10
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	else
	ifspawnedby 23625
		{
		seta[].shade -127
		ifrnd 1 { espawn GUNSMOKE geta[RETURN].z TEMP sub TEMP 2048 seta[RETURN].z TEMP seta[RETURN].pal 2 }
		sizeto 10 10
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	else
	ifspawnedby 10074
		{
		seta[].shade -127
		ifrnd 1 { espawn GUNSMOKE geta[RETURN].z TEMP sub TEMP 1024 seta[RETURN].z TEMP seta[RETURN].pal 2 }
		sizeto 20 20
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	else
	ifspawnedby 11651
		{
		seta[].shade -127
		ifrnd 1 { espawn GUNSMOKE geta[RETURN].z TEMP sub TEMP 1024 seta[RETURN].z TEMP seta[RETURN].pal 2 }
		sizeto 20 20
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	else
	ifspawnedby 10078
		{
		seta[].shade -127
		ifrnd 1 { espawn GUNSMOKE geta[RETURN].z TEMP sub TEMP 1024 seta[RETURN].z TEMP seta[RETURN].pal 2 }
		sizeto 12 12
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	else
	ifspawnedby 7936
		{
		seta[].shade -127
		ifrnd 1 { espawn GUNSMOKE geta[RETURN].z TEMP sub TEMP 1024 seta[RETURN].z TEMP seta[RETURN].pal 2 }
		sizeto 8 8
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	else
	ifspawnedby 8002
		{
		seta[].shade -127
		sizeto 4 4
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	else
		{
		seta[].shade -127
		ifrnd 4 { shoot SPARK espawn BIG_SMOKE geta[RETURN].z TEMP sub TEMP 8096 seta[RETURN].z TEMP seta[RETURN].pal 17 }
		sizeto 1 1
		ifcount 5 cstator 2
		ifcount 9 cstator 512
		ifcount 14 killit
		}
	}
enda

defstate enemy_spirit_damage
ifg SPIRIT_DAMAGE 0
	{
	ifrnd 96
		{
		espawn 14040
		geta[].x TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		seta[RETURN].pal 1
		
		geta[].y TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		sub TEMP 4096
		randvar TEMP2 2048
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
	sub SPIRIT_DAMAGE 1
	ifl sprite[].htextra 1 seta[].htextra 1
	soundonce FLESH_BURNING
	ifdead set SPIRIT_DAMAGE 0
	}
ends

defstate enemy_fire_damage
ifg COSMETIC_FLAME 0
	{
	sub COSMETIC_FLAME 1
	ifrnd 128
		{
		espawn 14040
		geta[].x TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		sub TEMP 4096
		randvar TEMP2 2048
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
	}
ifg FIRE_DAMAGE 0
	{
	ifdead break
	ifg sprite[].extra 0 set COSMETIC_FLAME 30
	ifinwater set FIRE_DAMAGE 0
	sub FIRE_DAMAGE 4
	ifonwater sub FIRE_DAMAGE 8
	geta[].extra TEMP
	ifg TEMP 0 sub TEMP 4
	ifl TEMP 1 { ifl sprite[].htextra 1 seta[].htextra 1 set TEMP 0 }
	seta[].extra TEMP
	soundonce FLESH_BURNING
	ifdead ife FIRE_DAMAGE 0 set PLAYER_VOICEOVER 21
	ifonwater { set FIRE_DAMAGE 0 soundonce STEAM_HISSING spawn BIG_SMOKE }
	ifinwater { set FIRE_DAMAGE 0 soundonce STEAM_HISSING spawn BIG_SMOKE }
	}
ends

defstate enemy_ice_damage
ifg ICE_DAMAGE 0
	{
	ifdead { ifspritepal 1 nullop else spritepal 1 }
	else ifg ICE_DAMAGE 1 { ifspritepal 27 nullop else spritepal 27 }
	geta[].xvel TEMP2
	divvar TEMP2 4
	seta[].xvel TEMP2
	geta[].yvel TEMP2
	divvar TEMP2 4
	seta[].yvel TEMP2	
	espawn BIG_SMOKE
	seta[RETURN].pal 1
	geta[RETURN].z TEMP4
		sub TEMP4 4096
		randvar TEMP2 2048
		sub TEMP4 TEMP2
	seta[RETURN].z TEMP4
	sub ICE_DAMAGE 1
	soundonce SOMETHINGFROZE
	ifdead { spritepal 1 set ICE_DAMAGE 0 }
	else { ife ICE_DAMAGE 1 getlastpal }
	}
ends

defstate enemyfloordamage
state getfloordist
ifl z 5
	{
	ifstrength 0 break else
		{
		gets[].floorpicnum TEMP
		ife TEMP PURPLELAVA
			{
			seta[].htextra 3
			}
		else
	ife TEMP FLOORPLASMA
			{
			ifrnd 32
				{
				randvar TEMP8 10
				seta[].htextra TEMP8
				}
			}
		else
	ife TEMP FLOORSLIME
			{
			ifrnd 64
				{
				randvar TEMP8 5
				seta[].htextra TEMP8
				}
			}
		else
	ife TEMP HURTRAIL
			{
			ifrnd 64
				{
				spawn FIRE2
				randvar TEMP8 5
				seta[].htextra TEMP8
				}
			}
		else
	ife TEMP 7387
			{
			ifrnd 64
				{
				randvar TEMP8 5
				seta[].htextra TEMP8
				}
			}
		else
	ife TEMP 7396
			{
			ifrnd 32
				{
				spawn FIRE2
				randvar TEMP8 10
				seta[].htextra TEMP8
				}
			}
		else
	ife TEMP 10526
			{
			ifrnd 32
				{
				spawn FIRE2
				randvar TEMP8 10
				seta[].htextra TEMP8
				}
			}
		}
	}
ends


defstate troop_body_jibs
  ifrnd 128
    guts HEADJIB1 1 else guts JIBS2 2
  ifrnd 128
    guts LEGJIB1 2
  ifrnd 128
    guts ARMJIB1 1
  ifrnd 64
    spawn BLOODPOOL
ends

defstate liz_body_jibs
  ifrnd 128
    guts LIZMANHEAD1 1
  ifrnd 128
    guts LIZMANLEG1 2
  ifrnd 128
    guts LIZMANARM1 1
  ifrnd 64
    spawn BLOODPOOL
ends

defstate human_jibs
	guts HUMAN_TORSO 1
	guts HUMAN_ARM 2
  	shoot NJIB2
  	shoot NJIB2
	shoot NJIB3
	ifrnd 16 ifcansee state trigger_showoff
  state jib_sounds
ends

defstate monst_body_jibs
  	shoot NJIB2
  	shoot NJIB2
  	shoot NJIB2
  	shoot NJIB3
  	shoot NJIB3
  	shoot NJIB3
	ifrnd 16 ifcansee state trigger_showoff
  state jib_sounds
ends



defstate rf_or
  ifrnd 128
    cstator 4
  else
    cstator 0
ends

defstate random_wall_jibs
  ifrnd 96
    shoot BLOODSPLAT1
  ifrnd 96
    shoot BLOODSPLAT2
  ifrnd 96
    shoot BLOODSPLAT3
  ifrnd 96
    shoot BLOODSPLAT4
  ifrnd 96
    shoot BLOODSPLAT1
ends

defstate random_ooz
  ifrnd 128
    spawn OOZ2
  else
    spawn OOZ
ends


defstate checksquished
  ifsquished
  {
    addkills 1
	state thegames_score
    state squish_sounds
    state standard_jibs
    state random_ooz
    killit
  }
ends

defstate check_metal_squished
  ifsquished
  {
    addkills 1
	state thegames_score
    sound METAL_CRUSH
    killit
  }
ends

// NEW GUN EFFECTS

useractor enemy 9375
move STOP
cstat 32768
add INTERNALCOUNT 1
ifg INTERNALCOUNT 520
	{
	  globalsound MIAGUN_APPEAR
	  espawn TRANSPORTERBEAM
	  seta[RETURN].pal 12
	  seta[].cstat TEMP9
	  seta[].extra MIA_HEALTH
	  spawn SHOOTME
	  set PAIN_AMOUNT 90
	  seta[].picnum TEMP7
	  }
enda

defstate WEP0_BLOOD_STUFF
ifactor ORC set WEP0_BLOODY 8 else
ifactor NEWBEAST set WEP0_BLOODY 8 else
ifactor SORCERER set WEP0_BLOODY 1 else
ifactor DARKAVATAR set WEP0_BLOODY 1 else
set WEP0_BLOODY 2
ends

defstate WEP2_BLOOD_STUFF
ifactor ORC set WEP2_BLOODY 11 else
ifactor NEWBEAST set WEP2_BLOODY 11 else
ifactor SORCERER set WEP2_BLOODY 3 else
ifactor DARKAVATAR set WEP2_BLOODY 3 else
set WEP2_BLOODY 21
ends

defstate WEP3_BLOOD_STUFF
ifactor ORC set WEP2_BLOODY 11 else
ifactor NEWBEAST set WEP3_BLOODY 11 else
ifactor SORCERER set WEP3_BLOODY 3 else
ifactor DARKAVATAR set WEP3_BLOODY 3 else
set WEP3_BLOODY 21
ends

defstate ENEMY_RES_STUFF
	globalsound RESEARCH_DATA
	palfrom 20 63 63 63
	quote 1025
	ife RADIO_CONTACT YES
		{
		ifrnd 64 globalsound MSCI_RES1
		else ifrnd 64 globalsound MSCI_RES2
		else ifrnd 64 globalsound MSCI_RES3
		else ifrnd 64 globalsound MSCI_RES4
		}
ends

defstate NEWGUNEFFECTS

geta[].htpicnum BULLET_HIT_TYPE
ifand tiledata[BULLET_HIT_TYPE].gameflags 8 getprojectile[BULLET_HIT_TYPE].userdata PROJ_UDATA else set PROJ_UDATA 0
	

ife BULLET_HIT_TYPE 12053 { ife CURWEAP 0 state WEP0_BLOOD_STUFF sound SLASH }
ife BULLET_HIT_TYPE 12054 { ife CURWEAP 0 state WEP0_BLOOD_STUFF }
ife BULLET_HIT_TYPE 10247 { ife CURWEAP 0 state WEP0_BLOOD_STUFF }
ife BULLET_HIT_TYPE 4961 { state WEP2_BLOOD_STUFF sound STAB }
ife BULLET_HIT_TYPE 16076 { state WEP2_BLOOD_STUFF sound STAB2 }
ife BULLET_HIT_TYPE 13404 { state WEP3_BLOOD_STUFF sound STAB }
ife BULLET_HIT_TYPE 13386 { state WEP3_BLOOD_STUFF sound STAB }
ife BULLET_HIT_TYPE 4960 { state WEP3_BLOOD_STUFF sound STAB }
ife BULLET_HIT_TYPE 6874 { state WEP3_BLOOD_STUFF sound STAB }
ife BULLET_HIT_TYPE 6875 { state WEP3_BLOOD_STUFF sound STAB }
ife BULLET_HIT_TYPE 18067 { sound STAB stopsound KNIFE_IMPACT }
ife BULLET_HIT_TYPE 18072 { sound STAB stopsound KNIFE_IMPACT }
ife BULLET_HIT_TYPE 4963 { sound STAB stopsound KNIFE_IMPACT }
ife BULLET_HIT_TYPE 14604 { sound STAB stopsound KNIFE_IMPACT }
ife BULLET_HIT_TYPE 14605 { sound STAB stopsound KNIFE_IMPACT }
ife BULLET_HIT_TYPE 12203 { sound STAB stopsound KNIFE_IMPACT }
ife BULLET_HIT_TYPE 12204 { sound STAB stopsound SHOVEL_IMPACT }
ife BULLET_HIT_TYPE 5010 sound BOLT_HIT
ife BULLET_HIT_TYPE 5011 sound BOLT_HIT
ife BULLET_HIT_TYPE GROWSPARK sound EXPANDERHIT
ife BULLET_HIT_TYPE FREEZEBLAST { set ICE_DAMAGE 26 seta[].htpicnum 0 }
ifand PROJ_UDATA 1 { set ENERGY_DAMAGE 26 seta[].htpicnum 0 }
ifand PROJ_UDATA 2 { set FIRE_DAMAGE 16 seta[].htpicnum 0 }
ifand PROJ_UDATA 4 { set ICE_DAMAGE 26 seta[].htpicnum 0 }
ifand PROJ_UDATA 16384 { set SPIRIT_DAMAGE 16 seta[].htpicnum 0 }

ifand PROJ_UDATA 8192 
	{
	ifinwater 
			{ 
			addstrength -25 
			sound LIGHT_CONDUCT
			spawn LIGHT_SPREAD
			palfrom 10 10 10 10
			}
			
	iffloordistl 8
			{
			gets[].floorpicnum FLOORTEX
			state CHECKSTEPS
			ife STEPSOUNDFX 2
				{
				addstrength -15
				sound LIGHT_CONDUCT
				spawn LIGHT_SPREAD
				palfrom 10 10 10 10
				}
			ife STEPSOUNDFX 3
				{
				addstrength -15
				sound LIGHT_CONDUCT
				spawn LIGHT_SPREAD
				palfrom 10 10 10 10
				}
			}
	ifdead set PLAYER_VOICEOVER 34
	}

ife BULLET_HIT_TYPE 9376 // MIA GUN
{
	ifactor APLAYER addphealth -150 else
		{
	  ifactor BOSS1 ifspritepal 0 break
	  ifactor BOSS2 ifspritepal 0 break
	  ifactor BOSS3 ifspritepal 0 break
	  ifactor BOSS4 ifspritepal 0 break
	  ifactor BOSS5 ifspritepal 0 break
	  ifactor LIZBOSS ifspritepal 0 break
	  ifactor PIGBOSS ifspritepal 0 break
	  ifactor BRUISER ifspritepal 24 break
	  
	  ifactor LIZTROOP
	  {
	  readarrayfromfile PERSONEL_RESEARCH 4002
	  ifg PERSONEL_RESEARCH[18] 0 nullop // improved jetpack controls
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22499
			setarray PERSONEL_RESEARCH[18] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
	   ifspritepal 10 // If it's the liztroop major, give the player the teleport device project
		{
			ifg PERSONEL_RESEARCH[7] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13339
			setarray PERSONEL_RESEARCH[7] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
	   ifspritepal 23 // If it's the liztroop freezer, give the player the de-frost kit project
		{
			ifg PERSONEL_RESEARCH[19] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13341
			setarray PERSONEL_RESEARCH[19] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
	 }
	 
	 ifactor SPACE_LIZTROOP // o2 oxygen
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[27] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22726
			setarray PERSONEL_RESEARCH[27] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	 ifactor MJ12_ASSASSIN // muscle suit
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[30] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22718
			setarray PERSONEL_RESEARCH[30] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	 ifactor LIZBOSS // better jetpack
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[28] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22725
			setarray PERSONEL_RESEARCH[28] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	 ifactor OGRE // improved shield
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[29] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22724
			setarray PERSONEL_RESEARCH[29] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
	 
	 ifactor ELITE_LIZMAN // if it's the elite lizard man, give the player the personal forceshield topic
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[22] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22734
			setarray PERSONEL_RESEARCH[22] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	 ifactor GORILLA // if it's the gorilla commando, give the player the personal forceshield topic
	  ife ENEMY_TYPE 13
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
		ifg PERSONEL_RESEARCH[22] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22734
			setarray PERSONEL_RESEARCH[22] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		ifg PERSONEL_RESEARCH[23] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22733
			setarray PERSONEL_RESEARCH[23] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
	 
	  ifactor PIGCOP // If it's the pig cop, give the player the improved body armour topic
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[4] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22739
			setarray PERSONEL_RESEARCH[4] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor PIG_SF // If it's the pig cop, give the player the improved body armour topic
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[4] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22739
			setarray PERSONEL_RESEARCH[4] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}	
	 
	  ifactor COBRA // If it's the COBRA, give the player the anti-toxin research
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
		ifg PERSONEL_RESEARCH[5] 0 nullop
		else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22498
			setarray PERSONEL_RESEARCH[5] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		ifg PERSONEL_RESEARCH[25] 0 nullop
		else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22731
			setarray PERSONEL_RESEARCH[25] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor NEWBEAST // If it's the newbeast, give them the acid boot protection topic
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[26] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22737
			setarray PERSONEL_RESEARCH[26] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor FASCIST // If it's the Imperical Union SOLDIER, give them the AMC troop lasergun
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[1] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 12971
			setarray PERSONEL_RESEARCH[1] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
	
	  ifactor SPIDER2 // If it's the spider, give the player the anti-toxin research
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[5] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22498
			setarray PERSONEL_RESEARCH[5] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor CYBERALIEN // If it's the cyber-alien, give the player the enhanced heat seeking project
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[15] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13342
			setarray PERSONEL_RESEARCH[15] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor LIZMAN
	  {
		readarrayfromfile WEAPONS_RESEARCH 4000
		ifg WEAPONS_RESEARCH[11] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 2
			set DISP_RES_PIC LIZMANGUNSPRITE
			setarray WEAPONS_RESEARCH[11] 3
			ifand NEW_RESEARCH 1 nullop else xorvar NEW_RESEARCH 1
			writearraytofile WEAPONS_RESEARCH 4000
			state ENEMY_RES_STUFF
			}
	   ifspritepal 24 // If it's the lizman laser gunner, give the player the laser gunner project
		{
		ifg WEAPONS_RESEARCH[2] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 2
			set DISP_RES_PIC LIZMANFGUNSPRITE
			setarray WEAPONS_RESEARCH[2] 3
			ifand NEW_RESEARCH 1 nullop else xorvar NEW_RESEARCH 1
			writearraytofile WEAPONS_RESEARCH 4000
			state ENEMY_RES_STUFF
			}
		}
	}
		
	  ifactor COMMANDER
	  {
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[20] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22738
			setarray PERSONEL_RESEARCH[20] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
	   ifspritepal 24 // Cycloid plasma topic
		{
		readarrayfromfile WEAPONS_RESEARCH 4000
			ifg WEAPONS_RESEARCH[9] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 2
			set DISP_RES_PIC 13547
			setarray WEAPONS_RESEARCH[9] 3
			ifand NEW_RESEARCH 1 nullop else xorvar NEW_RESEARCH 1
			writearraytofile WEAPONS_RESEARCH 4000
			state ENEMY_RES_STUFF
			}
		}
	}
				
	  ifactor MERC // carapace armour
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[2] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 12942
			setarray PERSONEL_RESEARCH[2] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor MERC2 // ablative plating
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[16] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 22501
			setarray PERSONEL_RESEARCH[16] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor ZSOLDIER // Extended AMC soldier magazines
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[3] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13331
			setarray PERSONEL_RESEARCH[3] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor ZSOLDIER2 // Extended AMC soldier magazines
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[3] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13331
			setarray PERSONEL_RESEARCH[3] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor CYBERTOUR // cybertour sheathing
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[6] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13324
			setarray PERSONEL_RESEARCH[6] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor SATYR // satyr fibre
		{
		readarrayfromfile PERSONEL_RESEARCH 4002
			ifg PERSONEL_RESEARCH[8] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 1
			set DISP_RES_PIC 13327
			setarray PERSONEL_RESEARCH[8] 3
			ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
			writearraytofile PERSONEL_RESEARCH 4002
			state ENEMY_RES_STUFF
			}
		}
		
	ifactor CULTIST
	{
	readarrayfromfile PERSONEL_RESEARCH 4002
	ifg PERSONEL_RESEARCH[21] 0 nullop // improved robes
		else
		{
		set DISP_RES -240
		set DISP_RES_PAL 1
		set DISP_RES_PIC 22736
		setarray PERSONEL_RESEARCH[21] 3
		ifand NEW_RESEARCH 4 nullop else xorvar NEW_RESEARCH 4
		writearraytofile PERSONEL_RESEARCH 4002
		state ENEMY_RES_STUFF
		}
		
	ifspritepal 49 // purple robed mystical cultist?
		{
		readarrayfromfile MYSTICAL_RESEARCH 4004
		ifg MYSTICAL_RESEARCH[1] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 18
			set DISP_RES_PIC 13333
			setarray MYSTICAL_RESEARCH[1] 3
			ifand NEW_RESEARCH 16 nullop else xorvar NEW_RESEARCH 16
			writearraytofile MYSTICAL_RESEARCH 4004
			state ENEMY_RES_STUFF
			}
		}
		
	}
	
	  ifactor ANUBIS_MUMMY // improved medi-kit speed
		{
		readarrayfromfile MYSTICAL_RESEARCH 4004
			ifg MYSTICAL_RESEARCH[5] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 18
			set DISP_RES_PIC 22717
			setarray MYSTICAL_RESEARCH[5] 3
			ifand NEW_RESEARCH 16 nullop else xorvar NEW_RESEARCH 16
			writearraytofile MYSTICAL_RESEARCH 4004
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor OCTABRAIN // first level of mystical shield
		{
		readarrayfromfile MYSTICAL_RESEARCH 4004
			ifg MYSTICAL_RESEARCH[1] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 18
			set DISP_RES_PIC 13333
			setarray MYSTICAL_RESEARCH[1] 3
			ifand NEW_RESEARCH 16 nullop else xorvar NEW_RESEARCH 16
			writearraytofile MYSTICAL_RESEARCH 4004
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor SORCERER // second level of mystical shield
		{
		readarrayfromfile MYSTICAL_RESEARCH 4004
			ifg MYSTICAL_RESEARCH[2] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 18
			set DISP_RES_PIC 13334
			setarray MYSTICAL_RESEARCH[2] 3
			ifand NEW_RESEARCH 16 nullop else xorvar NEW_RESEARCH 16
			writearraytofile MYSTICAL_RESEARCH 4004
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor LOST // third level of mystical shield
		{
		readarrayfromfile MYSTICAL_RESEARCH 4004
			ifg MYSTICAL_RESEARCH[3] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 18
			set DISP_RES_PIC 13335
			setarray MYSTICAL_RESEARCH[3] 3
			ifand NEW_RESEARCH 16 nullop else xorvar NEW_RESEARCH 16
			writearraytofile MYSTICAL_RESEARCH 4004
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor NINJA // If it's the ninja, give the player the ninja roll ability
		{
		readarrayfromfile MELEE_RESEARCH 4020
			ifg MELEE_RESEARCH[7] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 22
			set DISP_RES_PIC 17402
			setarray MELEE_RESEARCH[7] 3
			ifand NEW_RESEARCH 32 nullop else xorvar NEW_RESEARCH 32
			writearraytofile MELEE_RESEARCH 4020
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor SIREN // curse protection
		{
		readarrayfromfile MYSTICAL_RESEARCH 4004
			ifg MYSTICAL_RESEARCH[4] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 18
			set DISP_RES_PIC 22735
			setarray MYSTICAL_RESEARCH[4] 3
			ifand NEW_RESEARCH 16 nullop else xorvar NEW_RESEARCH 16
			writearraytofile MYSTICAL_RESEARCH 4004
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor GUARDIAN // If it's the guardian, give the player the guardian head project
		{
		readarrayfromfile MELEE_RESEARCH 4020
			ifg MELEE_RESEARCH[6] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 22
			set DISP_RES_PIC 13345
			setarray MELEE_RESEARCH[6] 3
			ifand NEW_RESEARCH 32 nullop else xorvar NEW_RESEARCH 32
			writearraytofile MELEE_RESEARCH 4020
			state ENEMY_RES_STUFF
			}
		}
		
	  ifactor RIPPER // If it's the ripper, give the player the ripper heart project
		{
		readarrayfromfile MELEE_RESEARCH 4020
			ifg MELEE_RESEARCH[4] 0 nullop
			else
			{
			set DISP_RES -240
			set DISP_RES_PAL 22
			set DISP_RES_PIC 13346
			setarray MELEE_RESEARCH[4] 3
			ifand NEW_RESEARCH 32 nullop else xorvar NEW_RESEARCH 32
			writearraytofile MELEE_RESEARCH 4020
			state ENEMY_RES_STUFF
			}
		}
	  
	  ifactor DOCTORJ break
	  ifactor MISTERH break
      globalsound ACTOR_SHRINKING
	  espawn TRANSPORTERBEAM
	  seta[RETURN].pal 17
	  ifactor CULTIST { ifn YVELSAVED 0 espawnvar YVELSAVED set YVELSAVED 0 }
	  geta[].picnum TEMP7
	  geta[].extra MIA_HEALTH
	  geta[].cstat TEMP9
	  cstat 32768
	  cactor 9375
	  resetcount
		}
}
else
ife BULLET_HIT_TYPE 7056 // REDM_BLAST
{
espawn SHRINKEREXPLOSION
set ENERGY_DAMAGE 72
seta[RETURN].pal 2
seta[RETURN].cstat 130
seta[RETURN].xrepeat 40
seta[RETURN].yrepeat 40
}
else
ife BULLET_HIT_TYPE 4713 // Anti-Newbeast/Acid gun
{
sound PISTOL_BODYHIT
ifactor NEWBEAST
	{
	sound NB_PETRIFY
	espawn 4705
	seta[RETURN].xrepeat 40
	seta[RETURN].yrepeat 40
	addkills 1
	state thegames_score
	killit
	}
}
else
ife BULLET_HIT_TYPE 5378 // Petrifygun
{
ifdead
      {
	  ifactor APLAYER break
        spritepal 7
        lotsofglass 30
	  soundonce GLASS_HEAVYBREAK
	  ifactor CULTIST { ifn YVELSAVED 0 espawnvar YVELSAVED }
	  ifactor BOSS1
	     	ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
		ifactor COMMANDER 		 		
			ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
	  addkills 1
	  state thegames_score
        killit
      }
}
else
ife BULLET_HIT_TYPE 6248 // Nemesis Staff
{
set SPIRIT_DAMAGE 64
ifdead
	{
	state jib_sounds
	geta[].htang TEMP2
	eshoot SPELL8
	seta[RETURN].ang TEMP2
	}
}
else
ife BULLET_HIT_TYPE 3790 // Ninja Star 2
{
ifdead
	{
	state jib_sounds
	geta[].htang TEMP2
	eshoot 3790
	seta[RETURN].ang TEMP2
	}
}
else
ife BULLET_HIT_TYPE 14509 // Dart (above water)
{
stopsound METALCLINK
sound NAIL_HITBOD
}
else
ife BULLET_HIT_TYPE 14510 // Dart (underwater)
{
stopsound METALCLINK
sound NAIL_HITBOD
}
else
ife BULLET_HIT_TYPE 6826 // Nail Guns
{
stopsound METALCLINK
sound NAIL_HITBOD
geta[].htang TEMP2
eshoot 6826
seta[RETURN].ang TEMP2
}
else
ife BULLET_HIT_TYPE 6816 // Enchanted Nails
{
stopsound METALCLINK
sound NAIL_HITBOD
geta[].htang TEMP2
eshoot 6826
seta[RETURN].ang TEMP2
}
else
ife BULLET_HIT_TYPE 19 // Dragon Slayer
{
stopsound DRAGONSLAYERHIT
spawn BLOOD 
spawn BLOOD 
spawn BLOOD 
guts JIBS6 1
sound DRAGONSLAYERHB
ifdead
	{
	state jib_sounds
	geta[].htang TEMP2
	eshoot 19
	seta[RETURN].ang TEMP2
	setthisprojectile[RETURN].range 3
	}
}
else
ife BULLET_HIT_TYPE 5125 // slug
{
sound HITFLESH
sound HITFLESH
sound HITFLESH
sound HITFLESH
sound HITFLESH
ifdead
	{
	state jib_sounds
	geta[].htang TEMP2
	eshoot 5125
	seta[RETURN].ang TEMP2
	}
}
else
ife BULLET_HIT_TYPE 6273 // ANIMAL TRANSFORMATION SPELL
	{
	ifactor APLAYER
		{
			ifg P_SPIRIT_ARMOUR 0
			{
				sub P_SPIRIT_ARMOUR 50 
				seta[].htextra -1 
				palfrom 20 0 0 40
				soundonce SPARM_PROTECT
				ifl P_SPIRIT_ARMOUR 0 set P_SPIRIT_ARMOUR 0
			}
			else 
			{
			addphealth -1000
			}
		}
		else
		{
		  ifactor BOSS1 ifspritepal 0 break
		  ifactor BOSS2 ifspritepal 0 break
		  ifactor BOSS3 ifspritepal 0 break
		  ifactor BOSS4 ifspritepal 0 break
		  ifactor BOSS5 ifspritepal 0 break
		  ifactor SERPENT_GOD ifspritepal 0 break
		  ifactor BRUISER ifspritepal 24 break
		  ifactor DOCTORJ break
		  ifactor MISTERH break
		  ifactor BOSS1
				ifn XVELSAVED 0 
						{
						operateactivators XVELSAVED THISACTOR
						operatemasterswitches XVELSAVED
						operaterespawns XVELSAVED
						set XVELSAVED 0
						}
		  ifactor COMMANDER 		 		
			ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
			  ifactor CULTIST
				{
				ifn YVELSAVED 0 espawnvar YVELSAVED
				}
		ifactor PIGCOP spawn PIG else spawn 6283
		globalsound TRANSFORM
		espawn EXPLOSION2
		seta[RETURN].pal 17
		ifactor CULTIST { ifn YVELSAVED 0 espawnvar YVELSAVED }
		addkills 1
		state thegames_score
		killit
		}
	}
else
ife BULLET_HIT_TYPE 6272 // OBJECT TRANSFORMATION SPELL
	{
	ifactor APLAYER
		{
			ifg P_SPIRIT_ARMOUR 0
			{
				sub P_SPIRIT_ARMOUR 50 
				seta[].htextra -1 
				palfrom 20 0 0 40
				soundonce SPARM_PROTECT
				ifl P_SPIRIT_ARMOUR 0 set P_SPIRIT_ARMOUR 0
			}
			else 
			{
			addphealth -1000
			}
		}
	else
		{
		  ifactor BOSS1 ifspritepal 0 break
		  ifactor BOSS2 ifspritepal 0 break
		  ifactor BOSS3 ifspritepal 0 break
		  ifactor BOSS4 ifspritepal 0 break
		  ifactor BOSS5 ifspritepal 0 break
		  ifactor SERPENT_GOD ifspritepal 0 break
		  ifactor BRUISER ifspritepal 24 break
		  ifactor SHAMBLER break
		  ifactor DOCTORJ break
		  ifactor MISTERH break
	  ifactor BOSS1
	     	ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
		ifactor COMMANDER 		 		
			ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
			ifactor CULTIST
				{
				ifn YVELSAVED 0 espawnvar YVELSAVED
				ifrnd 96 { espawn 8045 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 96 { espawn 8046 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 96 { espawn 8047 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 96 { espawn 8048 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				{ espawn 8049 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 }
				}
			else
			ifactor ZSCIEN
				{
				ifrnd 96 { espawn 8131 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 seta[RETURN].pal 22 } else
				ifrnd 96 { espawn 8127 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 seta[RETURN].pal 22 } else
				ifrnd 96 { espawn 8129 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 seta[RETURN].pal 22 } else
				ifrnd 96 { espawn 8132 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				{ espawn 8133 seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 }
				}
				else
				{
				ifrnd 32 { espawn HATRACK seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 32 { espawn DESKLAMP seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 32 { espawn COFFEEMACHINE seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 32 { espawn TEDDYBEAR seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 32 { espawn TRIPODCAMERA seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 32 { espawn GUMBALLMACHINE seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				ifrnd 32 { espawn BROOM seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 } else
				{ espawn MOP seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32 }
				}
		globalsound TRANSFORM
		espawn EXPLOSION2
		seta[RETURN].pal 17
		addkills 1
		state thegames_score
		killit
		}
		}
else
ife BULLET_HIT_TYPE 6857 // Pulse rifle
{
ifdead
	{
	ifactor BOSS1 break
	ifactor BOSS2 break
	ifactor BOSS3 break 
	ifactor BOSS4 break
	ifactor BOSS5 break
	ifactor SERPENT_GOD break
	ifactor DOCTORJ break
    ifactor MISTERH break
      ifactor LIZTROOP state troop_body_jibs
	ifactor CULTIST { ifn YVELSAVED 0 espawnvar YVELSAVED }
	  ifactor BOSS1
	     	ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
		ifactor COMMANDER 		 		
			ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
	espawn EXPLOSION2 
	seta[RETURN].pal 2 
	hitradius 2048 16 32 64 96
	sound PULSE_EX
	seta[RETURN].xrepeat 60 
	seta[RETURN].yrepeat 60
	state standard_jibs
	palfrom 20 20
	state thegames_score
	ifactor APLAYER nullop else killit
	}
}
else 
ife BULLET_HIT_TYPE 6276 // UNMAKER
{
addphealth 1
ifdead
	{
	ifactor APLAYER { geta[].htowner TEMP7 geta[TEMP7].extra TEMP8 add TEMP8 50 seta[TEMP7].extra TEMP8 } else
		{
		ifactor BOSS1
		{ addphealth 100 ifspritepal 0 ife VOLUME 0 ife LEVEL 7 endofgame 52 } else 
		ifactor BOSS2
		{ addphealth 100 ifspritepal 0 ife VOLUME 0 ife LEVEL 7 endofgame 52 } else 
		ifactor BOSS3
		{ addphealth 100 ifspritepal 0 ife VOLUME 0 ife LEVEL 7 endofgame 52 } else 
		ifactor BOSS4
		{ addphealth 100 ifspritepal 0 ife VOLUME 0 ife LEVEL 7 endofgame 52 } else 
		addphealth 20
	      ifactor LIZTROOP state troop_body_jibs
		state standard_jibs
		globalsound UNMADE
		addkills 1
		ifactor CULTIST { ifn YVELSAVED 0 espawnvar YVELSAVED }
	  ifactor BOSS1
	     	ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
		 ifactor COMMANDER 		 		
			ifn XVELSAVED 0 
					{
					operateactivators XVELSAVED THISACTOR
					operatemasterswitches XVELSAVED
					operaterespawns XVELSAVED
					set XVELSAVED 0
					}
		espawn SKULLEXPLOSION seta[RETURN].pal 2
		state thegames_score
		ifactor SERPENT_GOD nullop else
		killit
		}
	}
}
ends

// ======================================================================================================================
// ENEMY EXTERNAL FILES
// ======================================================================================================================
include CODE/ENEMY/AMC_ALTJS.CON // ?????
include CODE/ENEMY/AMC_BEYONDBRAIN.CON // Beyonder
include CODE/ENEMY/AMC_COBRA.CON // Egypt Cobra
include CODE/ENEMY/AMC_GORILLA.CON // Gorilla (meaning RAINF.map boys)
include CODE/ENEMY/AMC_HPOWERSUIT.CON // Heavy Powersuit (e.g. CNC.map in the construction yard)
include CODE/ENEMY/AMC_FASCIST.CON // Revolution & CNC boys
include CODE/ENEMY/AMC_MJ12TROOP.CON // MJ12 TROOPER
include CODE/ENEMY/AMC_PATCOS.CON // PATCOS specific code
include CODE/ENEMY/AMC_PEELDER.CON // Paradigm Eschaton Elder
include CODE/ENEMY/AMC_PEGRUNT.CON // Paradigm Eschaton Grunt
include CODE/ENEMY/AMC_SPACELIZTROOP.CON // Charon spaceliztroop

// ************************************************************************************
// LIZTROOP CODE
// ************************************************************************************

defstate drop_ammo
  ifrnd SPAWNAMMOODDS
	{
    spawn AMMO
	}
ends


action ATROOPSTAND     0  1  5  1  1
action ATROOPGROW    0  1  5  1  1
action ATROOPSTAYSTAND  -2  1  5  1  1
action ATROOPWALKING   0  4  5  1   12
action ATROOPWALKINGBACK 15   4  5   -1   12
action ATROOPRUNNING   0  4  5  1  8
action ATROOPSHOOT    35  1  5  1   30
action ATROOPJETPACK  40  1  5  1  1
action ATROOPJETPACKILL 40  2  5  1   50
action ATROOPFLINTCH  50  1  1  1  6
action ATROOPHDYING 28 5 1 1 16
action ATROOPHDEAD 32
action ATROOPDYING    50  5  1  1   16
action ATROOPDEAD     54
action ATROOPPLAYSUFFERDEAD 84  2  1   1   24
action ATROOPPLAYSUFFERING  85  2  1  1   21
action ATROOPPLAYDEAD   80
action ATROOPSUFFERDEAD 58  2  1   1   24
action ATROOPSUFFERING  59  2  1  1   21
action ATROOPDUCK     64  1  5  1  3
action ATROOPDUCKSHOOT  64  2  5  1   25
action ATROOPABOUTHIDE  74  1  1  1   25

action ATROOP_ENG_TRY_DRONE 74 1 1 1 25
action ATROOP_ENG_SPAWN_DRONE 75 1 1 1 25

action ATROOPHIDE     75  1  1  1   25
action ATROOPREAPPEAR   74  1  1  1   25
action ATROOPFROZEN    0  1  5

move TROOPWALKVELS 72
move TROOPWALKVELSBACK -72
move TROOPJETPACKVELS 64 -84
move TROOPJETPACKILLVELS 192 -38
move TROOPRUNVELS 108
move DONTGETUP
move SHRUNKVELS 32

ai AITROOPSEEKENEMY  ATROOPWALKING   TROOPWALKVELS seekplayer
ai AITROOPSEEKPLAYER ATROOPWALKING   TROOPWALKVELS seekplayer
ai AITROOPFLEEING  ATROOPWALKING   TROOPWALKVELS fleeenemy
ai AITROOPFLEEINGBACK ATROOPWALKINGBACK   TROOPWALKVELSBACK faceplayer
ai AITROOPDODGE    ATROOPWALKING   TROOPRUNVELS  dodgebullet
ai AITROOPSHOOTING   ATROOPSHOOT   STOP  faceplayer
ai AITROOPDUCKING  ATROOPDUCK    STOP  faceplayer
ai AITROOPJETPACK  ATROOPJETPACK   TROOPJETPACKVELS seekplayer
ai AITROOPSHRUNK   ATROOPWALKING   SHRUNKVELS fleeenemy
ai AITROOPHIDE     ATROOPABOUTHIDE STOP faceplayer

ai AITROOP_SPAWNDRONE ATROOP_ENG_TRY_DRONE STOP faceplayer
ai AITROOP_TRIGGERTOOL ATROOP_ENG_TRY_DRONE STOP faceplayer

ai AITROOPGROW     ATROOPGROW    DONTGETUP faceplayerslow

defstate troop_drone_state
ifaction ATROOP_ENG_SPAWN_DRONE
{
			geta[].x TEMP
			geta[].y TEMP2
			set TEMP3 TEMP
			add TEMP3 1024
			randvar TEMP4 2048
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			updatesector TEMP5 TEMP6 TEMP7
			ifn TEMP7 -1
			 ifg ALLY_MAG 0
				{
				espawn DRONE
				seta[RETURN].pal 24
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				geta[].z TEMP8
				sub TEMP8 1754
				seta[RETURN].z TEMP8
				espawn TRANSPORTERBEAM
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				geta[].z TEMP8
				sub TEMP8 2048
				seta[RETURN].z TEMP8
				sub ALLY_MAG 1
				}
ai AITROOPSEEKENEMY
}
else
    ifaction ATROOP_ENG_TRY_DRONE
      ifactioncount 2
    {
      action ATROOP_ENG_SPAWN_DRONE
    }
ends

defstate troop_tool_state
ifg P_HAS_SHIELD 0 // player has energy shield?
ifg P_ENERGYSHIELD 0
	{
	ifaction ATROOP_ENG_SPAWN_DRONE
		{
		sound SHORT_CIRCUIT
		palfrom 4 64 64
		sub P_ENERGYSHIELD TEMP6
		ifl P_ENERGYSHIELD 1
			{
			sound ESHIELD_BREAK
			palfrom 16 64 64
			set P_ENERGYSHIELD 0
			}
		set P_REC_DELAY 450
	ai AITROOPSEEKENEMY
		}
		else
			ifaction ATROOP_ENG_TRY_DRONE
			  ifactioncount 2
			{
			  action ATROOP_ENG_SPAWN_DRONE
			}
	}
else
ifand GUN_AMMO_TYPES 1024 
{
	ifaction ATROOP_ENG_SPAWN_DRONE
	{
	sound SHORT_CIRCUIT
	palfrom 10 0 40 0
	wackplayer
	set TEMP9 GUN_HEAT[CURWEAP]
	add TEMP9 200
	setarray GUN_HEAT[CURWEAP] TEMP9
	ai AITROOPSEEKENEMY
	}
	else
		ifaction ATROOP_ENG_TRY_DRONE
		  ifactioncount 2
		{
		  action ATROOP_ENG_SPAWN_DRONE
		}
}
else ai AITROOPSHOOTING
ends

defstate troophidestate
  ifaction ATROOPREAPPEAR
  {
    ifactioncount 2
    {
	  spawn SHOOTME
      sound SOMETHINGHITFORCE
      ai AITROOPSHOOTING
      cstat 257
    }
    else
    {
      sizeto 41 40
      sizeto 41 40
      sizeto 41 40
      sizeto 41 40
      spawn FRAMEEFFECT1
    }
  }
  else
    ifaction ATROOPWALKING
  {
    ifpdistl 2448
      ifpdistg 1024
    {
      ifceilingdistl 48
        break
      ifp pfacing
        break

      ifgapzl 64 nullop
      else
        ifawayfromwall
      {
        spawn TRANSPORTERSTAR
        action ATROOPREAPPEAR
        move 0
        break
      }
    }
  }
  else
    ifaction ATROOPHIDE
  {
    ifactioncount 2
    {
      spawn TRANSPORTERSTAR
      sound SOMETHINGHITFORCE
      action ATROOPWALKING
      move TROOPWALKVELS faceplayer
      cstat 32768
	  ifspritepal 10
	   ife camerasprite -1
		{
			getp[].posx TEMP
			getp[].posy TEMP2
			set TEMP3 TEMP
			add TEMP3 1024
			randvar TEMP4 2048
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			updatesector TEMP5 TEMP6 TEMP7
			ifn TEMP7 -1
				{
				seta[].x TEMP5 
				seta[].y TEMP6
				getp[].posz TEMP8
				spawn TRANSPORTERSTAR
				sub TEMP8 1754
				seta[].z TEMP8
				}
		}
    }
    else
    {
      sizeto 4 40
      sizeto 4 40
      sizeto 4 40
      sizeto 4 40
      spawn FRAMEEFFECT1
    }
  }
  else
    ifaction ATROOPABOUTHIDE
      ifactioncount 2
    {
      ifspritepal 3 
		{ 
		spawn EXPLOSION2
		sound LASERTRIP_ARMING
		globalsound LASERTRIP_EXPLODE
		hitradius 4048 10 60 100 150
		addkills 1
		state thegames_score
		state squish_sounds
		state troop_body_jibs
		state standard_jibs
		killit
		} 
		else
		{
      action ATROOPHIDE
      cstat 0
	    }
    }
ends


defstate troopgunnashoot
  ifp palive
  {
    ifpdistl 1024
      ai AITROOPSHOOTING
    else
      ifactornotstayput
    {
	state SKILL_SHOOT_LEVELADJUST
      ifactioncount 12
        ifl RANDOM_CHANCE SKILLCHANCE
          ifcanshoottarget
      {
        ifspritepal 23 ifrnd 4 ifpdistg 4096 ai AITROOPHIDE
        else ifspritepal 3 ifpdistl 4096 ai AITROOPHIDE
        else ifspritepal 10 ifrnd 16 ifpdistg 4096 ai AITROOPHIDE
        else ifspritepal 21 ifrnd 4 ifpdistg 4096 ai AITROOPHIDE
        else ifspritepal 12 ifrnd 4 ifpdistg 4096 ai AITROOPHIDE
		else ifspritepal 49 
			{
			ifrnd 16 ifpdistg 4096 ai AITROOP_SPAWNDRONE
			else ifrnd 32 ifpdistl 16392 ai AITROOP_TRIGGERTOOL
			}
        else
        {
          ifpdistl 1100
            ai AITROOPFLEEING
          else
          {
		  state correctcansee
            ifpdistl 4096
              ife sightvar YES
                ifcanshoottarget
      ai AITROOPSHOOTING
            else
            {
              move TROOPRUNVELS seekplayer
              action ATROOPRUNNING
            }
          }
        }
      }
    }
    else
	 {
	 state SKILL_SHOOT_LEVELADJUST
      ifcount 26
        ifl RANDOM_CHANCE SKILLCHANCE
      ai AITROOPSHOOTING
	  }
  }
ends

defstate troopseekstate
  state troopgunnashoot
  ifinwater
  {
    ai AITROOPJETPACK
    break
  }
  ifcansee
  {
		  
		geta[].htmovflag TEMP
		ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
		{
				 andvar TEMP 49152
				 ife TEMP 32768 // the actor is pushing on a wall
				 {
				   geta[].htmovflag TEMP2 // need to get the info again
				   andvar TEMP2 16383 // temp now stores the wall number
						   getwall[TEMP2].nextsector sect
						   ifn sect -1
						   {
						   ifand wall[TEMP2].cstat 1 break
						   ife sector[sect].lotag 20 operate
						   ife sector[sect].lotag 21 operate
						   ife sector[sect].lotag 22 operate
						   ife sector[sect].lotag 23 operate
							  ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
								{
								ai AITROOPJETPACK
								}
							}
				  }
		}
  
  
    ifmove TROOPRUNVELS
      ifpdistl 1596
        ai AITROOPDUCKING
    ifp phigher
    {
      ifceilingdistl 128 nullop
      else
        ifactornotstayput
          ai AITROOPJETPACK
      break
    }
    else
      ifrnd 4
    {

      ifspritepal 21
        ifpdistg 1596
      {
        ai AITROOPHIDE
        break
      }
      ifspritepal 3 ifpdistl 1596 { ai AITROOPHIDE break }
      ifspritepal 10 ifpdistg 1596 { ai AITROOPHIDE break }
      ifspritepal 23 ifpdistg 1596 { ai AITROOPHIDE break }
	  ifspritepal 49 ifrnd 16 ifpdistg 4096 ai AITROOP_SPAWNDRONE
	  ifspritepal 49 ifrnd 32 ifpdistl 16384 ai AITROOP_TRIGGERTOOL
      ifbulletnear
      {
        ifrnd 128
          ai AITROOPDODGE
        else
          ai AITROOPDUCKING
        break
      }
    }
  }
  ifnotmoving
  {
  state correctcansee
    ifrnd 32
      operate
    else
      ifcount 32
        ifp palive
          ife sightvar YES
            ifcanshoottarget
      ai AITROOPSHOOTING
  }
  ifrnd 1
  {
  ifspritepal 4 nullop else 
  ifspritepal 200 
    {
	ifrnd 128 soundonce ZOMBIE_ROAM1
	else ifrnd 128 soundonce ZOMBIE_ROAM2
	else soundonce ZOMBIE_ROAM3
	}
	else
  ifspritepal 41 // IW Gimpy
    {
	ifrnd 64 soundonce ZSOLD_ROAM 
	}
	else
	{ 
	ifrnd 128 { soundonce PRED_ROAM ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR PRED_ROAM 512 }
	else { soundonce PRED_ROAM2 ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR PRED_ROAM2 512 }
	}
  }
ends

defstate troopduckstate
  ifaction ATROOPDUCK
  {
    ifactioncount 8
    {
      ifp palive
      {
        ifrnd 128
          action ATROOPDUCKSHOOT
      }
      else
        ifmove DONTGETUP
          break
        else
          ai AITROOPSEEKPLAYER
    }
  }
  else
    ifaction ATROOPDUCKSHOOT
  {
    ifcount 64
    {
      ifmove DONTGETUP
        resetcount
      else
      {
        ifpdistl 1100
          ai AITROOPFLEEING
        else
          ai AITROOPSEEKPLAYER
      }
    }
    else
      ifactioncount 2
      {
        ifcanshoottarget
        {
          resetactioncount
		state shooting_settings
		ifn target -1
			{
			ifspritepal 16 { sound PISTOL_FIRE shoot 13772 ezshoot TEMP3 ARMOUR_PIERCING_SHOT } else 
			ifspritepal 49 { sound TURR_ATTACK ezshoot TEMP3 5394 } else
			ifspritepal 35 { sound FIREBALL_FIRE ezshoot TEMP3 BRUISERFIREBALL } else
		  ifspritepal 20 { sound SHORT_CIRCUIT ezshoot TEMP3 SPELL9 } else
			ifspritepal 23 { sound CAT_FIRE ezshoot TEMP3 FREEZEBLAST } else { sound PRED_ATTACK ezshoot TEMP3 FIRELASER }
			}
		else
			{
			ifspritepal 16 { sound PISTOL_FIRE shoot 13772 shoot ARMOUR_PIERCING_SHOT } else 
			ifspritepal 49 { sound TURR_ATTACK shoot 5394 } else
			ifspritepal 35 { sound FIREBALL_FIRE shoot BRUISERFIREBALL } else
		    ifspritepal 20 { sound SHORT_CIRCUIT shoot SPELL9 } else
			ifspritepal 23 { sound CAT_FIRE shoot FREEZEBLAST } else { sound PRED_ATTACK shoot FIRELASER }
			}
        }
        else ai AITROOPSEEKPLAYER
      }
  }
ends

defstate troopshootstate
  ifactioncount 2
  {
    ifcanshoottarget
    {    
	state shooting_settings
		
		
	ifn target -1
			{
			ifspritepal 16 { sound PISTOL_FIRE ezshoot TEMP3 ARMOUR_PIERCING_SHOT shoot 13772 } else 
			ifspritepal 49 { sound TURR_ATTACK ezshoot TEMP3 5394 } else
			ifspritepal 35 { sound FIREBALL_FIRE ezshoot TEMP3 BRUISERFIREBALL } else
		  ifspritepal 20 { sound SHORT_CIRCUIT ezshoot TEMP3 SPELL9 } else
			ifspritepal 23 { sound CAT_FIRE ezshoot TEMP3 FREEZEBLAST } else
			{ sound PRED_ATTACK ezshoot TEMP3 FIRELASER }
			}
		else
			{
			ifspritepal 16 { sound PISTOL_FIRE shoot ARMOUR_PIERCING_SHOT shoot 13772 } else 
			ifspritepal 49 { sound TURR_ATTACK shoot 5394 } else
			ifspritepal 35 { sound FIREBALL_FIRE shoot BRUISERFIREBALL } else
		  ifspritepal 20 { sound SHORT_CIRCUIT shoot SPELL9 } else
			ifspritepal 23 { sound CAT_FIRE shoot FREEZEBLAST } else
			{ sound PRED_ATTACK shoot FIRELASER }
			}
		

		
      resetactioncount
      ifrnd 128
        ai AITROOPSEEKPLAYER
      ifcount 24
      {
        ifrnd 96
          ifpdistg 2048
            ai AITROOPSEEKPLAYER
          else
          {
            ifpdistg 1596
              ai AITROOPFLEEING
            else
              ai AITROOPFLEEINGBACK
          }
      }
    }
    else
      ife target -1 ai AITROOPSEEKPLAYER
  }
ends

defstate troopfleestate
  ifactioncount 7
  {
  state SKILL_SHOOT_LEVELADJUST
    ifpdistg 3084
    {
      ai AITROOPSEEKPLAYER
      break
    }
    else
      ifl RANDOM_CHANCE SKILLCHANCE
        ifp palive
          ifcansee
            ifcanshoottarget
      {
        ifrnd 128
          ai AITROOPDUCKING
        else
      ai AITROOPSHOOTING
          break
      }
  }
  ifnotmoving
  {
    ifrnd 32
      operate
    else
      ifcount 32
        ifp palive
          ifcansee
            ifcanshoottarget
      {
        ifrnd 128
      ai AITROOPSHOOTING
        else
          ai AITROOPDUCKING
      }
  }
ends

defstate troopdying
cstat 0

ifspritepal 27 
	{ 
	ifrnd 8 { shoot SPARK espawn BIG_SMOKE seta[RETURN].pal 17 }
	seta[].shade 20
	}


  iffloordistl 32
  {
  
  	ifg FIRE_DAMAGE 0
		{
		sound ENGULF_FIRE
		spritepal 27
		spriteflags 5
		seta[].shade 20
		set FIRE_DAMAGE 0
		}
  
    ifactioncount 5
    {
      //cstat 0
      iffloordistl 8
      state BODY_FALL_NOISES
      ifrnd 64
        spawn BLOODPOOL
      state rf
      strength 0
      move STOP
      action ATROOPDEAD
    }
    break
  }
  else
  {
    state rf
    move 0
	
    action ATROOPDYING
  }
ends

defstate troophdying
cstat 0
  iffloordistl 32
  {
    ifactioncount 5
    {
      //cstat 0
      iffloordistl 8
      state BODY_FALL_NOISES
      ifrnd 64
        spawn BLOODPOOL
      state rf
      strength 0
      move STOP
      action ATROOPHDEAD
    }
    break
  }
  else
  {
    state rf
    move 0
    action ATROOPHDYING
  }
ends

defstate checktroophit
state NEWGUNEFFECTS
//spawn BLOOD
ifrnd 192 guts JIBS6 2
  ifaction ATROOPSUFFERING
  {
    stopsound LIZARD_BEG
	ife HEADSHOT 1
		{
		action ATROOPHDEAD
		guts JIBS6 6
		ifrnd 32 state trigger_showoff
		sound DECAPITATE
		}
		else
		{
		action ATROOPDEAD
	    ifspritepal 10 sound CAPT_DYING else sound PRED_DYING
		}
    //cstat 0
    state rf
    strength 0
    break
  }
  ifaction ATROOPPLAYSUFFERING
  {
    stopsound LIZARD_BEG
	ife HEADSHOT 1
		{
		action ATROOPHDEAD
		guts JIBS6 6
		ifrnd 32 state trigger_showoff
		sound DECAPITATE
		}
		else
		{
		action ATROOPDEAD

	    ifspritepal 10 { soundonce CAPT_DYING ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR CAPT_DYING 256 }
		else { soundonce PRED_DYING ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR PRED_DYING 512 }
		}
    //cstat 0
    state rf
    strength 0
    break
  }
  ifdead
  {
  
  	ifg FIRE_DAMAGE 0
		{
		spritepal 27
		spriteflags 5
		seta[].shade 20
		}
  
    ifg ICE_DAMAGE 0
    {
      sound SOMETHINGFROZE
      ifspritepal 1 nullop else spritepal 1
      move 0
      action ATROOPFROZEN
      strength 0
      break
    }

    ifspritepal 16
	{
	ifrnd 64
	 	{
		switch CHAR
		case 0
		case 3
		case 7
		 spawn FIRSTGUNSPRITE
		 break
		default
		 break
		endswitch
	 	}
	else
    state drop_ammo
	}

    state random_wall_jibs

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AITROOPGROW
      break
    }

    addkills 1
	state thegames_score

    ifwasweapon RPG
    {
      state squish_sounds
      state troop_body_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state troop_body_jibs
      state standard_jibs
      killit
    }
    else
    {
	ife HEADSHOT 2
		 {
		  ifrnd 32 state trigger_showoff
		  sound DECAPITATE
		  state jib_sounds
		  guts JIBS6 4
		  guts JIBS2 2
		  guts JIBS5 1
		  action ATROOPHDYING
		 }
	 else
	 {
		ifspritepal 200 sound ZOMBIE_DIE2
		else ifspritepal 41 sound ZSOLD_DIE1
	    else ifspritepal 10 { sound CAPT_DYING ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR CAPT_DYING 512 } 
		else { sound PRED_DYING ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR PRED_DYING 512 }
	      ifrnd 64
		   ifg sprite[].extra -50
	        iffloordistl 32
	      {
			sound LIZARD_BEG
			ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR LIZARD_BEG 512
	        spawn BLOODPOOL
	        strength 0
	        move 0
	        ifrnd 128 action ATROOPSUFFERING else 
				{ 
				ifonwater action ATROOPSUFFERING 
				else ifg FIRE_DAMAGE 0 action ATROOPSUFFERING
				else action ATROOPPLAYSUFFERING 
				}
	        break
	      }
		  
		ifphealthl 50
		{
		ifspritepal 10
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn 18682
			}
		else
		ifspritepal 49
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn 18682
			}
		}
		  
	      action ATROOPDYING
	      break
	    }
	}
  }
  else
  {
    state random_wall_jibs
	ifspritepal 200 set playsound ZSCI_PAIN else
	ifspritepal 41 set playsound ZSCI_PAIN else
    ifspritepal 10 set playsound CAPT_PAIN else ifspritepal 4 set playsound 4 else
		{
		ifrnd 128 set playsound PRED_PAIN2
		else set playsound PRED_PAIN
		}
		soundvar playsound 
		ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR playsound 512

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AITROOPSHRUNK
    }
    else
      ifwasweapon GROWSPARK
        sound EXPANDERHIT
    else
      iffloordistl 32
        ifg PAIN_AMOUNT 0
          action ATROOPFLINTCH
    else
      iffloordistl 32
        ifrnd 96
			{
			state PAIN_SKILL_LEVELADJUST
            action ATROOPFLINTCH
			}
  }
ends

defstate troopjetpackstate
  ifaction ATROOPJETPACKILL
  {
    ifcansee
      ifactioncount 2
    {
	
	ifrnd 32
		{
		state enemyfindtarget
		state shoot_target
		}
      resetactioncount
	  
        ifspritepal 16 { sound PISTOL_FIRE shoot 13772 ezshoot TEMP3 SHOTSPARK1 } else 
        ifspritepal 49 { sound TURR_ATTACK ezshoot TEMP3 5394 } else
		ifspritepal 35 { sound FIREBALL_FIRE ezshoot TEMP3 BRUISERFIREBALL } else
	  ifspritepal 20 { sound SHORT_CIRCUIT ezshoot TEMP3 SPELL9 } else
        ifspritepal 23 { sound CAT_FIRE ezshoot TEMP3 FREEZEBLAST } else
        { sound PRED_ATTACK ezshoot TEMP3 FIRELASER }
    }

    ifp phigher
      ai AITROOPJETPACK
    else
      ifinwater
        ai AITROOPJETPACK
    else
      ifcount 26
        iffloordistl 32
          ai AITROOPSEEKPLAYER
  }
  else
    ifcount 48
      ifcansee
  {
    action ATROOPJETPACKILL
    move TROOPJETPACKILLVELS
    seekplayer
  }
ends


defstate troopsufferingstate
  ifactioncount 2
  {
    ifrnd 16
      spawn WATERDRIP
    ifactioncount 14
    {
      stopsound LIZARD_BEG
      cstat 0
      strength 0
      action ATROOPSUFFERDEAD
      break
    }
  }
ends

defstate troopplaysufferingstate
    ifactioncount 14
    {
      stopsound LIZARD_BEG
      cstat 0
      strength 0
      action ATROOPPLAYSUFFERDEAD
      break
    }
ends

defstate troopshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AITROOPSEEKENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 48 40
	  }
  else
    state genericshrunkcode
ends


defstate troopcode fall

  ifinwater
    ifrnd 1
      spawn WATERBUBBLE
  ifaction ATROOPSTAND
  {
  ifspritepal 49 ai AITROOP_SPAWNDRONE
  else
    ifrnd 192
      ai AITROOPSHOOTING
    else
      ai AITROOPSEEKPLAYER
  }
  else
    ifaction ATROOPFROZEN
  {
    ifcount THAWTIME
    {
      ai AITROOPSEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
	   ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else ifaction ATROOPPLAYDEAD
  {
    ifhitweapon
    {

	state NEWGUNEFFECTS

      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished

    ifcount PLAYDEADTIME
    {
      addkills -1
      soundonce PRED_ROAM
      cstat 257
      strength 1
      ai AITROOPSHOOTING
    }
    else
      ifp pfacing
        resetcount

    break
  }
  else
    ifaction ATROOPDEAD
  {
    strength 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished
    break
  }
  else
    ifaction ATROOPHDEAD
  {
    strength 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished
    break
  }
  else
    ifaction ATROOPSUFFERDEAD
  {
    ifactioncount 2
    {
	ifspritepal 200 soundonce ZOMBIE_DIE1 else
	ifspritepal 41 soundonce ZSOLD_DIE1 else
        ifspritepal 10 soundonce CAPT_DYING else soundonce PRED_DYING
        action ATROOPDEAD
    }
  }
  else
    ifaction ATROOPPLAYSUFFERDEAD
  {
    ifactioncount 2
    {
        action ATROOPPLAYDEAD
    }
  }
  else
    ifaction ATROOPDYING
  {
  
  	ifg FIRE_DAMAGE 0
		{
		spritepal 27
		spriteflags 5
		seta[].shade 20
		}
  
    state troopdying
    break
  }
  else
    ifaction ATROOPHDYING
  {
    state troophdying
    break
  }
  else
    ifaction ATROOPSUFFERING
  {
    state troopsufferingstate
    ifhitweapon
      state checktroophit
    break
  }
  else
    ifaction ATROOPPLAYSUFFERING
  {
    state troopplaysufferingstate
    ifhitweapon
      state checktroophit
    break
  }
  else
    ifaction ATROOPFLINTCH
  {
   sub PAIN_AMOUNT 1
    ife PAIN_AMOUNT 0
      ai AITROOPSEEKENEMY
  }
  else
  {
    ifai AITROOPSEEKPLAYER
      state troopseekstate
    else
      ifai AITROOPJETPACK
    {
      state troopjetpackstate
      ifinwater nullop
      else
        soundonce RECO_ROAM
    }
    else
      ifai AITROOPSEEKENEMY
        state troopseekstate
    else
      ifai AITROOPSHOOTING
        state troopshootstate
    else
      ifai AITROOPFLEEING
        state troopfleestate
    else
      ifai AITROOPFLEEINGBACK
        state troopfleestate
    else
      ifai AITROOPDODGE
        state troopseekstate
    else
      ifai AITROOPDUCKING
        state troopduckstate
    else
      ifai AITROOPSHRUNK
        state troopshrunkstate
    else
      ifai AITROOPGROW
        state genericgrowcode
    else
      ifai AITROOPHIDE
    {
      state troophidestate
      break
    }
    else
      ifai AITROOP_SPAWNDRONE
    {
      state troop_drone_state
      break
    }
    else
      ifai AITROOP_TRIGGERTOOL
    {
      state troop_tool_state
      break
    }
  }

  ifhitweapon
    state checktroophit
  else
    state checksquished
ends

defstate checktrooppalette
  ifai 0
  {
    ifspritepal 0
        nullop
    else
        ifspritepal 3
          addstrength TROOPSTRENGTH // Double the hitpoint vals
    else
        ifspritepal 12
          addstrength TROOPSTRENGTH // Double the hitpoint vals
    else
        ifspritepal 49
		  {
		  set ALLY_MAG SKILL_LEVEL
          addstrength TROOPSTRENGTH // Double the hitpoint vals
		  }
    else
        ifspritepal 21
          addstrength TROOPSTRENGTH // Double the hitpoint vals
    else
        ifspritepal 10
          strength 150 
    else
        ifspritepal 35
          strength 125 
    else
        ifspritepal 20
          addstrength 25 
    else
        ifspritepal 23
          strength 75
	else
		ifspritepal 200
			{
			sizeat 28 28
			strength 200
			}
  }
ends

actor LIZTROOPJETPACK TROOPSTRENGTH
  state checktrooppalette
  state monst_glow
  spawn SHOOTME
  ai AITROOPJETPACK
  cactor LIZTROOP
enda

actor LIZTROOPDUCKING TROOPSTRENGTH
  state checktrooppalette
  state monst_glow
  spawn SHOOTME
  ai AITROOPDUCKING
  cactor LIZTROOP
  ifgapzl 48
    move DONTGETUP
enda

actor LIZTROOPSHOOT TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  state monst_glow
  spawn SHOOTME
  ai AITROOPSHOOTING
  cactor LIZTROOP
enda
actor LIZTROOPSTAYPUT TROOPSTRENGTH ATROOPSTAYSTAND
  state checktrooppalette
  state monst_glow
  spawn SHOOTME
  ai AITROOPSEEKPLAYER
  cactor LIZTROOP
enda
actor LIZTROOPRUNNING TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  state monst_glow
  spawn SHOOTME
  ai AITROOPSEEKPLAYER
  cactor LIZTROOP
enda
actor LIZTROOPONTOILET TROOPSTRENGTH
  ifcount 24
  {
  state monst_glow
    sound FLUSH_TOILET
	spawn SHOOTME
    operate
    ai AITROOPSEEKPLAYER
    cactor LIZTROOP
  }
  else
    ifcount 2
      nullop
  else
    state checktrooppalette
enda

actor LIZTROOPJUSTSIT TROOPSTRENGTH
  ifcount 30
  {
  state monst_glow
  spawn SHOOTME
    operate
    ai AITROOPSEEKPLAYER
    cactor LIZTROOP
  }
  else
    ifcount 2
      nullop
  else
    state checktrooppalette
enda


actor LIZTROOP TROOPSTRENGTH 

ifaction 0 
	{ 
	state monst_glow
	set command 8192
	spawn SHOOTME 
	action ATROOPSTAND
	ifspritepal 200 { stopsound PRED_RECOG ifrnd 128 soundonce ZSOLD_SIGHT else soundonce ZOMBIE_ROAM3 }
	ifspritepal 41 { stopsound PRED_RECOG soundonce ZSOLD_SIGHT }
	ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR PRED_RECOG 512  
	}

state ENEMYKNOCKBACKS
state enemyfloordamage
ifspritepal 35 nullop else state enemy_fire_damage
ifspritepal 23 nullop else state enemy_ice_damage
ifspritepal 41 nullop else state enemy_spirit_damage

  state checktrooppalette
  state troopcode
enda

// ************************************************************************************
// LIZMAN
// ************************************************************************************


action ALIZSTAND     0
action ALIZWALKING     0   4  5  1  15
action ALIZRUNNING     0   4  5  1  11
action ALIZTHINK     20  2  5  1  40
action ALIZSCREAM    30  1  5  1  2
action ALIZJUMP      45  3  5  1  20
action ALIZFALL      55  1  5
action ALIZSHOOTING    70  2  5  1  7
action ALIZDYING     60  6  1  1  15
action ALIZLYINGDEAD   65  1
action ALIZLYINGDEAD2 66 1
action ALIZLYINGDEAD_2 67 1
action ALIZLYINGDEAD2_2 68 1
action ALIZFROZEN     0  1  5

action ALIZHEADDIE   7324 6  1  1  15
action ALIZHEADDEAD  7329 1  1  1  1

move LIZWALKVEL 72
move LIZRUNVEL 192
move LIZJUMPVEL 184

ai AILIZGETENEMY ALIZWALKING LIZWALKVEL seekplayer
ai AILIZDODGE ALIZRUNNING LIZRUNVEL dodgebullet
ai AILIZCHARGEENEMY ALIZRUNNING LIZRUNVEL seekplayer
ai AILIZFLEENEMY ALIZWALKING LIZWALKVEL fleeenemy
ai AILIZSHOOTENEMY ALIZSHOOTING STOP faceplayer
ai AILIZJUMPENEMY ALIZJUMP LIZJUMPVEL jumptoplayer
ai AILIZTHINK ALIZTHINK STOP faceplayerslow
ai AILIZSHRUNK ALIZWALKING SHRUNKVELS fleeenemy
ai AILIZGROW ALIZSTAND  STOP faceplayerslow
ai AILIZSPIT ALIZSCREAM STOP faceplayerslow
ai AILIZDYING ALIZDYING STOP faceplayer
ai AILIZHDYING ALIZHEADDIE STOP faceplayer

state lizseekstate

  ifactornotstayput
  {
  state correctcansee
    ife sightvar YES
      ifp palive
        ifpdistl 2048
          ifcount 16
    {
	  sound MINIGUN_START
      ai AILIZSHOOTENEMY
      break
    }
    ifai AILIZCHARGEENEMY
    {
      ifcount 72
        ifcanshoottarget
      {
	    sound MINIGUN_START
        ai AILIZSHOOTENEMY
        break
      }
		geta[].htmovflag TEMP
		ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
		{
				 andvar TEMP 49152
				 ife TEMP 32768 // the actor is pushing on a wall
				 {
				   geta[].htmovflag TEMP2 // need to get the info again
				   andvar TEMP2 16383 // temp now stores the wall number
						   getwall[TEMP2].nextsector sect
						   ifn sect -1
						   {
						   ifand wall[TEMP2].cstat 1 break
						   ife sector[sect].lotag 20 operate
						   ife sector[sect].lotag 21 operate
						   ife sector[sect].lotag 22 operate
						   ife sector[sect].lotag 23 operate
							  ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
								{
								ai AILIZJUMPENEMY
								break
								}
							}
				  }
		}
    }
    else
      ifpdistg 4096
    {
      ifrnd 92
      {
        ifcount 48
          ifcanshoottarget
            { sound MINIGUN_START ai AILIZSHOOTENEMY }
      }
      else
        ifcount 24
      {
        ai AILIZCHARGEENEMY
        break
      }
    }

    iffloordistl 16
    {
      ifcount 48
        ifnotmoving
          ifcansee
      {
        ai AILIZJUMPENEMY
        break
      }
    }
    else
    {
      ifpdistg 1280
        ai AILIZJUMPENEMY
      break
    }

    ifrnd 4
      ifnotmoving
        operate
    else
      ifrnd 1
        ifbulletnear
    {
      ifgapzl 128
        ai AILIZDODGE
      else
        ifactornotstayput
      {
        ifrnd 32
          ai AILIZJUMPENEMY
        else
          ai AILIZDODGE
      }
    }
  }
  else
  {
    ifactioncount 16
    {
      ifp palive
        ifrnd 32
          ifcansee
            ifcanshoottarget
              { sound MINIGUN_START ai AILIZSHOOTENEMY }
    }
    ifcount 16
      ifrnd 32
        move LIZWALKVEL randomangle geth
  }

ends

state lizshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AILIZGETENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 48 40
	  }
  else
    state genericshrunkcode
ends

state lizfleestate
  ifcount 16
  {
    ifrnd 48
      ifp palive
        ifcansee
          ai AILIZSPIT
  }
  else
  {
    iffloordistl 16 nullop
    else
      ai AILIZGETENEMY
    break
  }
ends

state lizthinkstate
sizeat 40 30
  ifrnd 8
    soundonce CAPT_ROAM
  ifactioncount 3
  {
    ifrnd 32
      ifp palive
        ifcansee
		  {
		    sizeat 40 40
          ai AILIZSPIT
		  }
        else
          ifrnd 96
		    {
			sizeat 40 40
            ai AILIZGETENEMY
			}
  }
  else
    ifactioncount 2
      ifrnd 1
        spawn FECES
  ifrnd 64
    ifbulletnear
  {
  sizeat 40 40
    ifgapzl 96
      ai AILIZDODGE
    else
    {
      ifrnd 128
        ai AILIZJUMPENEMY
      else
        ai AILIZDODGE
    }
  }
ends

defstate lizshootstate
  ifcount 20
    ifrnd 8
  {
  state correctcansee
    ife sightvar YES
      ifpdistl 2048
    {
      ifrnd 128
        { sound MINIGUN_STOP ai AILIZFLEENEMY }
      break
    }
    ifrnd 80
      { sound MINIGUN_STOP ai AILIZTHINK }
    else
      { sound MINIGUN_STOP ai AILIZGETENEMY }
  }
  ifactioncount 2
  {
  state correctcansee
    ife sightvar YES
    {
	state shooting_settings
	ifspritepal 20 { sound SPELL1FIRE shoot SPELL1 } else
	ifspritepal 24 { sound PRED_ATTACK shoot FIRELASER } else
       { state SKILL_ENEMY_ACCURACY sound CAPT_ATTACK shoot CHAINGUN }
	   
		ife PERFMODE 1
		 

			{
			set gunsmoke_z 7844 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			set gunsmoke_z 4544
			espawn 16115
			state spawn_muzzleflash
			randvar TEMP 1024 
			zshoot TEMP RIFLESHELL 
			}
      resetactioncount
    }
    else
      { sound MINIGUN_STOP ai AILIZGETENEMY }
  }
ends

defstate checklizhit
state NEWGUNEFFECTS

  //spawn BLOOD
  ifrnd 192 guts JIBS6 2
  ifai AILIZSHRUNK
  {
    addkills 1
	state thegames_score
    state squish_sounds
    state standard_jibs
    killit
  }
  ifdead
  {
    ifg ICE_DAMAGE 0
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ALIZFROZEN
      strength 0
      break
    }

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AILIZGROW
      break
    }

    addkills 1
	state thegames_score

    ifwasweapon RPG
    {
      state squish_sounds
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
     ifwasweapon SHOTGUN
     ife HEADSHOT 2
	  ife FIRE_DAMAGE 0
    {
	 ifai AILIZHDYING break else ai AILIZHDYING
      sound DECAPITATE
      state jib_sounds
      guts LIZMANHEAD1 1
      state rf  
      ifrnd 64
        spawn BLOODPOOL
    }
    else
    {
	ifai AILIZDYING break else ai AILIZDYING
	
	  	ifg FIRE_DAMAGE 0
		{
		sound ENGULF_FIRE
		spritepal 27
		ifand sprite[].htflags 5 nullop else spriteflags 5
		seta[].shade 20
		}
	
      state rf
      ifrnd 64
        spawn BLOODPOOL
	    sound CAPT_DYING
    }
  }
  else
  {
    sound CAPT_PAIN
    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AILIZSHRUNK
      break
    }
    ifwasweapon GROWSPARK
      sound EXPANDERHIT

    state random_wall_jibs
	state correctcansee
    ifp palive
	ife sightvar YES
        ifcanshoottarget
    {
	ifaction ALIZTHINK sizeat 40 40
	ifaction ALIZSCREAM  sizeat 40 40
	  sound MINIGUN_START
      ai AILIZSHOOTENEMY
      break
    }
  }
ends

state lizjumpstate
  ifaction ALIZFALL
  {
    iffloordistl 16
      ai AILIZGETENEMY
  }
  else
    ifactioncount 3
      action ALIZFALL
ends

state lizdyingstate
  ifaction ALIZLYINGDEAD
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
  }
  else
  ifaction ALIZLYINGDEAD_2
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
  }
  else
  ifaction ALIZHEADDEAD
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
  }
  else
  ifaction ALIZLYINGDEAD2
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
  }
  else
  ifaction ALIZLYINGDEAD2_2
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
  }
  else
     ifai AILIZHDYING
      ifactioncount 6
  {
    iffloordistl 8
      state BODY_FALL_NOISES
    move STOP
    action ALIZHEADDEAD
	

	
  }
  else 
    ifai AILIZDYING
      ifactioncount 6
  {
    iffloordistl 8
      state BODY_FALL_NOISES
    move STOP
    ifrnd 96 
	 ifn CHAR 15
			{
			ifspritepal 24 spawn LIZMANFGUNSPRITE else
			spawn LIZMANGUNSPRITE
			ifrnd 128 action ALIZLYINGDEAD2_2 else action ALIZLYINGDEAD2
			}
			else { ifrnd 128 action ALIZLYINGDEAD_2 else action ALIZLYINGDEAD }

  }
ends

defstate lizdodgestate
  ifcount 13
    ai AILIZGETENEMY
ends

actor LIZMANSTAYPUT LIZSTRENGTH state monst_glow ai AILIZGETENEMY spawn SHOOTME cactor LIZMAN enda
actor LIZMANSPITTING LIZSTRENGTH state monst_glow ai AILIZSPIT spawn SHOOTME cactor LIZMAN enda
actor LIZMANJUMP LIZSTRENGTH state monst_glow ai AILIZJUMPENEMY spawn SHOOTME cactor LIZMAN enda

defstate lizcode
  state checksquished
  ifai 0
    { spawn SHOOTME ai AILIZGETENEMY }
  else
    ifaction ALIZLYINGDEAD
  {
    fall
    state lizdyingstate
    break
  }
  else
    ifaction ALIZLYINGDEAD2
  {
    fall
    state lizdyingstate
    break
  }
  else
    ifaction ALIZHEADDEAD
  {
    fall
    state lizdyingstate
    break
  }
  else
    ifaction ALIZFROZEN
  {
    ifcount THAWTIME
    {
      ai AILIZGETENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
	state NEWGUNEFFECTS
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
	  ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else
    ifai AILIZJUMPENEMY
      state lizjumpstate
  else
  {
    fall
    ifai AILIZGETENEMY
      state lizseekstate
    else
      ifai AILIZCHARGEENEMY
        state lizseekstate
    else
      ifai AILIZDODGE
        state lizdodgestate
    else
      ifai AILIZSHOOTENEMY
        state lizshootstate
    else
      ifai AILIZFLEENEMY
        state lizfleestate
    else
      ifai AILIZTHINK
        state lizthinkstate
    else
      ifai AILIZSHRUNK
        state lizshrunkstate
    else
      ifai AILIZGROW
        state genericgrowcode
    else
      ifai AILIZDYING
        state lizdyingstate
    else
      ifai AILIZHDYING
        state lizdyingstate
    else
      ifai AILIZSPIT
    {
	sizeat 40 30
      ifcount 26
	    {
		sizeat 40 40
        ai AILIZGETENEMY
		}
      else
        ifcount 18
          ifrnd 96
      {
        shoot SPIT
        sound LIZARD_SPIT
      }
    }
  }

  ifai AILIZSHRUNK
    break
  ifhitweapon
    state checklizhit
ends

actor LIZMAN LIZSTRENGTH
  fall
  
ifaction 0
{
state monst_glow
ifspritepal 24 strength 250
else ifspritepal 25 strength 200
}

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

  state lizcode
enda

// ************************************************************************************
// ROTATE GUN
// ************************************************************************************

action ASATNSPIN     0 5 1 1 4
action ASATSHOOTING   -10 3 5 1 40
action ASATWAIT      0 1 5 1 1
move TURRVEL

eventloadactor ROTATEGUN geta[].extra EXTRASAVED seta[].extra 0 enda

actor ROTATEGUN
// ASATSHOOTING TURRVEL faceplayer

  ifaction 0
  {
  ife EXTRASAVED 1 strength 150
  else strength ROTTURRETSTRENGTH
  spawn SHOOTME
    action ASATSHOOTING
    move TURRVEL faceplayer
  }
  else
    ifaction ASATNSPIN
  {
    ifactioncount 16
    {
      action ASATWAIT
      move TURRVEL faceplayer
    }
  }
  else
    ifaction ASATSHOOTING
  {
    ifactioncount 12
      ifrnd 8
    {
      action ASATWAIT
      move 0
    }
    ifcount 32
      resetcount
    else
      ifcount 16
    {
      ifcount 17 nullop
      else
      {
	  ife EXTRASAVED 1
		{
        sound ERPG_SHOOT
        shoot RPG
		}
		else
		{
        sound PRED_ATTACK
        shoot FIRELASER
		}
      }
    }
    else
      ifcount 4
    {
      ifcount 5 nullop
      else
      {
        ifcansee
          ifcanshoottarget
        {
		  ife EXTRASAVED 1
			{
	        sound ERPG_SHOOT
	        shoot RPG
			}
			else
			{
	        sound PRED_ATTACK
	        shoot FIRELASER
			}
        }
      }
    }
  }
  else
    ifaction ASATWAIT
  {
    ifactioncount 32
      ifrnd 32
        ifp palive
          ifcansee
    {
      action ASATSHOOTING
      move TURRVEL faceplayer
    }
  }
  ifhitweapon
  {
    ifdead
    {
      addkills 1
	  state thegames_score
      sound LASERTRIP_EXPLODE
      debris SCRAP1 15
      spawn EXPLOSION2
      killit
    }
    else
    {
      action ASATNSPIN
      debris SCRAP1 4
    }
    move 0
  }
enda

// ************************************************************************************
// ROTATE GUN 2
// ************************************************************************************

action ASAT2SHOOTING   0 2 5 1 40

useractor enemy 22877

  ifaction 0
  {
  cstator 256
  sizeat 40 40
  strength ROTTURRETSTRENGTH
  spawn SHOOTME
    action ASAT2SHOOTING
	move STOP faceplayer
  }
  else
    ifaction ASATNSPIN
  {
    ifactioncount 32
    {
      action ASATWAIT
      move STOP faceplayer
    }
  }
  else
    ifaction ASAT2SHOOTING
  {
    ifactioncount 12
      ifrnd 32
    {
      action ASATWAIT
      move 0
    }
    ifcount 32
      resetcount
    else
      ifcount 16
    {
      ifcount 17 nullop
      else
      {
        sound TURR_ATTACK 
		shoot 5394
      }
    }
    else
      ifcount 4
    {
      ifcount 5 nullop
      else
      {
        ifcansee
          ifcanshoottarget
        {
        sound TURR_ATTACK 
		shoot 5394
        }
      }
    }
  }
  else
    ifaction ASATWAIT
  {
    ifactioncount 64
      ifrnd 32
        ifp palive
          ifcansee
    {
      action ASAT2SHOOTING
      move STOP faceplayer
    }
  }
  ifhitweapon
  {
    ifdead
    {
      addkills 1
	  state thegames_score
      sound LASERTRIP_EXPLODE
      debris SCRAP1 15
      spawn EXPLOSION2
	  shoot SPARK shoot SPARK shoot SPARK shoot SPARK
      killit
    }
    else
    {
      action ASATNSPIN
      debris SCRAP1 4
    }
    move 0
  }
enda


// ************************************************************************************
// CANNONBALL for Pirates of the Carribean
// ************************************************************************************

define CANNONBALLSTRENGTH 400
move CANNONBALL1 512 0
move CANNONBALL2 512 10
move CANNONBALL3 512 20
move CANNONBALL4 512 40
move CANNONBALL5 512 80

useractor notenemy CANNONBALL CANNONBALLSTRENGTH

  ifaction 0
  {
    sizeat 32 32
    cstat 257         // Force actor to block
	move CANNONBALL1 geth getv
    action ZERO
  }

    ifactioncount 46
    {
      ifactioncount 47 nullop
      else
        move CANNONBALL5 geth getv
    }
    else
      ifactioncount 44
    {
      ifactioncount 45 nullop
      else
        move CANNONBALL4 geth getv
    }
    else
      ifactioncount 40
    {
      ifactioncount 41 nullop
      else
        move CANNONBALL3 geth getv
    }
    else
      ifactioncount 32
    {
      ifactioncount 33 nullop
      else
        move CANNONBALL2 geth getv
    }
    else
      ifactioncount 16
    {
      ifactioncount 17 nullop
      else move CANNONBALL1 geth getv
    }

  ifnotmoving
  {
    spawn EXPLOSION2
    sound PIPEBOMB_EXPLODE
    hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
    killit
  }

  ifhitweapon
  {
    ifdead
    {
      spawn EXPLOSION2
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      killit
    }
    else
      debris SCRAP1 3
  }

enda


define CANNONBALLS 1818
define CANNONBALLSSTRENGTH 10
move CANNONBALLSVEL

useractor notenemy CANNONBALLS CANNONBALLSSTRENGTH
  ifaction 0
  {
    cstator 257
    action ZERO
  }
  ifhitweapon
  {
    ifdead
    {
      spawn EXPLOSION2
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      killit
    }
    else
      debris SCRAP1 3
  }
enda


define CANNON 1810
define CANNONSTRENGTH 400
action ACANNONWAIT 0 1 7 1 1
action ACANNONSHOOTING 0 1 7 1 1
move CANNONSTOP

useractor enemy CANNON CANNONSTRENGTH // fall

  ifaction 0
  {
//    sizeat 64 64
    action ACANNONWAIT
  }
  else
    ifaction ACANNONSHOOTING
  {
    sound TANK_FIRE
    espawn CANNONBALL
	state SPAWN_IN_FRONT
	geta[RETURN].ang TEMP
	addvar TEMP 1024
	seta[RETURN].ang TEMP
	geta[RETURN].z TEMP
	subvar TEMP 3000
	seta[RETURN].z TEMP
    
	ifvare PERFMODE 1
		{
		espawn BIG_SMOKE2
		state SPAWN_IN_FRONT
		geta[RETURN].ang TEMP
		addvar TEMP 1024
		seta[RETURN].ang TEMP
		geta[RETURN].z TEMP
		subvar TEMP 3000
		seta[RETURN].z TEMP
		}
	action ACANNONWAIT
  }
  else
    ifaction ACANNONWAIT
  {
  ifspritepal 3 nullop else
    ifactioncount 64
    {
      ifrnd 128
        action ACANNONSHOOTING
      else
        resetactioncount
    }
  }

  ifhitweapon
  {
    ifdead
    {
      addkills 1
	  state thegames_score
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      spawn EXPLOSION2
      killit
    }
    else debris SCRAP1 3
  }
enda

// ************************************************************************************
// PROTOZOID EGG
// ************************************************************************************

action EGGOPEN1 1 1 1 1 4
action EGGOPEN2 2 1 1 1 4
action EGGOPEN3 2 1 1 1 4
action EGGWAIT  0
action EGGFROZEN 1
action EGGGROW 1
action EGGSHRUNK 1

actor EGG TOUGH
  fall
  state enemy_fire_damage
  ifaction 0
  {
    ifcount 64
    {
      ifrnd 128
      {
	  spawn SHOOTME
        action EGGWAIT
        move 0
      }
      else
      {
	  spawn SHOOTME
        sound SLIM_HATCH
        action EGGOPEN1
      }
    }
  }
  else
    ifaction EGGOPEN1
      ifactioncount 4
        action EGGOPEN2
  else
    ifaction EGGOPEN2
      ifactioncount 4
    {
      spawn GREENSLIME
      action EGGOPEN3
    }
  else
    ifaction EGGGROW
      state genericgrowcode
  else
    ifaction EGGSHRUNK
      state genericshrunkcode
  else
    ifaction EGGFROZEN
  {
    ifcount THAWTIME
    {
      action 0
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
	state NEWGUNEFFECTS
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      lotsofglass 30

      sound GLASS_BREAKING
      ifrnd 84
        spawn BLOODPOOL

      addkills 1
	  state thegames_score
	  ifg FIRE_DAMAGE 0
		{
		ifaction ONE nullop
		else
			{
			action ONE
			spritepal 4
			sizeto 0 0
			spawn FIRE2
			set PLAYER_VOICEOVER 21 
			}
		}
		else
      killit
    }

    // ifp pducking
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick

    break
  }

  ifhitweapon
  {
	state NEWGUNEFFECTS
    ifdead
    {
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action EGGFROZEN
        strength 0
        break
      }
      else
      ifwasweapon 7159
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action EGGFROZEN
        strength 0
        break
      }
      else
        ifwasweapon GROWSPARK
      {
        cstat 0
        move 0
        sound ACTOR_GROWING
        action EGGGROW
        break
      }

      addkills 1

      state squish_sounds

	spritepal 7
      state standard_jibs
      killit
    }
    else
      ifwasweapon SHRINKSPARK
      {
        move 0
        sound ACTOR_SHRINKING
        action EGGSHRUNK
        break
      }

      ifwasweapon GROWSPARK
        sound EXPANDERHIT
  }
  else
    ifaction EGGWAIT
  {
    ifcount 512
      ifrnd 2
    {
      ifaction EGGSHRUNK
        break
      sound SLIM_HATCH
      action EGGOPEN1
    }
  }

enda

// ************************************************************************************
// KAMIKAZE DRONE
// ************************************************************************************

action DRONEFRAMES   0   1   7   1   1
action DRONESCREAM   0   1   7   1   1
move DRONERUNVELS 128 64
move DRONERUNUPVELS 128 -64
move DRONEBULLVELS 252 -64
move DRONEBACKWARDS -64 -64
move DRONERISE 32 -32
move DRONESTOPPED -16

ai AIDRONEGETE DRONESCREAM DRONERUNVELS faceplayerslow getv
ai AIDRONEWAIT DRONEFRAMES DRONESTOPPED faceplayerslow
ai AIDRONEGETUP DRONESCREAM DRONERUNUPVELS faceplayer getv
ai AIDRONEPULLBACK DRONEFRAMES DRONEBACKWARDS faceplayerslow
ai AIDRONEHIT DRONESCREAM DRONEBACKWARDS faceplayer
ai AIDRONESHRUNK DRONEFRAMES SHRUNKVELS fleeenemy
ai AIDRONEDODGE DRONEFRAMES DRONEBULLVELS dodgebullet geth
ai AIDRONEDODGEUP DRONEFRAMES DRONERISE getv geth

defstate dronedead
  addkills 1
  set PLAYER_VOICEOVER 33
  state thegames_score
  debris SCRAP1 8
  debris SCRAP2 4
  debris SCRAP3 7
  spawn EXPLOSION2
  ifspritepal 40 spawn SKULLEXPLOSION else
  sound RPG_EXPLODE
  ifactor WASP_DRONE nullop else
  hitradius 2048 15 20 25 30
  killit
ends

defstate checkdronehitstate

  ifdead state dronedead
  else ifsquished { sound METAL_CRUSH state dronedead }
  else
  {
	geta[].htpicnum TEMP
	ife TEMP 6197 { addstrength -75 }
	ife TEMP 6464 { addstrength -10 }

	ifspritepal 40 sound CA_DRONE else
	ifspritepal 41 sound RED_COMPBEEP else
    sound DRON_PAIN
	ifspritepal 24 setactorsoundpitch THISACTOR DRON_PAIN 512
    ifbulletnear
    {
	state getceildist
      ifl z 64
        ifrnd 48
          ai AIDRONEDODGE
      ai AIDRONEDODGEUP
    }
    else
      ai AIDRONEGETE
  }
ends

defstate droneshrunkstate
  ifcount 24
    killit
  else
    sizeto 1 1
ends

defstate drone_explode
	state setknockback
      addkills 1
	  state thegames_score
	  ifspritepal 40 sound CA_DRONE else
	  ifspritepal 41 sound RED_COMPBEEP else
      sound DRON_ATTACK2
		  ifspritepal 24
		  {
		  setactorsoundpitch THISACTOR DRON_ATTACK2 512
		  debris SCRAP1 8
		  debris SCRAP2 4
		  debris SCRAP3 7
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  espawn EXPLOSION2
		  seta[RETURN].xrepeat 20
		  seta[RETURN].yrepeat 20
		  sound RPG_EXPLODE
		  
		  setactorsoundpitch THISACTOR RPG_EXPLODE 512
		  hitradius 1536 5 10 15 20
		  }
	  else
	  {
      debris SCRAP1 8
      debris SCRAP2 4
      debris SCRAP3 7
	  shoot SPARK
	  shoot SPARK
	  shoot SPARK
	  shoot SPARK
	  shoot SPARK
	  shoot SPARK
	  shoot SPARK
	  shoot SPARK
	  shoot SPARK
	  ifspritepal 40 spawn SKULLEXPLOSION else
      spawn EXPLOSION2
      sound RPG_EXPLODE
      hitradius 2048 30 40 50 60
	  }
		  ifspritepal 41 stopactorsound THISACTOR FLYBOOTS_HUM
		  else stopactorsound THISACTOR DRON_JETSND
      killit
ends

defstate checkdronenearplayer
state correctcansee

  ifp palive
   ife sightvar YES
    ifpdistl 1596
  {
  ife PERSONEL_RESEARCH[20] 2 // Drone IFF codes?s
		{
		ifcount 30
			state drone_explode
		  else
			{
			sound LASERTRIP_ARMING
				ifspritepal 24 setactorsoundpitch THISACTOR LASERTRIP_ARMING 512
			}
		}
	else
		{
		ifcount 8
			state drone_explode
		else
		  ifcount 3 nullop
		  else
			{
			sound LASERTRIP_ARMING
				ifspritepal 24 setactorsoundpitch THISACTOR LASERTRIP_ARMING 512
			}
		}
  }
  else
	{
	ai AIDRONEGETE
	resetcount
	}

ends

defstate dronegetstate
  ifrnd 192
  {
    ifn HOLOGRAM_ON -1
    {
    canseespr THISACTOR HOLOGRAM_ON TEMP2
    ife TEMP2 1 
		{
			geta[HOLOGRAM_ON].x mx
			geta[HOLOGRAM_ON].y my
			geta[].x x
			geta[].y y
			sub mx x
			sub my y
			getangle TEMP mx my
			seta[].ang TEMP
			ldist TEMP3 TEMP THISACTOR
			ifl TEMP3 60000 { move DRONEBULLVELS geth }
			ifl TEMP3 15960
			{
		  getp[].holoduke_amount TEMP4
		  sub TEMP4 120 ifl TEMP4 0 set TEMP4 0
		  setp[].holoduke_amount TEMP4
		  addkills 1
		  ifspritepal 41 stopactorsound THISACTOR FLYBOOTS_HUM
		  else stopactorsound THISACTOR DRON_JETSND
		  sound DRON_ATTACK2
		  debris SCRAP1 8
		  debris SCRAP2 4
		  debris SCRAP3 7
		  spawn EXPLOSION2
		  sound RPG_EXPLODE
		  hitradius 2048 15 20 25 30
		  killit
			}
		}
    }
	else
	{
	  state correctcansee
		ife sightvar YES
		{
		  ifbulletnear
		  {
			ai AIDRONEDODGE
			break
		  }
		  ifmove DRONEBULLVELS
		  {
			ifcount 64
			  ai AIDRONEPULLBACK
			else
			  ifnotmoving
				ifcount 16
				  ai AIDRONEPULLBACK
		  }
		  else
			ifcount 32
		  {
			ifp phigher
			  move DRONEBULLVELS geth getv
			else
			  move DRONEBULLVELS geth
		  }
		}
		else
		  ifrnd 1
			operate
	  }
  }
ends

defstate dronedodgestate
  ifai AIDRONEDODGEUP
  {
     ifcount 8
       ai AIDRONEGETE
     else
       ifnotmoving
         ai AIDRONEGETE
  }
  else
  {
    ifcount 8
      ai AIDRONEGETE
    else
      ifnotmoving
        ai AIDRONEGETE
  }
ends

actor DRONE DRONESTRENGTH
  state checkdronenearplayer

  ifrnd 2
    fall
  else
    {
	ifspritepal 40 nullop else
	ifspritepal 41
		{
		ifactorsound THISACTOR FLYBOOTS_HUM nullop else
		sound FLYBOOTS_HUM
		setactorsoundpitch THISACTOR FLYBOOTS_HUM 128
		}
	else
		{
		ifactorsound THISACTOR DRON_JETSND nullop else
		sound DRON_JETSND
		ifspritepal 24 setactorsoundpitch THISACTOR DRON_JETSND 512
		}
	}

  ifaction 0
    { 
	ifspritepal 41
		{
		sizeat 22 22
		stopsound DRON_RECOG
		sound BEEP2
		}
	set MONSTER_FLAGS 1
	state monst_glow
	ifspawnedby LIZTROOP
		{
		sizeat 20 20
		strength 1
		spritepal 24
		}
	spawn SHOOTME 
	ai AIDRONEGETE
	}

  else
    ifai AIDRONEWAIT
  {
    ifactioncount 4
      ifrnd 16
        ifcansee
    {
	ifspritepal 40 sound CA_DRONE else
	ifspritepal 41 sound RED_COMPBEEP else
      sound DRON_ATTACK1
	  ifspritepal 24 setactorsoundpitch THISACTOR DRON_ATTACK1 512
      ifp phigher
        ai AIDRONEGETUP
      else ai AIDRONEGETE
    }
  }
  else
    ifai AIDRONEGETE
      state dronegetstate
  else
    ifai AIDRONEGETUP
      state dronegetstate
  else
    ifai AIDRONEPULLBACK
  {
    ifcount 32
    ai AIDRONEWAIT
  }
  else
    ifai AIDRONEHIT
  {
    ifcount 8
      ai AIDRONEWAIT
  }
  else
    ifai AIDRONESHRUNK
      state droneshrunkstate
  else
    ifai AIDRONEDODGE
      state dronedodgestate
  else
    ifai AIDRONEDODGEUP
      state dronedodgestate

  ifhitweapon
    state checkdronehitstate


enda

// ************************************************************************************
// OCTABRAIN
// ************************************************************************************

action AOCTAWALK    0   3   5   1   15
action AOCTASTAND     0   1   5   1   15
action AOCTASCRATCH   0   4   5   1   15
action AOCTAHIT    29   1   1   1   10
action AOCTASHOOT    20   1   5   1   10
action AOCTASHOOT_2    37  1   5   1   10
action AOCTADYING    30   6   1   1   17
action AOCTADEAD     35   1   1   1  1
action AOCTAFROZEN    0   1   5

move OCTAWALKVELS 96 -30
move OCTAUPVELS 96 -70
move OCTASTOPPED 0 -30
move OCTAINWATER 96 24

ai AIOCTAGETENEMY AOCTAWALK OCTAWALKVELS seekplayer
ai AIOCTASHOOTENEMY AOCTASHOOT OCTASTOPPED faceplayer
ai AIOCTASHOOTENEMY_2 AOCTASHOOT_2 OCTASTOPPED faceplayer
ai AIOCTASCRATCHENEMY AOCTASCRATCH OCTASTOPPED faceplayerslow
ai AIOCTAHIT AOCTAHIT OCTASTOPPED faceplayer
ai AIOCTASHRUNK AOCTAWALK SHRUNKVELS faceplayer
ai AIOCTAGROW AOCTASTAND OCTASTOPPED faceplayerslow
ai AIOCTADYING AOCTADYING OCTASTOPPED faceplayer

defstate octagetenemystate
state correctcansee
  ife sightvar YES
  {
    ifactioncount 32
    {
      ifrnd 48
        ifcanshoottarget
      {
        sound OCTA_ATTACK1
		ifinwater ifrnd 64 ifpdistl 8024
			{
			getp[].cursectnum TEMP
			gets[TEMP].lotag TEMP2 
			ife TEMP2 2 ai AIOCTASHOOTENEMY_2 // use air leeching attack if player is in water
			else ai AIOCTASHOOTENEMY
			}
		else
        ai AIOCTASHOOTENEMY
        break
      }
    }
    else
      ifpdistl 1280
        ai AIOCTASCRATCHENEMY
  }

ends

defstate octascratchenemystate
  ifpdistg 1280
    ai AIOCTAGETENEMY
  else
    ifcount 32
  {
    resetcount
    sound OCTA_ATTACK2
    palfrom 16 32
	wackplayer
	addphealth OCTASCRATCHINGPLAYER
  }
ends

defstate octashootenemystate
ifg SKILL_LEVEL 3 // shoot much faster on higher difficulties
	{
	  ifcount 7
	  {
		ifcount 9
		  ai AIOCTAGETENEMY
	  }
	  else
		ifcount 6
		  shoot COOLEXPLOSION1
	  else
		ifactioncount 6
		  resetactioncount
	}
else
ifg SKILL_LEVEL 1 // shoot much faster on higher difficulties
	{
	  ifcount 13
	  {
		ifcount 15
		  ai AIOCTAGETENEMY
	  }
	  else
		ifcount 12
		  shoot COOLEXPLOSION1
	  else
		ifactioncount 6
		  resetactioncount
	}
else
	{
	  ifcount 25
	  {
		ifcount 27
		  ai AIOCTAGETENEMY
	  }
	  else
		ifcount 24
		  shoot COOLEXPLOSION1
	  else
		ifactioncount 6
		  resetactioncount
	}
ends

defstate octashootenemystate_2
  ifcount 25
  {
    ifcount 27
      ai AIOCTAGETENEMY
  }
  else
    ifcount 24
		{
		globalsound SUBMERGE
		ifcanseetarget
			{
			getp[].scuba_on TEMP
			ife TEMP 1
				{
				globalsound STEAM_HISSING
				wackplayer
				palfrom 15 0 0 30
				getp[].scuba_amount TEMP2
				sub TEMP2 320
				setp[].scuba_amount TEMP2
				}
			else
				{
				globalsound DROWNING
				wackplayer
				palfrom 30 0 0 30
				getp[].airleft TEMP
				randvar TEMP 50
				add TEMP 50
				ifg TEMP 100 set TEMP 100
				setp[].airleft TEMP
				}
			}
		}
  else
    ifactioncount 6
      resetactioncount
ends

defstate checkoctahitstate
	state NEWGUNEFFECTS
    ifrnd 128 guts JIBS6 2
  ifwasweapon SHRINKSPARK
  {
    sound ACTOR_SHRINKING
    ai AIOCTASHRUNK
  }
  else
  {
    ifdead
    {
      ifg ICE_DAMAGE 0
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action AOCTAFROZEN
        strength 0
        break
      }

      addkills 1
	  state thegames_score
      ifwasweapon RPG
      {
        state squish_sounds
        state standard_jibs
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
        killit
      }
      else
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
		shoot OCTA_TENT
        killit
      }
      else
        ifwasweapon GROWSPARK
      {
        cstat 0
        sound ACTOR_GROWING
        ai AIOCTAGROW
        break
      }
      else
      {
        state rf
        ai AIOCTADYING
      }
	  ifspritepal 40
	  {
	  sound INFERNAL_DIE
	  setactorsoundpitch THISACTOR INFERNAL_DIE -512
	  }
	  else
      sound OCTA_DYING
    }
    else
    {
      ifwasweapon RPG
      {
	  ifspritepal 40
	  {
	  sound INFERNAL_DIE
	  setactorsoundpitch THISACTOR INFERNAL_DIE -512
	  }
	  else
        sound OCTA_DYING
        addkills 1
		state thegames_score
        state standard_jibs
        killit
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT

	ifspritepal 40
	  {
	  sound INFERNAL_PAIN
	  setactorsoundpitch THISACTOR INFERNAL_PAIN -512
	  }
	  else
      sound OCTA_PAIN
      //spawn BLOOD
	  ifg PAIN_AMOUNT 0
	   ai AIOCTAHIT
	  else
      ifrnd 64
		{
		state PAIN_SKILL_LEVELADJUST
        ai AIOCTAHIT
		}
    }
  }
  state random_wall_jibs
ends

defstate octashrunkstate
  ifcount SHRUNKDONECOUNT
    ai AILIZGETENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 40 40
	  }
  else
    state genericshrunkcode
ends

defstate octadyingstate
  ifactioncount 6
  {
    ifrnd 64
      spawn BLOODPOOL
    move OCTASTOPPED
    action AOCTADEAD
    break
  }
  else
    ifactioncount 5 nullop
  else
    ifactioncount 4
      iffloordistl 8
        state BODY_FALL_NOISES
ends

actor OCTABRAINSTAYPUT OCTASTRENGTH AOCTASTAND
  ai AIOCTAGETENEMY
  state monst_glow
  spawn SHOOTME
  cactor OCTABRAIN
enda

actor OCTABRAIN OCTASTRENGTH AOCTASTAND
  fall
  state checksquished
 state ENEMYKNOCKBACKS
 state enemy_ice_damage
 state enemy_fire_damage
 state enemy_spirit_damage
 
 ifaction 0
	{
	
	ifspritepal 40
	{
	stopsound OCTA_RECOG
	sound INFERNAL_ALERT
	setactorsoundpitch THISACTOR INFERNAL_ALERT -512
	}
	
	set MONSTER_FLAGS 1
	state monst_glow
	}

  ifai 0
    { state monst_glow spawn SHOOTME ai AIOCTAGETENEMY }
  else
    ifaction AOCTADEAD
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state standard_jibs
      killit
    }
    break
  }
  else ifaction AOCTAFROZEN
  {
    ifcount THAWTIME
    {
      ai AIOCTAGETENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
      {
        ifactioncount 26
        {
          spawn WATERDRIP
          resetactioncount
        }
      }

    ifhitweapon
    {
      addkills 1
	  state thegames_score
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }

      lotsofglass 20
      ifrnd 84
        spawn BLOODPOOL
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else
  {
    ifrnd 1
      soundonce OCTA_ROAM

    ifai AIOCTAGETENEMY
      state octagetenemystate
    else
      ifai AIOCTAHIT
      {
	  sub PAIN_AMOUNT 1
        ife PAIN_AMOUNT 0
          ai AIOCTASHOOTENEMY
      }
    else
      ifai AIOCTADYING
      {
        state octadyingstate
        break
      }
    else
      ifai AIOCTASCRATCHENEMY
        state octascratchenemystate
    else
      ifai AIOCTASHOOTENEMY
        state octashootenemystate
    else
      ifai AIOCTASHOOTENEMY_2
        state octashootenemystate_2
    else
      ifai AIOCTASHRUNK
      {
        state octashrunkstate
        break
      }
    else
      ifai AIOCTAGROW
        state genericgrowcode
		
state thisactor_getzrange

    ifmove OCTAUPVELS nullop
    else
      ifp phigher
        move OCTAUPVELS seekplayer
    else
      ifmove OCTAINWATER nullop
      else
        ifinwater
          move OCTAINWATER seekplayer

    ifhitweapon
      state checkoctahitstate
  }
enda

// **************************************************************************************************
// PIGCOP
// **************************************************************************************************

defstate drop_shotgun
geta[].yvel YVELSAVED
ife YVELSAVED 1 spawn PIGCOPGUNSPRITE else
ifn CHAR 15
  ifrnd 96
	{
      spawn PIGCOPGUNSPRITE
	}
ends

action APIGWALK     0  4 5 1 20
action APIGRUN      0  4 5 1 11
action APIGSHOOT    30 2 5 1 58
action APIGSHOOT2    30 2 5 1 22
action APIGCOCK     25 1 5 1 16
action APIGSTAND    30 1 5 1 1
action APIGDIVE     40 2 5 1 40
action APIGDIVESHOOT  45 2 5 1 58
action APIGDIVESHOOT2  45 2 5 1 22
action APIGDYING    55 5 1 1 15
action APIGHIT      55 1 1 1 10
action APIGDEAD     60 1 1 1 1
action APIGDEAD2    93 1 1 1 1
action APIGDEAD2_FL 94 1 1 1 10
action APIGFROZEN    0 1 5
action APIGGROW      0

action APIGHEADDIE      87 5 1 1 15
action APIGHEADDEAD      92 1 1 1 1
action APIGBUTT  63 2 1 1 40

move PIGWALKVELS 72
move PIGRUNVELS 108

ai AIPIGSEEKENEMY APIGWALK PIGWALKVELS seekplayer
ai AIPIGSHOOTENEMY APIGSHOOT STOP faceplayer
ai AIPIGFLEEENEMY APIGWALK PIGWALKVELS fleeenemy
ai AIPIGSHOOT APIGSHOOT STOP faceplayer
ai AIPIGSHOOT2 APIGSHOOT2 STOP faceplayer
ai AIPIGDODGE APIGRUN PIGRUNVELS dodgebullet
ai AIPIGCHARGE APIGRUN PIGRUNVELS seekplayer
ai AIPIGDIVING APIGDIVE STOP faceplayer
ai AIPIGDYING APIGDYING STOP faceplayer
ai AIPIGSHRINK APIGWALK SHRUNKVELS fleeenemy
ai AIPIGGROW APIGGROW STOP faceplayerslow
ai AIPIGHIT APIGHIT STOP faceplayer

ai AIPIGHDYING APIGHEADDIE STOP faceplayer
ai AIPIGBUTT APIGBUTT STOP faceplayer
ai AIPIGDEADBUTT APIGBUTT STOP faceplayer

defstate pigcopbuttstate
ifcount 10 
{ 
state setknockback
wackplayer 
sound PIGBUTT 
palfrom 20 30 0 0 
addphealth -15
resetcount 
}
ifrnd 32 { sound PIG_ROAM3 }
ifpdistg 1024 { ai AIPIGSHOOTENEMY } else
ifp pdead { ifp palive { ai AIPIGSEEKENEMY } }
ends

defstate pigcopdeadbuttstate
ifcount 20 
{ 
wackplayer 
sound PIGBUTT 
palfrom 20 30 0 0 
resetcount 
}
ifrnd 32 sound PIG_ROAM3
ifp pdead { ifp palive { ai AIPIGSEEKENEMY } }
ends

defstate pigseekenemystate
  ifp pdead 
   ifpdistl 812
    {
	ai AIPIGDEADBUTT
   }
  else
  ifai AIPIGCHARGE
  {
  state correctcansee
    ife sightvar YES
	{
		ifpdistl 3084
		{
		  ifnotmoving
			ai AIPIGSEEKENEMY
		  else
			ai AIPIGDIVING
		}
		else 
		{
		state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE ai AIPIGSHOOTENEMY
		}
	}
  }
  else iffloordistl 32
  {
    ifpdistg 4096
    {
	state SKILL_SHOOT_LEVELADJUST
      ifl RANDOM_CHANCE SKILLCHANCE ai AIPIGSHOOTENEMY else ai AIPIGCHARGE
    }
    ifrnd 8
    {
      ifbulletnear
        ai AIPIGDODGE
    }
  }
state correctcansee
  ifrnd 128
    ife sightvar YES
  {
    ifai AIPIGDODGE
    {
      ifcount 32
        ifrnd 128 ai AIPIGCHARGE else ai AIPIGSHOOTENEMY
          break
    }
    iffloordistl 32
    {
      ifpdistl 1024
        ifp palive
		  {
		  state check_actor_hitscan
			ife hitsprite PLAYER_IDENTITY
	      ai AIPIGBUTT
		  }
      ifcount 24
      {
        ifrnd 32
          ifp palive
        {
		state SKILL_SHOOT_LEVELADJUST
		  ifl RANDOM_CHANCE SKILLCHANCE ai AIPIGSHOOTENEMY
          else
            ai AIPIGDIVING
          break
        }
      }
    }
  }
ends

defstate pigcop_shoot_stuff
		state shooting_settings
		 ifspritepal 13
			{
			sound EXPL_SHELL_FIRE
			shoot 9359
			shoot 9359
			shoot 9359
			shoot 9359
			shoot 9359
			}
			else
			{
			ifactor PIG_SF sound AA12_FIRE else
        	ifspritepal 14 sound RIOTGUN_FIRE else sound PIG_ATTACK
			ifn target -1
				{
				ezshoot TEMP3 SHOTGUN
				ezshoot TEMP3 SHOTGUN
				ezshoot TEMP3 SHOTGUN
				ezshoot TEMP3 SHOTGUN
				ezshoot TEMP3 SHOTGUN
				}
				else
				{
				shoot SHOTGUN
				shoot SHOTGUN
				shoot SHOTGUN
				shoot SHOTGUN
				shoot SHOTGUN
				}
			}
			ife PERFMODE 1
			ifcansee
			{
			set gunsmoke_z 7844 
			set gunsmoke_angle 350
			state spawn_gunsmoke_z
			ifaction APIGDIVESHOOT set gunsmoke_z 512
			else set gunsmoke_z 4644
			espawn 16114
			state spawn_muzzleflash
			}
ends


defstate pigshootenemystate
ifactor PIG_SF ai AIPIGSHOOT2
state correctcansee

ife sightvar YES
  {
    ifcount 12 nullop
    else
      ifcount 11
    {
	  state pigcop_shoot_stuff
    }
    ifcount 25 nullop
    else
      ifcount 24
      {
        action APIGCOCK
	   ifspritepal 13 shoot EXSHELL else shoot 3761
        sound SHOTGUN_COCK2
      }
    ifcount 48 nullop
    else
      ifcount 47
    {
	state pigcop_shoot_stuff
    }
    ifcount 60 nullop
    else
      ifcount 59
      {
        action APIGCOCK
	  	   ifspritepal 13 shoot EXSHELL else shoot 3761
        sound SHOTGUN_COCK2
      }
    ifcount 72
    {
      ifrnd 64
        resetcount
      else
      {
        ifpdistl 768
          ai AIPIGFLEEENEMY
        else
          ai AIPIGSEEKENEMY
      }
    }
    ifaction APIGCOCK
      ifactioncount 2
        action APIGSHOOT
  }
  else
    ai AIPIGSEEKENEMY
ends

defstate pig_sf_shootenemystate
state correctcansee

ife sightvar YES
  {
      ifcount 6 nullop
      else
        ifcount 5
	    state pigcop_shoot_stuff
      ifcount 12 nullop
      else
        ifcount 11	   
	      shoot 3761		
      ifcount 18 nullop
      else
        ifcount 17
		state pigcop_shoot_stuff
      ifcount 24 nullop
      else
        ifcount 23
			shoot 3761
      ifcount 30 nullop
      else
        ifcount 29
		state pigcop_shoot_stuff	
      ifcount 36 nullop
      else
        ifcount 35
			shoot 3761	
      ifcount 42 nullop
      else
        ifcount 41
		state pigcop_shoot_stuff				
      ifcount 48 nullop
      else
        ifcount 47
      {
	  	shoot 3761
      ifrnd 64
        resetcount
      else
		  {
			ifpdistl 768
			  ai AIPIGFLEEENEMY
			else
			  ai AIPIGSEEKENEMY
		  }
      }
 
    ifaction APIGCOCK
      ifactioncount 2
        action APIGSHOOT
  }
  else
    ai AIPIGSEEKENEMY
ends

defstate pigfleeenemystate
  ifactioncount 8
    ai AIPIGSEEKENEMY
  else
    ifnotmoving
      ai AIPIGSEEKENEMY
ends

defstate pigdivestate
  ifaction APIGDIVESHOOT
  {
  sizeat 40 24
  state correctcansee
    ife sightvar YES
    {
      ifcount 12 nullop
      else
        ifcount 11
      {
	    state pigcop_shoot_stuff
      }
      ifcount 25 nullop
      else
        ifcount 24
	   {
	      ifspritepal 13 shoot EXSHELL else shoot 3761
          sound SHOTGUN_COCK2
		}
      ifcount 48 nullop
      else
        ifcount 47
      {
		state pigcop_shoot_stuff
      }
      ifcount 60 nullop
      else
        ifcount 59
      {
        sound SHOTGUN_COCK2
	  	   ifspritepal 13 shoot EXSHELL else shoot 3761
        ifgapzl 32
          ai AIPIGDIVING
        else
        {
		sizeat 40 40
          ifpdistl 4096
            ai AIPIGFLEEENEMY
          else
            ai AIPIGSEEKENEMY
        }
      }
    }
    else
	 {
      ifgapzl 32
        ai AIPIGDIVING
      else
        ai AIPIGSEEKENEMY
	 sizeat 40 40
	}
  }
  else
    ifactioncount 2
    ifp palive
    {
	sizeat 40 24
      resetcount
      action APIGDIVESHOOT
    }
ends

defstate pig_sf_divestate
  ifaction APIGDIVESHOOT2
  {
  sizeat 40 24
  state correctcansee
    ife sightvar YES
    {
      ifcount 6 nullop
      else
        ifcount 5
	    state pigcop_shoot_stuff
      ifcount 12 nullop
      else
        ifcount 11	   
	      shoot 3761		
      ifcount 18 nullop
      else
        ifcount 17
		state pigcop_shoot_stuff
      ifcount 24 nullop
      else
        ifcount 23
			shoot 3761
      ifcount 30 nullop
      else
        ifcount 29
		state pigcop_shoot_stuff	
      ifcount 36 nullop
      else
        ifcount 35
			shoot 3761	
      ifcount 42 nullop
      else
        ifcount 41
		state pigcop_shoot_stuff				
      ifcount 48 nullop
      else
        ifcount 47
      {
	  	   shoot 3761
        ifgapzl 32
          ai AIPIGDIVING
        else
        {
		sizeat 40 40
          ifpdistl 4096
            ai AIPIGFLEEENEMY
          else
            ai AIPIGSEEKENEMY
        }
      }
    }
    else
	 {
      ifgapzl 32
        ai AIPIGDIVING
      else
        ai AIPIGSEEKENEMY
	 sizeat 40 40
	}
  }
  else
    ifactioncount 2
    ifp palive
    {
	sizeat 40 24
      resetcount
      action APIGDIVESHOOT2
    }
ends

defstate checkpighitstate

state NEWGUNEFFECTS

  ifdead
  {
    state random_wall_jibs


		 ifrnd 96
		 {
		 ifspritepal 13
			spawn EXPL_SHELLS
		  else
		  ifspritepal 14
		   spawn RIOTGUNSPRITE
		   else state drop_shotgun
		}
		else state drop_shotgun
	  
	    addkills 1
	state thegames_score

    ifwasweapon GROWSPARK
    {
      sound ACTOR_GROWING
      ai AIPIGGROW
      break
    }
	else
    ifg ICE_DAMAGE 0
    {
	ifaction APIGDIVESHOOT sizeat 40 40
	ifaction APIGDIVESHOOT2 sizeat 40 40
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action APIGFROZEN
      strength 0
      break
    }
	else
    ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
    else
      ifwasweapon RPG
    {
      state squish_sounds
      state standard_jibs
      killit
    }

      ife HEADSHOT 2
	   ifstrength -25
	    
     {
	 ifactor PIG_SF break
	  ifrnd 32 state trigger_showoff
      sound DECAPITATE
      state jib_sounds
      guts JIBS6 4
      guts JIBS2 2
      guts JIBS5 1
	  ifaction APIGDIVESHOOT sizeat 40 40
	  ifaction APIGDIVESHOOT2 sizeat 40 40
      ai AIPIGHDYING
     }
      else
	  {
	ifg FIRE_DAMAGE 0
		{
		sound ENGULF_FIRE
		spritepal 27
		spriteflags 5
		seta[].shade 20
		}
	 ifaction APIGDIVESHOOT sizeat 40 40
	 ifaction APIGDIVESHOOT2 sizeat 40 40
      ai AIPIGDYING
        ifrnd 128 sound PIG_DYING2 else sound PIG_DYING
		}
  }
  else
  {
    sound PIG_PAIN
    state random_wall_jibs

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIPIGSHRINK
    }
    else
      ifwasweapon GROWSPARK
        sound EXPANDERHIT
	else
	 ifg PAIN_AMOUNT 0
		{
		ifaction APIGDIVE nullop else
		ifaction APIGDIVESHOOT nullop else
		ifaction APIGDIVESHOOT2 nullop else
        ai AIPIGHIT
		}
    else
      ifrnd 32
		{
		ifactor PIG_SF break
		state PAIN_SKILL_LEVELADJUST
		ifaction APIGDIVE nullop else
		ifaction APIGDIVESHOOT nullop else
		ifaction APIGDIVESHOOT2 nullop else
        ai AIPIGHIT
		}
    else
      ifrnd 64
       { sizeat 40 40 ai AIPIGSHOOTENEMY }
    else
      ifrnd 64
      {
        ai AIPIGDIVING
		sizeat 40 24
		ifactor PIG_SF action APIGDIVESHOOT2 else
        action APIGDIVESHOOT
      }
  }
ends

defstate pigshrinkstate

	ifrnd 4
		{
		soundonce PIG_DYING
		setactorsoundpitch THISACTOR PIG_DYING 512
		}

  ifcount SHRUNKDONECOUNT
    ai AIPIGSEEKENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 48 40
	  }
  else
    state genericshrunkcode
ends

defstate pigdyingstate
cstat 0

ifspritepal 27 
	{ 
	ifrnd 8 { shoot SPARK espawn BIG_SMOKE seta[RETURN].pal 17 }
	seta[].shade 20
	}

  ifactioncount 5
  {
    ifrnd 64
      spawn BLOODPOOL
    state rf
    iffloordistl 8
      state BODY_FALL_NOISES
	  ifactor PIG_SF action APIGDEAD else
		  {
		ifrnd 128 action APIGDEAD2 else action APIGDEAD
			}
    move STOP
    break
  }
ends

defstate pighdyingstate
  ifactioncount 5
  {
    ifrnd 64
      spawn BLOODPOOL
      state rf
    iffloordistl 8
      state BODY_FALL_NOISES
   action APIGHEADDEAD
    move STOP
    break
  }
ends


action PIGDEAD2 33

useractor notenemy PIGCOPDEADSPRITE
cstat 256

ifaction 0
{
ifrnd 128 action PIGDEAD2 else action ZERO
}

ifhitweapon
  ifwasweapon RADIUSEXPLOSION
      {
       state squish_sounds
       state standard_jibs
       killit
      }
enda


actor PIGCOPDIVE PIGCOPSTRENGTH
	state monst_glow
  ai AIPIGDIVING
  action APIGDIVESHOOT
  spawn SHOOTME
  cactor PIGCOP
enda

actor PIGCOPSTAYPUT PIGCOPSTRENGTH
	state monst_glow
  ai AIPIGSEEKENEMY
  spawn SHOOTME
  cactor PIGCOP
enda


defstate PIGDEADSTATE

ifaction APIGDEAD2 ifrnd 8 ifl INTERNALCOUNT 10 action APIGDEAD2_FL
ifaction APIGDEAD2_FL
	{
	add INTERNALCOUNT 1
	ifrnd 32 action APIGDEAD2
	}

ifspritepal 27 
	{ 
	ifrnd 8 { espawn BIG_SMOKE seta[RETURN].pal 17 }
	seta[].shade 20
	}

      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
        killit
      }
      break
ends

defstate pigcop_maincode
ifactor PIG_SF nullop else state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

  state checksquished
  ifaction APIGSTAND
    ai AIPIGSEEKENEMY
  else ifaction APIGDEAD state PIGDEADSTATE
  else ifaction APIGDEAD2 state PIGDEADSTATE
  else ifaction APIGHEADDEAD state PIGDEADSTATE
  else ifaction APIGDEAD2_FL state PIGDEADSTATE
  else
    ifaction APIGFROZEN
  {
    ifcount THAWTIME
    {
      ai AIPIGSEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
        ifrnd 8
          spawn WATERDRIP

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      lotsofglass 20
      ifrnd 84 spawn BLOODPOOL
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else
    ifai AIPIGDYING
      state pigdyingstate
  else
    ifai AIPIGHDYING
      state pighdyingstate
  else
    ifai AIPIGHIT
    {
	sub PAIN_AMOUNT 1
      ife PAIN_AMOUNT 0
      ai AIPIGSEEKENEMY
    }
  else
    ifai AIPIGSHRINK
      state pigshrinkstate
  else
  {
    ifai AIPIGBUTT
state pigcopbuttstate
   else
    ifai AIPIGDEADBUTT
state pigcopdeadbuttstate
  else
    ifai AIPIGSEEKENEMY
      state pigseekenemystate
    else
      ifai AIPIGDODGE
        state pigseekenemystate
    else
      ifai AIPIGSHOOTENEMY
        state pigshootenemystate
    else
      ifai AIPIGSHOOT2
		state pig_sf_shootenemystate
    else
      ifai AIPIGGROW
        state genericgrowcode
    else
      ifai AIPIGFLEEENEMY
        state pigfleeenemystate
    else
      ifai AIPIGDIVING
	    {
		ifactor PIG_SF state pig_sf_divestate else
        state pigdivestate
		}
    else
      ifai AIPIGCHARGE
        state pigseekenemystate
    ifhitweapon
      state checkpighitstate
    ifrnd 1
    {
	randvar TEMP 3
		ife TEMP 0 soundonce PIG_ROAM else
		ife TEMP 1 soundonce PIG_ROAM2 else
		ife TEMP 2 soundonce PIG_ROAM3 else
		ife TEMP 3 soundonce PIG_ROAM4 
    }
  }
ends

actor PIGCOP PIGCOPSTRENGTH
  fall
  
	ifaction 0 
		{ 
		state monst_glow
		spawn SHOOTME 
		action APIGSTAND 
		} 
	//state BODYA_DAMAGE_MODIFIER 
	state pigcop_maincode
enda


defstate PIG_SF_PREP
	  state monst_glow
	  cstator 257
	  ifspritepal 0 spritepal 12
	  sizeat 40 40
	  strength 200
	  spawn SHOOTME
	  spriteflags NORMAL_ENEMY
ends

useractor enemy PIG_SF 200 APIGSTAND
  fall
  ifai 0 state PIG_SF_PREP
  //state BODYA_DAMAGE_MODIFIER // Modifier for Enemies with Body Armour
  state pigcop_maincode
enda

useractor enemy PIG_SF_DIVE 200
fall
  ifai 0 state PIG_SF_PREP
  
  ai AIPIGDIVING
  action APIGDIVESHOOT2
  //state BODYA_DAMAGE_MODIFIER // Modifier for Enemies with Body Armour
  
  cactor PIG_SF
enda


useractor enemystayput PIG_SF_STAYPUT 200 APIGSTAND
  
  ifai 0 state PIG_SF_PREP
  //state BODYA_DAMAGE_MODIFIER // Modifier for Enemies with Body Armour
  ai AIPIGSEEKENEMY
  cactor PIG_SF
enda

// ************************************************************************************
// Elite LIZMAN
// ************************************************************************************


action A_ELIZSTAND     0
action A_ELIZWALKING     0   4  5  1  15
action A_ELIZRUNNING     0   4  5  1  11
action A_ELIZJUMP      20  3  5  1  20
action A_ELIZFALL      30  1  5
action A_ELIZSHOOTING    41  2  5  1  7
action A_ELIZDYING     35  6  1  1  15
action A_ELIZLYINGDEAD   40  1
action A_ELIZFROZEN     0  1  5

ai AI_ELITELIZGETENEMY A_ELIZWALKING LIZWALKVEL seekplayer
ai AI_ELITELIZDODGE A_ELIZRUNNING LIZRUNVEL dodgebullet
ai AI_ELITELIZCHARGEENEMY A_ELIZRUNNING LIZRUNVEL seekplayer
ai AI_ELITELIZFLEENEMY A_ELIZWALKING LIZWALKVEL fleeenemy
ai AI_ELITELIZSHOOTENEMY A_ELIZSHOOTING STOP faceplayersmart
ai AI_ELITELIZJUMPENEMY A_ELIZJUMP LIZJUMPVEL jumptoplayer
ai AI_ELITELIZSHRUNK A_ELIZWALKING SHRUNKVELS fleeenemy
ai AI_ELITELIZGROW A_ELIZSTAND STOP faceplayerslow
ai AI_ELITELIZDYING A_ELIZDYING STOP faceplayer

defstate elite_lizseekstate

  ifactornotstayput
  {
  state correctcansee
    ife sightvar YES
      ifp palive
        ifpdistl 2048
          ifcount 16
    {
	  sound MINIGUN_START
      ai AI_ELITELIZSHOOTENEMY
      break
    }
    ifai AI_ELITELIZCHARGEENEMY
    {
      ifcount 72
        ifcanshoottarget
      {
	    sound MINIGUN_START
        ai AI_ELITELIZSHOOTENEMY
        break
      }
		geta[].htmovflag TEMP
		ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
		{
				 andvar TEMP 49152
				 ife TEMP 32768 // the actor is pushing on a wall
				 {
				   geta[].htmovflag TEMP2 // need to get the info again
				   andvar TEMP2 16383 // temp now stores the wall number
						   getwall[TEMP2].nextsector sect
						   ifn sect -1
						   {
						   ifand wall[TEMP2].cstat 1 break
						   ife sector[sect].lotag 20 operate
						   ife sector[sect].lotag 21 operate
						   ife sector[sect].lotag 22 operate
						   ife sector[sect].lotag 23 operate
							  ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
								{
								ai AI_ELITELIZJUMPENEMY
								break
								}
							}
				  }
		}
    }
    else
      ifpdistg 4096
    {
      ifrnd 92
      {
        ifcount 48
          ifcanshoottarget
            { sound MINIGUN_START ai AI_ELITELIZSHOOTENEMY }
      }
      else
        ifcount 24
      {
        ai AI_ELITELIZCHARGEENEMY
        break
      }
    }

    iffloordistl 16
    {
      ifcount 48
        ifnotmoving
          ifcansee
      {
        ai AI_ELITELIZJUMPENEMY
        break
      }
    }
    else
    {
      ifpdistg 1280
        ai AI_ELITELIZJUMPENEMY
      break
    }

    ifrnd 4
      ifnotmoving
        operate
    else
      ifrnd 1
        ifbulletnear
    {
      ifgapzl 128
        ai AI_ELITELIZDODGE
      else
        ifactornotstayput
      {
        ifrnd 32
          ai AI_ELITELIZJUMPENEMY
        else
          ai AI_ELITELIZDODGE
      }
    }
  }
  else
  {
    ifactioncount 16
    {
      ifp palive
        ifrnd 32
          ifcansee
            ifcanshoottarget
              { sound MINIGUN_START ai AI_ELITELIZSHOOTENEMY }
    }
    ifcount 16
      ifrnd 32
        move LIZWALKVEL randomangle geth
  }

ends

defstate elite_lizshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AI_ELITELIZGETENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 48 40
	  }
  else
    state genericshrunkcode
ends

defstate elite_lizfleestate

    iffloordistl 16 nullop
    else
      ai AI_ELITELIZGETENEMY
    break
  
ends

defstate elite_lizshootstate
  ifcount 20
    ifrnd 8
  {
  state correctcansee
    ife sightvar YES
      ifpdistl 2048
    {
      ifrnd 128
        { sound MINIGUN_STOP ai AI_ELITELIZFLEENEMY }
      break
    }
    else
      { sound MINIGUN_STOP ai AI_ELITELIZGETENEMY }
  }
  ifactioncount 2
  {
  state correctcansee
    ife sightvar YES
    {
	state shooting_settings
       state SKILL_ENEMY_ACCURACY sound TURR_ATTACK shoot 5394
	   
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7844 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			set gunsmoke_z 4544
			espawn 16113
			state spawn_muzzleflash
			}
      resetactioncount
    }
    else
      { sound MINIGUN_STOP ai AI_ELITELIZGETENEMY }
  }
ends

defstate checkelitelizhit

state NEWGUNEFFECTS
  ifrnd 128 guts JIBS6 1
  //spawn BLOOD
  ifai AI_ELITELIZSHRUNK
  {
    addkills 1
	state thegames_score
    state squish_sounds
    state standard_jibs
    killit
  }
  ifdead
  {
    ifg ICE_DAMAGE 0
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action A_ELIZFROZEN
      strength 0
      break
    }

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AI_ELITELIZGROW
      break
    }

    addkills 1
	state thegames_score

    ifwasweapon RPG
    {
      state squish_sounds
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
    {
	ifai AI_ELITELIZDYING break else ai AI_ELITELIZDYING
	
	  	ifg FIRE_DAMAGE 0
		{
		sound ENGULF_FIRE
		spritepal 27
		ifand sprite[].htflags 5 nullop else spriteflags 5
		seta[].shade 20
		}
	
      state rf
      ifrnd 64
        spawn BLOODPOOL
	    sound CAPT_DYING
    }
  }
  else
  {
    sound CAPT_PAIN
    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AI_ELITELIZSHRUNK
      break
    }
    ifwasweapon GROWSPARK
      sound EXPANDERHIT

    state random_wall_jibs
	state correctcansee
    ifp palive
	ife sightvar YES
        ifcanshoottarget
    {
	  sound MINIGUN_START
      ai AI_ELITELIZSHOOTENEMY
      break
    }
  }
ends

defstate elite_lizjumpstate
  ifaction A_ELIZFALL
  {
    iffloordistl 16
      ai AI_ELITELIZGETENEMY
  }
  else
    ifactioncount 3
      action A_ELIZFALL
ends

defstate elite_lizdyingstate
  ifaction A_ELIZLYINGDEAD
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
  }
  else
    ifai AI_ELITELIZDYING
      ifactioncount 6
  {
    iffloordistl 8
      state BODY_FALL_NOISES
    move STOP
	action A_ELIZLYINGDEAD 

  }
ends

defstate elite_lizdodgestate
  ifcount 13
    ai AI_ELITELIZGETENEMY
ends

useractor enemystayput ELITE_LIZMAN_STAYPUT 400 sizeat 45 45 cstator 257 state monst_glow ai AI_ELITELIZGETENEMY spawn SHOOTME cactor ELITE_LIZMAN enda
useractor enemy ELITE_LIZMAN_JUMP 400 sizeat 45 45 cstator 257 state monst_glow ai AI_ELITELIZJUMPENEMY spawn SHOOTME cactor ELITE_LIZMAN enda

defstate elite_lizcode
  state checksquished
  ifai 0
    { sizeat 45 45 cstator 257 spawn SHOOTME ai AI_ELITELIZGETENEMY set ENEMY_SHIELD 200 spritepal 97 }
  else
    ifaction A_ELIZLYINGDEAD
  {
    fall
    state elite_lizdyingstate
    break
  }
  else
    ifaction A_ELIZFROZEN
  {
    ifcount THAWTIME
    {
      ai AI_ELITELIZGETENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
	state NEWGUNEFFECTS
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
	  ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else
    ifai AI_ELITELIZJUMPENEMY
      state elite_lizjumpstate
  else
  {
    fall
    ifai AI_ELITELIZGETENEMY
      state elite_lizseekstate
    else
      ifai AI_ELITELIZCHARGEENEMY
        state elite_lizseekstate
    else
      ifai AI_ELITELIZDODGE
        state elite_lizdodgestate
    else
      ifai AI_ELITELIZSHOOTENEMY
        state elite_lizshootstate
    else
      ifai AI_ELITELIZFLEENEMY
        state elite_lizfleestate
    else
      ifai AI_ELITELIZSHRUNK
        state elite_lizshrunkstate
    else
      ifai AI_ELITELIZGROW
        state genericgrowcode
    else
      ifai AI_ELITELIZDYING
        state elite_lizdyingstate
  }

  ifai AI_ELITELIZSHRUNK
    break
	
	ifspritepal 32
		{
		ifcount 10 
			{
			ifg ENEMY_SHIELD 0 spritepal 97 else getlastpal
			}
		}
	
	state ENEMY_SHIELD_STUFF
	
  ifhitweapon
    state checkelitelizhit
ends

useractor enemy ELITE_LIZMAN 200
  fall
  
ifaction 0
{
sizeat 45 45
state monst_glow
}

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

  state elite_lizcode
enda

// ************************************************************************************
// BOSS 1 ( BATTLELORD)
// ************************************************************************************

action ABOSS1WALK        0  4  5  1  12
action ABOSS1FROZEN        30 1  5
action ABOSS1RUN         0  6  5  1  5
action ABOSS1PREPARE       30 1 5 1 4
action ABOSS1SHOOT         30 2  5  1  4
action ABOSS1LOB         40 2  5  1  35
action ABOSS1DYING        50 5  1  1  35
action BOSS1FLINTCH       50 1  1  1  1
action ABOSS1DEAD         55

move PALBOSS1SHRUNKRUNVELS 32
move PALBOSS1RUNVELS 128
move BOSS1WALKVELS 208
move BOSS1RUNVELS 296
move BOSS1STOPPED

ai AIBOSS1SEEKENEMY ABOSS1WALK BOSS1WALKVELS seekplayer
ai AIBOSS1RUNENEMY ABOSS1RUN BOSS1RUNVELS faceplayer
ai AIBOSS1PREPARE ABOSS1PREPARE BOSS1STOPPED faceplayer
ai AIBOSS1SHOOTENEMY ABOSS1SHOOT BOSS1STOPPED faceplayer
ai AIBOSS1SHOOTENEMY_BOT ABOSS1SHOOT BOSS1STOPPED shoottarget
ai AIBOSS1LOBBED ABOSS1LOB BOSS1STOPPED faceplayer // faceplayersmart
ai AIBOSS1DYING ABOSS1DYING BOSS1STOPPED faceplayer
ai AIBOSS1PALSHRINK ABOSS1WALK PALBOSS1SHRUNKRUNVELS furthestdir

state boss1palshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AITROOPSEEKENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 40 40
	  }
  else
    state genericshrunkcode
ends

state checkboss1seekstate
  ai AIBOSS1SEEKENEMY
  ifspritepal 0 nullop
    else   // a fake way of doing a ifspritepal NOT.
      move PALBOSS1RUNVELS seekplayer
ends

state boss1prepare
soundonce MINIGUN2_START
add INTERNALCOUNT 1
ifg INTERNALCOUNT 30
	{
    state shooting_settings
	ifn target -1
		{ ai AIBOSS1SHOOTENEMY_BOT }
		else
    ifp palive
      { ai AIBOSS1SHOOTENEMY }
	set INTERNALCOUNT 0
    }
ends

state boss1runenemystate
  ifpdistl 2048
  {
  ai AIBOSS1PREPARE
  }
  else
    ifcansee
  {
    ifactioncount 6
    {
      ifcanshoottarget
      {
	 ifpdistl 8192 { quake 6 }
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS1SEEKENEMY
    }
  }
  else
    ai AIBOSS1SEEKENEMY
ends

state boss1seekenemystate
  ifrnd 2
    {
	ifspritepal 40 soundonce ALIEN_TALK1 else
    soundonce BOS1_ROAM
	}
  else
    ifactioncount 6
  {
	ifpdistl 8192 { quake 6 }
    resetactioncount
	ifspritepal 40 sound CYBERDEMON_METAL else
    sound BOS1_WALK
  }

  ifpdistl 2548
    ifp palive
  {
  ai AIBOSS1PREPARE
  }

  ifcansee
    ifcount 32
  {
    ifrnd 32
    {
	 ai AIBOSS1PREPARE
    }
    else
      ifpdistg 2548
        ifrnd 192
          ifcanshoottarget
    {
      ifrnd 64
      {
        ai AIBOSS1RUNENEMY
        ifspritepal 0 nullop
        else
          move PALBOSS1RUNVELS seekplayer
      }
      else
        ai AIBOSS1LOBBED
    }
  }

ends

state boss1dyingstate
  ifaction ABOSS1DEAD
  {
    ifspritepal 0
      break
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        guts JIBS2 5              // Instead of the normal "standard_jibs"
        guts JIBS3 5              // amount, I found that ,because these
        guts JIBS4 5              // bodies are so huge, they should spawn
        guts JIBS5 15             // a more realistic amount of gutter!
        guts JIBS6 15
        debris SCRAP1 5           // There are also spawned some metal
        debris SCRAP2 5           // scraps, since this boss has a lot
        debris SCRAP5 5           // of metalware with him.
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 5
  {
    iffloordistl 8
      globalsound BOSSFALL
    action ABOSS1DEAD
	
		espawn BOSS1MINIGUN // Spawn the Boss's minigun
		geta[].x TEMP
		geta[].y TEMP2

		set TEMP3 TEMP
		add TEMP3 512
		
		getp[].ang TEMP4
		add TEMP4 1536

		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		geta[].z TEMP
		seta[RETURN].z TEMP
		
		
		geta[].xrepeat TEMP seta[RETURN].xrepeat TEMP
	    geta[].yrepeat TEMP seta[RETURN].yrepeat TEMP
	
    state rf
    ifspritepal 0 
	{ 
	quake 26
		ife VOLUME 5
			{
			readarrayfromfile BEAT_EPISODES 4053
			ife LEVEL 4 // Asteroid
				{ 
				ifand BEAT_EPISODES[8] 256 nullop else 
						{ 
						set TEMP BEAT_EPISODES[8]
						xorvar TEMP 512
						setarray BEAT_EPISODES[8] TEMP
						writearraytofile BEAT_EPISODES 4053
						}				
				ifn CHEATED 1
					{
					readarrayfromfile SKILL_MEDALS 4030
					ifl SKILL_MEDALS[250] SKILL_LEVEL setarray SKILL_MEDALS[250] SKILL_LEVEL
					writearraytofile SKILL_MEDALS 4030		
					}
				} 
			}
		ife VOLUME 6 
			{
			readarrayfromfile BEAT_EPISODES 4053
			ife LEVEL 7 // Tropical Alien Massacre
				{ 
					ifand BEAT_EPISODES[6] 4 nullop else 
						{ 
						set TEMP BEAT_EPISODES[6]
						xorvar TEMP 4
						setarray BEAT_EPISODES[6] TEMP
						writearraytofile BEAT_EPISODES 4053
						}		
				ifn CHEATED 1
					{
					readarrayfromfile SKILL_MEDALS 4030
					ifl SKILL_MEDALS[203] SKILL_LEVEL setarray SKILL_MEDALS[203] SKILL_LEVEL
					writearraytofile SKILL_MEDALS 4030		
					}
				} 
			ife LEVEL 13 // The Beach
				{ 
					ifand BEAT_EPISODES[6] 256 nullop else 
						{ 
						set TEMP BEAT_EPISODES[6]
						xorvar TEMP 256
						setarray BEAT_EPISODES[6] TEMP
						writearraytofile BEAT_EPISODES 4053
						}
				
				ifn CHEATED 1
					{
					readarrayfromfile SKILL_MEDALS 4030
					ifl SKILL_MEDALS[209] SKILL_LEVEL setarray SKILL_MEDALS[209] SKILL_LEVEL
					writearraytofile SKILL_MEDALS 4030		
					}
				} 
			ife LEVEL 33 // The Final confrontation
				{ 
					ifand BEAT_EPISODES[6] 65536 nullop else 
						{ 
						set TEMP BEAT_EPISODES[6]
						xorvar TEMP 65536
						setarray BEAT_EPISODES[6] TEMP
						writearraytofile BEAT_EPISODES 4053
						}
				
				ifn CHEATED 1
					{
					readarrayfromfile SKILL_MEDALS 4030
					ifl SKILL_MEDALS[217] SKILL_LEVEL setarray SKILL_MEDALS[217] SKILL_LEVEL
					writearraytofile SKILL_MEDALS 4030		
					}
				} 
			ife LEVEL 39 // The Lost Highway
				{ 
					ifand BEAT_EPISODES[6] 131072 nullop else 
						{ 
						set TEMP BEAT_EPISODES[6]
						xorvar TEMP 131072
						setarray BEAT_EPISODES[6] TEMP
						writearraytofile BEAT_EPISODES 4053
						}
				
				ifn CHEATED 1
					{
					readarrayfromfile SKILL_MEDALS 4030
					ifl SKILL_MEDALS[218] SKILL_LEVEL setarray SKILL_MEDALS[218] SKILL_LEVEL
					writearraytofile SKILL_MEDALS 4030		
					}
				} 
			state save_arrays
			state fatigue_system
			state budget_system
			ifn base_level 0 ifn base_volume -1 startlevel base_volume base_level else
			startlevel 6 0
			}
		else { ife VOLUME 0 ife LEVEL 7 ifn LOTAGSAVED 0 { state save_arrays state fatigue_system state budget_system endofgame 52 } }
	}
  }
ends

useractor notenemy BOSS1MINIGUN 50

ifaction 0 { state rf cstator 256 action ZERO }
fall

 ifhitweapon
  {
  sound HITMETAL
	  ifdead
	  {
	  sound VENT_BUST
	  debris SCRAP1 3           
	  debris SCRAP2 3           
	  debris SCRAP5 3
	  killit
	  }
  }
  
 		ifpdistl 1536 
		 ifp pfacing
			{
			readarrayfromfile WEAPONS_RESEARCH 4000
			ife WEAPONS_RESEARCH[4] 0
					{
					set player_use 0
					 ifhitspace
						{
						set DISP_RES -240
						set DISP_RES_PAL 2
						set DISP_RES_PIC 2687
						setarray WEAPONS_RESEARCH[4] 1
						writearraytofile WEAPONS_RESEARCH 4000
						globalsound RESEARCH_DATA
						palfrom 20 63 63 63
						quote 1025
						killit
						}
					}
			}

 enda

defstate boss1lobbedstate
  ifcansee
  {
    ifactioncount 2
    {
      resetactioncount
      
      ifspritepal 20 { sound BOS1_ATTACK2 shoot 5375 }
	  else ifspritepal 40 { sound CY_PLASMA_FIRE shoot 14644 } else
	  { sound BOS1_ATTACK2 shoot MORTER }
    }
    else
      ifcount 64
        ifrnd 16
          state checkboss1seekstate
  }
  else
    state checkboss1seekstate
ends

defstate boss1shootenemy
  ifcount 72
    { sound MINIGUN_STOP state checkboss1seekstate }
  else
    ifaction ABOSS1SHOOT
      ifactioncount 2
  {

    sound MINIGUN_SPIN
    sound BOS1_ATTACK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    resetactioncount
  }
ends

defstate boss1shoot_botenemy

ife target -1 ai AIBOSS1SHOOTENEMY

state calczdist

ifn target -1 ldist xydist THISACTOR target
ife xydist 0 set xydist 1

        geta[target].x mx
        geta[target].y my
        geta[].x x
        geta[].y y
        sub mx x
        sub my y

        getangle ANGVAR mx my
        seta[].ang ANGVAR
		


  ifcount 72
    { sound MINIGUN_STOP state checkboss1seekstate }
  else
    ifaction ABOSS1SHOOT
      ifactioncount 2
  {
	shiftvarl zdist 8
	divvarvar zdist xydist
  
    sound MINIGUN_SPIN
    sound BOS1_ATTACK1
	cactor PIGCOP
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
	cactor BOSS1
    resetactioncount
  }
ends

defstate checkboss1hitstate

	state NEWGUNEFFECTS

  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
  
  	ifn XVELSAVED 0 
		{
		operateactivators XVELSAVED THISACTOR
		operatemasterswitches XVELSAVED
		operaterespawns XVELSAVED
		set XVELSAVED 0
		}
  
    ifspritepal 0
      globalsound DUKE_TALKTOBOSSFALL
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifg ICE_DAMAGE 0
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS1FROZEN
        strength 0
        break
      }
    }

	ifspritepal 40 sound CYBERDEMON_DIE
    else sound BOS1_DYING

    addkills 1
	state thegames_score
    ai AIBOSS1DYING
  }
  else
  {
     ifg PAIN_AMOUNT 0
    {
      action BOSS1FLINTCH
      move 0
    }
    ifrnd 32
    {
      action BOSS1FLINTCH
      move 0
    }
	
	geta[].htowner target

    ifspritepal 0 nullop
    else
      ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIBOSS1PALSHRINK
      cstat 0
      break
    }

    soundonce BOS1_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

state boss1code

  ifaction ABOSS1FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS1SEEKENEMY
      spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score
      lotsofglass 20

      ifrnd 84
        spawn BLOODPOOL
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  ifai 0
  {
  	state monst_glow
  spawn SHOOTME
    ifspritepal 0
	  {
	  set CURBOSS THISACTOR
	  set BOSS_TYPE 1
      ai AIBOSS1RUNENEMY
	  }
    else
    {
	ifspritepal 24 { sizeat 55 55 strength 2500 } else
	ifspritepal 40 { sizeat 55 55 stopsound BOS1_RECOG globalsound ALIEN_TALK1 strength 8000 } else
      ifspritepal 0 strength 4500 else
	  strength BOSS1PALSTRENGTH
	  sound MINIGUN_START
      ai AIBOSS1SHOOTENEMY
    }
  }
  else
    ifaction BOSS1FLINTCH
  {
  sub PAIN_AMOUNT 2
    ifl PAIN_AMOUNT 1
    { 	
	state shooting_settings
	ifn target -1
		{ sound MINIGUN_START ai AIBOSS1SHOOTENEMY_BOT }
		else
          { sound MINIGUN_START ai AIBOSS1SHOOTENEMY } 
	}
  }
  else
    ifai AIBOSS1SEEKENEMY
      state boss1seekenemystate
  else
    ifai AIBOSS1RUNENEMY
      state boss1runenemystate
  else
    ifai AIBOSS1PREPARE
      state boss1prepare
  else
    ifai AIBOSS1SHOOTENEMY
      state boss1shootenemy
  else
    ifai AIBOSS1SHOOTENEMY_BOT
      state boss1shoot_botenemy
  else
    ifai AIBOSS1LOBBED
      state boss1lobbedstate
  else
    ifai AIBOSS1PALSHRINK
      state boss1palshrunkstate

  ifai AIBOSS1DYING
    state boss1dyingstate
  else
  {
  geta[].htextra TEMP7
  ifhitweapon
	{
	state checkboss1hitstate
	ifg TEMP7 POINT_AMOUNT
	{
	geta[].htowner TEMP4
	geta[TEMP4].picnum TEMP5
	ife TEMP5 1405
		{
		getactorvar[TEMP4].P_CREDITS TEMP6
		add TEMP6 1
		setactorvar[TEMP4].P_CREDITS TEMP6
		}
	}
	}
    else
      ifp palive
        ifspritepal 0
          ifpdistl 1280
		   ifcansee
    {
      addphealth -1000
      palfrom 63 63
    }
  }
ends

actor BOSS1STAYPUT BOSS1STRENGTH cactor BOSS1 state monst_glow enda
actor BOSS1 BOSS1STRENGTH fall state boss1code state monst_glow enda

// *********************************************************************************************************
// BOSS 2 (CYCLOID EMPORER)
// *********************************************************************************************************

action ABOSS2WALK        0  4  5  1  30
action ABOSS2FROZEN        0  1  5
action ABOSS2RUN         0  4  5  1  15
action ABOSS2SHOOT         20 2  5  1  15
action ABOSS2LOB         30 2  5  1  105
action ABOSS2DYING        40 8  1  1  35
action BOSS2FLINTCH       40 1  1  1  1
action ABOSS2DEAD         48

move PALBOSS2SHRUNKRUNVELS 32
move PALBOSS2RUNVELS 84
move BOSS2WALKVELS 192
move BOSS2RUNVELS 256

ai AIBOSS2SEEKENEMY ABOSS2WALK BOSS2WALKVELS seekplayer
ai AIBOSS2RUNENEMY ABOSS2RUN BOSS2RUNVELS faceplayer
ai AIBOSS2SHOOTENEMY ABOSS2SHOOT STOP faceplayer
ai AIBOSS2LOBBED ABOSS2LOB STOP faceplayer
ai AIBOSS2DYING ABOSS2DYING STOP faceplayer
ai AIBOSS2PALSHRINK ABOSS2WALK PALBOSS2SHRUNKRUNVELS furthestdir

state boss2palshrunkstate
  ifcount SHRUNKDONECOUNT
  {
    cstat 257
    ai AITROOPSEEKENEMY
  }
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 40 40
	  }
  else
    state genericshrunkcode
ends

state checkboss2seekstate
  ai AIBOSS2SEEKENEMY
  ifspritepal 0 nullop
  else   // a fake way of doing a ifspritepal NOT.
    move PALBOSS2RUNVELS seekplayer
ends

state boss2runenemystate
  ifcansee
  {
    ifactioncount 3
    {
      ifcanshoottarget
      {
	   ifpdistl 8192 { quake 6 }
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS2SEEKENEMY
    }
    ifcount 48
      ifrnd 2
    {
      ifp palive
      {
        sound BOS2_ATTACK
        ai AIBOSS2SHOOTENEMY
      }
      break
    }
  }
  else
    ai AIBOSS2SEEKENEMY
ends

state boss2seekenemystate
  ifrnd 2
    soundonce BOS2_ROAM
  else
    ifactioncount 3
  {
        ifpdistl 8192 { quake 6 }
    resetactioncount
    sound BOS1_WALK
  }

  ifcansee
    ifcount 32
      ifp palive
        ifrnd 48
          ifcanshoottarget
  {
    ifrnd 64
      ifpdistg 4096
    {
      ai AIBOSS2RUNENEMY
      ifspritepal 0 nullop
      else
        move PALBOSS2RUNVELS seekplayer
      break
    }

    ifpdistl 10240
    {
      ifrnd 128
      {
        sound BOS2_ATTACK
        ai AIBOSS2LOBBED
      }
    }
    else
    {
      sound BOS2_ATTACK
      ai AIBOSS2SHOOTENEMY
    }
  }
ends

state boss2dyingstate
  ifaction ABOSS2DEAD
  {
    ifspritepal 0
      break


    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        guts JIBS2 5              // Instead of the normal "standard_jibs"
        guts JIBS3 5              // amount, I found that ,because these
        guts JIBS4 5              // bodies are so huge, they should spawn
        guts JIBS5 15             // a more realistic amount of gutter!
        guts JIBS6 15
        debris SCRAP1 5           // There are also spawned some metal
        debris SCRAP2 5           // scraps, since this boss has a lot
        debris SCRAP5 5           // of metalware with him.
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 8
  {
    iffloordistl 8
      sound BOSSFALL
	ifspritepal 0 quake 26
    action ABOSS2DEAD
    cstat 0
    ifspritepal 0
      { 
	ifn VOLUME 5 
		{
		ife VOLUME 0 ife LEVEL 7 
			{
			state save_arrays
			state fatigue_system
			state budget_system
			endofgame 52
			}
		}
	}
  }
ends

state boss2lobbedstate
  ifcansee
  {
    ifactioncount 2
      resetactioncount
    else
      ifactioncount 1
    {
      ifrnd 128
        shoot COOLEXPLOSION1
    }
    else
      ifcount 64
        ifrnd 16
          state checkboss2seekstate
  }
  else
    state checkboss2seekstate
ends

state boss2shootenemy
  ifcount 72
    state checkboss2seekstate
  else
    ifaction ABOSS2SHOOT
      ifactioncount 2
  {
    sound ERPG_SHOOT
    shoot RPG
    resetactioncount
  }
ends

defstate checkboss2hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
		ife VOLUME 6
		 ife LEVEL 60
			{
			operateactivators 3001 THISACTOR
			set LOTAGSAVED 0
			}
			else
  	ifn LOTAGSAVED 0 
		{
		globalsound MUS_CY_DEFEAT
		operateactivators LOTAGSAVED THISACTOR
		operatemasterswitches LOTAGSAVED
		operaterespawns LOTAGSAVED
		set LOTAGSAVED 0
		}
  	ifn XVELSAVED 0 
		{
		operateactivators XVELSAVED THISACTOR
		operatemasterswitches XVELSAVED
		operaterespawns XVELSAVED
		set XVELSAVED 0
		}
  
      ifg ICE_DAMAGE 0
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS2FROZEN
        strength 0
        break
      }

    sound BOS2_DYING

    addkills 1
	state thegames_score

    ai AIBOSS2DYING
  }
  else
  {
    ifrnd 144
    {
      ifrnd 32
      {
        action BOSS2FLINTCH
        move 0
      }
      else
      {
        sound BOS2_ATTACK
        ai AIBOSS2SHOOTENEMY
      }
    }

    ifspritepal 0 nullop
    else
      ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIBOSS2PALSHRINK
      break
    }

    soundonce BOS2_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

state boss2code

  ifaction ABOSS2FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS2SEEKENEMY
        spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      ifrnd 84 spawn BLOODPOOL
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  ifai 0
  {
	state monst_glow
  globalsound BOS2_RECOG
  spawn SHOOTME
    ifspritepal 0
	  {
	  set CURBOSS THISACTOR
	  set BOSS_TYPE 1
      ai AIBOSS2RUNENEMY
	  }
    else
    {
      strength 1500
      sound BOS2_ATTACK ai AIBOSS2SHOOTENEMY
    }
  }
  else
    ifaction BOSS2FLINTCH
  {
    ifactioncount 3
      ai AIBOSS2SEEKENEMY
  }
  else
    ifai AIBOSS2SEEKENEMY
      state boss2seekenemystate
  else
    ifai AIBOSS2RUNENEMY
      state boss2runenemystate
  else
    ifai AIBOSS2SHOOTENEMY
      state boss2shootenemy
  else
    ifai AIBOSS2LOBBED
      state boss2lobbedstate
  else
    ifai AIBOSS2PALSHRINK
      state boss2palshrunkstate

  ifai AIBOSS2DYING
    state boss2dyingstate
  else
  {
geta[].htextra TEMP6
ifhitweapon
	{
	state checkboss2hitstate
	ifg TEMP6 POINT_AMOUNT
		{
		geta[].htowner TEMP4
		geta[TEMP4].picnum TEMP5
		ife TEMP5 1405
			{
			getactorvar[TEMP4].P_CREDITS TEMP6
			add TEMP6 1
			setactorvar[TEMP4].P_CREDITS TEMP6
			}
		} 
	}
    else
      ifp palive
        ifspritepal 0 
		ifpdistl 1280
		 ifcansee
    {
      addphealth -1000
      palfrom 63 63
    }
  }


ends

actor BOSS2 BOSS2STRENGTH fall state monst_glow state boss2code enda

// **************************************************************************************************
// BOSS 3 (Overlord)
// **************************************************************************************************

action ABOSS3WALK        0  4  5  1  30
action ABOSS3FROZEN        0  1  5
action ABOSS3RUN         0  4  5  1  15
action ABOSS3LOB        20 4  5  1  50
action ABOSS3LOBBING      30 2  5  1  15
action ABOSS3DYING        40 8  1  1  20
action BOSS3FLINTCH       40 1  1  1  1
action ABOSS3DEAD         48

move PALBOSS3SHRUNKRUNVELS 32
move PALBOSS3RUNVELS 84
move BOSS3WALKVELS 208
move BOSS3RUNVELS 270
move BOSS3STOPPED

ai AIBOSS3SEEKENEMY ABOSS3WALK BOSS3WALKVELS seekplayer
ai AIBOSS3RUNENEMY ABOSS3RUN BOSS3RUNVELS faceplayerslow
ai AIBOSS3LOBENEMY ABOSS3LOB BOSS3STOPPED faceplayer
ai AIBOSS3DYING ABOSS3DYING BOSS3STOPPED faceplayer
ai AIBOSS3PALSHRINK ABOSS3WALK PALBOSS3SHRUNKRUNVELS fleeenemy

state boss3palshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AIBOSS3SEEKENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 40 40
	  }
  else
    state genericshrunkcode
ends

state checkboss3seekstate
  ai AIBOSS3SEEKENEMY
  ifspritepal 0 nullop
  else   // a fake way of doing a ifspritepal NOT.
    move PALBOSS3RUNVELS seekplayer
ends

state boss3runenemystate
  ifcansee
  {
    ifactioncount 3
    {
      ifcanshoottarget
      {
        ifpdistl 8192 { quake 6 }
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS3SEEKENEMY
    }
  }
  else
    ai AIBOSS3SEEKENEMY
ends

state boss3seekenemystate
  ifrnd 2
    soundonce BOS3_ROAM
  else
    ifactioncount 3
    {
        ifpdistl 8192 { quake 6 }
      resetactioncount
      sound BOS1_WALK
    }

  ifcansee
    ifcount 32
      ifrnd 48
        ifcanshoottarget
  {
    ifrnd 64
      ifpdistg 4096
      {
        ai AIBOSS3RUNENEMY
        ifspritepal 0
          break
        move PALBOSS3RUNVELS seekplayer
        break
      }

    ifp palive
      ai AIBOSS3LOBENEMY
  }
ends

state boss3dyingstate
  ifaction ABOSS3DEAD
  {
    ifspritepal 0
      break

    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        guts JIBS2 5              // Instead of the normal "standard_jibs"
        guts JIBS3 5              // amount, I found that ,because these
        guts JIBS4 5              // bodies are so huge, they should spawn
        guts JIBS5 15             // a more realistic amount of gutter!
        guts JIBS6 15
        debris SCRAP1 5           // There are also spawned some metal
        debris SCRAP2 5           // scraps, since this boss has a lot
        debris SCRAP5 5           // of metalware with him.
        ifrnd 6
          {
            guts JIBS1 3
            spawn BLOODPOOL
          }                       // a badly drawn spine
        state jib_sounds            
        killit
      }
      break
    }
  }
  ifactioncount 8
  {
    iffloordistl 8
      sound BOSSFALL
      ifspritepal 0 quake 26
    action ABOSS3DEAD
    cstat 257
    ifspritepal 0
      { 
		ife VOLUME 6 
			{
			readarrayfromfile BEAT_EPISODES 4053
			ife LEVEL 26 // Daikarain
				{ 
					ifand BEAT_EPISODES[6] 32768 nullop else 
						{ 
						set TEMP BEAT_EPISODES[6]
						xorvar TEMP 32768
						setarray BEAT_EPISODES[6] TEMP
						writearraytofile BEAT_EPISODES 4053
						}
				
				ifn CHEATED 1
					{
					readarrayfromfile SKILL_MEDALS 4030
					ifl SKILL_MEDALS[216] SKILL_LEVEL setarray SKILL_MEDALS[216] SKILL_LEVEL
					writearraytofile SKILL_MEDALS 4030		
					}
				} 
			state save_arrays
			state fatigue_system
			state budget_system
			ifn base_level 0 ifn base_volume -1 startlevel base_volume base_level else
			startlevel 6 0
			}
		else { ife VOLUME 0 ife LEVEL 7 { state save_arrays state fatigue_system state budget_system endofgame 52 } }
	}
  }
ends

state boss3lobbedstate
  ifcansee
  {
    ifaction ABOSS3LOBBING
      ifactioncount 2
    {
	sound ERPG_SHOOT
      shoot RPG
      resetactioncount
      ifrnd 8
        ai AIBOSS3SEEKENEMY
    }

    ifactioncount 3
    {
      action ABOSS3LOBBING
      resetcount
    }
  }
  else
    state checkboss3seekstate
ends

defstate checkboss3hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
      globalsound DUKE_TALKTOBOSSFALL
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifg ICE_DAMAGE 0
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS3FROZEN
        strength 0
        break
      }
    }

    addkills 1
	state thegames_score
    ai AIBOSS3DYING

    sound BOS3_DYING

  }
  else
  {
    ifrnd 32
    {
      action BOSS3FLINTCH
      move 0
    }

    ifspritepal 0 nullop
    else
      ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIBOSS3PALSHRINK
      break
    }

    soundonce BOS3_PAIN
    debris SCRAP1 1
    guts JIBS6 1
  }
ends

defstate boss3code

  ifaction ABOSS3FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS3SEEKENEMY
        spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }

      addkills 1
	  state thegames_score
      lotsofglass 20

      ifrnd 84
        spawn BLOODPOOL
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  ifai 0
  {
 	state monst_glow
  globalsound BOS3_RECOG
  spawn SHOOTME
    ifspritepal 0
	  {
	  set CURBOSS THISACTOR
	  set BOSS_TYPE 1
      ai AIBOSS3RUNENEMY
	  }
    else
    {
      strength BOSS3PALSTRENGTH
      ai AIBOSS3LOBENEMY
    }                  
  }
  else
    ifaction BOSS3FLINTCH
    {
      ifactioncount 3
      ai AIBOSS3SEEKENEMY
    }
  else
    ifai AIBOSS3SEEKENEMY
      state boss3seekenemystate
  else
    ifai AIBOSS3RUNENEMY
      state boss3runenemystate
  else
    ifai AIBOSS3LOBENEMY
      state boss3lobbedstate
  else
    ifai AIBOSS3PALSHRINK
      state boss3palshrunkstate

  ifai AIBOSS3DYING
    state boss3dyingstate
  else
  {
	geta[].htextra TEMP6
	ifhitweapon
		{
		state checkboss3hitstate
		ifg TEMP6 POINT_AMOUNT
			{
			geta[].htowner TEMP4
			geta[TEMP4].picnum TEMP5
			ife TEMP5 1405
				{
				getactorvar[TEMP4].P_CREDITS TEMP6
				add TEMP6 1
				setactorvar[TEMP4].P_CREDITS TEMP6
				}
			} 
		}
    else
      ifp palive
        ifspritepal 0
          ifpdistl 1280
		   ifcansee
      {
        addphealth -1000
        palfrom 63 63
      }
  }
ends

actor BOSS3 BOSS3STRENGTH fall state boss3code state monst_glow enda
useractor enemystayput BOSS3STAYPUT BOSS3STRENGTH fall cactor BOSS3 state monst_glow enda

// **************************************************************************************************
// FAT COMMANDER
// **************************************************************************************************

move SMOKEVEL2 36

defstate smokering

// ife TEMP7 0 { set TEMP7 1 break }
// else set TEMP7 0

geta[].x mx
set TEMP5 mx
geta[].y TEMP6
add mx 256
randvar TEMP 127
set TEMP2 0

whilevarn TEMP2 1
{
	rotatepoint TEMP5 TEMP6 mx TEMP6 TEMP TEMP3 TEMP4
	add TEMP 128
	ifg TEMP 2047 set TEMP2 1
	ifrnd 128
	{
		espawn SMALLSMOKE
		seta[RETURN].x TEMP3
		seta[RETURN].y TEMP4
		seta[RETURN].ang TEMP
		seta[RETURN].cstat 32768
	}
}

ends

action ACOMMBREETH  0  3  5  1  40
action ACOMMFROZEN  0  1  5
action ACOMMSPIN   -5  1  5  1  12
action ACOMMGET   0  3  5  1  30
action ACOMMSHOOT  20  1  5   1 35
action ACOMMABOUTTOSHOOT 20 1 5 1 30
action ACOMMDYING  30  8  1  1  12
action ACOMMDEAD   38  1  1  1  1

action ACOMM_H_DYING 25 5 1 1 12
action ACOMM_H_DEAD 29 1 1 1 1


move COMMGETUPVELS 128 -64
move COMMGETVELS 128 64
move COMMSLOW 64 24

ai AICOMMWAIT ACOMMBREETH STOP faceplayerslow
ai AICOMMGET ACOMMGET COMMGETVELS seekplayer
ai AICOMMSHOOT ACOMMSHOOT STOP faceplayerslow
ai AICOMMABOUTTOSHOOT ACOMMABOUTTOSHOOT STOP faceplayerslow
ai AICOMMSPIN ACOMMSPIN COMMGETVELS spin
ai AICOMMDYING ACOMMDYING STOP faceplayer
ai AICOMM_H_DYING ACOMM_H_DYING STOP faceplayer
ai AICOMMSHRUNK ACOMMGET COMMSLOW furthestdir
ai AICOMMGROW ACOMMGET STOP furthestdir

defstate checkcommhitstate

  ifhitweapon
  {

	state NEWGUNEFFECTS

    guts JIBS6 2

    ifdead
    {
      ifg ICE_DAMAGE 0
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ACOMMFROZEN
        strength 0
        break
      }
      else
        ifwasweapon GROWSPARK
      {
        sound ACTOR_GROWING
        ai AICOMMGROW
        break
      }

      addkills 1
	  state thegames_score

      ifwasweapon RADIUSEXPLOSION
      {
        spawn BLOODPOOL
        state squish_sounds
        state standard_jibs
		 		ifn XVELSAVED 0 
				{
				operateactivators XVELSAVED THISACTOR
				operatemasterswitches XVELSAVED
				operaterespawns XVELSAVED
				set XVELSAVED 0
				}
        killit
      }
      else
        ifwasweapon RPG
      {
        state squish_sounds
        spawn BLOODPOOL
        state standard_jibs
		 ifn XVELSAVED 0 
			{
			operateactivators XVELSAVED THISACTOR
			operatemasterswitches XVELSAVED
			operaterespawns XVELSAVED
			set XVELSAVED 0
			}
        killit
      }

      
	  ife HEADSHOT 2
	   ifrnd 96
		{ 
		ifrnd 32 state trigger_showoff
		sound DECAPITATE 
		state jib_sounds
		ai AICOMM_H_DYING shoot NJIB shoot NJIB guts JIBS6 3 guts JIBS2 2 
		} 
	else
      {
	  sound COMM_DYING
	  ai AICOMMDYING
	  }
    }
    else
    {
      soundonce COMM_PAIN
      ifwasweapon SHRINKSPARK
      {
        sound ACTOR_SHRINKING
        ai AICOMMSHRUNK
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
      else
        ifrnd 24
          ai AICOMMABOUTTOSHOOT
    }
  }
ends

actor COMMANDERSTAYPUT COMMANDERSTRENGTH
  spawn SHOOTME
  cactor COMMANDER
  state monst_glow
  ai AICOMMABOUTTOSHOOT
enda

actor COMMANDER 
state ENEMYKNOCKBACKS
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

  state checksquished

  ifaction ACOMMFROZEN
  {
    fall

    ifcount THAWTIME
    {
      getlastpal
      ai AICOMMWAIT
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else ifai AICOMMDYING nullop else ifai AICOMM_H_DYING nullop else ifai AICOMMSHRUNK nullop else iffloordistl 16 state smokering
  
  ifai AICOMMDYING nullop else ifai AICOMM_H_DYING nullop else soundonce COMM_AMB
  
  ifg ENEMY_TALKING 0 sub ENEMY_TALKING 1
  
  ifai 0
	{
	state monst_glow
	spawn SHOOTME
	stopsound COMM_RECOG 
	ifrnd 128 ifn CHAR 10 ifn CHAR 12 sound COMM_RECOG3 // AMC squad!
	else ife CHAR 1 sound COMM_RECOG2 // Die earthling		
	else ife CHAR 14 sound COMM_RECOG2 // Die earthling		
	else sound COMM_RECOG // standard Die Human!


	set ENEMY_TALKING 45
ifspritepal 20 strength 500 else 
ifspritepal 24 { sizeat 50 50 strength 750 } else
strength COMMANDERSTRENGTH
    ai AICOMMSHOOT	
	}
  else
    ifai AICOMMWAIT
  {
    ifcount 20
    {
      ifcansee
      {
        ifcanshoottarget
        {
          ifrnd 96
            ai AICOMMGET
          else
            ai AICOMMABOUTTOSHOOT
        }
      }
      else
        ai AICOMMGET
    }
  }
  else
    ifai AICOMMABOUTTOSHOOT
  {
    ifactioncount 2
    {
      ifcansee
        ai AICOMMSHOOT
      else
      {
        ai AICOMMGET
        break
      }
    }
    ifrnd 32 
	 ife ENEMY_TALKING 0
		{
		ifrnd 96 soundonce COMM_ATTACK
		else ifrnd 128 soundonce COMM_ATTACK2
		else soundonce COMM_ATTACK3
		set ENEMY_TALKING 45
		}
  }
  else
    ifai AICOMMSHOOT
  {
    ifcanshoottarget
    {
      ifcount 24
        ifrnd 16
          ai AICOMMWAIT
      ifactioncount 2
      {
	  ifspritepal 24
		  {
		shoot 14644
		sound CY_PLASMA_FIRE
		}
		else
		{
		sound ERPG_SHOOT
		shoot RPG
		}
			
			ife PERFMODE 1
			ifcansee
			{
			set gunsmoke_z 1 
			set gunsmoke_angle 0
			state spawn_gunsmoke_z
			set gunsmoke_z 1844
			espawn 16114
			ifspritepal 24 seta[RETURN].pal 8
			state spawn_muzzleflash
			}
		
        resetactioncount
      }
    }
    else
      ai AICOMMGET
  }
  else
    ifai AICOMMSHRUNK
  {
    ifcount SHRUNKDONECOUNT
      ai AICOMMGET
    else
      ifcount SHRUNKCOUNT
	    {
		sound ACTOR_UNSHRINK
        sizeto 48 40
		}
    else
      state genericshrunkcode
  }
  else
    ifai AICOMMGROW
      state genericgrowcode
  else
    ifai AICOMMGET
  {
    ifnotmoving
      ifrnd 4
        operate
    ifpdistl 1024
      ifp palive
	   ife player_in_vehicle 0
		{
		state check_actor_hitscan
			ife hitsprite PLAYER_IDENTITY
			{
		  sound COMM_SPIN
		  ai AICOMMSPIN
		  break
			}
		}

    ifcansee
    {
      ifp phigher
        move COMMGETUPVELS getv geth faceplayer
      else
        move COMMGETVELS getv geth faceplayer
    }
    ifactioncount 8
      ifrnd 2
        ai AICOMMABOUTTOSHOOT
  }
  else
    ifai AICOMMSPIN
  {
    soundonce COMM_SPIN
    ifcount 16
    {
      ifpdistl 1280
      {
        addphealth CAPTSPINNINGPLAYER
        sound DUKE_GRUNT
        palfrom 32
        16 resetcount
      }
      else
        ifpdistg 2300
          ai AICOMMWAIT
    }
    ifactioncount 52
      ai AICOMMWAIT
    ifnotmoving
      ifrnd 32
        operate
  }

  ifai AICOMMDYING
  {
 		ifn XVELSAVED 0 
				{
				operateactivators XVELSAVED THISACTOR
				operatemasterswitches XVELSAVED
				operaterespawns XVELSAVED
				set XVELSAVED 0
				}
    fall
    strength 0

    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      spawn BLOODPOOL
      state standard_jibs
      killit
    }

    ifaction ACOMMDYING
      ifactioncount 8
    {
	stopactorsound THISACTOR COMM_AMB
      iffloordistl 8
        state BODY_FALL_NOISES
      cstat 0
      action ACOMMDEAD
    }
  }
  else
  ifai AICOMM_H_DYING
  {
 		ifn XVELSAVED 0 
				{
				operateactivators XVELSAVED THISACTOR
				operatemasterswitches XVELSAVED
				operaterespawns XVELSAVED
				set XVELSAVED 0
				}
    fall
    strength 0

    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      spawn BLOODPOOL
      state standard_jibs
      killit
    }

    ifaction ACOMM_H_DYING
      ifactioncount 5
    {
	stopactorsound THISACTOR COMM_AMB
      iffloordistl 8
        state BODY_FALL_NOISES
      cstat 0
      action ACOMM_H_DEAD
    }
  }
  else
  {
    ifrnd 2
	 ife ENEMY_TALKING 0
       { 
	   soundonce COMM_ROAM
	   set ENEMY_TALKING 40
	   }
    state checkcommhitstate
  }
enda


// **************************************************************************************************
// PIGCOP TANK
// **************************************************************************************************

define TANKSTRENGTH       500      // 2 3 4 5 7 8
//           off-set, numofframes, numofrot, skipframes, delay
action ATANKSPIN   0 1 7 1 4
action ATANKSHOOTING 7 2 7 1 10
action ATANKWAIT 0 1 7 1 1
action ATANKDESTRUCT 0 1 7 1 1
action ATANKDEAD 0 1 7 1 1
// move TANKVEL horiz vert
move TANKFORWARD 100

useractor enemystayput TANKSTAYPUT TANKSTRENGTH fall cactor TANK enda

useractor enemy TANK TANKSTRENGTH fall


  ifstrength 200
	{
	ifrnd 16 { sound SHORT_CIRCUIT shoot SPARK shoot SPARK }
	geta[].x TEMP
	geta[].y TEMP2

	set TEMP3 TEMP
	randvarvar TEMP4 512
	add TEMP3 TEMP4
	randvar TEMP4 2048

	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	espawn GUNSMOKE

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6
	
	geta[].z TEMP7
	sub TEMP7 6144
	randvar TEMP8 2048
	ifrnd 128 mulvar TEMP8 -1
	add TEMP7 TEMP8
	seta[RETURN].z TEMP7

	}
	
//state MECH_DAMAGE_MODIFIER

  ifaction 0
  {
	state monst_glow
    spawn SHOOTME
    sizeat 60 60
    action ATANKWAIT
    cstat 257
    clipdist 100
  }
  else
    ifaction ATANKSPIN
  {
    soundonce TANK_ROAM
	ifcount 8
			{
			ifinwater nullop else
			ifonwater nullop else
			spawn 2085
			resetcount
			}

    ifactioncount 20
    {
      ifrnd 16
        ifcansee
          ifcanshoottarget
      {
        move STOP geth
        action ATANKSHOOTING
        stopsound TANK_ROAM
      }
    }

    ifrnd 16
      move TANKFORWARD seekplayer
  }
  else
    ifaction ATANKSHOOTING
  {
    ifactioncount 22
    {
      ifpdistg 8192
      {
	  ifspritepal 25
		{
		sound FIREBALL_FIRE
		shoot 7047
		}
		else
		{
        sound BOS1_ATTACK2
        shoot MORTER
		}
      }
      resetcount
      move 0 action ATANKWAIT
    }
    else
      ifactioncount 2
    {
	ife TEMP6 0
		{		
			set gunsmoke_z 8244 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			geta[].x TEMP
			geta[].y TEMP2
			set TEMP3 TEMP
			add TEMP3 512
			geta[].ang TEMP4
			add TEMP4 gunsmoke_angle
			randvar TEMP5 16
			ifrnd 128 add TEMP4 TEMP5 else sub TEMP4 TEMP5
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			espawn 16115
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 8244 seta[RETURN].z TEMP
			espawn 16115
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 9644 seta[RETURN].z TEMP
			set TEMP6 1
		}
	ife TEMP6 1
		{		
			set gunsmoke_z 8244 
			set gunsmoke_angle -256
			state spawn_gunsmoke_z
			geta[].x TEMP
			geta[].y TEMP2
			set TEMP3 TEMP
			add TEMP3 512
			geta[].ang TEMP4
			add TEMP4 gunsmoke_angle
			randvar TEMP5 16
			ifrnd 128 add TEMP4 TEMP5 else sub TEMP4 TEMP5
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			espawn 16115
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 8244 seta[RETURN].z TEMP
			espawn 16115
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 9644 seta[RETURN].z TEMP
			set TEMP6 0
		}
      ifcansee
      {
        ifpdistl 16384
        {
          ifrnd 128
          {
		  ifspritepal 25
			{
			sound NAILGUN_FIRE
			eshoot 6826
			setthisprojectile[RETURN].extra 6
			}
			else
			{
            sound PISTOL_FIRE
            shoot SHOTSPARK1
			}
          }
        }
        else
          ifrnd 128
        {
		 sound PRED_ATTACK
		 shoot FIRELASER
        }
      }
      else
      {
        move TANKFORWARD seekplayer
        action ATANKSPIN
      }
    }

    ifrnd 16
    {
      stopsound TANK_ROAM
      move STOP faceplayerslow
    }
  }
  else
    ifaction ATANKWAIT
  {
    ifactioncount 32
    {
      move TANKFORWARD seekplayer
      action ATANKSPIN
    }
  }
  else
    ifaction ATANKDESTRUCT
  {
    ifactioncount 64
      { 
	  espawn PIGCOP 
	  action ATANKDEAD
	  
	  addkills 1
	state thegames_score
    hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
    sound LASERTRIP_EXPLODE
    debris SCRAP1 15
    spawn EXPLOSION2
    ifrnd 128
      {
        ifrnd 128
          espawn 2081
        else
          espawn 2082
      }
    else
      {
        ifrnd 128
          espawn 2083
        else
          espawn 2084
      }
	 seta[RETURN].pal sprite[].pal
	killit	  	  
	  }
    else
      ifactioncount 56
       sound LASERTRIP_ARMING
     else
       ifactioncount 48
         sound LASERTRIP_ARMING
     else
       ifactioncount 32
         sound LASERTRIP_ARMING
     else
       ifactioncount 16
         sound LASERTRIP_ARMING
     break
  }

  ifhitweapon
  {
    ifdead
		{
		state squish_sounds 
		state standard_jibs
		addkills 1
		state thegames_score
		hitradius 6144 TOUGH TOUGH TOUGH REALLYTOUGH
		sound LASERTRIP_EXPLODE
		debris SCRAP1 15
		spawn EXPLOSION2
		ifrnd 128
		  {
			ifrnd 128
			  espawn 2081
			else
			  espawn 2082
			seta[RETURN].pal sprite[].pal
		action 0
		move 0
		  }
		else
		  {
			ifrnd 128
			  espawn 2083
			else
			  espawn 2084
			seta[RETURN].pal sprite[].pal
		  }
		killit
		}
    else
    {
      debris SCRAP1 1
      ifaction ATANKSHOOTING break

      ifrnd 192
      {
        move STOP geth
        action ATANKSHOOTING
        stopsound TANK_ROAM
      }
    }
  }

  ifpdistl 1280
    ifhitspace
      ifp pfacing
        ifangdiffl 512
          action ATANKDESTRUCT
enda

useractor notenemy 2085
sizeat 32 32
cstat 546
ifcount 260 killit
enda

state WRECKCODE
ifaction 0
	{
	  sizeat 60 60
	  move 0
	  cstat 257
	  
	  clipdist 100
	  strength 100
	  action ZERO
    }
  
	ifhitweapon
		{
		debris SCRAP1 2
			ifdead
				{
				sound VENT_BUST
				debris SCRAP1 8
				debris SCRAP2 8
				debris SCRAP3 8
				killit
				}
		}
  
ends

useractor notenemy 2081
  state WRECKCODE
enda

useractor notenemy 2082
  state WRECKCODE
enda

useractor notenemy 2083
  state WRECKCODE
enda

useractor notenemy 2084
  state WRECKCODE
enda

// **************************************************************************************************
// BOSS 4 (Queen)
// **************************************************************************************************

action ABOSS4WALK          0 4  5  1  30
action ABOSS4DYING        35 9  1  1  20
action ABOSS4ABOUTTOSHOOT 20 1  5  1  40
action ABOSS4SHOOT        25 2  5  1  10
action ABOSS4LAYIT        45 3  5  1  120
action BOSS4FLINTCH       35 1  1  1  1
action ABOSS4DEAD         44

move BOSS4WALKVELS 128

ai AIBOSS4LAYEGGS ABOSS4WALK BOSS4WALKVELS seekplayer
ai AIBOSS4SHOOT ABOSS4ABOUTTOSHOOT STOP faceplayer
ai AIBOSS4DYING ABOSS4DYING STOP faceplayer

defstate boss4shootstate
  ifaction ABOSS4ABOUTTOSHOOT
    ifactioncount 3
      action ABOSS4SHOOT

  ifaction ABOSS4SHOOT
  {
    ifcount 48
    {
      ifrnd 4
        ai AIBOSS4LAYEGGS
    }
    ifcount 26
      ifrnd 32
    {
	flash
      ifrnd 128
      {
        sound SHORT_CIRCUIT
        ifinwater addphealth -2 else ifcansee addphealth -2
      }
      else
	  ifcansee
      {
        sound DUKE_GRUNT
        ifinwater addphealth -1 else ifcansee addphealth -1
      }
      palfrom 32 32 0 0
    }
  }

ends

defstate boss4layeggs
  ifrnd 2
	{
	setactorsoundpitch THISACTOR BOS4_ROAM 0
    sound BOS4_ROAM
	}
	
	ifaction ABOSS4WALK
		{
		ifactioncount 4
			{
			ifpdistl 8192 { quake 6 }
			ife TEMP6 1 sound BIG_BOSS_WALK2 else sound BOS1_WALK
	        resetactioncount
			}
		else
		ifactioncount 2
			{
			ifpdistl 8192 { quake 6 }
			ife TEMP6 1 sound BIG_BOSS_WALK1 else sound BOS1_WALK
			}
		}

  ifaction ABOSS4LAYIT
  {
    ifactioncount 3
      ifcount 32
    {
      ai AIBOSS4LAYEGGS
      ifrnd 32
        move BOSS4WALKVELS furthestdir geth
      spawn NEWBEASTHANG
    }
  }
  else
    ifcount 64
      ifrnd 4
  {
    move 0

    ifrnd 88
    {
      action ABOSS4LAYIT
	  setactorsoundpitch THISACTOR BOS4_LAY 0
      sound BOS4_LAY
    }
    else
      ifp palive
        ifcansee
    {
      ai AIBOSS4SHOOT
	  setactorsoundpitch THISACTOR BOS4_ATTACK 0
      sound BOS4_ATTACK
    }
  }

ends

defstate boss4dyingstate
  ifaction ABOSS4DEAD
    break
  else
    ifactioncount 9
  {
    iffloordistl 8
      sound BOSSFALL
	quake 26
	ifn VOLUME 5 
		{
		ife VOLUME 6 { state save_arrays state fatigue_system state budget_system setp[].fist_incs 32 }
		else { ife VOLUME 0 ife LEVEL 7 { state save_arrays state fatigue_system state budget_system endofgame 52 } }
		}

    action ABOSS4DEAD
    cstat 0
  }
ends

defstate checkboss4hitstate
  ifrnd 2
    spawn BLOODPOOL

  ifdead
  {
    globalsound DUKE_TALKTOBOSSFALL

    addkills 1
	state thegames_score
    ai AIBOSS4DYING

	setactorsoundpitch THISACTOR BOS4_DYING 0
    sound BOS4_DYING
  }
  else
  {
  setactorsoundpitch THISACTOR BOS4_PAIN 0
    soundonce BOS4_PAIN
    debris SCRAP1 1
    guts JIBS6 1

    ifaction ABOSS4LAYIT
      break

    ifrnd 16
    {
      action BOSS4FLINTCH
      move 0
    }
  }
ends

defstate boss4code

  ifai 0
    { 
	state monst_glow
	ifspritepal 0 
		{
		set CURBOSS THISACTOR
		set BOSS_TYPE 1
		}
	setactorsoundpitch THISACTOR BOS4_RECOG 0
	globalsound BOS4_RECOG 
	spawn SHOOTME
	ai AIBOSS4LAYEGGS 
	}
  else
    ifaction BOSS4FLINTCH
    {
      ifactioncount 3
        ai AIBOSS4LAYEGGS
    }
  else
    ifai AIBOSS4LAYEGGS
      state boss4layeggs
  else
    ifai AIBOSS4SHOOT
      state boss4shootstate

  ifai AIBOSS4DYING
    state boss4dyingstate
  else
  {
geta[].htextra TEMP7
ifhitweapon
	{
    state checkboss4hitstate
	ifg TEMP7 POINT_AMOUNT
	{
	geta[].htowner TEMP4
	geta[TEMP4].picnum TEMP5
	ife TEMP5 1405
		{
		getactorvar[TEMP4].P_CREDITS TEMP6
		add TEMP6 1
		setactorvar[TEMP4].P_CREDITS TEMP6
		}
	}
    else
      ifp palive
        ifpdistl 1280
      {
        addphealth -1000
        palfrom 63 63
      }
	}
  }
ends

actor BOSS4STAYPUT BOSS4STRENGTH

  fall
  cactor BOSS4
  ifspritepal 49 { sizeat 200 200 set TEMP6 1 }
  //spritepal 6
  state boss4code
  getlastpal

enda

actor BOSS4 BOSS4STRENGTH

  fall
  ifspritepal 49 { sizeat 200 200 set TEMP6 1 }
  //spritepal 6
  state boss4code
  getlastpal

enda

action QUEEN_SHOCK 0 2 5 1 5

spriteshadow 4765

useractor notenemy 4765

ifspritepal 49
		{
		ifaction 0 action QUEEN_SHOCK
		}
		
ifaction QUEEN_SHOCK
	{
	soundonce TESLA_ARC
	ifactioncount 1 sets[].visibility 240
	ifactioncount 2 { sets[].visibility 244 resetactioncount }
	}

enda

// *********************************************************************************************************
// BOSS 2 (CYCLOID HIGH EMPORER)
// *********************************************************************************************************

action ABOSS5IDLE        49  1  5  1  20
action ABOSS5WALK        0  4  5  1  30
action ABOSS5FROZEN        0  1  5
action ABOSS5RUN         0  4  5  1  15
action ABOSS5SHOOT         20 2  5  1  15
action ABOSS5LOB         30 2  5  1  105
action ABOSS5DYING        40 8  1  1  35
action BOSS5FLINTCH       40 1  1  1  1
action ABOSS5DEAD         48

move PALBOSS5SHRUNKRUNVELS 32

ai AIBOSS5SEEKENEMY ABOSS5WALK BOSS2WALKVELS seekplayer
ai AIBOSS5RUNENEMY ABOSS5RUN BOSS2RUNVELS faceplayer
ai AIBOSS5SHOOTENEMY ABOSS5SHOOT STOP faceplayer
ai AIBOSS5LOBBED ABOSS5LOB STOP faceplayer
ai AIBOSS5DYING ABOSS5DYING STOP faceplayer
ai AIBOSS5PALSHRINK ABOSS5WALK PALBOSS5SHRUNKRUNVELS furthestdir

defstate BOSS5palshrunkstate
  ifcount SHRUNKDONECOUNT
  {
    cstat 257
    ai AITROOPSEEKENEMY
  }
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 40 40
	  }
  else
    state genericshrunkcode
ends

defstate checkBOSS5seekstate
  ai AIBOSS5SEEKENEMY
  ifspritepal 0 nullop
  else   // a fake way of doing a ifspritepal NOT.
    move PALBOSS2RUNVELS seekplayer
ends

defstate BOSS5runenemystate
  ifcansee
  {
    ifactioncount 3
    {
      ifcanshoottarget
      {
	   quake 6
        resetactioncount
        ifrnd 128 sound BIG_BOSS_WALK2 else sound BIG_BOSS_WALK1
      }
      else
        ai AIBOSS5SEEKENEMY
    }
    ifcount 48
      ifrnd 2
    {
      ifp palive
      {
        sound BOS2_ATTACK
        ai AIBOSS5SHOOTENEMY
      }
      break
    }
  }
  else
    ai AIBOSS5SEEKENEMY
ends

defstate BOSS5seekenemystate
  ifrnd 2
    soundonce BOS2_ROAM
  else
    ifactioncount 3
  {
      quake 6
    resetactioncount
    ifrnd 128 sound BIG_BOSS_WALK2 else sound BIG_BOSS_WALK1
  }

  ifcansee
    ifcount 32
      ifp palive
        ifrnd 48
          ifcanshoottarget
  {
    ifrnd 64
      ifpdistg 4096
    {
      ai AIBOSS5RUNENEMY
      ifspritepal 0 nullop
      else
        move PALBOSS2RUNVELS seekplayer
      break
    }

    ifpdistl 10240
    {
      ifrnd 128
      {
        sound BOS2_ATTACK
        ai AIBOSS5LOBBED
      }
    }
    else
    {
      sound BOS2_ATTACK
      ai AIBOSS5SHOOTENEMY
    }
  }
ends

defstate BOSS5dyingstate
  ifaction ABOSS5DEAD
  {
    ifspritepal 0
      break
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        guts JIBS2 5              // Instead of the normal "standard_jibs"
        guts JIBS3 5              // amount, I found that ,because these
        guts JIBS4 5              // bodies are so huge, they should spawn
        guts JIBS5 15             // a more realistic amount of gutter!
        guts JIBS6 15
        debris SCRAP1 5           // There are also spawned some metal
        debris SCRAP2 5           // scraps, since this boss has a lot
        debris SCRAP5 5           // of metalware with him.
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 8
  {
  ifpdistl 8192 wackplayer
    iffloordistl 8
      sound BOSSFALL
	ifspritepal 0 quake 52
    action ABOSS5DEAD
    cstat 0
    ifspritepal 0
      { 
	ifn VOLUME 5 
		{
		state save_arrays
		state fatigue_system
		state budget_system
		}
	}
  }
ends

defstate BOSS5lobbedstate
  ifcansee
  {
    ifactioncount 2
      resetactioncount
    else
      ifactioncount 1
    {
      ifrnd 128
        shoot COOLEXPLOSION1
    }
    else
      ifcount 64
        ifrnd 16
          state checkBOSS5seekstate
  }
  else
    state checkBOSS5seekstate
ends

defstate BOSS5shootenemy
  ifcount 72
    state checkBOSS5seekstate
  else
    ifaction ABOSS5SHOOT
      ifactioncount 2
  {
    sound ERPG_SHOOT
    shoot RPG
    resetactioncount
  }
ends

defstate checkBOSS5hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
      globalsound DUKE_TALKTOBOSSFALL
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifg ICE_DAMAGE 0
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS5FROZEN
        strength 0
        break
      }
    }

    sound BOS2_DYING

    addkills 1
	state thegames_score

    ai AIBOSS5DYING
  }
  else
  {
    ifrnd 144
    {
      ifrnd 32
	  ifstrength 2000
      {
        action BOSS5FLINTCH
        move 0
      }
      else
      {
        sound BOS2_ATTACK
        ai AIBOSS5SHOOTENEMY
      }
    }

    ifspritepal 0 nullop
    else
      ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIBOSS5PALSHRINK
      break
    }

    soundonce BOS2_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

defstate BOSS5code

  ifaction ABOSS5FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS5SEEKENEMY
        spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      ifrnd 84 spawn BLOODPOOL
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  ifai 0
  {
	state monst_glow
  cstat 257
  globalsound BOS2_RECOG
  sizeat 75 75
  spawn SHOOTME
    ifspritepal 0
	  {
	  set CURBOSS THISACTOR
	  set BOSS_TYPE 1
      ai AIBOSS5RUNENEMY
	  }
    else
    {
      strength 1
      sound BOS2_ATTACK ai AIBOSS5SHOOTENEMY
    }
  }
  else
    ifaction BOSS5FLINTCH
  {
    ifactioncount 3
      ai AIBOSS5SEEKENEMY
  }
  else
    ifai AIBOSS5SEEKENEMY
      state BOSS5seekenemystate
  else
    ifai AIBOSS5RUNENEMY
      state BOSS5runenemystate
  else
    ifai AIBOSS5SHOOTENEMY
      state BOSS5shootenemy
  else
    ifai AIBOSS5LOBBED
      state BOSS5lobbedstate
  else
    ifai AIBOSS5PALSHRINK
      state BOSS5palshrunkstate

  ifai AIBOSS5DYING
    state BOSS5dyingstate
  else
  {
geta[].htextra TEMP6
ifhitweapon
	{
	seta[].xvel 0
	state checkBOSS5hitstate
	ifg TEMP6 POINT_AMOUNT
		{
		geta[].htowner TEMP4
		geta[TEMP4].picnum TEMP5
		ife TEMP5 1405
			{
			getactorvar[TEMP4].P_CREDITS TEMP6
			add TEMP6 1
			setactorvar[TEMP4].P_CREDITS TEMP6
			}
		} 
	}
    else
      ifp palive
        ifspritepal 0 
		ifpdistl 1280
		 ifcansee
    {
      addphealth -1000
      palfrom 63 63
    }
  }


ends

useractor enemy BOSS5 9000 ABOSS5IDLE fall state BOSS5code enda

// **************************************************************************************************
// Protector Drone
// **************************************************************************************************

action ANEWBEASTSTAND     0
action ANEWBEASTWALKING   10  4  5  1  12
action ANEWBEASTRUNNING   10  4  5  1  8
action ANEWBEASTTHINK     0   2  5  1  40
action ANEWBEASTSCRATCHING  30  3  5  1  20
action ANEWBEASTDYING     72  8  1  1  15
action ANEWBEASTFLINTCH   71  1  1  1  1
action ANEWBEASTLYINGDEAD 79  1  1
action ANEWBEASTSCREAM    50  2  5  1  40
action ANEWBEASTJUMP      80  2  5  1  50
action ANEWBEASTFALL      90  1  5
action ANEWBEASTFROZEN    10  1  5

spriteflags NEWBEAST SFLAG_NODAMAGEPUSH

spriteshadow 4705

action PETRINEWBEAST -85 1 5
action PNSMASHUP 1 7 1 1 10
action PNSMASHED 7 1 1 1 1

useractor notenemy 4705
cstat 257
fall

ifaction 0 
{
spritepal 27
action PETRINEWBEAST
}

ifaction PETRINEWBEAST
{
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick

ifhitweapon
	{
	cstat 0
	sound NB_EXPLODE
	guts JIBS6 20
	action PNSMASHUP
	}
}

ifaction PNSMASHUP
ifactioncount 7
	{
	cstat 0
	action PNSMASHED
	}

enda

action ANEWBEASTHANG      0  1  5
useractor enemy NEWBEASTHANG NEWBEASTSTRENGTH
  ifaction 0
  {
  	state monst_glow
	spriteflags NORMAL_ENEMY
  ifspawnedby BOSS4 spritepal 15
  spawn SHOOTME
    action ANEWBEASTHANG
    cstator 257
    sizeat 40 40
  }
  else
    ifhitweapon
  {
   ifdead
     {
	 spritepal 8
	  addkills 1
      state standard_jibs
      spawn 4679
      state squish_sounds
      killit
	 }
	 else
	 {
    cactor NEWBEAST
    action ANEWBEASTSTAND
    sound NEWBEAST_PAIN
	 }
  }
  else
    ifspawnedby BOSS4
      ifcount 200
        ifrnd 1
  {
    cactor NEWBEAST
    action ANEWBEASTSTAND
    sound NEWBEAST_PAIN
  }
enda

action ANEWBEASTHANGDEAD      -1  1  5
useractor enemy NEWBEASTHANGDEAD TOUGH

  ifaction 0
  {
	state monst_glow
    action ANEWBEASTHANGDEAD
    sizeat 40 40
    cstator 257
  }
  else
    ifhitweapon
  {
    ifdead
    {
      state standard_jibs
      spawn 4679
      state squish_sounds
      killit
    }
    else
    {
	ifrnd 32 { shoot 4714 shoot 4714 }
      guts JIBS6 1
      state squish_sounds
    }
  }
enda

move NEWBEASTWALKVEL 182
move NEWBEASTRUNVEL 356
move NEWBEASTJUMPVEL 264

ai AINEWBEASTGETENEMY ANEWBEASTWALKING NEWBEASTWALKVEL seekplayer
ai AINEWBEASTDODGE ANEWBEASTRUNNING NEWBEASTRUNVEL dodgebullet
ai AINEWBEASTCHARGEENEMY ANEWBEASTRUNNING NEWBEASTRUNVEL seekplayer
ai AINEWBEASTFLEENEMY ANEWBEASTWALKING NEWBEASTWALKVEL fleeenemy
ai AINEWBEASTSCRATCHENEMY ANEWBEASTSCRATCHING STOP faceplayerslow
ai AINEWBEASTJUMPENEMY ANEWBEASTJUMP NEWBEASTJUMPVEL jumptoplayer
ai AINEWBEASTTHINK ANEWBEASTTHINK STOP
// ai AINEWBEASTSHRUNK ANEWBEASTWALKING SHRUNKVELS fleeenemy
ai AINEWBEASTGROW ANEWBEASTSTAND  STOP faceplayerslow
ai AINEWBEASTDYING ANEWBEASTDYING STOP faceplayer
ai AINEWBEASTSHOOT ANEWBEASTSCREAM STOP faceplayerslow
ai AINEWBEASTFLINTCH ANEWBEASTFLINTCH STOP faceplayerslow


state newbeastseekstate

  ifactornotstayput
  {
    ifp palive
      ifcansee
        ifpdistl 1596
    {
	sound NEWBEAST_ATTACKMISS
      ai AINEWBEASTSCRATCHENEMY
      break
    }

    ifai AINEWBEASTCHARGEENEMY
    {
      ifp palive
        ifpdistl 1596
          ifcansee
      {
	  sound NEWBEAST_ATTACKMISS
        ai AINEWBEASTSCRATCHENEMY
        break
      }

      ifrnd 1
        ifpdistg 4096
          ifp palive
            ifcansee
      {
        ai AINEWBEASTSHOOT
        break
      }
    }
    else
      ifpdistg 4096
    {
      ai AINEWBEASTCHARGEENEMY
      break
    }

    iffloordistl 16
    {
      ifcount 32
        ifrnd 16
      {
        ifceilingdistl 96 break
        ai AINEWBEASTJUMPENEMY
      }
      break
    }

    ifrnd 4
    {
      ifnotmoving
        operate
    }
    else
      ifrnd 16
        ifbulletnear
    {
      ifgapzl 128
        ai AINEWBEASTDODGE
      else
        ifactornotstayput
      {
        ifrnd 128
        {
          ifceilingdistl 96 break
          ai AINEWBEASTJUMPENEMY
        }
        else
          ai AINEWBEASTDODGE
      }
    }
  }
  else
  {
    ifactioncount 16
    {
      ifp palive
        ifpdistl 1596
          ifcansee
      {
	  sound NEWBEAST_ATTACKMISS
        ai AINEWBEASTSCRATCHENEMY
        break
      }
    }
    ifcount 16
      ifrnd 32
        move NEWBEASTWALKVEL randomangle geth
  }

ends

/*
state newbeastshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AINEWBEASTGETENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends
*/

state newbeastfleestate
  ifcount 8
  {
    ifrnd 64
      ifpdistg 3500
        ifp palive
          ifcansee
            ai AINEWBEASTSHOOT
  }
  else
  {
    iffloordistl 16
    {
      ifnotmoving
        ai AINEWBEASTGETENEMY
    }
    else
      ai AINEWBEASTGETENEMY
    break
  }
ends

state newbeastthinkstate

  ifrnd 8
    soundonce NEWBEAST_ROAM

  ifactioncount 3
  {
    ifrnd 128
    {
      ifpdistg 3500
        ifp palive
          ifcansee
            ai AINEWBEASTSHOOT
    }
    else
      ai AINEWBEASTGETENEMY
  }

  ifrnd 16
    ifbulletnear
  {
    ifgapzl 96
      ai AINEWBEASTDODGE
    else
    {
      ifrnd 128
      {
        ifceilingdistl 144 break
        ai AINEWBEASTJUMPENEMY
      }
      else
        ai AINEWBEASTDODGE
    }
  }
ends

state newbeastscratchstate
  ifcount 20
    ifrnd 8
  {
    ifcansee
      ifpdistl 2048
    {
      ifrnd 128
        ai AINEWBEASTFLEENEMY
      break
    }
    ifrnd 80
      ai AINEWBEASTTHINK
    else
      ai AINEWBEASTGETENEMY
  }

  ifactioncount 3
  {
    ifpdistg 1596
      ai AINEWBEASTTHINK
    else ifp palive ifcansee
    {
	ifspritepal 3 { shoot 4609 shoot 4609 }
      shoot 4609
      resetactioncount
      resetcount
    }
  }
  else
    ifcount 15
      soundonce EJECT_CLIP // blank sound, game gives warning message if nullop or { }
  else
    ifcount 14
	  soundonce EJECT_CLIP // blank sound, game gives warning message if nullop or { }
ends

state checknewbeasthit

state NEWGUNEFFECTS

  // GROSS HACK TO SET PAL OF BLOOD SPLATS TO GREEN
  spritepal 8
  guts JIBS6 1
  getlastpal
  
  // previous way of spawning blood -- also gets deleted due to deleting hardcoded red splats
  espawn BLOOD seta[RETURN].pal 8
  ifwasweapon SHOTSPARK1 shoot 4714
/*
  ifai AINEWBEASTSHRUNK
  {
    addkills 1
    state squish_sounds
    state standard_jibs
    killit
  }
*/
  ifdead
  {
  ifai AINEWBEASTDYING break
    ifg ICE_DAMAGE 0
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ANEWBEASTFROZEN
      strength 0
      break
    }

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AINEWBEASTGROW
      break
    }

    addkills 1
	state thegames_score

    ifwasweapon RPG
    {
      state squish_sounds
	  shoot 4714 shoot 4714 shoot 4714 shoot 4714 shoot 4714
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
	  shoot 4714 shoot 4714 shoot 4714 shoot 4714 shoot 4714
      state standard_jibs
      killit
    }
    else
    {
      state rf
	  shoot 4714 shoot 4714 shoot 4714 shoot 4714 shoot 4714
      ai AINEWBEASTDYING
      ifrnd 128
        spawn 4679
    }
	ifspritepal 3 sound ALIENS_DIE else
    sound NEWBEAST_DYING
  }
  else
  {
    sound NEWBEAST_PAIN
    ifwasweapon GROWSPARK
      sound EXPANDERHIT
/*
//  The alien is immune to the shrinker
    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AINEWBEASTSHRUNK
      break
    }
*/
    state random_wall_jibs
    ifg PAIN_AMOUNT 0
      ai AINEWBEASTFLINTCH
	 else
    ifrnd 32
		{
		state PAIN_SKILL_LEVELADJUST
        ai AINEWBEASTFLINTCH
		}
    else
      ifrnd 32
        ifpdistg 3500
          ifp palive
            ifcansee
              ai AINEWBEASTSHOOT
  }
ends

state newbeastjumpstate
  ifaction ANEWBEASTFALL
  {
    iffloordistl 16
      ai AINEWBEASTGETENEMY
  }
  else
    ifcount 32
      action ANEWBEASTFALL
ends

state newbeastdyingstate
  ifaction ANEWBEASTLYINGDEAD
  {
  ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
  }
  else
    ifai AINEWBEASTDYING
      ifactioncount 7
  {
    iffloordistl 8
      state BODY_FALL_NOISES
    move STOP
    action ANEWBEASTLYINGDEAD
  }
ends

state newbeastdodgestate
  ifcount 13
    ai AINEWBEASTGETENEMY
ends

useractor enemystayput NEWBEASTSTAYPUT NEWBEASTSTRENGTH ai AINEWBEASTGETENEMY cstator 257  sizeat 40 40 spawn SHOOTME cactor NEWBEAST enda
useractor enemy NEWBEASTJUMP NEWBEASTSTRENGTH ai AINEWBEASTJUMPENEMY cstator 257 sizeat 40 40 spawn SHOOTME cactor NEWBEAST enda

defstate newbeastcode
  state checksquished
  ifai 0
  {
  spawn SHOOTME
    cstator 257
    ai AINEWBEASTGETENEMY
  }
  else
    ifaction ANEWBEASTLYINGDEAD
  {
    fall
    state newbeastdyingstate
    break
  }
  else
    ifaction ANEWBEASTFROZEN
  {
    ifcount THAWTIME
    {
      ai AINEWBEASTGETENEMY
      spritepal 0
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      ifrnd 128
        spawn 4679
      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else
    ifai AINEWBEASTJUMPENEMY
      state newbeastjumpstate
  else
  {
    fall
    ifai AINEWBEASTGETENEMY
      state newbeastseekstate
    else
      ifai AINEWBEASTCHARGEENEMY
        state newbeastseekstate
    else
      ifai AINEWBEASTFLINTCH
    {
	sub PAIN_AMOUNT 1
      ife PAIN_AMOUNT 0
        ai AINEWBEASTGETENEMY
    }

    else
      ifai AINEWBEASTDODGE
        state newbeastdodgestate
    else
      ifai AINEWBEASTSCRATCHENEMY
        state newbeastscratchstate
    else
      ifai AINEWBEASTFLEENEMY
        state newbeastfleestate
    else
      ifai AINEWBEASTTHINK
        state newbeastthinkstate
/*
    else
      ifai AINEWBEASTSHRUNK
        state newbeastshrunkstate
*/
    else
      ifai AINEWBEASTGROW
        state genericgrowcode
    else
      ifai AINEWBEASTDYING
        state newbeastdyingstate
    else
      ifai AINEWBEASTSHOOT
    {
      ifp pshrunk
        ai AINEWBEASTGETENEMY
      else
        ifcount 26
          ai AINEWBEASTGETENEMY
      else
        ifcount 25
          {
		  ifspritepal 3 { shoot SPIT shoot SPIT shoot SPIT shoot SPIT } else
		ifspritepal 17 { sound SPELL8FIRE shoot SPELL8 } else
	{ sound SHRINKER_FIRE shoot SHRINKER }
	   }
      else
      {
        ifcount 5
          nullop
        else
          ifcount 4
            sound NEWBEAST_SPIT
      }
    }
  }

  ifhitweapon
    state checknewbeasthit
ends


useractor enemy NEWBEAST NEWBEASTSTRENGTH
  fall
  ifaction 0
  {
 	state monst_glow
	
	ifspritepal 3 ifrnd 64 sound ALIENS_RECOG
	
    spawn SHOOTME
    cstator 257
    sizeat 40 40
    ai AINEWBEASTDODGE
  }

state ENEMYKNOCKBACKS
state enemy_ice_damage
state enemy_fire_damage
state enemy_spirit_damage

  ifaction ANEWBEASTFROZEN
    state newbeastcode
  else
  {
ife sprite[].pal 0 seta[].pal 15
    state newbeastcode
    ifaction ANEWBEASTFROZEN
      break
  }
enda

// ********************************************
// SHARK
// ********************************************

action ASHARKCRUZING 0 8 5 1 24
action ASHARKFLEE  0 8 5 1 10
action ASHARKATACK   0 8 5 1 6
action ASHARKSHRUNK  0 8 5 1 24
action ASHARKGROW  0 8 5 1 24
action ASHARKFROZEN  0 1 5 1 24

move SHARKVELS 24
move SHARKFASTVELS 72
move SHARKFLEEVELS 40
move SHARKUP 72 -40
move SHARKDOWN 72 40

actor SHARK SHARKSTRENGTH 

ifaction 0
{
state monst_glow
action ASHARKCRUZING 
move SHARKVELS randomangle geth
}

ifspritepal 6 nullop
else ifspritepal 4 nullop
else
	{
   gets[].lotag TEMP
   ifn TEMP 2
   {
       seta[].x TEMP2
       seta[].y TEMP3
       seta[].z TEMP4
       updatesectorz TEMP2 TEMP3 TEMP4 TEMP5
       ifn TEMP5 -1 changespritesect THISACTOR TEMP5
   }
   else
   {
       geta[].x TEMP2
       geta[].y TEMP3
       geta[].z TEMP4
   }
	}

  ifaction ASHARKSHRUNK
  {
    ifcount SHRUNKDONECOUNT
      action ASHARKCRUZING
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 60 60
	  }
    else
      state genericshrunkcode
    break
  }
  else
    ifaction ASHARKGROW
  {
    ifcount SHRUNKDONECOUNT
      action ASHARKCRUZING
    else
      ifcount SHRUNKCOUNT
        sizeto 24 24
    else
      state genericgrowcode
  }
  else
    ifaction ASHARKFROZEN
  {
    fall

    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick

    ifcount THAWTIME
    {
      action ASHARKFLEE
      getlastpal
      break
    }
    else
      ifcount FROZENDRIPTIME
        ifactioncount 26
          resetactioncount

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
        break

      lotsofglass 20
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      addkills 1
	  state thegames_score
      killit
    }
    break
  }
  else
    ifaction ASHARKFLEE
  {
    ifcount 16
      ifrnd 48
    {
      action ASHARKCRUZING
      move SHARKVELS randomangle geth
    }
  }
  else
    ifaction ASHARKCRUZING
  {
    ifcansee
      ifcount 48
        ifrnd 64
          ifpdistl 2048
    {
      action ASHARKATACK
    }
     else
      ifp phigher ifrnd 128
        move SHARKUP getv faceplayer geth
      else
		{
		geta[].z z
		getp[].posz TEMP
		ifg TEMP z ifrnd 128 move SHARKDOWN getv faceplayer geth
		}

  }
  else
    ifaction ASHARKATACK
  {
      ifpdistl 1280
      {
      move SHARKFASTVELS faceplayer getv
        ifp palive ifcanshoottarget
        {
		 state check_actor_hitscan
			ife hitsprite PLAYER_IDENTITY
			{
            palfrom 32 32
			sound OCTA_ATTACK2	
			wackplayer
			addphealth SHARKBITESTRENGTH
			}
        }
        action ASHARKFLEE
        move SHARKFLEEVELS fleeenemy
      }
     else
      ifp phigher ifrnd 128
        move SHARKUP faceplayer getv geth
    else
      ifnotmoving
    {
      ifcount 32
      {
        action ASHARKCRUZING
        move SHARKVELS randomangle geth
      }
    }
    else
      ifcount 48
        ifrnd 2
    {
      action ASHARKCRUZING
      move SHARKFASTVELS randomangle geth
    }
      else
		{
		geta[].z z
		getp[].posz TEMP
		ifg TEMP z ifrnd 128 move SHARKDOWN getv faceplayer geth
		}
  }

  ifhitweapon
  {
state NEWGUNEFFECTS

    ifdead
    {
      ifwasweapon GROWSPARK
      {
        move 0
        cstat 0
        action ASHARKGROW
        sound ACTOR_GROWING
        break
      }
      else
        ifg ICE_DAMAGE 0
      {
        spritepal 1
        strength 0
        action ASHARKFROZEN
        sound SOMETHINGFROZE
      }
      else
      {
        state squish_sounds
        guts JIBS6 5
        addkills 1
		state thegames_score
        killit
      }
    }
    else
    {
      ifwasweapon SHRINKSPARK
      {
        action ASHARKSHRUNK
        sound ACTOR_SHRINKING
        move 0
        break
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT

      move SHARKVELS randomangle geth
    }
  }
enda



// **************************************************************************************************
// TRIAD GANGSTER
// **************************************************************************************************

action ATRIADIDLE     0  1 5 1 10
action ATRIADFROZEN 0 1 5 1 10
action ATRIADWALK     0  4 5 1 20
action ATRIADRUN      0  4 5 1 11
action ATRIADSHOOT 20 2 5 1 11
action ATRIADTHROW 30 3 5 1 20

action ATRIADFLINCH 83 1 1 1 20

action ATRIADDYING 60 7 1 1 15
action ATRIADDEAD 66 1 1 1 1

action ATRIADHDYING 76 6 1 1 15
action ATRIADHDEAD 82 1 1 1 15

action ATRIADCHOPDY 67 9 1 1 12
action ATRIADCHOPD 75 1 1 1 1


action ATRIADJUMP 40 3 5 1 20
action ATRIADFALL 50 1 5 1 1

move TRIADWALKVELS 72
move TRIADRUNVELS 108 
move TRIADJUMPVELS 158

ai AITRIADIDLE ATRIADIDLE STOP
ai AITRIADSEEKENEMY ATRIADWALK TRIADWALKVELS seekplayer
ai AITRIADRUSHENEMY ATRIADRUN TRIADRUNVELS faceplayer
ai AITRIADSHOOT ATRIADSHOOT STOP faceplayer
ai AITRIADDEAD ATRIADDEAD STOP faceplayer
ai AITRIAD_HEAD_DEAD ATRIADHDEAD STOP faceplayer
ai AITRIADCHOPD ATRIADCHOPD STOP faceplayer
ai AITRIADTHROW ATRIADTHROW STOP faceplayer
ai AITRIADJUMP ATRIADJUMP TRIADJUMPVELS jumptoplayer
ai AITRIADSHRUNK ATRIADRUN TRIADRUNVELS furthestdir
ai AITRIADGROW ATRIADIDLE STOP

useractor enemystayput TRIADSTAYPUT
ife sprite[].pal 0 seta[].pal 22
state monst_glow
cactor TRIAD
enda

useractor enemy TRIADJUMP 50
ifaction 0
{
set MONSTER_FLAGS 2
state monst_glow
geta[].htflags TEMP2
orvar TEMP2 4096
orvar TEMP2 4194304
seta[].htflags TEMP2
set ENEMY_TALKING 0
ifspritepal 0 spritepal 36
ifspritepal 10 strength 100 else
ifspritepal 16 strength 75 else
ifspritepal 49 strength 150 else
strength 50
ifspritepal 16 nullop
else
	{
	ifrnd 96 soundonce TRIADALERT
	else ifrnd 96 soundonce TRIADALERT2
	else ifrnd 96 soundonce TRIADALERT3
	set ENEMY_TALKING 60
	}
sizeat 22 22
action ATRIADJUMP
ai AITRIADJUMP
cstator 257
cactor TRIAD
}
enda

useractor enemy TRIAD 50 ATRIADIDLE
fall

ifai 0
{
set MONSTER_FLAGS 2
state monst_glow
spriteflags 3	
spawn SHOOTME
ifspritepal 0 spritepal 36
set ENEMY_TALKING 0
ifspritepal 10 strength 100 else
ifspritepal 16 strength 75 else
ifspritepal 49 strength 150 else
strength 50
ifspritepal 16 nullop
else
	{
	ifrnd 96 soundonce TRIADALERT
	else ifrnd 96 soundonce TRIADALERT2
	else ifrnd 96 soundonce TRIADALERT3
	set ENEMY_TALKING 60
	}
sizeat 22 22
ai AITRIADIDLE
cstator 257
}

//ifspritepal 49 state BODYA_DAMAGE_MODIFIER // Modifier for Enemies with Body Armour

state spawn_cold_breathe

ifg ENEMY_TALKING 0 sub ENEMY_TALKING 1

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifaction ATRIADFROZEN
{
move 0
state frozen_code
}
else
ifaction ATRIADFALL
{
move TRIADRUNVELS 0
iffloordistl 16 ai AITRIADSEEKENEMY
}
else
ifaction ATRIADFLINCH
{
move 0
sub PAIN_AMOUNT 1
ife PAIN_AMOUNT 0 ai AITRIADSEEKENEMY
}
else
ifaction ATRIADHDYING
{
strength 0
ifactioncount 4 state BODY_FALL_NOISES_SOUNDONCE 
ifactioncount 6 { cstat 0 state rf spawn 16368 ai AITRIAD_HEAD_DEAD }
}
else
ifaction ATRIADDYING
{
strength 0
ifactioncount 4 state BODY_FALL_NOISES_SOUNDONCE 
ifactioncount 7 { spawn 16368 ai AITRIADDEAD }
}
else
ifaction ATRIADCHOPDY
{
strength 0
seta[].xvel -2
ifactioncount 9 { state BODY_FALL_NOISES spawn 16368 ai AITRIADCHOPD }
}
else
ifai AITRIADDEAD
{
strength 0
move 0

    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		state human_jibs
        state standard_jibs
        killit
      }
      break
    }

}
else
ifai AITRIAD_HEAD_DEAD
{
strength 0
move 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		state human_jibs
        state standard_jibs
        killit
      }
      break
    }

}
else
ifai AITRIADCHOPD
{
strength 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		state human_jibs
        state standard_jibs
        killit
      }
      break
    }

}
else
ifai AITRIADGROW
state genericgrowcode
else
ifai AITRIADSHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AITRIADSEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 28 28
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AITRIADJUMP
{
ifactioncount 4 action ATRIADFALL
}
else
ifai AITRIADIDLE
{
ifp pdead nullop
else
	{
	state correctcansee
	ife sightvar YES ai AITRIADSEEKENEMY
	}
}
else
ifai AITRIADSEEKENEMY
{
ifand ENEMY_KILLED 1 // Triad is killed?
  ife ENEMY_TALKING 0 // no speech coming from this guy?
   ifrnd 96
	{
	ifrnd 128 sound TRIAD_MANDOWN1
	else ifrnd 128 sound TRIAD_MANDOWN2
	else sound TRIAD_MANDOWN3
	set ENEMY_TALKING 60
	set ENEMY_KILLED 0
	}
	
ifp pdead
	{
	ife ENEMY_TALKING 0
		{
		ifrnd 96 soundonce TRIAD_KILLPL1
		else ifrnd 96 soundonce TRIAD_KILLPL2
		set ENEMY_TALKING 60
		}
	ai AITRIADIDLE
	}

geta[].htmovflag TEMP
ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
{
         andvar TEMP 49152
         ife TEMP 32768 // the actor is pushing on a wall
         {
           geta[].htmovflag TEMP2 // need to get the info again
           andvar TEMP2 16383 // temp now stores the wall number
                   getwall[TEMP2].nextsector sect
                   ifn sect -1
				   {
				   ifand wall[TEMP2].cstat 1 break
				   ife sector[sect].lotag 20 operate
				   ife sector[sect].lotag 21 operate
				   ife sector[sect].lotag 22 operate
				   ife sector[sect].lotag 23 operate
                      ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
						{
                        ai AITRIADJUMP
                        }
					}
          }
}

ifrnd 2 
 ife ENEMY_TALKING 0
	{ 
	ifspritepal 16 nullop 
	else 
	ifcanseetarget
		{
		ifrnd 96 soundonce TRIAD_SEEPL2
		else ifrnd 96 soundonce TRIAD_SEEPL3
		else soundonce TRIADROAM 
		set ENEMY_TALKING 60
		}
		else
		{
		ifrnd 96 soundonce TRIAD_FINDPL1
		else ifrnd 96 soundonce TRIAD_FINDPL2
		else soundonce TRIAD_FINDPL3
		set ENEMY_TALKING 60
		}
	}
ifpdistl 5120
 ifrnd 32
  {
   ai AITRIADRUSHENEMY
  }
else
 ifrnd 64
   ifcanshoottarget
	{
	state SKILL_SHOOT_LEVELADJUST
	ifl RANDOM_CHANCE SKILLCHANCE ai AITRIADSHOOT
	}
else ifrnd 2 ai AITRIADIDLE
}
else
ifai AITRIADRUSHENEMY
{

geta[].htmovflag TEMP
ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
{
         andvar TEMP 49152
         ife TEMP 32768 // the actor is pushing on a wall
         {
           geta[].htmovflag TEMP2 // need to get the info again
           andvar TEMP2 16383 // temp now stores the wall number
                   getwall[TEMP2].nextsector sect
                   ifn sect -1
				   {
				   ifand wall[TEMP2].cstat 1 break
				   ife sector[sect].lotag 20 operate
				   ife sector[sect].lotag 21 operate
				   ife sector[sect].lotag 22 operate
				   ife sector[sect].lotag 23 operate
                      ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
						{
                        ai AITRIADJUMP
                        }
					}
          }
}

state correctcansee
	ife sightvar YES
	{
	ifrnd 16
	ifspritepal 49
	ifpdistg 4096
		{
		ai AITRIADTHROW
		}
	else
	ifrnd 16
	ifspritepal 10
	ifpdistg 2048
		{
		ai AITRIADTHROW
		}
	else
	ifrnd 64
		{
		state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE ai AITRIADSHOOT
		}
	}
}
else
ifai AITRIADTHROW
{
ifactioncount 2 
	{ 
	ifspritepal 49
		{
		sound GRENPIN 
		ifpdistl 4096 eshoot FL_GRENADE
		else eshoot H_GRENADE 
		setthisprojectile[RETURN].extra 60
		}
	else
	ifspritepal 10
		{
		shoot 3789
		eshoot 3789
		geta[RETURN].ang TEMP add TEMP 32 seta[RETURN].ang TEMP
		eshoot 3789
		geta[RETURN].ang TEMP sub TEMP 32 seta[RETURN].ang TEMP
		}
	ai AITRIADSEEKENEMY 
	}
} 
else
ifai AITRIADSHOOT
{
	ifactioncount 1 
	{
	state correctcansee
	ife sightvar YES
		{ 
		state SKILL_ENEMY_ACCURACY
		state DARKNESS_ENEMY_ACCURACY
		ifspritepal 10 { shoot CHAINGUN sound TMPFIRE } else
		ifspritepal 49 { shoot SHOTGUN sound SMG_SHOT } else
		ifspritepal 16 { shoot SHOTSPARK1 sound SMAC10FIRE } else
		{ shoot SHOTSPARK1 sound TRIAD_FIRE }
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 8244 
			set gunsmoke_angle 0
			state spawn_gunsmoke_z
			ifspritepal 16 nullop else
			{
			set gunsmoke_z 6544
			espawn 16115
			state spawn_muzzleflash
			}
			randvar TEMP 1024 
			zshoot TEMP 13772
			}
		ifrnd 32 ai AITRIADSEEKENEMY
		resetactioncount 
		}
	else ai AITRIADSEEKENEMY
	}
}

ifhitweapon
{
state NEWGUNEFFECTS
ifaction ATRIADDYING break
ifaction ATRIADDEAD break
ifaction ATRIADHDEAD break
ifaction ATRIADHDYING break
// spawn BLOOD
guts JIBS6 1
state random_wall_jibs

 ifwasweapon RADIUSEXPLOSION
	ifstrength 0
	{
	set FIRE_DAMAGE 0 
		state human_jibs
        state squish_sounds
        state standard_jibs
        killit
      }

ifdead 
	{ 
	addkills 1  
	xorvar ENEMY_KILLED 1
	
	   set TEMP2 2649
		whilevarn TEMP2 2662 // This loops through and stops all possible speech from this actor
			{
			stopactorsound THISACTOR TEMP2
			add TEMP2 1
			}
	

	ifspritepal 49 ifrnd 16 spawn SMGSPRITE 
	
	geta[].htpicnum BULLET_HIT_TYPE
	ifand tiledata[BULLET_HIT_TYPE].gameflags 8 getprojectile[BULLET_HIT_TYPE].userdata PROJ_UDATA else set PROJ_UDATA 0
	
	ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AITRIADGROW break }
	else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ATRIADFROZEN } 
	else ifwasweapon 7163 	
	{ 		
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		spawn ONFIREGUY 
		killit 
	}
	else ifand PROJ_UDATA 8 // slashing death
	{ state sword_kill_sounds ifrnd 32 state trigger_showoff
	ife SWORD_ANIM 1 cstat 0 else cstat 4 sound SLASHDIE action ATRIADCHOPDY } 
	else ife HEADSHOT 2 
	  ifrnd 64
		{ 
		ifrnd 32 state trigger_showoff
		sound DECAPITATE 
		state jib_sounds
		action ATRIADHDYING shoot NJIB shoot NJIB guts JIBS6 3 guts JIBS2 2 
		} 
	else
	ifg ENERGY_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 4
		guts JIBS3 6
		spawn DISINTIGRATE_GUY
		killit
		}
	else
	ifg SPIRIT_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 1
		guts JIBS3 6
		spawn SPIRIT_DEATH_GUY
		killit
		}
	else
	ifg FIRE_DAMAGE 0 
	{ 		
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		set PLAYER_VOICEOVER 21
		spawn ONFIREGUY 
		killit 
	}
	else
	ifstrength -175
      {
	  set FIRE_DAMAGE 0 
		state human_jibs
        state squish_sounds
        state standard_jibs
        killit
      }
	else 
		{
		state rf 
		sound TRIADDIE 
		action ATRIADDYING
		}
	state thegames_score
	} 
else 
ifg PAIN_AMOUNT 0 action ATRIADFLINCH else
ifrnd 64 { soundonce TRIADPAIN state PAIN_SKILL_LEVELADJUST action ATRIADFLINCH }
ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AITRIADSHRUNK }
}
state checksquished
enda

// ***********************************************************************************************
// SATYR DEMON
// ***********************************************************************************************

action ASATYR_FROZEN 35 1 5 1 10
action ASATYRIDLE 0 1 5 1 10 
action ASATRYWALK      0  4 5 1 20
action ASATRYRUN      0  4 5 1 4
action ASATYRSLASH    20 3 5 1 15
action ASATYRFLINCH 35 1 5 1 10
action ASATYRGROW 35 1 5 1 10

action ASATYRDYING 40 6 1 1 10
action ASATYRDEAD 46 1 1 1 10

action ASATYR_H_DYING 395 7 1 1 10
action ASATYR_H_DEAD 401 1 1 1 10


move SATYRWALKVELS 80 
move SATYRRUNVELS 208 

ai AISATYRIDLE ASATYRIDLE STOP seekplayer
ai AISATYRSEEKENEMY ASATRYWALK SATYRWALKVELS seekplayer
ai AISATYRRUSHENEMY ASATRYRUN SATYRRUNVELS faceplayer
ai AISATYRSLASHENEMY ASATYRSLASH STOP faceplayer
ai AISATYRDEAD ASATYRDEAD STOP faceplayer
ai AISATYR_H_DEAD ASATYR_H_DEAD STOP faceplayer
ai AISATYRSHRUNK ASATRYRUN SATYRRUNVELS furthestdir
ai AISATYRGROW ASATYRGROW STOP seekplayer



useractor enemystayput SATYRSTAYPUT 175 ASATYRIDLE
spawn SHOOTME
sound SATYR_ALERT
state monst_glow
ifspritepal 47 { strength 300 sizeat 30 30 }
else { strength 175 sizeat 26 26 }
ai AISATYRSEEKENEMY
cstator 257
cactor SATYR
enda

useractor enemy SATYR 175 ASATYRIDLE
fall

ifai 0
	{
	state monst_glow
		spawn SHOOTME
		sound SATYR_ALERT
		ifspritepal 47 { setactorsoundpitch THISACTOR SATYR_ALERT -512 strength 300 sizeat 30 30 }
		else { strength 175 sizeat 26 26 }
		geta[].htflags temp
		orvar temp SFLAG_NODAMAGEPUSH
		seta[].htflags temp
		ai AISATYRIDLE
		cstator 257
	}

ifai AISATYRRUSHENEMY nullop else ifspritepal 47 nullop else state ENEMYKNOCKBACKS
state enemy_ice_damage
state enemy_spirit_damage

ifaction ASATYR_FROZEN
	state frozen_code
else
ifai AISATYRDEAD
	{
	move STOP
		ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
			shoot SATYR_HEAD
			state squish_sounds
		  state standard_jibs
			killit
		  }
		  break
		}
	}
else
ifai AISATYR_H_DEAD
	{
	move STOP
	ifhitweapon
		{
		ifwasweapon RADIUSEXPLOSION
			{
			state squish_sounds
			state standard_jibs
			killit
			}
		break
		}
	}
else
ifaction ASATYRDYING
	{
	strength 0
	ifactioncount 6 { state BODY_FALL_NOISES ai AISATYRDEAD }
	}
else
ifaction ASATYR_H_DYING
	{
	strength 0
	ifactioncount 6 { state BODY_FALL_NOISES ai AISATYR_H_DEAD }
	}
else
ifaction ASATYRFLINCH
	{
	ifdead break
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0 ai AISATYRSEEKENEMY
	}
else
ifai AISATYRGROW state genericgrowcode
else
ifai AISATYRSHRUNK
	{
		ifcount SHRUNKDONECOUNT
		  ai AISATYRSEEKENEMY
		else ifcount SHRUNKCOUNT
		  {
		  sound ACTOR_UNSHRINK
		ifspritepal 47 sizeto 52 52 else sizeto 46 46
		}
		else
		  state genericshrunkcode
		break
	}
else
ifai AISATYRIDLE
	{
		state correctcansee
		ifp palive
		ife sightvar YES
		{
		ifpdistl 8012 ai AISATYRRUSHENEMY else ai AISATYRSEEKENEMY
		}
		else ifrnd 128 ai AISATYRSEEKENEMY
	}
else
ifai AISATYRSEEKENEMY
	{
	state correctcansee	
	ifpdistl 8012 ife sightvar YES ifrnd 32 { sound SATYR_ALERT ifspritepal 47 setactorsoundpitch THISACTOR SATYR_ALERT -512 ai AISATYRRUSHENEMY }
	else ifrnd 2 ai AISATYRIDLE
	}
else
ifai AISATYRRUSHENEMY
	{
	state correctcansee
	ifpdistg 8012 ife sightvar YES ai AISATYRSEEKENEMY
	else ifpdistl 1024 ai AISATYRSLASHENEMY
	}
else
ifai AISATYRSLASHENEMY
{
	ifpdistg 1024 ai AISATYRRUSHENEMY else
	ifactioncount 3 
	{ 
	sound SCRATCHS
          palfrom 32 32
		ifspritepal 47 eshoot 17849 else
		eshoot 4609
		setthisprojectile[RETURN].isound SCRATCHS
		resetactioncount 
	}
}

ifhitweapon
{
	state NEWGUNEFFECTS
	sound SATYR_PAIN
	ifspritepal 47 setactorsoundpitch THISACTOR SATYR_PAIN -512
	//spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		addkills 1
		state rf
		state thegames_score
		  ifwasweapon RADIUSEXPLOSION
		  {
				eshoot SATYR_HEAD
				geta[RETURN].ang TEMP
				sub TEMP 1024
				seta[RETURN].ang TEMP
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				state squish_sounds
			  state standard_jibs
			killit
		  }
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AISATYRGROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action ASATYR_FROZEN } 
		else
			{
			ife HEADSHOT 2
				{
				state jib_sounds
				action ASATYR_H_DYING
				eshoot SATYR_HEAD
                
                geta[].htang TEMP
				seta[RETURN].ang TEMP
                
                geta[RETURN].z TEMP
                sub TEMP 1200
                seta[RETURN].z TEMP
                
                geta[].pal TEMP
                seta[RETURN].pal TEMP
				
                ifrnd 32 state trigger_showoff
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				}
				else
				{
				sound SATYR_DIE
				ifspritepal 47 setactorsoundpitch THISACTOR SATYR_DIE -512
				action ASATYRDYING
				spawn BLOODPOOL
				}
			}
		}
    else ifwasweapon KNEE ife CURWEAP 0 ife temp_weapon 16 { ifaction ASATYRSLASH nullop else action ASATYRFLINCH }
	else ifg PAIN_AMOUNT 0 action ASATYRFLINCH
	else ifrnd 64 { ifspritepal 24 nullop else ifaction ASATYRSLASH nullop else { state PAIN_SKILL_LEVELADJUST action ASATYRFLINCH } }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AISATYRSHRUNK }
}


state checksquished

enda

// ********************************************************************************************
// SHADE DEMON
// ********************************************************************************************

action ASHADE_FROZEN 35 1 5 1 10
action ASHADE_GROW 35 1 5 1 10
action ASHADEIDLE  0 1 5 1 20
action ASHADEWALK      0  4 5 1 20
action ASHADERUN      0  4 5 1 11
action ASHADEFIRE    20 3 5 1 25
action ASHADEFLINCH 35 1 5 1 10
action ASHADE_DISAPEAR 35 1 5 1 10
action ASHADEDYING 40 5 1 1 10


move SHADEWALKVELS 80 
move SHADERUNVELS 108 

ai AI_SHADE_DISAPEAR ASHADE_DISAPEAR STOP faceplayer
ai AISHADESEEKENEMY ASHADEWALK SHADEWALKVELS seekplayer
ai AISHADERUSHENEMY ASHADERUN SHADERUNVELS faceplayer
ai AISHADESHOOTENEMY ASHADEFIRE STOP faceplayer
ai AISHADESHRUNK ASHADERUN SHADERUNVELS furthestdir
ai AISHADEGROW ASHADE_GROW STOP seekplayer


useractor enemystayput SHADESTAYPUT
state monst_glow
cactor SHADE
enda

useractor enemy SHADE 75 ASHADEIDLE
fall

ifai 0
	{
	spawn SHOOTME
	state monst_glow
	seta[].blend 254
	ifspritepal 4 { strength 50 sizeat 24 24 } 
	else ifspritepal 24 { sound SHADE_ALERT strength 200 sizeat 30 30 }
	else { sound SHADE_ALERT strength 75 sizeat 24 24 }
	action ASHADERUN
	ai AISHADESEEKENEMY
	cstator 257
	}

state ENEMYKNOCKBACKS
state enemy_ice_damage
state enemy_spirit_damage

ifaction ASHADE_FROZEN
{
state frozen_code
}
else
ifaction ASHADEFLINCH
{
sub PAIN_AMOUNT 1
	move STOP 
	ife PAIN_AMOUNT 0 ai AISHADESEEKENEMY
}
else
ifaction ASHADEDYING
{
	strength 0
	ifactioncount 5 killit
}
else
ifai AISHADEGROW state genericgrowcode
else
ifai AISHADESHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AISHADESEEKENEMY
    else ifcount SHRUNKCOUNT
      {
	  sound ACTOR_UNSHRINK
	ifspritepal 4 sizeto 24 24
	else ifspritepal 24 sizeto 30 30
	else sizeto 24 24
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_SHADE_DISAPEAR
{
state enemyfindtarget
ife target -1 { cstat 257 sizeat 24 24 ai AISHADESEEKENEMY }
add INTERNALCOUNT 1
	spawn FRAMEEFFECT1
	ife INTERNALCOUNT 4 { cstat 2 soundonce DEMON_TELEPORT sizeto 2 24 }
	ifg INTERNALCOUNT 4 ifl INTERNALCOUNT 26 sizeto 2 24
	ife INTERNALCOUNT 26
	 ifg target 0
		{
			cstat 32768
			geta[target].x TEMP
			geta[target].y TEMP2
			set TEMP3 TEMP
			add TEMP3 1024
			randvar TEMP4 2048
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			updatesector TEMP5 TEMP6 TEMP7
			ifn TEMP7 -1
				{
				seta[].x TEMP5 
				seta[].y TEMP6
				gets[].floorz TEMP8
				seta[].z TEMP8
				espawn PENTAGRAM
				spawn BURNING2
				seta[RETURN].z TEMP8
				}
			else { cstat 257 sizeat 24 24 ai AISHADESEEKENEMY }
		} 
	ife INTERNALCOUNT 27 { soundonce DEMON_TELEPORT cstat 2 sizeto 24 24 spawn 8433 }
	ife INTERNALCOUNT 40 { spawn SHOOTME cstat 257 sizeat 24 24 ai AISHADESEEKENEMY }
}
else
ifai AISHADESEEKENEMY
{	
// state enemyfindtarget
state SKILL_SHOOT_LEVELADJUST
	ifspritepal 4 cstat 32768 else cstat 514
	ifrnd 4 ai AISHADESEEKENEMY
	ifpdistl 8012 ai AISHADERUSHENEMY else
	ifl xydist 8012 ai AISHADERUSHENEMY
	else ifg xydist 8012
		ifl RANDOM_CHANCE SKILLCHANCE
		 ife camerasprite -1
				{
				ife target -1
					{
					getp[].posx TEMP
					getp[].posy TEMP2
					}
				else
					{
					geta[target].x TEMP
					geta[target].y TEMP2
					}
				set TEMP3 TEMP
				add TEMP3 1024
				randvar TEMP4 2048
				rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
				updatesector TEMP5 TEMP6 TEMP7
				ifn TEMP7 -1
					{
					gets[TEMP7].floorshade TEMP8
					ifg SKILL_LEVEL 2 // they can do it in slightly brighter areas on Expert or Professional
					 ifg TEMP8 14
						{
						set INTERNALCOUNT 0
						ai AI_SHADE_DISAPEAR
						resetcount
						}
					else
					ifg TEMP8 19
						{
						set INTERNALCOUNT 0
						ai AI_SHADE_DISAPEAR
						resetcount
						}
					}
				}				
}
else
ifai AISHADERUSHENEMY
{
ifrnd 2 state enemyfindtarget
ifcansee set target PLAYER_IDENTITY
	ifspritepal 4 cstat 771 else cstat 259
	ifg xydist 8012 ai AISHADESEEKENEMY
	else ifn target -1 ifrnd 32 ai AISHADESHOOTENEMY
	else ifcansee ifrnd 32 ai AISHADESHOOTENEMY
}
else
ifai AISHADESHOOTENEMY
{
cstat 259
	ifactioncount 3 
	{ 
	ife target -1 ifcansee set target PLAYER_IDENTITY
		sound DEMON_THROWFIRE
		ifn target -1
			{
			setprojectile[7526].workslike 32770
			shoot 7526
			setprojectile[7526].workslike 36866
			}
		else
		shoot 7526
		ifspritepal 24
			{
			sound DEMON_THROWFIRE
			eshoot 7526	
			geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
			sound DEMON_THROWFIRE
			eshoot 7526	
			geta[RETURN].ang TEMP sub TEMP 128 seta[RETURN].ang TEMP
			}
		resetactioncount
		ai AISHADERUSHENEMY
	}
}

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD  
	//guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AISHADEGROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ASHADE_FROZEN } 
		else
			{
			state thegames_score
			state rf
			sound SHADE_DIE
			addkills 1
			action ASHADEDYING
			}
		}
else
    ifg PAIN_AMOUNT 0 { sound SHADE_PAIN action ASHADEFLINCH } else
	ifrnd 64 { ifspritepal 24 nullop else { state PAIN_SKILL_LEVELADJUST sound SHADE_PAIN action ASHADEFLINCH } }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AISHADESHRUNK }
}

enda

// ********************************************************************************************
// SPIRIT DEMON
// ********************************************************************************************

action ASPIRIT_FROZEN 65 1 5 1 10
action ASPIRIT_GROW 65 1 5 1 10
action ASPIRITIDLE  0 1 5 1 20
action ASPIRITWALK      0  4 5 1 20
action ASPIRITRUN      0  4 5 1 11
action ASPIRITFIRE    20 5 5 1 16
action ASPIRITFLINCH 45 1 1 1 10
action ASPIRITDYING 45 9 1 1 10
action ASPIRITDEAD 50 1 1 1 10

move SPIRITWALKVELS 90 
move SPIRITRUNVELS 118 
move SPIRITSTOP 0

ai AISPIRITSEEKENEMY ASPIRITWALK SPIRITWALKVELS seekplayer
ai AISPIRITRUSHENEMY ASPIRITRUN SPIRITRUNVELS seekplayer
ai AISPIRITSHOOTENEMY ASPIRITFIRE SPIRITSTOP shoottarget
ai AISPIRITDEAD ASPIRITDEAD SPIRITSTOP faceplayer
ai AISPIRITSHRUNK ASPIRITRUN SPIRITRUNVELS furthestdir
ai AISPIRITGROW ASPIRIT_GROW SPIRITSTOP seekplayer

spritenoshade SPIRIT
spritenoshade SPIRITSTAYPUT

useractor enemystayput SPIRITSTAYPUT
state monst_glow
cactor SPIRIT
enda

useractor enemy SPIRIT 125 ASPIRITIDLE
fall

ifai 0
{
	spawn SHOOTME
	state monst_glow
	seta[].blend 255
	seta[].shade 0
	ifspritepal 24 { sound SPIRIT_ALERT strength 200 sizeat 28 28 }
	else { sound SPIRIT_ALERT strength 125 sizeat 24 24 }
	action ASPIRITRUN
	ai AISPIRITSEEKENEMY
	cstator 33
	cstator 257
}

state ENEMYKNOCKBACKS
state enemy_ice_damage
state enemy_spirit_damage

ifaction ASPIRIT_FROZEN
{
state frozen_code
}
else
ifaction ASPIRITFLINCH
{
sub PAIN_AMOUNT 1
	move SPIRITSTOP 
	ife PAIN_AMOUNT 0 ai AISPIRITSEEKENEMY
}
else
ifai AISPIRITDEAD
{
move SPIRITSTOP
cstat 2
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		spritepal 4
	  state standard_jibs
        killit
      }
      break
    }
}
else
ifaction ASPIRITDYING
{
	strength 0
	ifactioncount 6 ai AISPIRITDEAD
}
else
ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD  
	//guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AISPIRITGROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ASPIRIT_FROZEN } 
		else
			{
			state thegames_score
			state rf
			sound SPIRIT_DIE
			addkills 1
			action ASPIRITDYING
			}
		}
else
    ifg PAIN_AMOUNT 0 action ASPIRITFLINCH else
	ifrnd 64 { ifspritepal 24 nullop else { state PAIN_SKILL_LEVELADJUST action ASPIRITFLINCH } }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AISPIRITSHRUNK }
}
else
ifai AISPIRITGROW state genericgrowcode
else
ifai AISPIRITSHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AISPIRITSEEKENEMY
    else ifcount SHRUNKCOUNT
      {
	  sound ACTOR_UNSHRINK
	ifspritepal 4 sizeto 55 55
	else ifspritepal 24 sizeto 60 60
	else sizeto 50 50
	}
    else
      state genericshrunkcode
    break
}
else
ifai AISPIRITSEEKENEMY
{	
state enemyfindtarget
state SKILL_SHOOT_LEVELADJUST
	ifspritepal 4 cstat 32768 else cstat 514
	ife target -1 ifrnd 4 { ai AISPIRITSEEKENEMY }
	ifrnd 2 ai AISPIRITRUSHENEMY
	ifl xydist 8012 ai AISPIRITRUSHENEMY		
}
else
ifai AISPIRITRUSHENEMY
{
state enemyfindtarget
	ifspritepal 4 cstat 771 else cstat 259
	ifg xydist 8012 ai AISPIRITSEEKENEMY
	else ifn target -1 ifrnd 32 ai AISPIRITSHOOTENEMY
}
else
ifai AISPIRITSHOOTENEMY
{
cstat 259
state enemyfindtarget
	ifactioncount 5 
	{ 
		sound DEMON_THROWFIRE
		ifn target -1 getactorvar[target].IS_PLAYER TEMP2
		ife TEMP2 1
			{
			setprojectile[SPELL8].workslike 65538
			setprojectile[SPELL8].extra 30
			eshoot SPELL8
			setprojectile[SPELL8].extra 150
			setprojectile[SPELL8].workslike 36866
			}
		else
		{
		setprojectile[SPELL8].workslike 69634
		setprojectile[SPELL8].extra 30
		eshoot SPELL8
		setprojectile[SPELL8].extra 150
		setprojectile[SPELL8].workslike 36866
		}
		ifspritepal 24
			{
			sound DEMON_THROWFIRE
			eshoot SPELL8
			setthisprojectile[RETURN].extra 30
			geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
			sound DEMON_THROWFIRE
			eshoot SPELL8	
			setthisprojectile[RETURN].extra 30
			geta[RETURN].ang TEMP sub TEMP 128 seta[RETURN].ang TEMP
			}
		resetactioncount
		ai AISPIRITRUSHENEMY
	}
}

enda

// ********************************************************************************************
// INFERNAL DEMON
// ********************************************************************************************

action A_INFERNAL_FROZEN 50 1 5 1 10
action A_INFERNAL_GROW 50 1 5 1 10
action A_INFERNAL_IDLE  0 1 5 1 20
action A_INFERNAL_WALK 0  4 5 1 16
action A_INFERNAL_RUN  0  4 5 1 8
action A_INFERNAL_FIRE 20 6 5 1 25
action A_INFERNAL_FLINCH 50 1 5 1 10
action A_INFERNAL_DYING 55 6 1 1 10
action A_INFERNAL_DEAD 60 1 1 1 10


move _INFERNAL_WALKVELS 180 
move _INFERNAL_RUNVELS 208 

ai AI_INFERNAL_SEEKENEMY A_INFERNAL_WALK _INFERNAL_WALKVELS seekplayer
ai AI_INFERNAL_RUSHENEMY A_INFERNAL_RUN _INFERNAL_RUNVELS faceplayer
ai AI_INFERNAL_SHOOTENEMY A_INFERNAL_FIRE STOP faceplayer
ai AI_INFERNAL_DEAD A_INFERNAL_DEAD STOP faceplayer
ai AI_INFERNAL_SHRUNK A_INFERNAL_RUN STOP furthestdir
ai AI_INFERNAL_GROW A_INFERNAL_GROW STOP seekplayer

useractor enemystayput INFERNAL_STAYPUT
cactor INFERNAL
state monst_glow
enda

useractor enemy INFERNAL 75 A_INFERNAL_IDLE
fall

ifai 0
{
	spawn SHOOTME
	state monst_glow
	sound INFERNAL_ALERT 
	strength 75 
	sizeat 26 26
	action A_INFERNAL_RUN
	ai AI_INFERNAL_SEEKENEMY
	cstator 257
}

ifg sprite[].htextra 0                            // if the actor is set to take some damage from a weapon...
{
  ife sprite[].htowner THISACTOR              // if the owner of the weapon IS this actor
    seta[].htextra -1       // set the damage to zero 
}

state ENEMYKNOCKBACKS
state enemy_ice_damage
state enemy_spirit_damage

ifaction A_INFERNAL_FROZEN
{
state frozen_code
}
else
ifaction A_INFERNAL_FLINCH
{
sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0 ai AI_INFERNAL_SEEKENEMY
}
else
ifai AI_INFERNAL_DEAD
{
move STOP
strength 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		spritepal 4
	  state standard_jibs
        killit
      }
      break
    }
}
else
ifaction A_INFERNAL_DYING
{
	strength 0
	ifactioncount 6 { spawn BLOODPOOL ai AI_INFERNAL_DEAD }
}
else
ifai AI_INFERNAL_GROW state genericgrowcode
else
ifai AI_INFERNAL_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_INFERNAL_SEEKENEMY
    else ifcount SHRUNKCOUNT
      {
	  sound ACTOR_UNSHRINK
	sizeto 26 26
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_INFERNAL_SEEKENEMY
{	
ifcansee { }
	ifpdistl 8012 ai AI_INFERNAL_RUSHENEMY
	else ifcansee ifcanshoottarget ifrnd 4 { sound INFERNAL_CHARGE ai AI_INFERNAL_SHOOTENEMY }
}
else
ifai AI_INFERNAL_RUSHENEMY
{
set TEMP 4
state SKILL_SHOOT_LEVELADJUST
	ifpdistg 8012 ai AI_INFERNAL_SEEKENEMY
	else ifcansee ifcanshoottarget ifl RANDOM_CHANCE SKILLCHANCE { sound INFERNAL_CHARGE ai AI_INFERNAL_SHOOTENEMY }
}
else
ifai AI_INFERNAL_SHOOTENEMY
{
	geta[].htflags TEMP2
	ifand TEMP2 4 xorvar TEMP2 4
	seta[].htflags TEMP2
	seta[].shade -64
	ifactioncount 5
	{ 
	ifn TEMP 0
		{
		sound DEMON_THROWFIRE
		shoot SPELL4
		set TEMP 0
		}
	}
	ifactioncount 6
	{
	geta[].htflags TEMP2
	ifand TEMP2 4 nullop else xorvar TEMP2 4
	seta[].htflags TEMP2
	
		resetactioncount
		ai AI_INFERNAL_RUSHENEMY
	}
}

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD  
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_INFERNAL_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action A_INFERNAL_FROZEN } 
		else
			{
			state thegames_score
			state rf
			sound INFERNAL_DIE
			addkills 1
			action A_INFERNAL_DYING
			}
		}
else
    ifg PAIN_AMOUNT 0 { sound INFERNAL_PAIN action A_INFERNAL_FLINCH } else
	ifrnd 64 { sound INFERNAL_PAIN state PAIN_SKILL_LEVELADJUST action A_INFERNAL_FLINCH }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_INFERNAL_SHRUNK }
}

enda

// **********************************************************
// BRUISER DEMON
// **********************************************************

action ABRUISER_FROZEN 50 1 5 1 10
action ABRUISERIDLE  0 1 5 1 20
action ABRUISERWALK      0  4 5 1 20
action ABRUISERRUN      0  4 5 1 11
action ABRUISERFIRE    20 3 5 1 25
action ABRUISERFIREBIG 35 3 5 1 15
action ABRUISERFLINCH 50 1 5 1 10
action ABRUISERDYING 55 10 1 1 15

move BRUISERWALKVELS 60 
move BRUISERRUNVELS 80 
move BRUISERSTOP 0

ai AIBRUISERSEEKENEMY ABRUISERWALK BRUISERWALKVELS seekplayer
ai AIBRUISERRUSHENEMY ABRUISERRUN BRUISERRUNVELS faceplayer
ai AIBRUISERSCRATCHENEMY ABRUISERFIRE BRUISERSTOP faceplayer
ai AIBRUISERSHOOTENEMY ABRUISERFIRE BRUISERSTOP faceplayer
ai AIBRUISERBIGSHOOTENEMY ABRUISERFIREBIG BRUISERSTOP faceplayer

spriteflags BRUISER SFLAG_NODAMAGEPUSH

useractor enemystayput BRUISERSTAYPUT 1250 ABRUISERIDLE
cactor BRUISER
enda

spritenoshade BRUISER

useractor enemy BRUISER 1250 ABRUISERIDLE
fall

gets[].floorshade TEMP
sub TEMP 10 
seta[].shade TEMP

ifai 0
{
	spawn SHOOTME
	state monst_glow
	sound BRUISER_ALERT
	ifspritepal 24 { strength 2000 sizeat 36 36 set CURBOSS THISACTOR set BOSS_TYPE 2 }
	else { strength 1250 sizeat 28 28 }
	action ABRUISERRUN
	ai AIBRUISERSEEKENEMY
	cstator 257
}

state enemy_ice_damage
state enemy_spirit_damage

ifaction ABRUISER_FROZEN
{
state frozen_code
}
else
ifaction ABRUISERFLINCH
{
sub PAIN_AMOUNT 2
	move BRUISERSTOP
	ifl PAIN_AMOUNT 1 ai AIBRUISERSHOOTENEMY
}
else
ifaction ABRUISERDYING
{
	move 0 spin
	spawn 3296
	strength 0
	ifactioncount 5 
		{
		spritepal 106
		spawn GROUNDEXPLOSION flash 
		quake 13 
		sound BARREL_EXPLODE
		state standard_jibs
		state monst_body_jibs
		state monst_body_jibs
		killit
		}
}
else
ifhitweapon
{
	// state NEWGUNEFFECTS
	geta[].htpicnum TEMP
	ife TEMP 7613 seta[].htextra -1
	ifwasweapon 7159 { set ICE_DAMAGE 52 addstrength -100 }
	ifwasweapon FREEZEBLAST { set ICE_DAMAGE 26 addstrength -25 }
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	//spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	
	sound BRUISER_PAIN
	ifdead
		{
		ifspritepal 3 operateactivators 15 THISACTOR
		ifspritepal 24 { ifand HELLGKEYSA 32 nullop else add HELLGKEYSA 32 }
		ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ABRUISER_FROZEN } 
		else
			{
			sound BRUISER_DIE
			state rf
			state thegames_score
			addkills 1
			action ABRUISERDYING
			}
		}
	else ifg PAIN_AMOUNT 0 action ABRUISERFLINCH
	else ifrnd 16 { state PAIN_SKILL_LEVELADJUST action ABRUISERFLINCH }
}
else
ifai AIBRUISERSEEKENEMY
{	
state SKILL_SHOOT_LEVELADJUST
divvar SKILLCHANCE 2
ifrnd 8 ai AIBRUISERRUSHENEMY
else ifcansee ifcanshoottarget ifl RANDOM_CHANCE SKILLCHANCE ai AIBRUISERSHOOTENEMY
}
else
ifai AIBRUISERRUSHENEMY
{
state SKILL_SHOOT_LEVELADJUST
	ifpdistg 8012 ifcansee ifcanseetarget ai AIBRUISERSEEKENEMY
	else ifpdistl 1024 ai AIBRUISERSCRATCHENEMY
	else 
	 ifcansee 
	  ifcanshoottarget 
	   ifl RANDOM_CHANCE SKILLCHANCE 
		{
		state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE 
		ai AIBRUISERBIGSHOOTENEMY
		else ai AIBRUISERSHOOTENEMY
		}
}
else
ifai AIBRUISERSCRATCHENEMY
{
	soundonce BRUISER_FLAME
	ifpdistg 1024 ai AIBRUISERRUSHENEMY else
	ifactioncount 3 
	{ 
	sound SCRATCHS
    palfrom 32 32
	wackplayer
	addphealth -30
	add FIRE_DAMAGE 25
	resetactioncount 
	}
}

else
ifai AIBRUISERSHOOTENEMY
{
	ifpdistl PARTICLE_DISTANCE // if player is within defined distance, spawn extra flare effects
		{
			espawn PROJECTILE_FLARE
			geta[].htg_t 0 TEMP2
			set TEMP3 sprite[].x
			ifg TEMP2 11 add TEMP3 64
			else ifg TEMP2 5 add TEMP3 256
			else add TEMP3 300
			geta[].ang TEMP4
			add TEMP4 512
			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			seta[RETURN].ang sprite[].ang
			geta[].z TEMP4
			ifg TEMP2 11 sub TEMP4 8062
			else ifg TEMP2 5 sub TEMP4 12784
			else sub TEMP4 14784
			seta[RETURN].z TEMP4
		}


	ifactioncount 3 
	{ 
		sound BRUISER_THROW
		shoot BRUISERFIREBALL
		ai AIBRUISERRUSHENEMY
	}
}

else
ifai AIBRUISERBIGSHOOTENEMY
{

	ifpdistl PARTICLE_DISTANCE // if player is within defined distance, spawn extra flare effects
		{
			espawn PROJECTILE_FLARE
			geta[].htg_t 0 TEMP2
			set TEMP3 sprite[].x
			ifg TEMP2 7 add TEMP3 64
			else ifg TEMP2 3 add TEMP3 300
			else add TEMP3 350
			geta[].ang TEMP4
			add TEMP4 512
			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			seta[RETURN].ang sprite[].ang
			geta[].z TEMP4
			ifg TEMP2 7 sub TEMP4 8062
			else ifg TEMP2 3 sub TEMP4 12784
			else sub TEMP4 14784
			seta[RETURN].z TEMP4
			
			espawn PROJECTILE_FLARE
			set TEMP3 sprite[].x
			ifg TEMP2 7 add TEMP3 64
			else ifg TEMP2 3 add TEMP3 300
			else add TEMP3 350
			geta[].ang TEMP4
			add TEMP4 -512
			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			seta[RETURN].ang sprite[].ang
			geta[].z TEMP4
			ifg TEMP2 7 sub TEMP4 8062
			else ifg TEMP2 3 sub TEMP4 12784
			else sub TEMP4 14784
			seta[RETURN].z TEMP4
			
		}

	ifactioncount 3 
	{ 
		flash
		sound BRUISER_THROW
		sound BRUISER_THROW
		sound BRUISER_THROW
		shoot BRUISERFIREBALL
		eshoot BRUISERFIREBALL
		geta[RETURN].ang TEMP
		add TEMP 64
		seta[RETURN].ang TEMP
		eshoot BRUISERFIREBALL
		geta[RETURN].ang TEMP
		sub TEMP 64
		seta[RETURN].ang TEMP
		ai AIBRUISERRUSHENEMY
	}
}

enda

// *************************************************************
// CYBERTOUR
// *************************************************************

action ACYBERT_FROZEN 45 1 5 1 10
action ACYBERTIDLE 0 1 5 1 20
action ACYBERTWALK 0 4 5 1 16
action ACYBERTSCRATCH 20 3 5 1 15
action ACYBERTPREPARE 35 1 5 1 10
action ACYBERTFIRE 40 1 5 1 4
action ACYBERTFLINCH 45 1 1 1 10
action ACYBERTDIE 45 5 1 1 20
action ACYBERTDEAD 49 1 1 1 10

move CYBERTWALK 120
move CYBERTSTOP 0

ai AICYBERTSEEKENEMY ACYBERTWALK CYBERTWALK seekplayer
ai AICYBERTSCRATCHENEMY ACYBERTSCRATCH CYBERTSTOP faceplayer
ai AICYBERTPREPARESHOOT ACYBERTPREPARE CYBERTSTOP faceplayer
ai AICYBERTSHOOTENEMY ACYBERTFIRE CYBERTSTOP faceplayersmart
ai AICYBERTFLINCH ACYBERTFLINCH CYBERTSTOP faceplayer
ai AICYBERTDEAD ACYBERTDIE CYBERTSTOP faceplayer

useractor enemystayput CYBERTOURSTAYPUT 700 ACYBERTIDLE
state monst_glow
cactor CYBERTOUR
enda

useractor enemy CYBERTOUR 700 ACYBERTIDLE
fall

ifai 0
{
	state monst_glow
    globalsound CYBERT_ALERT
	ifspritepal 24 { sizeat 34 34 strength 1000 }
	else { sizeat 28 28 strength 700 }
	spriteflags NORMAL_ENEMY
	spawn SHOOTME
	cstator 257
	action ACYBERTWALK
	ai AICYBERTSEEKENEMY
}

ifg sprite[].htextra 0                            // if the actor is set to take some damage from a weapon...
{
  ife sprite[].htowner THISACTOR              // if the owner of the weapon IS this actor
    seta[].htextra -1       // set the damage to zero 
}

ifaction ACYBERT_FROZEN
{
state frozen_code
}
else
ifaction ACYBERTDEAD move CYBERTSTOP
else
ifai AICYBERTDEAD
	{
	add INTERNALCOUNT 1
	ifactioncount 5 action ACYBERTDEAD 
	ife INTERNALCOUNT 1 sound CYBERT_DIE
	ife INTERNALCOUNT 15
		{
		state random_wall_jibs
		flash
		sound HUGE_GIB
		shoot SPARK
		shoot SPARK
		shoot SPARK
		spawn BIG_EXPLOSION
		sound EXPLOSION_LARGE
		spawn 18935
		spritepal 27
		ife INVASION 1 nullop else
			{
			state standard_jibs
			state monst_body_jibs
			state monst_body_jibs
			}
		debris SCRAP1 6
		guts JIBS6 2
		getlastpal 
		}
	}
else
ifai AICYBERTFLINCH
{
	sub PAIN_AMOUNT 1
	ife PAIN_AMOUNT 0 ai AICYBERTSEEKENEMY
}
else
ifai AICYBERTSEEKENEMY
	{
	state SKILL_SHOOT_LEVELADJUST
	ifcount 13 { sound CYBERT_WALK resetcount }
	ifpdistg 1024
		{
		 ifcanseetarget
		  ifcanshoottarget
		   ifl RANDOM_CHANCE SKILLCHANCE
		    {
			state SKILL_SHOOT_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE { sound CYBERT_ALERT set TEMP4 1 } else set TEMP4 0
			ai AICYBERTPREPARESHOOT
			}
		}
	else
	ifpdistl 1024
		ai AICYBERTSCRATCHENEMY
	}
else
ifai AICYBERTSCRATCHENEMY
	{
	ifpdistl 1024
		{
		ifactioncount 3 
			{ 
			palfrom 32 32 0 0
			soundonce SCRATCHS
			addphealth -30
			wackplayer
			state setknockback
			resetactioncount
			}
		}
	else
	ifpdistg 1024
		{
		ai AICYBERTSHOOTENEMY
		}
	}
else
ifai AICYBERTPREPARESHOOT
	{
	ifpdistl 1024 ai AICYBERTSCRATCHENEMY else
	ifactioncount 8 ai AICYBERTSHOOTENEMY
	}
else
ifai AICYBERTSHOOTENEMY
	{
	ifactioncount 1
		{
		ifstrength 100 shoot HOMING_MISSILE else
		ifspritepal 24 shoot HOMING_MISSILE else
		ife TEMP4 1 shoot HOMING_MISSILE else
			{
			setprojectile[MICRO_MISSILE].offset -512
			shoot MICRO_MISSILE
			setprojectile[MICRO_MISSILE].offset 224
			}
		flash
		sound CYBERT_FIRE
		
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 5244 
			set gunsmoke_angle 356
			state spawn_gunsmoke_z
			set gunsmoke_z 5244
			espawn 16114
			seta[RETURN].pal 2
			state spawn_muzzleflash
			}
		set TEMP4 0
		ai AICYBERTSEEKENEMY
		}
	}

//state MECH_DAMAGE_MODIFIER
ifhitweapon
	{
	state NEWGUNEFFECTS
	//spawn BLOOD
	guts JIBS6 1	
	state random_wall_jibs
	ifdead
		{
		ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ACYBERT_FROZEN } 
		else
			{
			state rf
			state thegames_score
			addkills 1
			ai AICYBERTDEAD
			}
		}
	else ifwasweapon RPG  seta[].xvel 5
	else ifwasweapon KNEE ife CURWEAP 0 ife temp_weapon 16 ifrnd 200 ai AICYBERTFLINCH
	else ifg PAIN_AMOUNT 0 ai AICYBERTFLINCH
	else ifrnd 4 { state PAIN_SKILL_LEVELADJUST ai AICYBERTFLINCH }
}


enda

// *********************************************************************************************
// SPIDER DEMON
// *********************************************************************************************

action A_SPIDERD_IDLE 0 1 5 1 20
action A_SPIDERD_WALK 5 4 5 1 15
action A_SPIDERD_PREPARE 25 1 5 1 10
action A_SPIDERD_FIRE 25 2 5 1 8
action A_SPIDERD_MIND 35 3 5 1 4
action A_SPIDERD_PAIN 50 1 5 1 20
action A_SPIDERD_DIE 55 5 1 1 20
action A_SPIDERD_DEAD 59 1 

move SPIDERD_WALK 160

ai AI_SPIDERD_SEEKENEMY A_SPIDERD_WALK SPIDERD_WALK seekplayer
ai AI_SPIDERD_PREPARESHOOT A_SPIDERD_PREPARE STOP faceplayer
ai AI_SPIDERD_SHOOTENEMY A_SPIDERD_FIRE STOP faceplayer //shoottarget
ai AI_SPIDERD_PREPARESHOOT2 A_SPIDERD_MIND STOP faceplayer
ai AI_SPIDERD_SHOOTNUKE A_SPIDERD_FIRE STOP shoottarget
ai AI_SPIDERD_DEAD A_SPIDERD_DIE STOP faceplayer

useractor enemy SPIDERDEMON 12000 A_SPIDERD_IDLE
fall

ifai 0
	{
		state monst_glow
		clipdist 96
		globalsound SPIDERDEMON_SIGHT
		quake 120
		set ALLY_MAG SKILL_LEVEL
		spriteflags NORMAL_ENEMY
		set CURBOSS THISACTOR
		set BOSS_TYPE 2
		strength 12000
		sizeat 64 64
		spawn SHOOTME
		cstator 257
		action A_SPIDERD_WALK
		ai AI_SPIDERD_SEEKENEMY
	}
	
ifdead nullop
else
ifpdistl 1526
ifcansee
{
wackplayer
palfrom 40 40 0 0
addphealth -100
}

ifg sprite[].htextra 0                            // if the actor is set to take some damage from a weapon...
{
  ife sprite[].htowner THISACTOR              // if the owner of the weapon IS this actor
    seta[].htextra -1       // set the damage to zero 
}

ifaction A_SPIDERD_DEAD move STOP
else
ifai AI_SPIDERD_DEAD
	{
	add INTERNALCOUNT 1
	ifactioncount 8 action A_SPIDERD_DEAD
	ife INTERNALCOUNT 1 sound SPIDERDEMON_DIE
	ife INTERNALCOUNT 20 { spawn NUCLEAR_EXPLOSION globalsound CHOPPER_EXPLODE }
	ife INTERNALCOUNT 30
		{
			flash
			sound HUGE_GIB
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			spawn 18935
			spritepal 27
			ife INVASION 1 nullop else
				{
				state standard_jibs
				state standard_jibs
				state standard_jibs
				state monst_body_jibs
				state monst_body_jibs
				}
			debris SCRAP1 14
			guts JIBS6 2
			getlastpal 

		}
	}
else
ifai AI_SPIDERD_SEEKENEMY
	{
	state SKILL_SHOOT_LEVELADJUST
	ifcount 6 { ifpdistl 16000 quake 13 ifactorsound THISACTOR CYBERDEMON_METAL nullop else sound CYBERDEMON_METAL }
	ifcount 13 { ifactorsound THISACTOR CYBERDEMON_METAL nullop else sound CYBERDEMON_METAL resetcount }
	ifpdistg 1024
		{
		ifrnd 16 ifg ALLY_MAG 0 ifstrength 3000 { globalsound SPIDERDEMON_SIGHT quake 260 ai AI_SPIDERD_PREPARESHOOT2 }
		 ifcanseetarget
		  ifcanshoottarget
		   ifl RANDOM_CHANCE SKILLCHANCE
			ai AI_SPIDERD_PREPARESHOOT
		}
	else ifrnd 8 ai AI_SPIDERD_SEEKENEMY
	}
else
ifai AI_SPIDERD_PREPARESHOOT
	{
	ifactioncount 3 ai AI_SPIDERD_SHOOTENEMY
	}
else
ifai AI_SPIDERD_SHOOTENEMY
	{
	ifactioncount 2
		{
		geta[].z TEMP6
		add TEMP6 8192
		seta[].z TEMP6
		ifstrength 6000 ifrnd 128 eshoot HOMING_MISSILE else
		eshoot RPG
		sub TEMP6 8192
		seta[].z TEMP6
		flash
		sound CYBERDEMON_SHOOT
		resetactioncount
		ifcansee ifcanseetarget { ifrnd 8 ai AI_SPIDERD_SEEKENEMY } else ai AI_SPIDERD_SEEKENEMY
		}
	}
else
ifai AI_SPIDERD_PREPARESHOOT2
	{
	ifactioncount 40 ai AI_SPIDERD_SHOOTNUKE
	}
else
ifai AI_SPIDERD_SHOOTNUKE
	{
	ifactioncount 2
		{
		sub ALLY_MAG 1
		geta[].z TEMP6
		add TEMP6 8192
		seta[].z TEMP6
		eshoot ATOM_BOMB
		sub TEMP6 8192
		seta[].z TEMP6
		flash
		globalsound Z_MISSILE_FIRE
		soundonce Z_WARNING
		setactorsoundpitch THISACTOR Z_WARNING -2048
		resetactioncount
		ai AI_SPIDERD_SEEKENEMY
		}
	}
	
geta[].htextra TEMP7
ifhitweapon
	{
	ifg TEMP7 POINT_AMOUNT
	{
	geta[].htowner TEMP4
	geta[TEMP4].picnum TEMP5
	ife TEMP5 1405
		{
		getactorvar[TEMP4].P_CREDITS TEMP6
		add TEMP6 1
		setactorvar[TEMP4].P_CREDITS TEMP6
		}
	}
	ifrnd 8 soundonce BRUISER_PAIN
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	//spawn BLOOD
	guts JIBS6 1	
	state random_wall_jibs
	ifdead
		{
			state rf
			state thegames_score
			ifn HITAGSAVED 0
				{
			   operateactivators HITAGSAVED THISACTOR
			   operatemasterswitches HITAGSAVED
			   operaterespawns HITAGSAVED
				}
			addkills 1
			ai AI_SPIDERD_DEAD
		}
}
	
enda

// *********************************************************************************************
// CYBERDEMON
// *********************************************************************************************

action ACYBERD_IDLE -5 1 5 1 20
action ACYBERDWALK 0 4 5 1 15
action ACYBERDPREPARE 20 1 5 1 10
action ACYBERDFIRE 20 2 5 1 30
action ACYBERDDIE 30 6 1 1 20
action ACYBERDDEAD 36 1 1 1 20

move CYBERDWALK 160
move CYBERDSTOP 0

ai AICYBERDSEEKENEMY ACYBERDWALK CYBERDWALK seekplayer
ai AICYBERDPREPARESHOOT ACYBERDPREPARE CYBERDSTOP faceplayer
ai AICYBERDSHOOTENEMY ACYBERDFIRE CYBERDSTOP faceplayersmart
ai AICYBERDDEAD ACYBERDDIE CYBERDSTOP faceplayer

useractor enemystayput CYBERDEMONSTAYPUT 6000 ACYBERD_IDLE
cactor CYBERDEMON
enda

useractor enemy CYBERDEMON 6000 ACYBERD_IDLE
fall

ifai 0
{
	state monst_glow
	clipdist 96
    globalsound CYBERDEMON_SEE
	spriteflags NORMAL_ENEMY
    set CURBOSS THISACTOR
    set BOSS_TYPE 2
	strength 6000
	sizeat 40 40
	spawn SHOOTME
	cstator 257
	action ACYBERDWALK
	ai AICYBERDSEEKENEMY
}

ifdead nullop
else
ifpdistl 1526
ifcansee
{
wackplayer
palfrom 40 40 0 0
addphealth -100
}

ifaction ACYBERDDEAD move CYBERDSTOP
else
ifai AICYBERDDEAD
	{
	add INTERNALCOUNT 1
	ifactioncount 6 action ACYBERDDEAD
	ife INTERNALCOUNT 1 sound CYBERDEMON_DIE
	ife INTERNALCOUNT 20 { spawn NUCLEAR_EXPLOSION globalsound CHOPPER_EXPLODE }
	ife INTERNALCOUNT 30
		{
			flash
			sound HUGE_GIB
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			spawn 18935
			spritepal 27
			ife INVASION 1 nullop else
				{
				state standard_jibs
				state standard_jibs
				state standard_jibs
				state monst_body_jibs
				state monst_body_jibs
				}
			debris SCRAP1 14
			guts JIBS6 2
			getlastpal 

		}
	}
else
ifai AICYBERDSEEKENEMY
	{
	state SKILL_SHOOT_LEVELADJUST
	ifcount 6 { ifpdistl 16000 quake 13 ifactorsound THISACTOR CYBERDEMON_STOMP nullop else sound CYBERDEMON_STOMP }
	ifcount 13 { ifactorsound THISACTOR CYBERDEMON_METAL nullop else sound CYBERDEMON_METAL resetcount }
	ifpdistg 1024
		{
		 ifcanseetarget
		  ifcanshoottarget
		   ifl RANDOM_CHANCE SKILLCHANCE
			ai AICYBERDPREPARESHOOT
		}
	else ifrnd 8 ai AICYBERDSEEKENEMY
	}
else
ifai AICYBERDPREPARESHOOT
	{
	ifactioncount 3 ai AICYBERDSHOOTENEMY
	}
else
ifai AICYBERDSHOOTENEMY
	{
	ifactioncount 2
		{
		eshoot RPG
		geta[].x TEMP
		geta[].y TEMP2

		set TEMP3 TEMP

		
		sub TEMP3 256

		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		flash
		sound CYBERDEMON_SHOOT
		ifrnd 128 resetactioncount else ai AICYBERDSEEKENEMY
		}
	}
	
geta[].htextra TEMP7
ifhitweapon
	{
	ifg TEMP7 POINT_AMOUNT
	{
	geta[].htowner TEMP4
	geta[TEMP4].picnum TEMP5
	ife TEMP5 1405
		{
		getactorvar[TEMP4].P_CREDITS TEMP6
		add TEMP6 1
		setactorvar[TEMP4].P_CREDITS TEMP6
		}
	}
	ifrnd 8 soundonce BRUISER_PAIN
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	state NEWGUNEFFECTS
	//spawn BLOOD
	guts JIBS6 1	
	state random_wall_jibs
	ifdead
		{
			state rf
			state thegames_score
			ifn HITAGSAVED 0
				{
			   operateactivators HITAGSAVED THISACTOR
			   operatemasterswitches HITAGSAVED
			   operaterespawns HITAGSAVED
				}
			addkills 1
			ai AICYBERDDEAD
		}
}

enda


// ****************************************************************************
// ZOMBIE SCIENTIST
// ****************************************************************************

action AZSCIEN_FROZE 28 1 1 1 10
action AZSCIEN_GROW 28 1 1 1 10
action AZSCIENSTAND     0  1 5 1 10
action AZSCIENWALK      5  4 5 1 24
action AZSCIENRUN      5  4 5 1 16
action AZSCIENFIRE    -26 2 5 1 25
action AZSCIENFLINCH 28 1 1 1 10

action AZSCIENDYING 28 5 1 1 12
action AZSCIENDEAD 33 1 1 1 12

action AZSCIEN_H_DYING -108 5 1 1 10
action AZSCIEN_H_DEAD -103 1 1 1 10

move ZSCIENWALKVELS 60 
move ZSCIENRUNVELS 80 
move ZSCIENSTOP 0

ai AIZSCIENSEEKENEMY AZSCIENWALK ZSCIENWALKVELS faceplayer seekplayer
ai AIZSCIENRUSHENEMY AZSCIENRUN ZSCIENRUNVELS faceplayer
ai AIZSCIENSHOOTENEMY AZSCIENFIRE ZSCIENSTOP faceplayer
ai AIZSCIENDEAD AZSCIENDEAD ZSCIENSTOP faceplayer
ai AIZSCIEN_HEAD_DEAD AZSCIEN_H_DEAD ZSCIENSTOP faceplayer
ai AIZSCIENSHRUNK AZSCIENRUN ZSCIENRUNVELS furthestdir
ai AIZSCIENGROW AZSCIEN_GROW ZSCIENSTOP furthestdir


useractor enemystayput ZSCIENSTAYPUT 50 AZSCIENSTAND
state monst_glow
cactor ZSCIEN
enda

useractor enemy ZSCIEN 50 AZSCIENSTAND
fall

ifai 0
{
	state monst_glow
	ifspritepal 24
		{
		strength 100
		sizeat 29 29
		}
	else
		{
		strength 50
		sizeat 25 25
		}
	spriteflags NORMAL_ENEMY
	spawn SHOOTME
	action AZSCIENRUN
	ai AIZSCIENSEEKENEMY
	cstator 257
}


state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifaction AZSCIEN_FROZE
{
state frozen_code
}
else
ifaction AZSCIENFLINCH
{
	sub PAIN_AMOUNT 1
	move ZSCIENSTOP
	ife PAIN_AMOUNT 0 ai AIZSCIENSEEKENEMY
}
else
ifai AIZSCIENDEAD
{
move ZSCIENSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifai AIZSCIEN_HEAD_DEAD
{
move ZSCIENSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifaction AZSCIENDYING
{
	ifactioncount 5 { state BODY_FALL_NOISES strength 0 ai AIZSCIENDEAD }
}
else
ifaction AZSCIEN_H_DYING
{
	ifactioncount 5 { state BODY_FALL_NOISES strength 0 ai AIZSCIEN_HEAD_DEAD }
}
else
ifai AIZSCIENGROW state genericgrowcode
else
ifai AIZSCIENSHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIZSCIENSEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 25 25
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AIZSCIENSEEKENEMY
{	
	ifpdistl 8012 ai AIZSCIENRUSHENEMY
}
else
ifai AIZSCIENRUSHENEMY
{
	state SKILL_SHOOT_LEVELADJUST
	ifpdistg 8012 ai AIZSCIENSEEKENEMY
	else ifcansee ifcanshoottarget ifl RANDOM_CHANCE SKILLCHANCE ai AIZSCIENSHOOTENEMY
}
else
ifai AIZSCIENSHOOTENEMY
{
	ifactioncount 2 
	{ 
		ifspritepal 24
		{
		sound SILVER_T_FIRE
		shoot RMAXREVOLVERSHOT
		}
		else
		{
		state SKILL_ENEMY_ACCURACY
		sound PISTOL_FIRE
		shoot CHAINGUN
		}
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 8244 
			set gunsmoke_angle 0
			state spawn_gunsmoke_z
			set gunsmoke_z 6044
			espawn 16115
			state spawn_muzzleflash
			randvar TEMP 1024 
			zshoot TEMP 13772
			}
		ai AIZSCIENRUSHENEMY
	}
}

ifhitweapon
{
	ifai AIZSCIENSHRUNK break
	ifai AIZSCIENGROW break
	state NEWGUNEFFECTS
	//spawn BLOOD
	//guts JIBS6 1	
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIZSCIENGROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AZSCIEN_FROZE } 
		else ifg ENERGY_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 4
			guts JIBS3 6
			spawn DISINTIGRATE_GUY
			killit
			}
		else ifg SPIRIT_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 1
		guts JIBS3 6
		spawn SPIRIT_DEATH_GUY
		killit
		}
		else ifg FIRE_DAMAGE 0
			{ 
			ifrnd 64 sound MERC_ONFIRE1
			else ifrnd 64 sound MERC_ONFIRE2
			else ifrnd 64 sound MERC_ONFIRE3
			else sound MERC_ONFIRE4
			set PLAYER_VOICEOVER 21
			spawn ONFIREGUY 
			killit
			}
		else
		{
		state rf
		state thegames_score
		addkills 1
		ife HEADSHOT 2 
			{
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				action AZSCIEN_H_DYING
			}
			else
			{
			sound ZSCI_DIE
			action AZSCIENDYING
			}
		}
		ifrnd SPAWNAMMOODDS
			{
			switch CHAR
			case 0
			case 3
			case 4
			case 5
			case 7
			  spawn AMMO
			  break
			default
			break
			endswitch
			}
		ifphealthl 50
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn HYPOSPRAY
			}
		}
else
    ifg PAIN_AMOUNT 0 action AZSCIENFLINCH
	else ifrnd 64 { sound ZSCI_PAIN state PAIN_SKILL_LEVELADJUST action AZSCIENFLINCH }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIZSCIENSHRUNK }
}

state checksquished

enda

// ************************************************************************************
// ZOMBIE CHAINGUN SOLDIER
// ************************************************************************************

action AZCHAING_FROZE 0 1 5 1 10
action AZCHAING_GROW 30 1 1 1 10

action AZCHAING_IDLE 0 1 5 1 20

action AZCHAINGRUN     0  4 5 1 20
action AZCHAINGFIRE    20 2 5 1 4
action AZCHAINGFLINCH 30 1 1 1 10
action AZCHAINGDYING 31 6 1 1 10
action AZCHAINGDEAD 36 1 1 1 10

action AZCHAING_HEADSHOT 37 6 1 1 10
action AZCHAING_HEADDEAD 42 1 1 1 10

move ZCHAINGWALKVELS 60 
move ZCHAINGRUNVELS 80 
move ZCHAINGSTOP 0

ai AIZCHAINGSEEKENEMY AZCHAINGRUN ZCHAINGWALKVELS seekplayer
ai AIZCHAINGSHOOTENEMY AZCHAINGFIRE ZCHAINGSTOP faceplayer
ai AIZCHAINGDEAD AZCHAINGDEAD ZCHAINGSTOP faceplayer
ai AIZCHAING_HEADDEAD AZCHAING_HEADDEAD ZCHAINGSTOP faceplayer
ai AIZCHAINGSHRUNK AZCHAINGRUN ZCHAINGRUNVELS furthestdir
ai AIZCHAING_GROW AZCHAING_GROW STOP faceplayer


useractor enemystayput ZCHAINGSTAYPUT 125 AZCHAING_IDLE
state monst_glow
cactor ZCHAING
enda

useractor enemy ZCHAING 125 AZCHAING_IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	ifspritepal 43 {
		strength 250 sizeat 26 26
	}
	else ifspritepal 24 {
		strength 150 sizeat 24 24
	} else {
        spritepal 10 strength 125 sizeat 24 24
    }
	spriteflags NORMAL_ENEMY
	action AZCHAINGRUN
	ai AIZCHAINGSEEKENEMY
	sound ZSOLD_SIGHT
	cstator 257
}


state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

//ifspritepal 24 state BODYA_DAMAGE_MODIFIER

ifaction AZCHAING_FROZE state frozen_code 
else
ifai AIZCHAINGDEAD
{
move ZCHAINGSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifai AIZCHAING_HEADDEAD
{
move ZCHAINGSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifaction AZCHAINGDYING
{
	strength 0
	ifactioncount 6 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZCHAINGDEAD }
}
else
ifaction AZCHAING_HEADSHOT
{
	strength 0
	ifactioncount 6 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZCHAING_HEADDEAD }
}
else
ifai AIZCHAING_GROW state genericgrowcode
else
ifai AIZCHAINGSHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIZCHAINGSEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 55 55
	  }
    else
      state genericshrunkcode
    break
}
else
ifaction AZCHAINGFLINCH
{
	ifdead { strength 0 set PAIN_AMOUNT 0 }
	sub PAIN_AMOUNT 1
	move ZCHAINGSTOP
	ife PAIN_AMOUNT 0 ai AIZCHAINGSEEKENEMY
}
else
ifai AIZCHAINGSEEKENEMY
{	
state SKILL_SHOOT_LEVELADJUST
ifg shoot_countdown 0 sub shoot_countdown 1
	ife shoot_countdown 0 ifcansee ifcanshoottarget ifl RANDOM_CHANCE SKILLCHANCE { soundonce MINIGUN_START ai AIZCHAINGSHOOTENEMY }
	ifrnd 16 soundonce ZSOLD_ROAM
}
else
ifai AIZCHAINGSHOOTENEMY
{
	ifactioncount 1
	{ 
		ifspritepal 24
		{
		state SKILL_ENEMY_ACCURACY
		sound BOS1_ATTACK1
		shoot ZRIFLESHOTU
		}
	else
		{
		state SKILL_ENEMY_ACCURACY
		sound ZCHAING_FIRE
		shoot SHOTSPARK1
		}
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			set gunsmoke_z 5044
			espawn 16115
			state spawn_muzzleflash
			shoot RIFLESHELL
			shoot SHELL_LINK
			}
		ifrnd 4 { soundonce MINIGUN_STOP ai AIZCHAINGSEEKENEMY }
		resetactioncount
	}
}

ifhitweapon
{
ifaction AZCHAINGDYING break
ifaction AZCHAING_HEADSHOT break
	state NEWGUNEFFECTS
	//spawn BLOOD
	//guts JIBS6 4
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIZCHAING_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AZCHAING_FROZE } 
		else
			{
			state rf
			addkills 1
			state thegames_score
			ifg FIRE_DAMAGE 0 
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				ifrnd 128 sound ZSOLD_DIE1 else sound ZSOLD_DIE2
				spawn ONFIREGUY
				killit
				}
			else
			ife HEADSHOT 2 
			{
			ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				action AZCHAING_HEADSHOT
			}
			else
			ifg ENERGY_DAMAGE 0
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				spritepal 4
				guts JIBS3 6
				spawn DISINTIGRATE_GUY
				killit
				}
			else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
			else
				{
				ifrnd 128 sound ZSOLD_DIE1 else sound ZSOLD_DIE2
				action AZCHAINGDYING
				}
			}
		ifrnd 24 { espawn ZCHAINGUN_SPRITE randvar TEMP 100 add TEMP 50 setactorvar[RETURN].YVELSAVED TEMP }
		ifphealthl 50
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn HYPOSPRAY
			}
		}
else
	ifg PAIN_AMOUNT 0 action AZCHAINGFLINCH 
	else ifrnd 16 { sound ZSCI_PAIN state PAIN_SKILL_LEVELADJUST action AZCHAINGFLINCH }
	else ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIZCHAINGSHRUNK }
}

state checksquished

enda

// ************************************************************************************
// ZOMBIE RIFLE SOLDIER
// ************************************************************************************

action AZSOLDIER_FROZE 0 1 5 1 10
action AZSOLDIER_GROW 30 1 1 1 10
action AZSOLDIER_IDLE 0 1 5 1 20
action AZSOLDIERRUN  0  4 5 1 20
action AZSOLDIERFIRE 20 2 5 1 4
action AZSOLDIERFLINCH 30 1 1 1 10
action AZSOLDIERDYING 35 5 1 1 16
action AZSOLDIERDEAD 39 1 1 1 10

action AZSOLDIER_HEADSHOT 40 5 1 1 16
action AZSOLDIER_HEADDEAD 44 1 1 1 10


move ZSOLDIERWALKVELS 60 
move ZSOLDIERRUNVELS 80 
move ZSOLDIERSTOP 0

ai AIZSOLDIERSEEKENEMY AZSOLDIERRUN ZSOLDIERWALKVELS seekplayer
ai AIZSOLDIERSHOOTENEMY AZSOLDIERFIRE ZSOLDIERSTOP seekplayer
ai AIZSOLDIERDEAD AZSOLDIERDEAD ZSOLDIERSTOP faceplayer
ai AIZSOLDIER_HEADDEAD AZSOLDIER_HEADDEAD ZSOLDIERSTOP faceplayer
ai AIZSOLDIERSHRUNK AZSOLDIERRUN ZSOLDIERRUNVELS furthestdir
ai AIZSOLDIER_GROW AZSOLDIER_GROW STOP faceplayer

useractor enemystayput ZSOLDIER_STAYPUT 75 AZSOLDIER_IDLE
state monst_glow
cactor ZSOLDIER
enda

useractor enemy ZSOLDIER 75 AZSOLDIER_IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	ifspritepal 24 { strength 200 sizeat 30 30 } else
	{ strength 75 sizeat 25 25 }
	action AZSOLDIERRUN
	ai AIZSOLDIERSEEKENEMY
	sound FZOM_SIGHT
	cstat 257
}

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

//ifspritepal 24 state BODYA_DAMAGE_MODIFIER

ifaction AZSOLDIER_FROZE state frozen_code 
else
ifaction AZSOLDIERFLINCH
{
	sub PAIN_AMOUNT 1
	move ZSOLDIERSTOP
	ife PAIN_AMOUNT 0 ai AIZSOLDIERSEEKENEMY
}
else
ifai AIZSOLDIERDEAD
{
move ZSOLDIERSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifai AIZSOLDIER_HEADDEAD
{
move ZSOLDIERSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifaction AZSOLDIERDYING
{
strength 0
	ifactioncount 5 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZSOLDIERDEAD }
}
else
ifaction AZSOLDIER_HEADSHOT
{
strength 0
	ifactioncount 5 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZSOLDIER_HEADDEAD }
}
else
ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIZSOLDIER_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AZSOLDIER_FROZE } 
		else
			{
			state rf
			guts JIBS6 3
			addkills 1
			state thegames_score
			ifg FIRE_DAMAGE 0 
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				sound FZOM_DIE
				spawn ONFIREGUY
				killit
				}
			else 
			ife HEADSHOT 2 
				{
			    ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				action AZSOLDIER_HEADSHOT
				}
			else ifg SPIRIT_DAMAGE 0
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				spritepal 1
				guts JIBS3 6
				spawn SPIRIT_DEATH_GUY
				killit
				}
			else
			ifg ENERGY_DAMAGE 0
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				spritepal 4
				guts JIBS3 6
				spawn DISINTIGRATE_GUY
				killit
				}
			else
				{
				sound FZOM_DIE
				action AZSOLDIERDYING
				}
			ifrnd 48 { espawn M16SPRITE randvar TEMP 30 setactorvar[RETURN].YVELSAVED TEMP }
			}
		ifphealthl 50
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn HYPOSPRAY
			}
		}
else
	ifg PAIN_AMOUNT 0 action AZSOLDIERFLINCH 
	else ifrnd 16 { sound FZOM_HURT state PAIN_SKILL_LEVELADJUST action AZSOLDIERFLINCH }
	else ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIZSOLDIERSHRUNK }
}
else
ifai AIZSOLDIER_GROW state genericgrowcode
else
ifai AIZSOLDIERSHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIZSOLDIERSEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 55 55
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AIZSOLDIERSEEKENEMY
{	
state SKILL_SHOOT_LEVELADJUST
ifg shoot_countdown 0 sub shoot_countdown 1
	ife shoot_countdown 0 ifn target -1 ifl RANDOM_CHANCE SKILLCHANCE ai AIZSOLDIERSHOOTENEMY
	ifrnd 16 { soundonce ZSOLD_ROAM setactorsoundpitch THISACTOR ZSOLD_ROAM 256 }
} 
else
ifai AIZSOLDIERSHOOTENEMY
{
	ifactioncount 2
	{ 
		ifspritepal 24
			{
			sound M16_FIRE
			shoot ZRIFLESHOT
			}
		else
			{
			state SKILL_ENEMY_ACCURACY
			sound M16_2_FIRE
			shoot SHOTSPARK1
			}
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			shoot RIFLESHELL
			set gunsmoke_z 5044
			state spawn_enemy_ARFLASH
			state spawn_muzzleflash
			}
		ifrnd 32 ai AIZSOLDIERSEEKENEMY
	ife target -1 ai AIZSOLDIERSEEKENEMY
		resetactioncount
	}
}

state checksquished

enda

useractor enemystayput ZSOLDIER2_STAYPUT 75 AZSOLDIER_IDLE
state monst_glow
cactor ZSOLDIER2
enda

useractor enemy ZSOLDIER2 75 AZSOLDIER_IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	ifspritepal 25 { strength 200 sizeat 28 28 } 
    else { strength 75 sizeat 25 25 }
	action AZSOLDIERRUN
	ai AIZSOLDIERSEEKENEMY
	sound ZSOLD_SIGHT 
	cstat 257
}

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

//ifspritepal 24 state BODYA_DAMAGE_MODIFIER

ifaction AZSOLDIER_FROZE state frozen_code 
else
ifaction AZSOLDIERFLINCH
{
	sub PAIN_AMOUNT 1
	move ZSOLDIERSTOP
	ife PAIN_AMOUNT 0 ai AIZSOLDIERSEEKENEMY
}
else
ifai AIZSOLDIERDEAD
{
move ZSOLDIERSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifai AIZSOLDIER_HEADDEAD
{
move ZSOLDIERSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifaction AZSOLDIERDYING
{
strength 0
	ifactioncount 5 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZSOLDIERDEAD }
}
else
ifaction AZSOLDIER_HEADSHOT
{
strength 0
	ifactioncount 5 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZSOLDIER_HEADDEAD }
}
else
ifai AIZSOLDIER_GROW state genericgrowcode
else
ifai AIZSOLDIERSHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIZSOLDIERSEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 55 55
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AIZSOLDIERSEEKENEMY
{	
state SKILL_SHOOT_LEVELADJUST
ifg shoot_countdown 0 sub shoot_countdown 1
	ife shoot_countdown 0 ifcansee ifcanshoottarget ifl RANDOM_CHANCE SKILLCHANCE ai AIZSOLDIERSHOOTENEMY
	ifrnd 16 soundonce ZSOLD_ROAM
}
else
ifai AIZSOLDIERSHOOTENEMY
{
	ifactioncount 2
	{ 
		ifspritepal 24
			{
			sound M16_FIRE
			shoot ZRIFLESHOT
			}
		else
			{
			state SKILL_ENEMY_ACCURACY
			sound M16_2_FIRE
			shoot SHOTSPARK1
			}
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			shoot RIFLESHELL
			set gunsmoke_z 6044
			state spawn_enemy_ARFLASH
			state spawn_muzzleflash
			}
		ifrnd 64  ai AIZSOLDIERSEEKENEMY
		ife target -1 ai AIZSOLDIERSEEKENEMY
		resetactioncount
	}
}

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	//guts JIBS6 5	
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIZSOLDIER_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AZSOLDIER_FROZE } 
		else
			{
			state rf
			addkills 1
			state thegames_score
			ifg FIRE_DAMAGE 0 
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
				ifrnd 128 sound ZSOLD_DIE1
				else sound ZSOLD_DIE2
			spawn ONFIREGUY
			killit
			}
			else
			ife HEADSHOT 2 
			{
			ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				action AZSOLDIER_HEADSHOT
			}
			else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
			else
			ifg ENERGY_DAMAGE 0
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				spritepal 4
				guts JIBS3 6
				spawn DISINTIGRATE_GUY
				killit
				}
			else
				{
				ifrnd 128 sound ZSOLD_DIE1
				else sound ZSOLD_DIE2
				action AZSOLDIERDYING
				}
			ifrnd 48 { espawn M16SPRITE randvar TEMP 30 setactorvar[RETURN].YVELSAVED TEMP }
			}
		ifphealthl 50
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn HYPOSPRAY
			}
		}
else
	ifg PAIN_AMOUNT 0 action AZSOLDIERFLINCH 
	else ifrnd 16 { sound ZSCI_PAIN state PAIN_SKILL_LEVELADJUST action AZSOLDIERFLINCH }
	else ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIZSOLDIERSHRUNK }
}

state checksquished

enda


// ************************************************************************************
// ZOMBIE GRENADE SOLDIER
// ************************************************************************************

action AZ_GRENADEL__FROZE 0 1 5 1 10
action AZ_GRENADEL__GROW 30 1 1 1 10
action AZ_GRENADEL__IDLE 0 1 5 1 20
action AZ_GRENADEL_RUN  0  4 5 1 11
action AZ_GRENADEL_FIRE 20 2 5 1 24
action AZ_GRENADEL_FLINCH 30 1 1 1 10
action AZ_GRENADEL_DYING 35 5 1 1 10
action AZ_GRENADEL_DEAD 40 1 1 1 10

action AZ_GRENADEL__HEADSHOT 41 6 1 1 10
action AZ_GRENADEL__HEADDEAD 46 1 1 1 10

ai AIZ_GRENADEL_SEEKENEMY AZ_GRENADEL_RUN ZSOLDIERWALKVELS seekplayer
ai AIZ_GRENADEL_SHOOTENEMY AZ_GRENADEL_FIRE STOP faceplayer
ai AIZ_GRENADEL_DEAD AZ_GRENADEL_DEAD STOP faceplayer
ai AIZ_GRENADEL__HEADDEAD AZ_GRENADEL__HEADDEAD STOP faceplayer
ai AIZ_GRENADEL_SHRUNK AZ_GRENADEL_RUN ZSOLDIERRUNVELS furthestdir
ai AIZ_GRENADEL__GROW AZ_GRENADEL__GROW STOP faceplayer

useractor enemystayput Z_GRENADEL_STAYPUT 200 AZ_GRENADEL__IDLE
state monst_glow
cactor Z_GRENADEL
enda

useractor enemy Z_GRENADEL 200 AZ_GRENADEL__IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	ifspritepal 43 { strength 400 sizeat 26 26 } 
    else ifspritepal 24 { strength 225 sizeat 24 24 }
	else { spritepal 21 strength 200 sizeat 24 24 }
	action AZ_GRENADEL_RUN
	ai AIZ_GRENADEL_SEEKENEMY
	sound ZSOLD_SIGHT
	cstator 257
}

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

// ifspritepal 24 state BODYA_DAMAGE_MODIFIER

ifaction AZ_GRENADEL__FROZE state frozen_code 
else
ifaction AZ_GRENADEL_FLINCH
{
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0 ai AIZ_GRENADEL_SEEKENEMY
}
else
ifai AIZ_GRENADEL_DEAD
{
move STOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifai AIZ_GRENADEL__HEADDEAD
{
move STOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
}
else
ifaction AZ_GRENADEL_DYING
{
	ifactioncount 5 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZ_GRENADEL_DEAD }
}
else
ifaction AZ_GRENADEL__HEADSHOT
{
	ifactioncount 5 { state BODY_FALL_NOISES spawn BLOODPOOL ai AIZ_GRENADEL__HEADDEAD }
}
else
ifai AIZ_GRENADEL__GROW state genericgrowcode
else
ifai AIZ_GRENADEL_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIZ_GRENADEL_SEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 55 55
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AIZ_GRENADEL_SEEKENEMY
{	
ifg shoot_countdown 0 sub shoot_countdown 1
	ife shoot_countdown 0 ifcansee ifcanshoottarget ifrnd 32 ai AIZ_GRENADEL_SHOOTENEMY
	ifrnd 16 { soundonce ZSOLD_ROAM setactorsoundpitch THISACTOR ZSOLD_ROAM -128 }
} 
else
ifai AIZ_GRENADEL_SHOOTENEMY
{
	ifactioncount 1
	{ 
			addvar ALLY_MAG 1
			sound RG_GL_FIRE
			eshoot 5375
			setthisprojectile[RETURN].extra 20
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			set gunsmoke_z 5044
			espawn 16114
			state spawn_muzzleflash
			}
		ifg ALLY_MAG 5 
			{
			ai AIZ_GRENADEL_SEEKENEMY
			set ALLY_MAG 0
			}
		resetactioncount
	}
}

geta[].htextra TEMP

ifg TEMP 0                            // if the actor is set to take some damage from a weapon...
{
  geta[].htowner TEMP      // gets the owner of the weapon into TEMP
  ife TEMP THISACTOR              // if the owner of the weapon IS this actor
    seta[].htextra 0       // set the damage to 0
}

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	//guts JIBS6 1	
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIZ_GRENADEL__GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AZ_GRENADEL__FROZE } 
		else
			{
			state rf
			addkills 1
			state thegames_score
			ifg FIRE_DAMAGE 0 
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			ifrnd 128 sound ZSOLD_DIE2 else
			sound ZSOLD_DIE1
			spawn ONFIREGUY
			killit
			}
			else 
			ife HEADSHOT 2 
			{
			    ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				action AZ_GRENADEL__HEADSHOT
			}
			else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
			else
			ifg ENERGY_DAMAGE 0
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				spritepal 4
				guts JIBS3 6
				spawn DISINTIGRATE_GUY
				killit
				}
			else
				{
				ifrnd 128 sound ZSOLD_DIE2 else
				sound ZSOLD_DIE1
				action AZ_GRENADEL_DYING
				}
			ifrnd 8 { espawn RIOTGUN_GRENADEL_SPRITE randvar TEMP 4 setactorvar[RETURN].YVELSAVED TEMP }
			}
		ifphealthl 50
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn HYPOSPRAY
			}
		}
else
	ifg PAIN_AMOUNT 0 action AZ_GRENADEL_FLINCH 
	else ifrnd 8 { sound ZSCI_PAIN state PAIN_SKILL_LEVELADJUST action AZ_GRENADEL_FLINCH }
	else ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIZ_GRENADEL_SHRUNK }
}

state checksquished

enda

// ******************************************************************************
// FLESH WIZARD
// ******************************************************************************

action AFLESH_WIZ_IDLE 0 1 5 1 0
action AFLESH_WIZ_FROZEN 0 1 5 1 0
action AFLESH_WIZ_MOVE 0 1 5 1 10
action AFLESH_WIZ_SHOOT 5 2 5 1 20
action AFLESH_WIZ_PAIN 15 1 5 1 10
action AFLESH_WIZ_DIE 20 7 1 1 10
action AFLESH_WIZ_DEAD 27 1 1 1 10
action AFLESH_WIZ_HEAD_DIE 2791 7 1 1 10
action AFLESH_WIZ_HEAD_DEAD 2798 1 1 1 10

move FLESHMOVE 96 0
move FLESHSTOP

ai AIFLESH_WIZ_MOVE AFLESH_WIZ_MOVE FLESHMOVE seekplayer
ai AIFLESH_WIZ_SHRUNK AFLESH_WIZ_MOVE FLESHMOVE furthestdir
ai AIFLESH_WIZ_SHOOT AFLESH_WIZ_SHOOT FLESHSTOP faceplayerslow
ai AIFLESH_WIZ_PAIN AFLESH_WIZ_PAIN FLESHSTOP
ai AIFLESH_WIZ_DIE AFLESH_WIZ_DIE FLESHSTOP
ai AIFLESH_WIZ_HEAD_DIE AFLESH_WIZ_HEAD_DIE FLESHSTOP

useractor enemystayput FLESHWIZARDSTAYPUT 125 AFLESH_WIZ_IDLE
state monst_glow
cactor FLESHWIZARD
enda

useractor enemy FLESHWIZARD 125 AFLESH_WIZ_IDLE
fall

ifai 0
	{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	sizeat 26 26
	strength 125
	cstat 257
	ai AIFLESH_WIZ_MOVE
	}
	
state ENEMYKNOCKBACKS
state enemy_ice_damage
state enemy_fire_damage
state enemy_spirit_damage

ifaction AFLESH_WIZ_FROZEN state frozen_code 
else
ifaction AFLESH_WIZ_DEAD 
	{
	move FLESHSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
	        state monst_body_jibs
			ife INVASION 1  nullop else
			{
		  state standard_jibs
			}
	        killit
	      }
	      break
	    }
	}
else
ifaction AFLESH_WIZ_HEAD_DEAD 
	{
	move FLESHSTOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
	        state monst_body_jibs
			ife INVASION 1  nullop else
			{
		  state standard_jibs
			}
	        killit
	      }
	      break
	    }
	}
else
ifai AIFLESH_WIZ_DIE
	{
	ifactioncount 7 { state rf action AFLESH_WIZ_DEAD }
	}
else
ifai AIFLESH_WIZ_HEAD_DIE
	{
	ifactioncount 7 { state rf action AFLESH_WIZ_HEAD_DEAD }
	}
else
ifai AIFLESH_WIZ_MOVE
	{
	ifpdistl 16000
	 ifcansee
	  ifcanshoottarget
	   ifrnd 32
		{
		ai AIFLESH_WIZ_SHOOT
		}
	}
else
ifai AIFLESH_WIZ_SHOOT
	{
	ifactioncount 2
		{
		sound FLESH_SQUIRT
		eshoot GASBURST
		setthisprojectile[RETURN].extra 5
		ai AIFLESH_WIZ_MOVE
		}
	}
else
ifai AIFLESH_WIZ_PAIN
{
	sub PAIN_AMOUNT 1
	move FLESHSTOP
	ife PAIN_AMOUNT 0 ai AIFLESH_WIZ_MOVE
}
else
ifai AIFLESH_WIZ_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIFLESH_WIZ_MOVE
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 55 55
	  }
    else
      state genericshrunkcode
    break
}
	
ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	//guts JIBS6 1	
	state random_wall_jibs
	ifdead
		{
		ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AFLESH_WIZ_FROZEN } 
		else
		ife HEADSHOT 2 
			{ 
			ifrnd 32 state trigger_showoff
			state jib_sounds
			sound DECAPITATE
			state rf	
			ai AIFLESH_WIZ_HEAD_DIE
			shoot NJIB 
			shoot NJIB 
			guts JIBS6 3 
			guts JIBS2 2 
			} 
		else
			{
			ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
			ifrnd 128 sound ZSOLD_DIE1 else sound ZSOLD_DIE2
			addkills 1
			state thegames_score
			ai AIFLESH_WIZ_DIE
			}
		}
else
	ifg PAIN_AMOUNT 0 ai AIFLESH_WIZ_PAIN
	else ifrnd 16 { sound ZSCI_PAIN state PAIN_SKILL_LEVELADJUST ai AIFLESH_WIZ_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIFLESH_WIZ_SHRUNK }
}

state checksquished

enda

// ******************************************************************************
// HADES SPHERE
// ******************************************************************************

action AHADESFLOAT 0 1 5 1 0
action AHADESBLAST 5 3 5 1 10
action AHADESBIGBLAST 20 3 5 1 15
action AHADESPAIN 35 1 5 1 10
action AHADESDYING 41 7 1 1 8
action AHADESDEAD 48 1 1 1 10

move MHADESFLOAT 128 0
move MHADESFLOATUP 128 -128
move MHADESFLOATDOWN 128 128
move MHADESTOP 0

ai AIHADESFLOAT AHADESFLOAT MHADESFLOAT faceplayer seekplayer
ai AIHADESFLOATUP AHADESFLOAT MHADESFLOATUP faceplayer seekplayer getv
ai AIHADESFLOATDOWN AHADESFLOAT MHADESFLOATDOWN faceplayer seekplayer getv
ai AIHADESSHOOT AHADESBLAST MHADESFLOAT faceplayer
ai AIHADESBIGSHOOT AHADESBIGBLAST MHADESTOP faceplayer
ai AIHADESPAIN AHADESPAIN MHADESTOP faceplayer
ai AIHADESDYING AHADESDYING MHADESTOP faceplayer
ai AIHADESDEAD AHADESDEAD MHADESTOP faceplayer

useractor enemystayput HADESPHERESTAYPUT 300 AHADESFLOAT
state monst_glow
cactor HADESPHERE
enda

useractor enemy HADESPHERE 300 AHADESFLOAT

ifai 0
{
set MONSTER_FLAGS 1
	state monst_glow
spriteflags NORMAL_ENEMY_TRU
spawn SHOOTME
sound HADES_ALERT
ifspritepal 24 { strength 1000 sizeat 40 40 } else
{ strength 300 sizeat 30 30 }
ai AIHADESFLOAT
cstator 257
}


ifai AIHADESDEAD
	{
	fall
	move 0
	
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
	        killit
	      }
	      break
	    }
	
	}
else
ifai AIHADESDYING
	{
	cstat 0
	strength 0
	ifactioncount 2
	ife TEMP7 0
		{
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		state squish_sounds
		spawn ENERGY_EXPLOSION
		spawn 8433
		set TEMP7 1
		}
	ifactioncount 5 fall
	ifactioncount 7 ai AIHADESDEAD
	}
else
ifai AIHADESPAIN
	{
	sub PAIN_AMOUNT 1
	move MHADESTOP
	ife PAIN_AMOUNT 0 ai AIHADESFLOAT
	}
else
ifhitweapon
	{
	state NEWGUNEFFECTS
	soundonce HADES_PAIN 
	//spawn BLOOD 
	guts JIBS6 1
	state random_wall_jibs
    ifwasweapon RPG 
	{ seta[].xvel 5 }
	ifdead
		{
		sound HADES_DIE
		ai AIHADESDYING
		state rf
		addkills 1
		set TEMP4 0
		state thegames_score
		}
	else ifg PAIN_AMOUNT 0 ai AIHADESPAIN
	else ifrnd 16 { state PAIN_SKILL_LEVELADJUST ai AIHADESPAIN }
	}
else
ifai AIHADESFLOAT
{
ifcansee
 ifcanseetarget
  ifrnd 8
  {
  ifrnd 64 ai AIHADESBIGSHOOT else
   ai AIHADESSHOOT
   }
   else
ifrnd 128
	{
	 ifp phigher
        ai AIHADESFLOATUP
      else
		{
		geta[].z z
		getp[].posz TEMP
		ifg TEMP z ai AIHADESFLOATDOWN
		}
	}
}
else
ifai AIHADESFLOATUP
{
state thisactor_getzrange
ifcansee
 ifcanseetarget
  ifrnd 8
  {
  ifrnd 64 ai AIHADESBIGSHOOT else
   ai AIHADESSHOOT
   }
   else
ifrnd 16 ai AIHADESFLOAT
}
else
ifai AIHADESFLOATDOWN
{
iffloordistl 8 fall
state thisactor_getzrange
ifcansee
 ifcanseetarget
  ifrnd 8
  {
  ifrnd 64 ai AIHADESBIGSHOOT else
   ai AIHADESSHOOT
   }
   else
ifrnd 16 ai AIHADESFLOAT
}
else
ifai AIHADESSHOOT
{
ifactioncount 3 { sound HADES_FIRE shoot HADESBLAST }
ifactioncount 4 ai AIHADESFLOAT
}
else
ifai AIHADESBIGSHOOT
{
ifactioncount 4 { sound HADES_BIGBLAST shoot HADESBLASTH ai AIHADESFLOAT }
}


state ENEMYKNOCKBACKS
state enemy_ice_damage
state enemy_spirit_damage

enda

// ******************************************************************************
// ABYSS DESPOT
// ******************************************************************************

action ADESPOTFLOAT 0 1 5 1 0
action ADESPOTBLAST 5 3 5 1 10
action ADESPOTBIGBLAST 20 3 5 1 25
action ADESPOTCAST 35 2 5 1 20
action ADESPOTPAIN 45 1 5 1 10
action ADESPOTDYING 50 10 1 1 20

move MDESPOTFLOAT 128 0
move MDESPOTFLOATUP 128 -128
move MDESPOTFLOATDOWN 128 128

ai AIDESPOTFLOAT ADESPOTFLOAT MDESPOTFLOAT seekplayer
ai AIDESPOTFLOATUP ADESPOTFLOAT MDESPOTFLOATUP seekplayer getv
ai AIDESPOTFLOATDOWN ADESPOTFLOAT MDESPOTFLOATDOWN seekplayer getv
ai AIDESPOTSHOOT ADESPOTBLAST MDESPOTFLOAT faceplayer
ai AIDESPOTBIGSHOOT ADESPOTBIGBLAST STOP faceplayerslow
ai AIDESPOTCAST ADESPOTCAST STOP faceplayer
ai AIDESPOTPAIN ADESPOTPAIN STOP faceplayer
ai AIDESPOTDYING ADESPOTDYING STOP faceplayer

useractor enemy ABYSS_DESPOT

ifaction 0
{
	state monst_glow
spawn SHOOTME
spriteflags NORMAL_ENEMY_TRU
globalsound DESPOT_SIGHT
ifspritepal 41 strength 6000 else
strength 12000
sizeat 34 34
action ADESPOTFLOAT
ai AIDESPOTFLOAT
set ALLY_MAG SKILL_LEVEL
set CURBOSS THISACTOR
set BOSS_TYPE 2
cstator 257
}

ifg sprite[].htextra 0                            // if the actor is set to take some damage from a weapon...
{
  ife sprite[].htowner THISACTOR              // if the owner of the weapon IS this actor
    seta[].htextra -1       // set the damage to zero 
}

ifai AIDESPOTDYING
	{
	cstat 0
	ifactioncount 3
	ifn TEMP4 1
		{
		quake 26
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11426
		shoot 11431
		shoot 11431
		palfrom 40 40 0 0
		set TEMP4 1
		}
	ifactioncount 10 { ifn HITAGSAVED 0 { operateactivators HITAGSAVED THISACTOR } killit }
	}
else
ifai AIDESPOTPAIN
	{
	move STOP
	ifactioncount 3 ai AIDESPOTFLOAT
	}
else
ifai AIDESPOTFLOAT
{
ifcansee
 ifcanseetarget
  ifrnd 8
  {
  sound DESPOT_ACTION
  set INTERNALCOUNT 0
  ifstrength 6000 ifg ALLY_MAG 0 ifrnd 32 ai AIDESPOTCAST else
  ifrnd 64 ai AIDESPOTBIGSHOOT else
   ai AIDESPOTSHOOT
   }
   else
ifrnd 64
	{
	 ifp phigher
        ai AIDESPOTFLOATUP
      else
		{
		geta[].z z
		getp[].posz TEMP
		ifg TEMP z ai AIDESPOTFLOATDOWN
		}
	}
}
else
ifai AIDESPOTFLOATUP
{
state thisactor_getzrange
ifcansee
 ifcanseetarget
  ifrnd 8
  {
  sound DESPOT_ACTION
  set INTERNALCOUNT 0
  ifstrength 6000 ifg ALLY_MAG 0 ifrnd 32 ai AIDESPOTCAST else
  ifrnd 64 ai AIDESPOTBIGSHOOT else
   ai AIDESPOTSHOOT
   }
   else
ifrnd 16 ai AIDESPOTFLOAT
}
else
ifai AIDESPOTFLOATDOWN
{
state thisactor_getzrange
ifcansee
 ifcanseetarget
  ifrnd 8
  {
  sound DESPOT_ACTION
  set INTERNALCOUNT 0
  ifstrength 6000 ifg ALLY_MAG 0 ifrnd 32 ai AIDESPOTCAST else
  ifrnd 64 ai AIDESPOTBIGSHOOT else
   ai AIDESPOTSHOOT
   }
   else
ifrnd 16 ai AIDESPOTFLOAT
}
else
ifai AIDESPOTCAST
{
ifactioncount 2
	{
	
	set TEMP3 sprite[].x
	add TEMP3 1536
	randvar TEMP4 2048

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

	espawn HADESPHERE

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6

	sub ALLY_MAG 1
	sound DEMON_TELEPORT
	ai AIDESPOTFLOAT
	resetactioncount
	}
}
else
ifai AIDESPOTSHOOT
{
add INTERNALCOUNT 1
ife INTERNALCOUNT 3 { sound HADES_BIGBLAST geta[].z TEMP sub TEMP 2048 seta[].z TEMP shoot HADESBLASTH geta[].z TEMP add TEMP 2048 seta[].z TEMP }
else ife INTERNALCOUNT 4 { ai AIDESPOTFLOAT set INTERNALCOUNT 0 }
}
else
ifai AIDESPOTBIGSHOOT
{
ifactioncount 4 { sound HADES_BIGBLAST eshoot REDM_BLAST setthisprojectile[RETURN].extra 140 ai AIDESPOTFLOAT }
}

geta[].htextra TEMP7
ifhitweapon
	{
	
	ifg TEMP6 POINT_AMOUNT
		{
		geta[].htowner TEMP4
		geta[TEMP4].picnum TEMP5
		ife TEMP5 1405
			{
			getactorvar[TEMP4].P_CREDITS TEMP6
			add TEMP6 1
			setactorvar[TEMP4].P_CREDITS TEMP6
			}
		} 
	
	soundonce DESPOT_PAIN
	//spawn BLOOD 
	guts JIBS6 1
	state random_wall_jibs
	seta[].xvel 0
	ifdead
		{
		globalsound DESPOT_DIE
		ai AIDESPOTDYING
		state rf
		addkills 1
		set TEMP4 0
		state thegames_score
		}
	else ifrnd 4 ai AIDESPOTPAIN
	}

enda



// ********************************************************************************************
// CHRYSSALID
// ********************************************************************************************

action ACHRYSS_MOVE 0 4 5 1 20
action ACHRYSS_SWIPE1 20 2 5 1 12
action ACHRYSS_SWIPE2 30 2 5 1 12
action ACHRYSS_PREP 40 1 5 1 12
action ACHRYSS_JUMP 45 1 5 1 12
action ACHRYSS_LAND 50 1 5 1 12

action ACHRYSS_HURT 60 1 1
action ACHRYSS_DIE 61 6 1 1 16
action ACHRYSS_DEAD 66

move CHR_SEEK 480
move CHR_JUMP 160 -160

ai AI_CHRYSS_SEEK ACHRYSS_MOVE CHR_SEEK seekplayer
ai AI_CHRYSS_SWIPE1 ACHRYSS_SWIPE1 STOP shoottarget
ai AI_CHRYSS_SWIPE2 ACHRYSS_SWIPE2 STOP shoottarget
ai AI_CHRYSS_PREP ACHRYSS_PREP STOP
ai AI_CHRYSS_JUMP ACHRYSS_JUMP CHR_JUMP jumptoplayer
ai AI_CHRYSS_FALL ACHRYSS_JUMP CHR_SEEK seekplayer
ai AI_CHRYSS_LAND ACHRYSS_LAND STOP

ai AI_CHRYSS_HURT ACHRYSS_HURT STOP
ai AI_CHRYSS_DIE ACHRYSS_DIE STOP

useractor enemy CHRYSSALID_SLEEP
fall
ifaction 0
	{
	cstat 257
	strength 500
	sizeat 28 28
	action ACAR
	}

ifaction ACAR
	{
	ifpdistl 2048
		{
		ifrnd 2 
			{
			sound CHRYSS_SIGHT
			cactor CHRYSSALID
			}
		}
	ifhitweapon
		{
		strength 1000
		sound CHRYSS_SIGHT
		cactor CHRYSSALID
		}
	}

enda

spriteflags CHRYSSALID 5251105

useractor enemy CHRYSSALID
fall

ifai 0
	{
	state monst_glow
	spawn SHOOTME
	spriteflags 5251105
	strength 1000
	sizeat 28 28
	sound CHRYSS_SIGHT
	ai AI_CHRYSS_SEEK
	cstator 257
	}


state spawn_cold_breathe

state ENEMYKNOCKBACKS
state enemyfloordamage

ifaction ACHRYSS_DEAD
	{
	strength 0
		ifhitweapon
		{
		state standard_jibs
		state monst_body_jibs
		state monst_body_jibs
		sound SQUISHED
		killit
		}
		break
	}
else
ifai AI_CHRYSS_DIE
	{
	move STOP
	ifactioncount 6
		action ACHRYSS_DEAD
	}
else
ifai AI_CHRYSS_HURT
	{
	ifg PAIN_AMOUNT 0 sub PAIN_AMOUNT 1
	ifdead 
		{
		addkills 1
		sound CHRYSS_DIE
		ifai AI_CHRYSS_DIE nullop else ai AI_CHRYSS_DIE
		}
	else
	ifl PAIN_AMOUNT 1 ai AI_CHRYSS_SEEK
	}
else
ifai AI_CHRYSS_SEEK
	{
	state correctcansee
	geta[].htmovflag TEMP4
	ifn TEMP4 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
	{
			 andvar TEMP4 49152
			 ife TEMP4 32768 // the actor is pushing on a wall
			 {
			   geta[].htmovflag TEMP2 // need to get the info again
			   andvar TEMP2 16383 // temp now stores the wall number
					   getwall[TEMP2].nextsector sect
					   ifn sect -1
					   {
					   ifand wall[TEMP2].cstat 1 break
					   ife sector[sect].lotag 20 operate
					   ife sector[sect].lotag 21 operate
					   ife sector[sect].lotag 22 operate
					   ife sector[sect].lotag 23 operate
						  ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
							{
							ai AI_CHRYSS_PREP
							}
						}
			  }
	}
	else
	ifrnd 2 { sound CHRYSS_SCUTTLE ai AI_CHRYSS_SEEK }
	ifrnd 1 soundonce CHRYSS_ROAM
	ifpdistl 1536 ai AI_CHRYSS_SWIPE1
	}
else
ifai AI_CHRYSS_PREP
	{
	ifactioncount 3 ai AI_CHRYSS_JUMP
	}
else
ifai AI_CHRYSS_JUMP
	{
	ifactioncount 3 ai AI_CHRYSS_FALL
	}
else
ifai AI_CHRYSS_FALL
	{
	iffloordistl 16 { sound MONSTER_LAND stopsound THUD ai AI_CHRYSS_LAND }
	}
else
ifai AI_CHRYSS_LAND
	{
	ifactioncount 3 ai AI_CHRYSS_SEEK
	}
ifai AI_CHRYSS_SWIPE1
	{
	ifactioncount 2 
		{
		sound SCRATCHS
		shoot 17663
		resetactioncount
		ifpdistg 1536 ai AI_CHRYSS_SEEK else ai AI_CHRYSS_SWIPE2
		}
	}
else
ifai AI_CHRYSS_SWIPE2
	{
	ifactioncount 2 
		{
		sound SCRATCHS
		shoot 17663
		resetactioncount
		ifpdistg 1536 ai AI_CHRYSS_SEEK else ai AI_CHRYSS_SWIPE1
		}
	}
	
ifhitweapon
	{
	state NEWGUNEFFECTS
    //spawn BLOOD 
	state random_wall_jibs
    ifwasweapon RPG 
	{ seta[].xvel 5 }
	ifdead
		{
		resetactioncount
		sound CHRYSS_DIE
		state rf
		ai AI_CHRYSS_DIE
		guts JIBS6 10	
		addkills 1
		state thegames_score
		}
	else ifg PAIN_AMOUNT 0 { sound CHRYSS_PAIN ai AI_CHRYSS_HURT }
	else ifrnd 16 { sound CHRYSS_PAIN state PAIN_SKILL_LEVELADJUST ai AI_CHRYSS_HURT }
	}

enda

// ******************************************************************************
// CULTIST
// ******************************************************************************

action ACULTIST_FROZE   89 1 5 1 0
action ACULTIST_GROW   89 1 5 1 0
action ACULTISTSTAND    0 1 5 1 0
action ACULTISTWALK     0 5 5 1 20
action ACULTISTRUN      0 5 5 1 11
action ACULTISTSHOOT 52 2 5 1 11
action ACULTISTSHOOT2 52 2 5 1 10
action ACULTISTPUMP 52 1 5 1 20
action ACULTISTFLINCH 89 1 5 1 20
action ACULTISTDYING 95 8 1 1 15
action ACULTIST_TWITCH 101 1 1 1 10
action ACULTISTDEAD 102 1 1 1 1
action ACULTISTGRUESOMEDEATH 104 7 1 1 8
action ACULTISTGRUESOMEDEAD 111 1 1 1 1
action ACULTISTHEADSHOT 196 8 1 1 15
action ACULTISTHEADDEAD 203 1 1 1 1
action ACULTIST_SLICED 7596 5 1 1 20
action ACULTIST_SLICE_DEAD 7602 1 1 1 10
action ACULTISTTHROW 63 6 5 1 15
action ACULTISTJUMP 26 5 5 1 20
action ACULTISTFALL 46 1 5 1 1
action ACULTISTCHOKE 132 1 1 1 10
action ACULTISTSHOTGUNSTRUGGLE 133 1 1 1 10
action ACULTISTFCHOKE 83 1 1 1 10

action ACULTIST_KNEEL 46 1 5 1 10
action ACULTIST_GETUP 46 1 5 1 10
action ACULTIST_CRAWL 7565 4 5 1 20
action ACULTIST_ONFLOOR 7585 1 5 1 0

move CULTISTWALKVELS 72
move CULTISTRUNVELS 108 
move CULTISTJUMPVELS 158

ai AICULTISTIDLE ACULTISTSTAND STOP
ai AICULTISTSEEKENEMY ACULTISTWALK CULTISTWALKVELS seekplayer
ai AICULTISTRUSHENEMY ACULTISTRUN CULTISTRUNVELS faceplayer
ai AICULTISTSHOOT ACULTISTSHOOT STOP faceplayer
ai AICULTISTSHOOT_BOT ACULTISTSHOOT STOP seekplayer
ai AICULTISTSHOOT2 ACULTISTSHOOT2 STOP faceplayer
ai AICULTISTPUMP ACULTISTPUMP STOP faceplayer
ai AICULTISTDEAD ACULTISTDEAD STOP faceplayer
ai AICULTIST_SLICED_DEAD ACULTIST_SLICE_DEAD STOP faceplayer
ai AICULTISTHEADDEAD ACULTISTHEADDEAD STOP faceplayer
ai AICULTISTGRUESOMEDEAD ACULTISTGRUESOMEDEAD STOP faceplayer
ai AICULTISTTHROW ACULTISTTHROW STOP faceplayer
ai AICULTISTTHROWNET ACULTISTTHROW STOP faceplayer
ai AICULTISTJUMP ACULTISTJUMP CULTISTJUMPVELS jumptoplayer
ai AICULTISTSHRUNK ACULTISTRUN CULTISTRUNVELS furthestdir
ai AICULTIST_GROW ACULTIST_GROW STOP
ai AICULTIST_CRAWL ACULTIST_CRAWL CULTISTWALKVELS seekplayer dodgebullet

defstate CULTISTSHOOTPLASMA // just as a test. Change to something else as needed
	state enemyLocateAnyTarget // target == the sprite to shoot at
	getprojectile[5372].vel PROJECTILE_VEL
	state sang_getprojectilezvel // TEMP3 == ZVEL

	ifn target -1
	{
		setprojectile[5372].offset -120
		ezshoot TEMP3 5372
		setprojectile[5372].offset 224
		setthisprojectile[RETURN].extra 15 sound 535
	}
ends

defstate CULTISTCHOKE
ifmultiplayer { set CHOKE 0 ai AICULTISTSEEKENEMY break }
move 0
geta[].x TEMP
geta[].y TEMP2

set TEMP3 TEMP
add TEMP3 512

ifrnd 196 addphealth -1

geta[].ang TEMP4
add TEMP4 256

rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6


setp[].posx TEMP5
setp[].posy TEMP6
geta[].z TEMP
add TEMP -16000
setp[].posz TEMP
setp[].weapon_pos 10

        geta[].x mx
        geta[].y my
        getp[].posx x
        getp[].posy y
        sub mx x
        sub my y
        getangle TEMP8 mx my
        setp[].ang TEMP8

ifl CHOKE 1 { pkick ai AICULTISTSEEKENEMY break }

ifp pdead { ai AICULTISTIDLE set CHOKE 0 }
ends

defstate CULTISTFORCECHOKE
move 0


ifrnd 196 { ifg P_SPIRIT_ARMOUR 0 { soundonce SPARM_PROTECT sub P_SPIRIT_ARMOUR 1 } else addphealth -1 }

setp[].weapon_pos 10

        geta[].x mx
        geta[].y my
        getp[].posx x
        getp[].posy y
        sub mx x
        sub my y
        getangle TEMP8 mx my
        setp[].ang TEMP8

ifl FCHOKE 1 { set FCHOKESTOP 76 ai AICULTISTSEEKENEMY break }

ifp pdead { set FCHOKESTOP 76 ai AICULTISTIDLE set FCHOKE 0 }
ends

defstate cultist_dead_stuff
	ifn YVELSAVED 0 { espawnvar YVELSAVED set YVELSAVED 0 }

	state thegames_score
	state rf 
	addkills 1 

	ifspritepal 21 
		{
			ifrnd SPAWNAMMOODDS
			{
			switch CHAR
			case 0
			case 4
			case 5
			case 9
			ifg EXTRASAVED 5 spawn HBOMBAMMO else
			ifg EXTRASAVED 0 spawn 3689
			break
			endswitch
			} 
		}
	else
	ifphealthl 50
		{
		state SKILL_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE spawn HPOWDER
		}
	else
	ifrnd SPAWNAMMOODDS
		{
		ifspritepal 10 ifn YVELSAVED SAWNOFFSPRITE spawn SAWNOFFSPRITE
		ifspritepal 16 ifn YVELSAVED AK114SPRITE spawn AK114SPRITE
		ifspritepal 49 ifn YVELSAVED FNFALSPRITE spawn FNFALSPRITE
		ifspritepal 36 ifn YVELSAVED TOMMYGUNSPRITE spawn TOMMYGUNSPRITE
		}
ends

useractor enemystayput CULTISTSTAYPUT
cactor CULTIST
enda

useractor enemy CULTISTSHOTGUNSTRUGGLE
ifaction 0
{
set MONSTER_FLAGS 2
state monst_glow
strength 125
sizeat 28 28
cstator 257
ifcansee
 ifcanseetarget
  ifpdistl 2048
	{
	sound PIGBUTT
	wackplayer
	action ACULTISTSHOTGUNSTRUGGLE
	set SHOTGUN_STRUGGLE_NUM 0
	set SHOTGUN_STRUGGLE THISACTOR
	}
	else ai AICULTISTSEEKENEMY
cactor CULTIST
}
enda

useractor enemy CULTISTJUMP
ifai 0
{
set MONSTER_FLAGS 2
state monst_glow
spawn SHOOTME
spriteflags NORMAL_ENEMY
ifspritepal 20 { ife EXTRASAVED -1 set EXTRASAVED 5 strength 500 } else
ifspritepal 49 { ife EXTRASAVED -1 set EXTRASAVED 5 strength 250 } else
ifspritepal 36 { ife EXTRASAVED -1 set EXTRASAVED 2 strength 150 } else
ifspritepal 21 { ife EXTRASAVED -1 set EXTRASAVED 20 strength 100 } else
ifspritepal 10 strength 125 else
strength 75
sizeat 28 28
action ACULTISTJUMP
ai AICULTISTJUMP
cstator 257
cactor CULTIST
}
enda

useractor enemy CULTIST 75 ACULTISTSTAND
fall

ifai 0
{
set MONSTER_FLAGS 2
state monst_glow
spawn SHOOTME
spriteflags NORMAL_ENEMY
ifspritepal 20 { ife EXTRASAVED -1 set EXTRASAVED 5 strength 250 } else
ifspritepal 49 { ife EXTRASAVED -1 set EXTRASAVED 5 strength 200 } else
ifspritepal 3 { ife EXTRASAVED -1 set EXTRASAVED 2 strength 150 } else
ifspritepal 36 { ife EXTRASAVED -1 set EXTRASAVED 2 strength 150 } else
ifspritepal 16 { set EXTRASAVED 3 strength 125 } else
ifspritepal 21 { set EXTRASAVED 20 strength 100 } else
ifspritepal 10 strength 125 else
strength 75
sizeat 28 28
ifaction ACULTISTSHOTGUNSTRUGGLE nullop else
ai AICULTISTIDLE
cstator 257
}


state spawn_cold_breathe

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifaction ACULTIST_FROZE { state frozen_code break }

geta[].zvel TEMP8
ifg TEMP8 3000 { ifstrength 0 break action ACULTISTFALL }

ifaction ACULTISTFALL
{
// fall
move CULTISTRUNVELS seekplayer
geta[].zvel TEMP7
ifg TEMP7 3500 add FALL_COUNTER 5
ifg FALL_COUNTER 70 ifl FALL_COUNTER 80 globalsound CULTIST_FALL
iffloordistl 16 
		{ 
		ifonwater sound LANDWATER else sound LANDNORMAL 
		ai AICULTISTSEEKENEMY 
		ifg FALL_COUNTER 40 
			{
			seta[].htextra FALL_COUNTER
			set FALL_COUNTER 0
			}
		}
}

ifp pdead
{
ifstrength 0 break else ai AICULTISTIDLE
}
else
ifaction ACULTISTDYING
{
cstator 256
strength 0
ifhitweapon { spawn BLOOD guts JIBS6 1 ifactioncount 3 nullop else action ACULTISTDYING }
ifactioncount 8 { state BODY_FALL_NOISES spawn 7991 state rf ai AICULTISTDEAD }
}
else
ifaction ACULTIST_SLICED
{
cstator 256
strength 0
ifactioncount 5 { state BODY_FALL_NOISES spawn 7991 state rf ai AICULTIST_SLICED_DEAD }
}
else
ifaction ACULTISTHEADSHOT
{
strength 0
ifactioncount 8 { state BODY_FALL_NOISES spawn 7991 ai AICULTISTDEAD }
}
else
ifaction ACULTISTGRUESOMEDEATH
{
strength 0
ifactioncount 6 { state BODY_FALL_NOISES spawn 7991 ai AICULTISTGRUESOMEDEAD } else
ifactioncount 4 
		{
		ifspritepal 36 sound TOMMYG_FIRE else
		ifspritepal 49 sound FNFAL_FIRE else
		ifspritepal 20 sound FG42_FIRE  else
		sound CULTIST_RIFLE 
		} 
		else
ifactioncount 2 
		{
		ifspritepal 36 sound TOMMYG_FIRE else
		ifspritepal 49 sound FNFAL_FIRE else
		ifspritepal 20 sound FG42_FIRE  else
		sound CULTIST_RIFLE 
		}
		else
ifactioncount 1 { guts JIBS6 6 shoot NJIB shoot NJIB shoot NJIB }
}
else
ifaction ACULTISTCHOKE
{
state CULTISTCHOKE
}
else
ifaction ACULTISTSHOTGUNSTRUGGLE
{
lockplayer 26
move STOP
geta[].x TEMP
geta[].y TEMP2

set TEMP3 TEMP
add TEMP3 256

geta[].ang TEMP4

rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

setp[].posx TEMP5
setp[].posy TEMP6

        geta[].x mx
        geta[].y my
        getp[].posx x
        getp[].posy y
        sub mx x
        sub my y
        getangle TEMP8 mx my
        setp[].ang TEMP8

ifhitweapon
	{
	set SHOTGUN_STRUGGLE -1 
	setp[].movement_lock 0
	ifdead strength 1
	ai AICULTISTSEEKENEMY
	break
	}
	
	ifp pdead ai AICULTISTIDLE

	ifrnd 16 { ifg SHOTGUN_STRUGGLE_NUM 75 soundonce CULTIST_DIE3 else soundonce ZSCI_PAIN }
	ife SHOTGUN_STRUGGLE_NUM -100
		{
		ifrnd 32 state trigger_showoff
		set HEADSHOT 2
		sound DECAPITATE 
		shoot NJIB 
		shoot NJIB 
		state jib_sounds
		stopsound CULTIST_DIE3
		guts JIBS6 3 
		guts JIBS2 2 
		strength 0
		state cultist_dead_stuff
		cstat 0
		set SHOTGUN_STRUGGLE_NUM 0
		set SHOTGUN_STRUGGLE -1
		setp[].movement_lock 0
		ai AICULTISTDEAD
		break
		}
	else ifpdistg 1524 { setp[].movement_lock 0 set SHOTGUN_STRUGGLE -1 ai AICULTISTSEEKENEMY }
	else setp[].movement_lock 15
}
else
ifaction ACULTISTFCHOKE
{
state CULTISTFORCECHOKE
}
else
ifaction ACULTIST_TWITCH
{
move 0
add INTERNALCOUNT 1
ifactioncount 1 ai AICULTISTDEAD
}
else
ifai AICULTISTDEAD
{
strength 0
move 0

ifrnd 4 ifl INTERNALCOUNT 5 action ACULTIST_TWITCH

    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state monst_body_jibs
		ife INVASION 1  nullop else
		{
	  state standard_jibs
		}
	  ifrnd 128 shoot NJIB4
	  ifrnd 128 shoot NJIB4
        killit
      }
      break
    }

}
else
ifai AICULTIST_SLICED_DEAD
{
strength 0
move 0

    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state monst_body_jibs
	  state standard_jibs
	  ifrnd 128 shoot NJIB4
	  ifrnd 128 shoot NJIB4
        killit
      }
      break
    }

}
else
ifai AICULTISTHEADDEAD
{
strength 0
move 0

    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state monst_body_jibs
	  state standard_jibs
	  ifrnd 128 shoot NJIB4
	  ifrnd 128 shoot NJIB4
        killit
      }
      break
    }

}
else
ifai AICULTISTGRUESOMEDEAD
{
strength 0
move 0

    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
	  guts JIBS6 8
        killit
      }
      break
    }
}
else
ifai AICULTISTJUMP
{
ifactioncount 4 action ACULTISTFALL
}
else
ifai AICULTIST_GROW state genericgrowcode
else
ifai AICULTISTSHRUNK
{
	ifrnd 4
		{
		soundonce CULTIST_DIE3
		setactorsoundpitch THISACTOR CULTIST_DIE3 512
		}
    ifcount SHRUNKDONECOUNT
      ai AICULTISTSEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 28 28
	  }
    else
      state genericshrunkcode
    break
}
else
ifaction ACULTISTFLINCH
{
move 0
sub PAIN_AMOUNT 1
ifdead action ACULTISTDYING
ife PAIN_AMOUNT 0 ai AICULTISTSEEKENEMY
}
else
ifaction ACULTIST_GETUP
{
ifactioncount 3 { sizeat 28 28 ai AICULTISTSEEKENEMY }
}
else
ifai AICULTIST_CRAWL
{
ifrnd 16 { sizeat 28 28 action ACULTIST_GETUP resetactioncount }
}
else
ifaction ACULTIST_KNEEL
{
ifactioncount 2 { sizeat 28 13 ai AICULTIST_CRAWL resetactioncount  }
}
else
ifai AICULTISTIDLE
{
	state correctcansee
	ife sightvar YES ai AICULTISTSEEKENEMY
else
ife allies_present 1
	{
	ifspritepal 10 nullop else
		{
		ife allies_present 1 state enemyfindtarget
		ife both_present 1 state enemyfindtarget2
		ifn target -1 ai AICULTISTSHOOT_BOT
		}
	}
}
else
ifai AICULTISTSEEKENEMY
{
state correctcansee
geta[].htmovflag TEMP4
ifn TEMP4 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
{
         andvar TEMP4 49152
         ife TEMP4 32768 // the actor is pushing on a wall
         {
           geta[].htmovflag TEMP2 // need to get the info again
           andvar TEMP2 16383 // temp now stores the wall number
                   getwall[TEMP2].nextsector sect
                   ifn sect -1
				   {
				   ifand wall[TEMP2].cstat 1 break
				   ife sector[sect].lotag 20 operate
				   ife sector[sect].lotag 21 operate
				   ife sector[sect].lotag 22 operate
				   ife sector[sect].lotag 23 operate
                      ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
						{
                        ai AICULTISTJUMP
                        }
					}
          }
}

ifg shoot_countdown 0 sub shoot_countdown 1

state correctcansee
    ife sightvar YES
	ife shoot_countdown 0
	{
	state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE  
		{
		ifspritepal 10 ai AICULTISTSHOOT2 else ai AICULTISTSHOOT
		}
	}

ifpdistl 5120
ife sightvar YES
 ifrnd 64
  {
   ai AICULTISTRUSHENEMY
  }
else ifspritepal 10 ife sightvar YES ifpdistl 1596 ifrnd 64 ife SHOTGUN_STRUGGLE -1 ife sprite[].sectnum player[].cursectnum
		{ 
		ifaction ACULTISTSHOTGUNSTRUGGLE break
		ifaction ACULTISTCHOKE break
		sound PIGBUTT
		wackplayer
		action ACULTISTSHOTGUNSTRUGGLE
		set SHOTGUN_STRUGGLE_NUM 0
		set SHOTGUN_STRUGGLE THISACTOR
		}
else ifpdistl 1024 ifrnd 16 ifcansee ife sprite[].sectnum player[].cursectnum
		{ 
		ifaction ACULTISTCHOKE break
		action ACULTISTCHOKE 
		sound GRABTHROAT 
		geta[].pal TEMP set cultist_pal TEMP
		ife SKILL_LEVEL 1 set CHOKE 13 
		else ife SKILL_LEVEL 2 set CHOKE 26 
		else ife SKILL_LEVEL 3 set CHOKE 52
		else set CHOKE 52 
		}
else ifspritepal 49 ifn OWNERSAVED 1
	{ ifmultiplayer nullop else ifpdistl 4096 ifrnd 32 ifcansee ifcanseetarget ife FCHOKESTOP 0
		{ 
		action ACULTISTFCHOKE 
		sound GRABTHROAT 
		sound DEMON_TELEPORT
		ife SKILL_LEVEL 1 set FCHOKE 26 
		else ife SKILL_LEVEL 2 set FCHOKE 38 
		else ife SKILL_LEVEL 3 set FCHOKE 52
		else set FCHOKE 52
		}



	}
else ifrnd 16 ai AICULTISTSEEKENEMY

state SKILL_SHOOT_LEVELADJUST
ifbulletnear ifl RANDOM_CHANCE SKILLCHANCE { sizeat 28 28 action ACULTIST_KNEEL resetactioncount }

}
else
ifai AICULTISTRUSHENEMY
{

geta[].htmovflag TEMP4
ifn TEMP4 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
{
         andvar TEMP4 49152
         ife TEMP4 32768 // the actor is pushing on a wall
         {
           geta[].htmovflag TEMP2 // need to get the info again
           andvar TEMP2 16383 // temp now stores the wall number
                   getwall[TEMP2].nextsector sect
                   ifn sect -1
				   {
				   ifand wall[TEMP2].cstat 1 break
				   ife sector[sect].lotag 20 operate
				   ife sector[sect].lotag 21 operate
				   ife sector[sect].lotag 22 operate
				   ife sector[sect].lotag 23 operate
                      ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
						{
                        ai AICULTISTJUMP
                        }
					}
          }
}

	ifcansee
	{
	ifspritepal 21
		{
		ifrnd 32
		 ifg EXTRASAVED 0
		  ifpdistg 2048
			{
			ai AICULTISTTHROW
			}
		}
	else
	ifrnd 8
	 ifg EXTRASAVED 0
	  ifpdistg 2048
		{
		ai AICULTISTTHROW
		}
	else
	 ifrnd 8
	   ifg ZVELSAVED 0
	    ifpdistl 6098
		{
		ai AICULTISTTHROWNET
		}
	else
	 ifrnd 32
		{
		ife allies_present 1 state enemyfindtarget
		ife both_present 1 state enemyfindtarget2
		ifspritepal 10 ai AICULTISTSHOOT2 
		else
			{
			ifn target -1 ai AICULTISTSHOOT_BOT
			else ai AICULTISTSHOOT
			}
		}
	}
}
else
ifai AICULTISTTHROW
{
ifactioncount 5 
	{ 
	sub EXTRASAVED 1
	sound TNT_THROW 
	ifspritepal 49 eshoot GRENADE else
	ifspritepal 16 eshoot FL_GRENADE else
	eshoot DYNAMITESTICK 
	setthisprojectile[RETURN].extra 50
	ai AICULTISTSEEKENEMY 
	}
} 
else
ifai AICULTISTTHROWNET
{
ifactioncount 5 
	{ 
	sub ZVELSAVED 1
	sound TNT_THROW 
	spawn 10298
	ai AICULTISTSEEKENEMY 
	}
} 
else
ifai AICULTISTPUMP
{
add TEMP2 1
ife TEMP2 6 { sound SAWNOFF_COCK shoot 3761 shoot 3761 } 
ifg TEMP2 25 { ai AICULTISTSEEKENEMY resetcount set TEMP2 0 }
}
else
ifai AICULTISTSHOOT
{
  state correctcansee
	ife sightvar YES
	 {
	  ifactioncount 1 
		{ 
		state DARKNESS_ENEMY_ACCURACY
		ifspritepal 3 
			{ 
			state CULTISTSHOOTPLASMA
			} 
			else
		ifspritepal 36 { state SKILL_ENEMY_ACCURACY shoot CHAINGUN sound TOMMYG_FIRE ife PERFMODE 1 ifcansee shoot RIFLESHELL } else
		ifspritepal 16 { state SKILL_ENEMY_ACCURACY shoot CHAINGUN sound AK104FIRE ife PERFMODE 1 ifcansee shoot RIFLESHELL } else
		ifspritepal 49 { shoot CHAINGUN sound FNFAL_FIRE ife PERFMODE 1 shoot RIFLESHELL } else
		ifspritepal 20 { shoot SHOTGUN sound FG42_FIRE ife PERFMODE 1 shoot RIFLESHELL } else
		{ state SKILL_ENEMY_ACCURACY shoot SHOTSPARK1 sound CULTIST_RIFLE ife PERFMODE 1 ifcansee shoot RIFLESHELL }
		globalsound DISTANT_RIFLE
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle -76
			state spawn_gunsmoke_z
			set gunsmoke_z 4044
			ifspritepal 49 state spawn_enemy_ARFLASH
			else ifspritepal 20 state spawn_enemy_ARFLASH
			else ifspritepal 3 { set gunsmoke_z 3200 espawn 16113 }
			else espawn 16115
			state spawn_muzzleflash
			}
		ifrnd 32 ai AICULTISTSEEKENEMY
		resetactioncount 
		}
	}
	else ai AICULTISTSEEKENEMY
}
else
ifai AICULTISTSHOOT_BOT
{
	ifn target -1
	 {
	  ifactioncount 1 
		{ 
		state shoot_target
		state DARKNESS_TARGET_ACCURACY
		ifspritepal 3 { state CULTISTSHOOTPLASMA } else
		ifspritepal 36 { state SKILL_ENEMY_ACCURACY zshoot TEMP3 CHAINGUN sound TOMMYG_FIRE ife PERFMODE 1 ifcansee shoot RIFLESHELL } else
		ifspritepal 49 { zshoot TEMP3 CHAINGUN sound FNFAL_FIRE ife PERFMODE 1 ifcansee shoot RIFLESHELL } else // does max damage against non-players
		ifspritepal 20 { zshoot TEMP3 SHOTGUN sound FG42_FIRE ife PERFMODE 1 ifcansee shoot RIFLESHELL } else
		{ state SKILL_ENEMY_ACCURACY zshoot TEMP3 SHOTSPARK1 sound CULTIST_RIFLE ife PERFMODE 1 ifcansee shoot RIFLESHELL }
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle -76
			state spawn_gunsmoke_z
			set gunsmoke_z 4044
			ifspritepal 49 state spawn_enemy_ARFLASH
			else ifspritepal 20 state spawn_enemy_ARFLASH
			else espawn 16115
			state spawn_muzzleflash
			}
		ifrnd 16 ai AICULTISTSEEKENEMY
		resetactioncount 
		}
	}
	else ife target -1 ai AICULTISTSEEKENEMY
}
else
ifai AICULTISTSHOOT2
{
	ifactioncount 2 { set TEMP2 0 ai AICULTISTPUMP } else
	ifactioncount 1
	{
	state correctcansee
	ife sightvar YES
		{ 
		sound SAWNOFF_FIRE
		shoot SHOTGUN 
		shoot SHOTGUN 
		set gunsmoke_z 7644 
		set gunsmoke_angle -76
		state spawn_gunsmoke_z
		set gunsmoke_z 4044
		espawn 16114
		state spawn_muzzleflash
		}
	}
	else ai AICULTISTSEEKENEMY
}


ifhitweapon
{

ifspritepal 20 nullop else state NEWGUNEFFECTS
ifai AICULTIST_CRAWL sizeat 28 28
ifaction ACULTIST_SLICED break
ifaction ACULTISTDYING break
ifaction ACULTISTDEAD break
ifaction ACULTISTGRUESOMEDEATH break

state random_wall_jibs

      ifwasweapon RADIUSEXPLOSION
	ifstrength 0
	{
        state squish_sounds
	  state monst_body_jibs
	  action ACULTISTGRUESOMEDEATH
      }


	ifwasweapon SHOTSPARK1
	{
	ife CHAR 5
	ifstrength 1
		{
		ife CURWEAP 3
			{
			guts JIBS4 2
			guts JIBS3 1
			guts JIBS1 1
			guts JIBS5 1
			}
		}
	}

ifdead 
	{ 
	state cultist_dead_stuff
	ifspritepal 20 ifn OWNERSAVED -1 { operateactivators OWNERSAVED THISACTOR }
	
	geta[].htpicnum BULLET_HIT_TYPE
	ifand tiledata[BULLET_HIT_TYPE].gameflags 8 getprojectile[BULLET_HIT_TYPE].userdata PROJ_UDATA else set PROJ_UDATA 0

      ifwasweapon RADIUSEXPLOSION
      {
	  ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
		ifspritepal 20 
		{ palfrom 40 40 0 40 spawn SKULLEXPLOSION globalsound CULTIST_HAUNT }
        state squish_sounds
	  state monst_body_jibs
	  action ACULTISTGRUESOMEDEATH
      }
	else
      ifwasweapon RPG
      {
	  ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
		ifspritepal 20 
		{ palfrom 40 40 0 40 spawn SKULLEXPLOSION globalsound CULTIST_HAUNT }
        state squish_sounds
	  state monst_body_jibs
	  action ACULTISTGRUESOMEDEATH
      }
	else 	
	ifg ENERGY_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 4
		guts JIBS3 6
		spawn DISINTIGRATE_GUY
		killit
		}
	else ifg SPIRIT_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 1
		guts JIBS3 6
		spawn SPIRIT_DEATH_GUY
		killit
		}
	else
	ifg FIRE_DAMAGE 0
	{
	ifrnd 96 sound CULTIST_ONFIRE1
	else ifrnd 96 sound CULTIST_ONFIRE2
	else sound CULTIST_ONFIRE3
	spawn ONFIREGUY 
	set PLAYER_VOICEOVER 21
	killit
	}
else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ACULTIST_FROZE } 
else ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AICULTIST_GROW break }
else ifand PROJ_UDATA 8 // slicing death
	{ ifrnd 32 state trigger_showoff cstat 4 sound SLASHDIE action ACULTIST_SLICED } 
	else
	{
	ifspritepal 20 
	{ palfrom 40 40 0 40 action ACULTISTGRUESOMEDEATH spawn SKULLEXPLOSION globalsound CULTIST_HAUNT } else
	ife HEADSHOT 2 
		{ 
		ifspritepal 49 state trigger_showoff else
		ifrnd 32 state trigger_showoff
		state jib_sounds
		sound DECAPITATE
		state rf	
		action ACULTISTHEADSHOT 
		shoot NJIB 
		shoot NJIB 
		guts JIBS6 3 
		guts JIBS2 2 
		} 
		else
		{ 
		randvar TEMP 30
		ifl TEMP 10 sound CULTIST_DIE1 else
		ifl TEMP 20 sound CULTIST_DIE2 else
		sound CULTIST_DIE3
		state rf
		action ACULTISTDYING 
		}
	}
	} 
else 
ifg PAIN_AMOUNT 0 action ACULTISTFLINCH
else ifrnd 32 { sound ZSCI_PAIN state PAIN_SKILL_LEVELADJUST action ACULTISTFLINCH }
ifwasweapon SHRINKSPARK { ifspritepal 49 nullop else ifspritepal 20 nullop else { sound ACTOR_SHRINKING ai AICULTISTSHRUNK } }
}

state checksquished

enda


// ******************************************************************************
// THE SLIME
// ******************************************************************************

action SLIMEIDLE 0



move SLIMSTILL 0 0
move SLIMEMOVE 96 0

useractor notenemy SLIMEPUDDLE
fall
cstat 34

ifaction 0
{
seta[].blend 255
sizeat 8 8
action ZERO
}

ifaction ZERO
{
sizeto 32 32
}

enda

useractor notenemy SLIME
cstat 291
gets[].floorz TEMP5
seta[].z TEMP5

ifhitweapon
{
set TEMP4 0
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
zshoot -4096 SLIMEPROJ
killit
}

ifmove 0
{
seta[].blend 255
spritepal 0
sizeto 32 32
set TEMP4 1
}

ife TEMP4 1
{
geta[].xrepeat TEMP
geta[].yrepeat TEMP2
ifaction 0 
	{ 
	sizeto 48 48 
	ife TEMP 48
	 ife TEMP2 48
		action ZERO
	ife TEMP3 1
		{
		move SLIMEMOVE geth faceplayer
		} 
	}
else
ifaction ZERO
	{
	sizeto 24 24 
	ife TEMP 24
	 ife TEMP2 24
		{
		sound SLIME_MOVE
		action 0
		}
	ife TEMP3 1
		{
		move SLIMSTILL
		}
	}
ifpdistl 8092
	{
	set TEMP3 1
	}
	else
	{
	set TEMP3 0
	}

ifpdistl 812
{
soundonce SLIME_DIGEST
ifrnd 8 
	{ 
	wackplayer 
	getp[].boot_amount TEMP
	ifg TEMP 0 { quote 75 sub TEMP 2 setp[].boot_amount TEMP } else
		{ 
		palfrom 16 16 0 0
		addphealth -2
		}
	}
}

}


enda

// ******************************************************************************
// MERCENARY
// ******************************************************************************

action AMERC_FROZEN 40 1 1 1 10

action AMERCIDLE 5 1 5 1 10
action AMERCRUN 0 4 5 1 16
action AMERCREADYSHOOT 20 1 5 1 11
action AMERCSHOOT 25 1 5 1 11
action AMERCTHROW 30 2 5 1 15

action AMERCPAIN 40 1 1 1 5
action AMERCGROW 40 1 1 1 5

action AMERCDYING 40 5 1 1 8
action AMERC_HEAD_DYING 45 5 1 1 8
action AMERCDEAD 44 1 1 1 1
action AMERCHDEAD 49 1 1 1 1

move MERCRUN 108 
move MERCSTOP 0

ai AIMERCIDLE AMERCIDLE MERCSTOP
ai AIMERCSEEKENEMY AMERCRUN MERCRUN seekplayer
ai AIMERCDODGE AMERCRUN MERCRUN dodgebullet
ai AIMERCREADYSHOOT AMERCREADYSHOOT MERCSTOP faceplayer
ai AIMERCSHOOT AMERCSHOOT MERCSTOP faceplayer
ai AIMERCTHROW AMERCTHROW MERCSTOP faceplayersmart
ai AIMERCSHRUNK AMERCRUN MERCRUN furthestdir
ai AIMERCGROW AMERCGROW MERCSTOP

ai AIMERCDYING AMERCDYING MERCSTOP faceplayer
ai AIMERC_HEAD_DYING AMERC_HEAD_DYING MERCSTOP faceplayer

useractor enemystayput MERCSTAYPUT
cactor MERC
enda

useractor enemy MERC 150 AMERCIDLE
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage
fall

state checksquished

state spawn_cold_breathe

ifai 0
{
set MONSTER_FLAGS 2
state monst_glow
set ZVELSAVED 1
spawn SHOOTME
spriteflags NORMAL_ENEMY
sizeat 24 24
strength 150
cstator 257
ai AIMERCIDLE
}

ife INTERNALCOUNT 0
	{
	ifbulletnear
		{
		ifrnd 4 soundonce SD_GDOWN
		ifaction AMERC_FROZEN break
		ifdead break
		ifai AIMERCDODGE nullop
		else ai AIMERCDODGE
		}
	}

ifaction AMERC_FROZEN state frozen_code
else
ifaction AMERCDEAD
	{
	move MERCSTOP
	strength 0
	move 0
		ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
			state squish_sounds
			state human_jibs
			ife INVASION 1  nullop else
			{
		  state standard_jibs
			}
		  ifrnd 128 shoot NJIB4
		  ifrnd 128 shoot NJIB4
			killit
		  }
		  break
		}
	}
else
ifaction AMERCHDEAD
	{
	move MERCSTOP
	strength 0
	move 0
		ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
			state squish_sounds
			state human_jibs
			ife INVASION 1  nullop else
			{
		  state standard_jibs
			}
		  ifrnd 128 shoot NJIB4
		  ifrnd 128 shoot NJIB4
			killit
		  }
		  break
		}
	}
else
ifai AIMERC_HEAD_DYING 
	{
	ifactioncount 5 { ifaction AMERCDYING state BODY_FALL_NOISES spawn BLOOD action AMERCHDEAD }
	}
else
ifai AIMERCDYING 
	{
	ifactioncount 5 { ifaction AMERCDYING state BODY_FALL_NOISES spawn BLOOD action AMERCDEAD }
	}
else
ifaction AMERCPAIN
	{
	sub PAIN_AMOUNT 1
	move MERCSTOP
	ife PAIN_AMOUNT 0 ai AIMERCSEEKENEMY
	}
else
ifai AIMERCIDLE
	{
	state correctcansee
	ife sightvar YES
		{
		ifrnd 64 soundonce MERC_SIGHT1
		else ifrnd 64 soundonce MERC_SIGHT2
		else ifrnd 64 soundonce MERC_SIGHT3
		else ifrnd 64 soundonce MERC_SIGHT4
		else ifrnd 64 soundonce MERC_SIGHT5
		else ifrnd 64 ifn CHAR 11 soundonce GET_THAT_GUY // don't say 'GET THAT GUY' if you're playing as Jane
		ai AIMERCSEEKENEMY
		}
	}
else
ifai AIMERCTHROW
	{
		geta[].htlastvx mx
		geta[].htlastvy my
		geta[].x x
		geta[].y y
		sub mx x
		sub my y
		getangle ANGVAR mx my
		ifactioncount 2 soundonce JG_FLIP
		ifactioncount 4 
			{ 
			seta[].ang ANGVAR 
			sound THROWSOMET 
			shoot FL_GRENADE 
			ai AIMERCSEEKENEMY
			sub ZVELSAVED 1
			resetactioncount
			}
	}
else
ifai AIMERCGROW state genericgrowcode
else
ifai AIMERCSHRUNK
	{
		ifcount SHRUNKDONECOUNT
		  ai AIMERCSEEKENEMY
		else ifcount SHRUNKCOUNT
		  {
		  sound ACTOR_UNSHRINK
		  sizeto 42 42
		  }
		else
		  state genericshrunkcode
		break
	}
else
ifai AIMERCSEEKENEMY
	{
	state SKILL_SHOOT_LEVELADJUST
	state correctcansee
	ife sightvar YES
		{
		ife SCOPE 1 ifrnd 4 sound SD_SNIPR
		else
		ifrnd 4 sound MERC_SUPPRESS
		  ifl RANDOM_CHANCE SKILLCHANCE
			ai AIMERCREADYSHOOT
			else ai AIMERCSEEKENEMY
		}
		else ifrnd 4 ifawayfromwall ifg ZVELSAVED 0 { ifspawnedby MONS_SPAWNER nullop else { ifrnd 8 soundonce SD_FIREH ai AIMERCTHROW } }
	}
else
ifai AIMERCDODGE
	{
	ife WEAPON_TYPE 4 ifrnd 4 soundonce SD_RPG else
	ifrnd 4 soundonce SD_BACKUP 
	ifrnd 16 { ifbulletnear nullop else ai AIMERCSEEKENEMY }
	}
else
ifai AIMERCREADYSHOOT
	{
	state correctcansee
	ife sightvar YES
	{ ifactioncount 5 ai AIMERCSHOOT }
	else ai AIMERCSEEKENEMY
	}
else
ifai AIMERCSHOOT
	{
	ifactioncount 0 
		{ 
		sound MERC_SHOTGUN
		shoot SHOTSPARK1 
		shoot SHOTSPARK1 
		shoot SHOTSPARK1 
		shoot SHOTSPARK1 
		shoot SHOTSPARK1 
				{
				set gunsmoke_z 8244 
				set gunsmoke_angle 256
				state spawn_gunsmoke_z
				set gunsmoke_z 5044
				espawn 16114
				state spawn_muzzleflash
				shoot 3761
				}
		ifrnd 96 ai AIMERCSEEKENEMY else
		ai AIMERCREADYSHOOT
		ifp pdead
			{
			soundonce SD_TDESTR
			ai AIMERCIDLE
			}
		}
	}



ifhitweapon
{
state NEWGUNEFFECTS
//spawn BLOOD 
ifg FIRE_DAMAGE 0 nullop else guts JIBS6 1
state random_wall_jibs
ifdead 
{
addkills 1
state thegames_score
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		state standard_jibs
	  state monst_body_jibs
	  killit
      }
	else
      ifwasweapon RPG
      {
        state squish_sounds
		state standard_jibs
	  state monst_body_jibs
	  killit
      }
	else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AMERC_FROZEN } 
	else ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIMERCGROW break }
	else ifg ENERGY_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 4
		guts JIBS3 6
		spawn DISINTIGRATE_GUY
		killit
		}
	else ifg SPIRIT_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 1
		guts JIBS3 6
		spawn SPIRIT_DEATH_GUY
		killit
		}
	else ifg FIRE_DAMAGE 0
		{ 
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		spawn ONFIREGUY 
		set PLAYER_VOICEOVER 21
		killit
		}
	else ifwasweapon 7163 
		{ 
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		spawn ONFIREGUY 
		killit
		}
	else
	ife HEADSHOT 2
	{ 
	state rf
	ifrnd 32 state trigger_showoff 
	sound DECAPITATE 
	shoot NJIB shoot NJIB guts JIBS6 3 guts JIBS2 2 
	ai AIMERC_HEAD_DYING
	} 
	else
	{ 
	state rf
	ifrnd 128 sound MERC_DIE1
	else ifrnd 128 sound MERC_DIE2
	else sound MERC_DIE3
	ai AIMERCDYING
	} 
}
else
	{
	ifstrength 50 ifrnd 32 soundonce SD_MEDIC
	else
	ifrnd 128 soundonce MERC_PAIN 

		geta[].xvel xvel
		ifg PAIN_AMOUNT 0 action AMERCPAIN else
		ifrnd 32 { state PAIN_SKILL_LEVELADJUST action AMERCPAIN }
	else
	ifrnd 196 { ifg FIRE_DAMAGE 0 nullop else ai AIMERCSHOOT }
	}
ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIMERCSHRUNK }
}

enda 

// ******************************************************************************
// MERCENARY 2
// ******************************************************************************


action AMERC2_FROZEN 0 1 5 1 10

action AMERC2IDLE 0 1 5 1 10
action AMERC2RUN 0 4 5 1 11
action AMERC2READYSHOOT 20 1 5 1 11
action AMERC2SHOOT 25 1 5 1 11

action AMERC2PAIN 30 1 5 1 5

action AMERC2GROW 30 1 5 1 5

action AMERC2DYING 30 5 1 1 8
action AMERC2DEAD 35 1 1 1 1

action AMERC2_H_DYING -37 5 1 1 8
action AMERC2_H_DEAD -33 1 1 1 1


ai AIMERC2IDLE AMERC2IDLE MERCSTOP
ai AIMERC2SEEKENEMY AMERC2RUN MERCRUN seekplayer
ai AIMERC2READYSHOOT AMERC2READYSHOOT MERCSTOP faceplayer
ai AIMERC2SHOOT AMERC2SHOOT MERCSTOP faceplayer
ai AIMERC2SHRUNK AMERC2RUN MERCRUN furthestdir
ai AIMERC2GROW AMERC2GROW MERCSTOP

ai AIMERC2DYING AMERC2DYING MERCSTOP faceplayer
ai AIMERC2_H_DYING AMERC2_H_DYING MERCSTOP faceplayer

useractor enemystayput MERC2STAYPUT 100 AMERC2IDLE
cactor MERC2
enda

useractor enemy MERC2 100 AMERC2IDLE
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage
fall

state checksquished

state spawn_cold_breathe

ifai 0
{
set MONSTER_FLAGS 2
state monst_glow
spawn SHOOTME
spriteflags NORMAL_ENEMY
sizeat 25 25
strength 100
cstator 257
ai AIMERC2IDLE
}

ifaction AMERC2_FROZEN state frozen_code
else
ifaction AMERC2PAIN
{
sub PAIN_AMOUNT 1
move MERCSTOP
ife PAIN_AMOUNT 0 ai AIMERC2SEEKENEMY
}
else
ifaction AMERC2_H_DEAD
{
move MERCSTOP
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state human_jibs
		ife INVASION 1  nullop else
		{
	  state standard_jibs
		}
	  ifrnd 128 shoot NJIB4
	  ifrnd 128 shoot NJIB4
        killit
      }
      break
    }
}
else
ifai AIMERC2_H_DYING 
{
ifactioncount 5 { ifaction AMERC2_H_DYING state BODY_FALL_NOISES action AMERC2_H_DEAD }
}
else
ifaction AMERC2DEAD
{
move MERCSTOP
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state human_jibs
		ife INVASION 1  nullop else
		{
	  state standard_jibs
		}
	  ifrnd 128 shoot NJIB4
	  ifrnd 128 shoot NJIB4
        killit
      }
      break
    }
}
else
ifai AIMERC2DYING 
{
ifactioncount 5 { ifaction AMERC2DYING state BODY_FALL_NOISES action AMERC2DEAD }
}
else
ifai AIMERC2IDLE
{
ifcansee 
	{
	ifrnd 64 soundonce MERC_SIGHT1
	else ifrnd 64 soundonce MERC_SIGHT2
	else ifrnd 64 soundonce MERC_SIGHT3
	else ifrnd 64 soundonce MERC_SIGHT4
	else ifrnd 64 soundonce MERC_SIGHT5
	else ifrnd 64 soundonce GET_THAT_GUY
	ai AIMERC2SEEKENEMY
	}
}
else
ifai AIMERC2GROW state genericgrowcode
else
ifai AIMERC2SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIMERC2SEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 42 42
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AIMERC2SEEKENEMY
{
ifcansee
	{
	state SKILL_SHOOT_LEVELADJUST
	 ifcanshoottarget
	  ifl RANDOM_CHANCE SKILLCHANCE
		ai AIMERC2READYSHOOT
	}
}
else
ifai AIMERC2READYSHOOT
{
ifcanseetarget
ifcanshoottarget
{ ifactioncount 4 ai AIMERC2SHOOT }
else ai AIMERC2SEEKENEMY
}
else
ifai AIMERC2SHOOT
{
ifactioncount 0 
	{ 
	sound MERC2_RIFLE
	shoot ARMOUR_PIERCING_SHOT
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 8244 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			shoot RIFLESHELL 
			set gunsmoke_z 5044
			espawn 16115
			state spawn_muzzleflash
			}
	ifrnd 96 ai AIMERC2SEEKENEMY else
	ai AIMERC2READYSHOOT
	}
}


ifhitweapon
{
state NEWGUNEFFECTS
ifrnd 32 guts JIBS6 1
state random_wall_jibs
ifdead 
{
addkills 1
state thegames_score
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		state standard_jibs
	  state human_jibs
	  killit
      }
	else
      ifwasweapon RPG
      {
        state squish_sounds
		state standard_jibs
	  state human_jibs
	  killit
      }
	else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AMERC2_FROZEN } 
	else ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIMERC2GROW break }
	else ifg ENERGY_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 4
		guts JIBS3 6
		spawn DISINTIGRATE_GUY
		killit
		}
	else ifg SPIRIT_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 1
		guts JIBS3 6
		spawn SPIRIT_DEATH_GUY
		killit
		}
	else ifg FIRE_DAMAGE 0
		{ 
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		spawn ONFIREGUY 
		set PLAYER_VOICEOVER 21
		killit
		}
	else ifwasweapon 7163 	
	{ 		
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		spawn ONFIREGUY 
		killit 
	}
	else
	ife HEADSHOT 2
	{
    guts JIBS6 4 guts JIBS2 2
	ifrnd 128 sound HEL_HS1 else sound HEL_HS2
	state rf
	ai AIMERC2_H_DYING
	}
	else
	{ 
	state rf
	ifrnd 128 sound MERC_DIE1
	else ifrnd 128 sound MERC_DIE2
	else sound MERC_DIE3
	ai AIMERC2DYING
    ifrnd 64 spawn BLOODPOOL
	} 
}
else
	{
	ifrnd 128 soundonce MERC_PAIN 
	ifg PAIN_AMOUNT 0 action AMERC2PAIN
	else ifrnd 32 { state PAIN_SKILL_LEVELADJUST action AMERC2PAIN }
	else ifrnd 196 { resetactioncount ai AIMERC2READYSHOOT }
	}
ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIMERC2SHRUNK }
}

enda 

// ******************************************************************************
// LIGHT POWER SUIT
// ******************************************************************************

action ALPSUIT_IDLE 0 1 5 1 10
action ALPSUIT_MOVE 0 4 5 1 14
action ALPSUIT_FIRE 20 2 5 1 8
action ALPSUIT_DIE 30 5 1 1 20
action ALPSUIT_HEAD_DIE -215 3 1 1 30
action ALPSUIT_DEAD 34 1 1 1 10

move LPSUIT_WALK 150 0

ai AILPSUIT_IDLE ALPSUIT_IDLE STOP
ai AILPSUIT_MOVE ALPSUIT_MOVE LPSUIT_WALK seekplayer
ai AILPSUIT_FIRE ALPSUIT_FIRE STOP faceplayer
ai AILPSUIT_DIE ALPSUIT_DIE STOP
ai AILPSUIT_HEAD_DIE ALPSUIT_HEAD_DIE STOP

useractor enemystayput LPOWERSUITSTAYPUT state monst_glow cactor LPOWERSUIT enda

useractor enemy LPOWERSUIT 500 ALPSUIT_IDLE
fall

ifai 0
	{
	set MONSTER_FLAGS 2
	state monst_glow
	ifspawnedby MONS_SPAWNER sleeptime 0
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	strength 500
	sizeat 24 24
	cstat 257
	  ifrnd 64 soundonce LP_SIGHT1
	  else ifrnd 64 soundonce LP_SIGHT2
	  else ifrnd 64 soundonce LP_SIGHT3
	  else soundonce LP_SIGHT4
	ai AILPSUIT_IDLE
	}
	
ifaction ALPSUIT_DEAD break
	
ifai AILPSUIT_DIE
	{
	ifactioncount 4 { state BODY_FALL_NOISES sound LANDMETAL action ALPSUIT_DEAD }
	}
else
ifai AILPSUIT_HEAD_DIE
	{
	ifactioncount 3 { state BODY_FALL_NOISES sound LANDMETAL action ALPSUIT_DEAD }
	}
else
ifai AILPSUIT_IDLE
	{
	ifcansee
	 ifcanseetarget
	  ai AILPSUIT_MOVE
	}
else
ifai AILPSUIT_MOVE
	{
	ifactioncount 3 nullop else
	 ifactioncount 2 sound BIG_BOOT_STEP
		state SKILL_SHOOT_LEVELADJUST
		ifcanseetarget
		 ifcanshoottarget
		  ifl RANDOM_CHANCE SKILLCHANCE
		   ai AILPSUIT_FIRE
		   
		ifrnd 4 ai AILPSUIT_IDLE
	}
else
ifai AILPSUIT_FIRE
	{
	ifactioncount 1 
		{ 
		state SKILL_ENEMY_ACCURACY 
		shoot SHOTSPARK1 
		sound M4A1_FIRE 
		espawn 16115
		state spawn_muzzleflash
		resetactioncount 
		}
	ifrnd 16 ai AILPSUIT_MOVE
	}

ifhitweapon
	{
	seta[].xvel 0
    
    // Debris + blood
    ifrnd 64 
        { 
        ifspritepal 0 { spritepal 1 debris SCRAP1 1 debris SCRAP5 1 getlastpal }
        else { debris SCRAP1 1 debris SCRAP5 1 }
        }
	ifrnd 32 guts JIBS6 1
	
    ifdead
		{
		ifn YVELSAVED 0 espawnvar YVELSAVED
		soundonce PA_DIE
		ife HEADSHOT 2
			{ 
			state rf
			sound GLASS_BREAKING 
			ifrnd 128 sound HEL_HS1 else sound HEL_HS2
			guts JIBS6 5
            spawn BLOODPOOL
			ai AILPSUIT_HEAD_DIE 
			shoot NJIB
			lotsofglass 3
			} 
		else 
			{
			state rf
			ai AILPSUIT_DIE
			ifrnd 64 soundonce LP_DIE1
			else ifrnd 64 soundonce LP_DIE2
			else ifrnd 64 soundonce LP_DIE3
			else soundonce LP_DIE4
			}
		addkills 1
		}
	}
	
enda

// ******************************************************************************
// Code by George W. Bernard  
// ******************************************************************************

define GWBOSSSTRENGTH 6000
define GWBOSSPALSTRENGTH 750

action GWBOSSSCREAM        0 4 5 1 12
action GWBOSSFAST          0 4 5 1 5
action GWBOSSFRAMES        0 1 5 1 5
action AGWBOSSSHOOT       20 2 5 1 4
action AGWBOSSLOB         30 2 5 1 35

move GWBOSSWALKVELS 128 64
move GWBOSSWALKUPVELS 128 -96
move GWBOSSRUNVELS 160 64
move GWBOSSRUNUPVELS 160 -128
move GWBOSSBULLVELS 256 -96
move GWBOSSBACKWARDS -96 -128
move GWBOSSRISE 48 -96
move GWBOSSSTOPPED -16

ai AIGWBOSSGETE GWBOSSSCREAM GWBOSSRUNVELS faceplayerslow getv
ai AIGWBOSSWAIT GWBOSSFRAMES GWBOSSSTOPPED faceplayerslow
ai AIGWBOSSGETUP GWBOSSSCREAM GWBOSSRUNUPVELS faceplayer getv
ai AIGWBOSSPULLBACK GWBOSSFRAMES GWBOSSBACKWARDS faceplayerslow
ai AIGWBOSSHIT GWBOSSSCREAM GWBOSSBACKWARDS faceplayer
// ai AIGWBOSSSHRUNK GWBOSSFRAMES SHRUNKVELS fleeenemy
ai AIGWBOSSDODGE GWBOSSFRAMES GWBOSSBULLVELS dodgebullet geth
ai AIGWBOSSDODGEUP GWBOSSFRAMES GWBOSSRISE getv geth
ai AIGWBOSSSHOOTENEMY AGWBOSSSHOOT GWBOSSSTOPPED faceplayer
ai AIGWBOSSLOBBED AGWBOSSLOB GWBOSSSTOPPED faceplayer
// ai AIPALGWBOSSGETE GWBOSSSCREAM GWBOSSWALKVELS faceplayerslow getv
// ai AIPALGWBOSSGETUP GWBOSSSCREAM GWBOSSWALKUPVELS faceplayer getv

defstate checkgwbossseekstate
  ai AIGWBOSSGETE
  ifspritepal 0
      move GWBOSSRUNVELS seekplayer
    else
      move GWBOSSWALKVELS seekplayer
ends

defstate checkgwbosspalette
 ifai 0
 {
  ifspritepal 0
    {
    set CURBOSS THISACTOR
    sizeat 32 32
    strength GWBOSSSTRENGTH
    }
  else
    {
    sizeat 24 24
    strength GWBOSSPALSTRENGTH
    }
 }
ends

defstate gwbossdead
  addkills 1
  debris SCRAP1 24
  debris SCRAP2 16
  debris SCRAP3 20
  spawn EXPLOSION2
  sound RPG_EXPLODE
      ifspritepal 0
      { hitradius 16382 180 210 240 270
       palfrom 64 64 56 48
       cstat 0 }
      else
      { hitradius 8192 45 60 75 90
       palfrom 32 32 28 24
       cstat 0 }
      killit
ends

defstate checkgwbosshitstate

  ifdead state gwbossdead
  else ifsquished state gwbossdead
  else
  {
    sound DRON_PAIN
    ifbulletnear
    {
      ifceilingdistl 64
        ifrnd 48
          ai AIGWBOSSDODGE
      ai AIGWBOSSDODGEUP
    }
    else
      ai AIGWBOSSGETE
  }
ends

defstate checkgwbossnearplayer

  ifp palive
    ifpdistl 1596
  {
    ifcount 8
    {
      addkills 1
      sound DRON_ATTACK2
      debris SCRAP1 12
      debris SCRAP2 8
      debris SCRAP3 10
      spawn EXPLOSION2
      sound RPG_EXPLODE
      ifspritepal 0
      { hitradius 12288 180 210 240 270
       palfrom 64 64 56 48
       addphealth -150
       cstat 0 }
      else
      { hitradius 8192 45 60 75 90
       palfrom 32 32 28 24
       cstat 0 }
      killit
    }
    else
      ifcount 3 nullop
      else
        sound LASERTRIP_ARMING
  }

ends

defstate gwbossgetstate
  ifrnd 192
  {
    ifcansee
    {
      ifbulletnear
      {
        ai AIGWBOSSDODGE
        break
      }
      ifmove GWBOSSBULLVELS
      {
        ifcount 64
          ai AIGWBOSSPULLBACK
        else
          ifnotmoving
            ifcount 16
              ai AIGWBOSSPULLBACK
      }
      else
        ifcount 32
      {
        ifp phigher
          move GWBOSSBULLVELS geth getv
        else
          move GWBOSSBULLVELS geth
      }
    }
    else
      ifrnd 1
        operate
  }
ends

defstate gwbossdodgestate
  ifai AIGWBOSSDODGEUP
  {
     ifcount 8
       ai AIGWBOSSGETE
     else
       ifnotmoving
         ai AIGWBOSSGETE
  }
  else
  {
    ifcount 8
      ai AIGWBOSSGETE
    else
      ifnotmoving
        ai AIGWBOSSGETE
  }
ends

defstate gwbossseekenemystate
  ifrnd 2
    soundonce BOS3_ROAM
  else
    ifactioncount 6
  {
    resetactioncount
  }

  ifpdistl 2548
    ifp palive
  {
    ai AIGWBOSSSHOOTENEMY
    break
  }

  ifcansee
    ifcount 32
  {
    ifrnd 32
    {
      ifp palive
        ifcanshoottarget
          ai AIGWBOSSSHOOTENEMY
    }
    else
      ifpdistg 2548
        ifrnd 192
          ifcanshoottarget
    {
      ifrnd 64
      {
        ai AIGWBOSSGETE
        ifspritepal 0
          move GWBOSSRUNVELS seekplayer
        else
          move GWBOSSWALKVELS seekplayer
      }
      else
        ai AIGWBOSSLOBBED
    }
  }

ends

defstate gwbosslobbedstate
  ifcansee
  {
    ifactioncount 2
    {
ifspritepal 0 {
      resetactioncount
      sound ERPG_SHOOT
      shoot RPG
      shoot RPG
      shoot MORTER
      shoot MORTER
      shoot RPG
      shoot RPG }
else {
      resetactioncount
      sound ERPG_SHOOT
      shoot RPG
      shoot RPG }
    }
    else
      ifcount 64
        ifrnd 16
          state checkgwbossseekstate
  }
  else
    state checkgwbossseekstate
ends

defstate gwbossshootenemy
  ifcount 16
    state checkgwbossseekstate
  else
    ifaction AGWBOSSSHOOT
      ifactioncount 1
  {
    sound CAPT_ATTACK
    shoot CHAINGUN
    shoot CHAINGUN
    shoot CHAINGUN
    shoot CHAINGUN
    resetactioncount
  }
ends

useractor enemystayput GWBOSSSTAYPUT state monst_glow cactor GWBOSS enda

useractor enemy GWBOSS GWBOSSSTRENGTH
  state checkgwbosspalette
  ifspritepal 12 state checkgwbossnearplayer
  ifrnd 2
    fall
  else
    soundonce DRON_JETSND

  ifaction 0
    {
	set MONSTER_FLAGS 1
	state monst_glow
	  spawn SHOOTME
	  spriteflags NORMAL_ENEMY //ROBOT_ENEMY
    cstator 257
    ai AIGWBOSSGETE
    clipdist 100
    }
  else
    ifai AIGWBOSSSHOOTENEMY
      state gwbossshootenemy
  else
    ifai AIGWBOSSLOBBED
      state gwbosslobbedstate
  else
    ifai AIGWBOSSWAIT
  {
    ifactioncount 4
      ifrnd 16
        ifcansee
    {
      soundonce DRON_ATTACK1
      ifp phigher
        ai AIGWBOSSGETUP
      else ai AIGWBOSSGETE
    }
  }
  else
    ifai AIGWBOSSGETE
      state gwbossgetstate
  else
    ifai AIGWBOSSGETUP
      state gwbossgetstate
  else
    ifai AIGWBOSSPULLBACK
  {
    ifcount 24
      { ifpdistl 14336
    ai AIGWBOSSSHOOTENEMY
      else
    ai AIGWBOSSLOBBED }
  }
  else
    ifai AIGWBOSSHIT
  {
    ifcount 8
      ai AIGWBOSSLOBBED
  }
  else
    ifai AIGWBOSSDODGE
      state gwbossdodgestate
  else
    ifai AIGWBOSSDODGEUP
      state gwbossdodgestate
	  geta[].htextra TEMP6
  ifhitweapon
    state checkgwbosshitstate

  ifrnd 16
  { 
    ifrnd 32
ifspritepal 0 {
      ifpdistl 12288
	   ifcansee
	    ifcanseetarget
    {  ifrnd 64
      { addphealth -2
        palfrom 32 32 0 0
        sound SHORT_CIRCUIT
        sound DUKE_GRUNT }
       else
      { addphealth -1
        palfrom 32 32 0 0
        sound SHORT_CIRCUIT
        sound DUKE_GRUNT } } }
else {
      ifpdistl 4192
	   ifcansee
	    ifcanseetarget
    {  ifrnd 32
      { addphealth -2
        palfrom 32 32 0 0
        sound SHORT_CIRCUIT
        sound DUKE_GRUNT }
       else
      { addphealth -1
        palfrom 32 32 0 0
        sound SHORT_CIRCUIT
        sound DUKE_GRUNT } } }
  }
enda

// ******************************************************************************
// DARK AVATAR
// ******************************************************************************

action ADARKA_IDLE 30 1 5 1 10
action ADARKA_RUN 0 4 5 1 15
action ADARKA_PREP_CAST 20 1 5 1 30
action ADARKA_CAST 25 1 5 1 15
action ADARKA_PAIN 35 1 1 1 15
action ADARKA_DIE 35 7 1 1 20
action ADARKA_DEAD 42 1 1 1 10

move DARKA_STOP 0
move DARKA_MOVE 130

ai AIDARKAV_IDLE ADARKA_IDLE DARKA_STOP
ai AIDARKAV_MOVE ADARKA_RUN DARKA_MOVE seekplayer

ai AIDARKAV_PREP_FIRE ADARKA_PREP_CAST DARKA_STOP faceplayer
ai AIDARKAV_CAST_FIRE ADARKA_CAST DARKA_STOP faceplayersmart

ai AIDARKAV_PREP_ICE ADARKA_PREP_CAST DARKA_STOP faceplayer
ai AIDARKAV_CAST_ICE ADARKA_CAST DARKA_STOP faceplayersmart

ai AIDARKAV_PREP_THUND ADARKA_PREP_CAST DARKA_STOP faceplayer
ai AIDARKAV_CAST_THUND ADARKA_CAST DARKA_STOP faceplayersmart

ai AIDARKAV_PREP_SPIRIT ADARKA_PREP_CAST DARKA_STOP faceplayer
ai AIDARKAV_CAST_SPIRIT ADARKA_CAST DARKA_STOP faceplayersmart

ai AIDARKAV_WACK_PLAYER ADARKA_CAST DARKA_STOP faceplayer

ai AIDARKAV_DIE ADARKA_DIE DARKA_STOP 

spriteshadow 10946

useractor enemystayput 10946
ifaction 0
{
action ACAR
sizeat 34 34
cstat 257
}

ifaction ACAR
{
checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		globalsound DARKAV_SIGHT
		quake 52
		set HITAGSAVED 1110
		cactor DARKAVATAR_STAYPUT
		}
}

enda

useractor enemystayput DARKAVATAR_STAYPUT 8000 ADARKA_IDLE
ifai 0
{
state monst_glow
cactor DARKAVATAR
}
enda

useractor enemy DARKAVATAR 8000 ADARKA_IDLE
fall

ifai 0
{
state monst_glow
spawn SHOOTME
spriteflags NORMAL_ENEMY
strength 8000
set CURBOSS THISACTOR
set BOSS_TYPE 5
sizeat 34 34
cstat 257

ifspritepal 3 set HITAGSAVED 1110

	ifcansee 
	 ifcanseetarget
		{
		ifrnd 128 
			{
			set PLAYER_VOICEOVER 9
			}
		}

globalsound DARKAV_SIGHT
ai AIDARKAV_IDLE
}
else
ifaction ADARKA_DEAD break
else 
ifaction ADARKA_PAIN
{
sub PAIN_AMOUNT 2
move DARKA_STOP
ifl PAIN_AMOUNT 1 ai AIDARKAV_IDLE
}
else
ifai AIDARKAV_DIE
{
ifactioncount 7 action ADARKA_DEAD
}
else
ifai AIDARKAV_IDLE
{
  state correctcansee
    ife sightvar YES
  ai AIDARKAV_MOVE
  else ifrnd 16 ai AIDARKAV_MOVE
}
else
ifai AIDARKAV_MOVE
{
//state SUPERNATURAL_DAMAGE_MODIFIER
ifcanseetarget
 ifcanshoottarget
  ifrnd 4
  {
  sound DARKAV_SHOOT
  randvar TEMP2 3
  ife TEMP2 0 ai AIDARKAV_PREP_FIRE
  else ife TEMP2 1 ai AIDARKAV_PREP_ICE
  else ife TEMP2 2 ai AIDARKAV_PREP_THUND
  else ife TEMP2 3 ai AIDARKAV_PREP_SPIRIT
  }
else
ifpdistl 2048
 ifrnd 64
  {
  ai AIDARKAV_WACK_PLAYER
 }
ifrnd 1 { soundonce DARKAV_ROAM ai AIDARKAV_IDLE }
}
else
ifai AIDARKAV_WACK_PLAYER
{
ifactioncount 0 spritepal 23
ifactioncount 1
	{
	state setknockback
	sound FORCE_BLAST
	wackplayer 
	palfrom 20 30 0 0 
	addphealth -15
	getlastpal
	ai AIDARKAV_MOVE
	resetactioncount
	}
}
else
ifai AIDARKAV_PREP_FIRE
{
spritepal 21
ifactioncount 4 { ai AIDARKAV_CAST_FIRE resetactioncount }
}
else
ifai AIDARKAV_CAST_FIRE
{
flash
soundonce BRUISER_FLAME
shoot 7163
eshoot BRUISERFIREBALL geta[RETURN].ang TEMP sub TEMP 48 seta[RETURN].ang TEMP
eshoot BRUISERFIREBALL geta[RETURN].ang TEMP add TEMP 48 seta[RETURN].ang TEMP
ifactioncount 1 { getlastpal ai AIDARKAV_MOVE resetactioncount }
}
else
ifai AIDARKAV_PREP_ICE
{
spritepal 3
ifactioncount 4 { ai AIDARKAV_CAST_ICE resetactioncount }
}
else
ifai AIDARKAV_CAST_ICE
{
flash
soundonce GREMGUN_ICE
shoot 7159
eshoot FREEZEBLAST geta[RETURN].ang TEMP sub TEMP 48 seta[RETURN].ang TEMP
eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 48 seta[RETURN].ang TEMP
ifactioncount 1 { getlastpal ai AIDARKAV_MOVE resetactioncount }
}
else
ifai AIDARKAV_PREP_THUND
{
spritepal 16
ifactioncount 4 { ai AIDARKAV_CAST_THUND resetactioncount }
}
else
ifai AIDARKAV_CAST_THUND
{
flash
soundonce THUNDER
shoot SPELL2
eshoot 6198 geta[RETURN].ang TEMP sub TEMP 48 seta[RETURN].ang TEMP
eshoot 6198 geta[RETURN].ang TEMP add TEMP 48 seta[RETURN].ang TEMP
ifactioncount 1 { getlastpal ai AIDARKAV_MOVE resetactioncount }
}
else
ifai AIDARKAV_PREP_SPIRIT
{
spritepal 12
ifactioncount 4 { ai AIDARKAV_CAST_SPIRIT resetactioncount }
}
else
ifai AIDARKAV_CAST_SPIRIT
{
flash
soundonce CULTIST_HAUNT
shoot SPELL8
eshoot DAYBLAST geta[RETURN].ang TEMP sub TEMP 48 seta[RETURN].ang TEMP
eshoot DAYBLAST geta[RETURN].ang TEMP add TEMP 48 seta[RETURN].ang TEMP
ifactioncount 1 { getlastpal ai AIDARKAV_MOVE resetactioncount }
}

geta[].htextra TEMP7
ifhitweapon
	{
	  ife sprite[].htowner THISACTOR              // if the owner of the weapon IS this actor
		seta[].htextra -1       // set the damage to zero 
	
	ifg TEMP7 POINT_AMOUNT
	{
		geta[].htowner TEMP4
		geta[TEMP4].picnum TEMP5
		ife TEMP5 1405
			{
			getactorvar[TEMP4].P_CREDITS TEMP6
			add TEMP6 1
			setactorvar[TEMP4].P_CREDITS TEMP6
			}
		}
		
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	espawn BLOOD seta[RETURN].pal 1
	spritepal 1
	guts JIBS6 1
	state random_wall_jibs
	getlastpal
	ifdead
		{
		    ifn YVELSAVED 0 espawnvar YVELSAVED
			ifn HITAGSAVED 0
				{
				operateactivators HITAGSAVED THISACTOR
				operatemasterswitches HITAGSAVED
				operaterespawns HITAGSAVED
				}
			sound DARKAV_DIE
			state rf
			addkills 1
			state thegames_score
			ai AIDARKAV_DIE
		}
	else ifg PAIN_AMOUNT 0 action ADARKA_PAIN
	else ifrnd 6 { action ADARKA_PAIN state PAIN_SKILL_LEVELADJUST sound DARKAV_PAIN }
}

enda


// ******************************************************************************
// SORCERER
// ******************************************************************************

action ASORCERER_FROZEN 5 1 5 1 10
action ASORCERERFLOAT 0 1 5 1 10
action ASORCERERCAST 10 3 5 1 20
action ASORCERERPAIN 5 1 5 1 10
action ASORCERERDIE 25 8 1 1 15

move MSORCERERFLOAT 64 0
move MSORCERERFLOATUP 64 -64
move MSORCERERFLOATDOWN 64 64
move MSORCERERSTOP 0

ai AISORCERERFLOAT ASORCERERFLOAT MSORCERERFLOAT faceplayerslow dodgebullet geth
ai AISORCERERFLOATUP ASORCERERFLOAT MSORCERERFLOATUP faceplayerslow dodgebullet getv
ai AISORCERERFLOATDOWN ASORCERERFLOAT MSORCERERFLOATDOWN faceplayerslow dodgebullet getv
ai AISORCERERSHOOT ASORCERERCAST MSORCERERSTOP faceplayer

ai AISORCERERPUSH ASORCERERCAST MSORCERERSTOP faceplayer
ai AISORCERERPAIN ASORCERERPAIN MSORCERERSTOP faceplayerslow
ai AISORCERERTELEPORT ASORCERERPAIN MSORCERERSTOP spin
ai AISORCERERDYING ASORCERERDIE MSORCERERSTOP faceplayer

// This code sets the sprite a bit above the ground so it has the appearance of floating, except if that means clipping through the ceiling	
defstate check_canfloat
	updatesectorz sprite[].x sprite[].y sprite[].z TEMP4 
	ifn TEMP4 -1 getflorzofslope TEMP4 sprite[].x sprite[].y z
	ifn TEMP4 -1 getceilzofslope TEMP4 sprite[].x sprite[].y TEMP2
	set TEMP3 TEMP2
	sub TEMP3 z
	mulvar TEMP3 -1
	// TEMP3 now contains the height difference in "units" between ceiling and floor, multiplied by -1 to make it easier to understand (for me :P)
	// The *exact* height of a sorcerer is 12 544 units
	// For each unit that TEMP3 is higher than 12 544, the sorcerer can float that many units above the floor up to a maximum of 4000.
	sub TEMP3 12544

	geta[].z TEMP
	sub TEMP z
	mulvar TEMP -1 // TEMP contains the distance in units between the actor z and the floorz, again adjusted

	ifg TEMP3 4000 // can float 4000 units
	{
		// save the result of what would be the normal float height in TEMP10
		sub z 4000
		set TEMP10 z
		set TEMP9 1
		ifl TEMP 4000 // but is not floating that yet or higher
		{
			seta[].z TEMP10
			seta[].zvel 0 // stop falling
		}
	}
	else // float the amount that we can
	{
		sub z TEMP3
		set TEMP10 z
		set TEMP9 0
		seta[].z z
		seta[].zvel 0 // stop falling
	}	
ends // TEMP9 == 1 if the wizard can float 4000 units or more, 0 if they can't

useractor enemy SORCERER 250 ASORCERERFLOAT

ifai 0
	{
	set MONSTER_FLAGS 1
	state monst_glow
	ifspritepal 0 spritepal 21
	spawn SHOOTME
	spriteflags ROBOT_ENEMY
    
	strength 250
	sizeat 24 24
	action ASORCERERFLOAT
	ai AISORCERERFLOAT
	cstat 257
	}


state check_canfloat
//state SUPERNATURAL_DAMAGE_MODIFIER

ifaction ASORCERER_FROZEN state frozen_code else
ifai AISORCERERDYING
	{
	cstat 0
	add INTERNALCOUNT 1
    //spriteflags 39
    spriteflags 7
    
    ife INTERNALCOUNT 16 { spritepal 1 spawn 8433 state standard_jibs spritepal 0 }
	seta[].shade -64
	ifactioncount 7 fall
	ifactioncount 8 killit
	}
else
ifai AISORCERERPAIN
	{
	sub PAIN_AMOUNT 1
	move MSORCERERSTOP
	ife PAIN_AMOUNT 0 ai AISORCERERFLOAT
	}
else
ifai AISORCERERFLOAT
{
//sizeto 24 24
//spriteflags 35
//spriteflags 3

 ifcanseetarget
  ifcanshoottarget
  ifrnd 4
  {
  sound PRIEST_CAST01
   ai AISORCERERSHOOT
   }
   else
   ifpdistl 1024
    ifrnd 32
	ai AISORCERERPUSH
   else
// Check if must teleport
ifpdistg 8098
 ifrnd 16
  ife camerasprite -1
	{
	getp[].posx TEMP
	getp[].posy TEMP2
	set TEMP3 TEMP
	add TEMP3 1024
	randvar TEMP4 2048
	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	ifn TEMP7 -1
		{
		set INTERNALCOUNT 0
		ai AISORCERERTELEPORT
		resetcount
		}
	}
	else
ifrnd 128
	{
	 state check_canfloat
	 // Skip the float detection code if the wizard can't float freely in here
	 ife TEMP9 1
	 {
		 ifp phigher
			ai AISORCERERFLOATUP
		  else
		  {
			geta[].z z
			ifg TEMP10 z 
			{
				ai AISORCERERFLOATDOWN
			}
		  }
	  }
	}
}
else
ifai AISORCERERTELEPORT
{
add INTERNALCOUNT 1
	spawn FRAMEEFFECT1
	ife INTERNALCOUNT 4 { cstat 2 soundonce PRIEST_CAST02 sizeto 2 24 }
	ife INTERNALCOUNT 26
		{
			cstat 32768
			getp[].posx TEMP
			getp[].posy TEMP2
			set TEMP3 TEMP
			add TEMP3 1024
			randvar TEMP4 2048
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			updatesectorz TEMP5 TEMP6 player[].posz TEMP7
			ifn TEMP7 -1
				{
				spawn 8433
				// It's possible that this teleport code will put the sorcerer in the ceiling or floor, but that will be corrected by the check_canfloat state
				seta[].x TEMP5 
				seta[].y TEMP6
				getp[].posz TEMP8
				sub TEMP8 1754
				seta[].z TEMP8
				}
			else { cstat 257 sizeat 24 24 ai AISORCERERFLOAT }
		} 
	ife INTERNALCOUNT 27 { soundonce PRIEST_APPEAR cstat 2 sizeto 24 24 spawn 8433 }
	ife INTERNALCOUNT 40 { spawn SHOOTME cstat 257 sizeat 24 24 ai AISORCERERFLOAT }
}
else
ifai AISORCERERFLOATUP
{
state thisactor_getzrange
 ifcanseetarget
  ifcanshoottarget
  ifrnd 4
  {
  sound PRIEST_CAST01
   ai AISORCERERSHOOT
   }
   else
   ifpdistl 1024
    ifrnd 32
	ai AISORCERERPUSH
	else
ifrnd 16 ai AISORCERERFLOAT
}
else
ifai AISORCERERFLOATDOWN
{
state thisactor_getzrange
 ifcanseetarget
  ifcanshoottarget
  ifrnd 4
  {
  sound PRIEST_CAST01
   ai AISORCERERSHOOT
   }
   else
   ifpdistl 1024
    ifrnd 32
	ai AISORCERERPUSH
   else
ifrnd 16 ai AISORCERERFLOAT

// TEMP10: Minimal floating distance for this sector
ifg sprite[].z TEMP10
	{
	seta[].z TEMP10
	ai AISORCERERFLOAT
	}

}
else
ifai AISORCERERSHOOT
{
spriteflags 7
//spriteflags 39

seta[].shade -64
ifactioncount 3 
	{ 
	setprojectile[PRIEST_BLAST].workslike 32770
	shoot PRIEST_BLAST 
	setprojectile[PRIEST_BLAST].workslike 36866
	ai AISORCERERFLOAT 
	resetactioncount 
	}
}
else
ifai AISORCERERPUSH
{
spriteflags 7
//spriteflags 39
seta[].shade -64
ifactioncount 1 
	{ 
	getp[].posx mx
	getp[].posy my
	geta[].x x
	geta[].y y
	sub mx x
	sub my y
	getangle knockbackang mx my
	set knockback 6
	sound FORCE_BLAST
	ifpdistl 1024
		{
		wackplayer 
		palfrom 20 30 0 0 
		addphealth -15
		}
	ai AISORCERERFLOAT 
	resetactioncount
	}
}


ifhitweapon
	{
	state NEWGUNEFFECTS
	soundonce PRIEST_PAIN 
	espawn BLOOD seta[RETURN].pal 1
	spritepal 1
	guts JIBS6 1
	state random_wall_jibs
	getlastpal
	ifwasweapon 6875 { set WEP3_BLOODY 3 sound STAB }
    ifwasweapon RPG 
	{ seta[].xvel 5 }
	ifdead
		{
		ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ASORCERER_FROZEN } 
		else
			{
			state jib_sounds
			sound PRIEST_DEATH
			ai AISORCERERDYING
			state rf
			addkills 1
			state thegames_score
			set INTERNALCOUNT 0
			}
		}
	else ifpdistl 1024 { ifai AISORCERERPUSH nullop else ai AISORCERERPUSH }
	else ifg PAIN_AMOUNT 0 ai AISORCERERPAIN
	else ifrnd 16 { state PAIN_SKILL_LEVELADJUST ai AISORCERERPAIN }
	}

state ENEMYKNOCKBACKS

enda


// DUMMY FOR SANG CAPTURE CUTSCENE

action DUMMY -1 1 5 1 1

action DUMMYCAST 10 3 5 1 32

useractor notenemy 9773 
ifaction 0 action DUMMY

ifn camerasprite -1
ifaction DUMMY
	{
	checkactivatormotion HITAGSAVED
	
		ife RETURN 1
			{
			seta[].shade 0
			sound PRIEST_CAST01
			action DUMMYCAST
			}
	
	}
	
ifaction DUMMYCAST
	{
	ifactioncount 3
		{
		globalsound WHOOSH
		palfrom 62 62 62 62
		killit
		}
	}

enda

useractor notenemy 9777
ifspritepal 3 { ifn camerasprite -1 cstat 0 else cstat 32768  }
action ACAR
enda

// ================================================================================================
// DUMMIES FOR AIR SHIP
// ================================================================================================

action DUMMY_PIG_WALK -25 4 5 1 20

defstate PRISON_ENEMIES_STUFF
ifaction 0
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		action ZERO
		resetcount
		}
	}
else
ifaction ZERO
{
ifcount 180 killit
}
ends

useractor notenemy 1685

ifaction 0 action ACAR
	
ifaction ACAR
	{
	sleeptime 0
	ifpdistl 4096 ifrnd 2 sound PRED_ROAM
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		action ZERO
		resetcount
		}
	}
else
ifaction ZERO
{
ifcount 180 killit
}

enda

useractor notenemy 1749

ifaction 0 action ACAR
	
ifaction ACAR
	{
	sleeptime 0
	ifpdistl 4096 ifrnd 2 sound PRED_ROAM2
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		action ZERO
		resetcount
		}
	}
else
ifaction ZERO
{
ifcount 180 killit
}

enda

useractor notenemy 1760 state PRISON_ENEMIES_STUFF enda
useractor notenemy 1935 state PRISON_ENEMIES_STUFF enda
useractor notenemy 1942 state PRISON_ENEMIES_STUFF enda
useractor notenemy 2049 state PRISON_ENEMIES_STUFF enda

spriteshadow 2025

useractor notenemy 2025
ifaction 0 action ACAR

ifaction ACAR
	{
	sleeptime 0
	ifpdistl 4096 ifrnd 2 soundonce PIG_ROAM3
	checkactivatormotion LOTAGSAVED
	
		ife RETURN 1
			{
			globalsound PIG_RECOG
			action DUMMY_PIG_WALK
			set INTERNALCOUNT 0
			}
			
	ifg INTERNALCOUNT 70
		{
		add INTERNALCOUNT 1
		ifg INTERNALCOUNT 160 { action 0 spawn PIGCOP killit }
		}
	
	}
	
ifaction DUMMY_PIG_WALK
	{
	add INTERNALCOUNT 1
	move PIGWALKVELS geth
	ifg INTERNALCOUNT 74
		{
		globalsound PIG_ROAM4
		action ACAR
		move STOP
		}
	}

enda

spriteshadow 7492

action DUMMY_SHADE_FIRE    0 3 5 1 25

useractor notenemy 7492

ifaction 0
	{
	cstator 257
	sound SHADE_ALERT
	spritepal 0
	strength 50 
	sizeat 24 24
	geta[].ang TEMP6
	action ACAR
	set INTERNALCOUNT 0
	}
	
ifaction ACAR
	{
	ife INTERNALCOUNT 0 action DUMMY_SHADE_FIRE
	else ifg INTERNALCOUNT 0
		{
		ife camerasprite -1
			{
			add INTERNALCOUNT 1
			ifg INTERNALCOUNT 10 { action 0 cactor SHADE }
			}
		}
		
	}

ifaction DUMMY_SHADE_FIRE
{
cstat 257
	ifactioncount 3 
	{ 
		sound DEMON_THROWFIRE
		eshoot 7526
		seta[RETURN].ang TEMP6
		action ACAR
		set INTERNALCOUNT 1
	}
}
	

enda

// ******************************************************************************
// LE SANG
// ******************************************************************************

spriteshadow LESANG_DUMMY

action LESANGD -1 1 5 1 1

useractor notenemy LESANG_DUMMY
sizeat 24 24
action LESANGD
enda

action A_LESANG_STAND 0 0 5 1 0
action A_LESANG_WALK 0 0 5 1 12
action A_LESANG_ATTACK 5 3 5 1 40
action A_LESANG_TELEP 20 2 1 1 45
action A_LESANG_DIE 30 4 1 1 45
action A_LESANG_LEV 34 1

move LESANGWALK 120

ai AI_LESANG_WALK A_LESANG_WALK LESANGWALK seekplayer
ai AI_LESANG_TELEP A_LESANG_TELEP STOP
ai AI_LESANG_ATTACK A_LESANG_ATTACK STOP faceplayersmart
ai AI_LESANG_ATTACK2 A_LESANG_ATTACK STOP faceplayersmart
ai AI_LESANG_ATTACK3 A_LESANG_ATTACK STOP faceplayersmart
ai AI_LESANG_SUMMON A_LESANG_ATTACK STOP
ai AI_LESANG_SPECIAL A_LESANG_ATTACK STOP
ai AI_LESANG_DIE A_LESANG_DIE STOP
ai AI_LESANG_LEV A_LESANG_LEV STOP

useractor enemy LESANG 8000 A_LESANG_STAND
fall

ifai 0
	{
	state monst_glow
	set MONSTER_FLAGS 1
	geta[].htflags temp
	orvar temp SFLAG_NODAMAGEPUSH
	seta[].htflags temp
	ifspritepal 3 
		{
		set BOSS_TYPE 7
		set CURBOSS THISACTOR
		strength 12000 
		set ALLY_MAG 20
		set INTERNALCOUNT_3 0
		}
		else
		{
		set BOSS_TYPE 7
		set CURBOSS THISACTOR
		ife SKILL_LEVEL 1 set ALLY_MAG 10
		ife SKILL_LEVEL 2 set ALLY_MAG 20
		ife SKILL_LEVEL 3 set ALLY_MAG 30
		ife SKILL_LEVEL 4 set ALLY_MAG 40
		ife SKILL_LEVEL 5 set ALLY_MAG 50
		strength 8000
		set INTERNALCOUNT_3 2
		}
	ai AI_LESANG_WALK
	sizeat 24 24
	cstat 257
	}
	
ifstrength 8000 ife INTERNALCOUNT_3 0
	{
	set INTERNALCOUNT_3 1
	globalsound LESANG_ATTACK2
	flash
	set INTERNALCOUNT 0
	ai AI_LESANG_SPECIAL
	}
	
ifstrength 6000 ife INTERNALCOUNT_3 2
	{
	ife SKILL_LEVEL 1 set ALLY_MAG 5
	ife SKILL_LEVEL 2 set ALLY_MAG 10
	ife SKILL_LEVEL 3 set ALLY_MAG 15
	ife SKILL_LEVEL 4 set ALLY_MAG 20
	ife SKILL_LEVEL 5 set ALLY_MAG 25
	set INTERNALCOUNT_3 3
	}
	
ifai AI_LESANG_LEV
	{
	soundonce SPELL2AMB
	ifrnd 4 shoot SPARK2
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 60
		{
		palfrom 64 64 64 64
		operateactivators 601 THISACTOR
		operaterespawns 601
		operatemasterswitches 601
		killit
		}
	}
else
ifai AI_LESANG_DIE
	{
	spritepal 0
	globalsound THUNDERBALL_HIT
	flash
	shoot SPARK2
	ifactioncount 3 ai AI_LESANG_LEV
	}
else
ifai AI_LESANG_WALK
	{
	ifcansee
	 ifcanseetarget
	  ifrnd 4
	   ifg ALLY_MAG 0
	    ifstrength 8000
		{
		globalsound LESANG_AID
		set INTERNALCOUNT 0
		sub ALLY_MAG 1
		ai AI_LESANG_SUMMON		
		}
	
	ifcansee
	 ifcanseetarget
	  ifrnd 8
		{
		globalsound LESANG_ATTACK1
		set INTERNALCOUNT 0
		sub ALLY_MAG 1
		ifg INTERNALCOUNT_3 1 ifrnd 128 ai AI_LESANG_ATTACK3 else
		ifrnd 128 ai AI_LESANG_ATTACK2 else
		ai AI_LESANG_ATTACK	
		}
	}
else
ifai AI_LESANG_SPECIAL
	{
	spritepal 11
	add INTERNALCOUNT 1
		ife INTERNALCOUNT 10
			{
			sound THUNDERBALL_HIT
			}
		ife INTERNALCOUNT 25
			{
			palfrom 64 64 64 64
			screensound USE_PORTAL
			operateactivators 600 THISACTOR
			operaterespawns 600
			operatemasterswitches 600
			}
		ifg INTERNALCOUNT 30
			{
			killit
			}
	}	
else
ifai AI_LESANG_SUMMON
	{
	spritepal 21
	add INTERNALCOUNT 1
		ife INTERNALCOUNT 10
			{
			sound THUNDERBALL_HIT
			}
		ife INTERNALCOUNT 30
			{
				getp[].posx TEMP
				getp[].posy TEMP2
				set TEMP3 TEMP
				add TEMP3 1024
				randvar TEMP4 2048
				rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
				updatesector TEMP5 TEMP6 TEMP7
				ifn TEMP7 -1
					{
					espawn 8433
					shoot SPARK shoot SPARK shoot SPARK shoot SPARK
					seta[RETURN].x TEMP5 
					seta[RETURN].y TEMP6
					getp[].posz TEMP8
					seta[RETURN].z TEMP8
					ifstrength 6000 ifrnd 96 espawn SIREN else
					ifrnd 128 espawn ANUBIS_MUMMY else
					espawn ANUBIS
					changespritesect RETURN TEMP7
					seta[RETURN].x TEMP5 
					seta[RETURN].y TEMP6
					getp[].posz TEMP8
					sub TEMP8 1024
					seta[RETURN].z TEMP8
					}
			ai AI_LESANG_WALK
			}
	}	
else
ifai AI_LESANG_ATTACK
	{
	spritepal 0
	add INTERNALCOUNT 1
		ife INTERNALCOUNT 10
			{
			sound THUNDERBALL_HIT
			}
		ife INTERNALCOUNT 25
			{
			flash
			soundonce THUNDER
			shoot SPELL2
			ifg INTERNALCOUNT_3 1
				{
				eshoot 6198 geta[RETURN].ang TEMP sub TEMP 128 seta[RETURN].ang TEMP
				eshoot 6198 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
				eshoot 6198 geta[RETURN].ang TEMP sub TEMP 64 seta[RETURN].ang TEMP
				eshoot 6198 geta[RETURN].ang TEMP add TEMP 64 seta[RETURN].ang TEMP
				}
			}
		ife INTERNALCOUNT 30
			{
			ai AI_LESANG_WALK
			}
	}
else
ifai AI_LESANG_ATTACK2
	{
	spritepal 10
	add INTERNALCOUNT 1
		ife INTERNALCOUNT 10
			{
			sound THUNDERBALL_HIT
			}
		ife INTERNALCOUNT 25
			{
			flash
			soundonce GREMGUN_FIRE
			shoot 7163
			ifg INTERNALCOUNT_3 1
				{
				eshoot 7526 geta[RETURN].ang TEMP sub TEMP 128 seta[RETURN].ang TEMP
				eshoot 7526 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
				eshoot 7526 geta[RETURN].ang TEMP sub TEMP 64 seta[RETURN].ang TEMP
				eshoot 7526 geta[RETURN].ang TEMP add TEMP 64 seta[RETURN].ang TEMP
				}
			}
		ife INTERNALCOUNT 30
			{
			ai AI_LESANG_WALK
			}
	}
else
ifai AI_LESANG_ATTACK3
	{
	spritepal 49
	add INTERNALCOUNT 1
		ife INTERNALCOUNT 10
			{
			sound THUNDERBALL_HIT
			}
		ife INTERNALCOUNT 25
			{
			flash
			shoot HADESBLASTH
			eshoot HADESBLAST geta[RETURN].ang TEMP sub TEMP 64 seta[RETURN].ang TEMP
			eshoot HADESBLAST geta[RETURN].ang TEMP add TEMP 64 seta[RETURN].ang TEMP
			}
		ife INTERNALCOUNT 30
			{
			ai AI_LESANG_WALK
			}
	}	
	
ifhitweapon
	{
	shoot BLOOD
		ifdead
			{
			set CURBOSS -1
			set SLO_MO_SHOWOFF 40
			ai AI_LESANG_DIE
			addkills 1
			}
	}

enda

action LESANG_FDIE 

spriteshadow 9844

useractor notenemy 9844 

ifaction 0
	{
	spritepal 21
	sizeat 25 25
	ifrnd 4 shoot SPARK2
	soundonce SPELL2AMB
	checkactivatormotion 605
	 ife RETURN 1
		{
		quake 52
		spawn 8433
		spawn SPIRIT_DEATH_GUY
		screensound FORCE_BLAST
		killit
		}
	}

enda


// ******************************************************************************
// Eschaton Paradigm mook
// ******************************************************************************

spriteshadow 14222

useractor notenemy 14222 100 0 ifaction 0 { sizeat 24 24 action ACAR } enda

spriteshadow 18744

useractor notenemy 18744 100 0 ifaction 0 { sizeat 24 24 action ACAR } enda

// ******************************************************************************
// Trenton Solari
// ******************************************************************************

spriteshadow 14228
spritenoshade 14228

action TRENTON_WALK_AWAY 4716 4 5 1 8

useractor notenemy 14228

ifaction 0 { sizeat 27 27 action ACAR } 

ifaction ACAR
	{
	ifn LOTAGSAVED 0
		{
		checkactivatormotion LOTAGSAVED
			ife RETURN 1
				{
				action TRENTON_WALK_AWAY
				}
		}
	}
	
ifaction TRENTON_WALK_AWAY // 'Running'
	{
	fall
	move fake_player_run geth
	randvar FOOTSTEPCOUNT 3
	add TEMP4 1
	ifg TEMP4 8 
		{
		ife FOOTSTEPCOUNT 0 globalsound STEP1 else
		ife FOOTSTEPCOUNT 1 globalsound STEP2 else
		ife FOOTSTEPCOUNT 2 globalsound STEP3 else
		ife FOOTSTEPCOUNT 3 globalsound STEP4 
		set TEMP4 0
		}
	sub YVELSAVED 1
	ife YVELSAVED 0
		{
		move 0
		action ACAR
		ifspritepal 3 killit
		}
	}
	
enda

action A_TRENTON_STAND 0 1 5 1 0
action A_TRENTON_WALK 0 4 5 1 12
action A_TRENTON_ATTACK 20 4 5 1 12
action A_TRENTON_PARRY 40 1 5 1 0
action A_TRENTON_PAIN 45 1 5 1 0

move TREN_WALK 140

ai AI_TRENTON_STAND A_TRENTON_STAND STOP faceplayer
ai AI_TRENTON_WALK A_TRENTON_WALK TREN_WALK seekplayer
ai AI_TRENTON_ATTACK A_TRENTON_ATTACK STOP seekplayer
ai AI_TRENTON_SPELL A_TRENTON_PARRY STOP seekplayer
ai AI_TRENTON_PARRY_PROJ A_TRENTON_PARRY STOP seekplayer
ai AI_TRENTON_PARRY_MELEE A_TRENTON_PARRY STOP seekplayer
ai AI_TRENTON_TELEPORT A_TRENTON_STAND STOP

spriteflags TRENTON_SOLARI SFLAG_NODAMAGEPUSH

useractor enemy TRENTON_SOLARI
fall

ifaction 0
	{
	state monst_glow
	spawn SHOOTME
	sizeat 27 27
	cstat 257
	ifspawnedby APLAYER 
		{
		set ALLY_MAG 0
		strength 20000
		ai AI_TRENTON_WALK 
		}
	else
	ifspritepal 3
		{
		set ALLY_MAG 0
		strength 3000
		
		ife gp_subt 0
			{
			qputs 7500 ^2Trenton: ^0Time for a rematch Mikko, don't hold back this time.
			set gp_subt 130
			}
		
		ai AI_TRENTON_WALK
		}
	else
	ifspritepal 10
		{
		globalsound BLOOD_EXPLOSION
		spawn 18935
		strength 1500
		ai AI_TRENTON_WALK 
		}
	else
		{
		set ALLY_MAG 0
		strength 2000
		ai AI_TRENTON_STAND 
		}
	}
	
ife ALLY_MAG 2 
 ife global_trigger 5108 
		{
		globalsound BLOOD_EXPLOSION
		spawn 18935
		killit
		}
	
ifg targetlock 0 sub targetlock 1
	
//state MELEE_DAMAGE_MODIFIER
	
ifai AI_TRENTON_TELEPORT
	{
	ifl TEMP4 254 add TEMP4 8
	set alpha TEMP4
	state SPRITE_FADE
	ifg TEMP4 254 
		{
		globalsound BLOOD_EXPLOSION
		spawn 18935
		ife ALLY_MAG 2 { spawn BRIMSTONE killit }
		globalsound TRENTON_BAT_LAUGH
		globalsound BATS_FLYBY
		screensound TRENTON_BAT_LAUGH
		screensound BATS_FLYBY
		ifrnd 128 spawn 10644 else spawn 10643
		set TEMP 20
		whilevarn TEMP 0
			{
			set TEMP3 sprite[].x
			add TEMP3 256
			randvar TEMP4 2048
			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
			espawn 6200
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			geta[].z TEMP7
			sub TEMP7 4096
			randvar TEMP8 1024
			sub TEMP7 TEMP8
			seta[RETURN].z TEMP7
			espawn 18935
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			seta[].z TEMP7
			sub TEMP 1
			}
		ifn HITAGSAVED 0
			{
			operateactivators HITAGSAVED THISACTOR
			operatemasterswitches HITAGSAVED
			operaterespawns HITAGSAVED
			}
		else
			{
			ife ALLY_MAG 3 set global_trigger 5108
			operateactivators 5108 THISACTOR
			operatemasterswitches 5108
			operaterespawns 5108
			}

			readarrayfromfile WEAPONS_RESEARCH 4000
			ife WEAPONS_RESEARCH[10] 0 // Unlock beamsabre research
				{
				setarray WEAPONS_RESEARCH[10] 1
				writearraytofile WEAPONS_RESEARCH 4000
				}
		killit
		}
	}
else
ifai AI_TRENTON_STAND
	{
	ifn LOTAGSAVED 0
		checkactivatormotion LOTAGSAVED
	else
		checkactivatormotion 10018
		ife RETURN 1 ai AI_TRENTON_WALK
	}
else
ifai AI_TRENTON_WALK
	{
	state enemyfindtarget
	add INTERNALCOUNT 1
	 ifg INTERNALCOUNT 9
		{
		ifrnd 128 sound NPC_STEP1 else sound NPC_STEP2
		set INTERNALCOUNT 0
		}
		
	ifstrength 2000
	ife ALLY_MAG 1
		{
		
		ife gp_subt 0
			{
			qputs 7500 ^2Trenton: ^0I will wipe that smug grin off of your stupid face!
			set gp_subt 130
			}
		
		strength 3000
		espawn TRENTON_SOLARI
		seta[RETURN].pal 10
		setactorvar[RETURN].ALLY_MAG 2
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		set TEMP4 256
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		espawn TRENTON_SOLARI
		seta[RETURN].pal 10
		setactorvar[RETURN].ALLY_MAG 2
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		set TEMP4 -256
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		espawn TRENTON_SOLARI
		seta[RETURN].pal 10
		setactorvar[RETURN].ALLY_MAG 2
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		set TEMP4 -512
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		espawn TRENTON_SOLARI
		seta[RETURN].pal 10
		setactorvar[RETURN].ALLY_MAG 2
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		set TEMP4 -512
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set ALLY_MAG 3
		}
		
ifg INTERNALCOUNT_2 0 sub INTERNALCOUNT_2 1
		
	ife ALLY_MAG 1 ifrnd 8 ai AI_TRENTON_SPELL else
	ifn target -1
	 ifl xydist 1280
	  ifrnd 64
	   ife INTERNALCOUNT_2 0
		{
		ai AI_TRENTON_ATTACK
		}
		
	ifhitweapon
		{
		geta[].htpicnum TEMP
		getprojectile[TEMP].userdata TEMP2		
		ifg INTERNALCOUNT_2 0 
			{
			 ifand TEMP2 131072 
				{
				spawn BLOOD
				sound SLASH
				set INTERNALCOUNT_2 0
				set TEMP2 0
				}
			}
		else
			{
			ifand TEMP2 131072 
				{
				ai AI_TRENTON_PARRY_MELEE 
				}
				else
				{
				ai AI_TRENTON_PARRY_PROJ
				}
			}
		}
		
	}
else
ifai AI_TRENTON_ATTACK
	{
	state enemyfindtarget
	ifactioncount 3 
		{
		ife target -1 ai AI_TRENTON_WALK
		else ifg xydist 1280 ai AI_TRENTON_WALK
		else ai AI_TRENTON_ATTACK
		}
	else ifactioncount 2 
		{
		   ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 80
				ifn skybox -1 nullop else wackplayer
				state setknockback
				sound BEAMSABRE_CLASH
				ifl SKILL_LEVEL 3 set INTERNALCOUNT_2 90 else 
				set INTERNALCOUNT_2 50
				ai AI_TRENTON_WALK
				}
			else
			{
			getactorvar[target].myowner TEMP4
			ifn TEMP4 PLAYER_IDENTITY
				{
				seta[TEMP4].htextra -200
				seta[TEMP4].htpicnum 12053
				}
			shoot 12053
			}
		}
	else ifactioncount 1 soundonce BEAMSABRE_SWING
	ife target -1 ai AI_TRENTON_WALK
	ifg xydist 1280 ai AI_TRENTON_WALK
	}
else ifai AI_TRENTON_SPELL
	{
	ifactioncount 8
		{
		ifrnd 128
			{
			spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204
			spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204 spawn 6204
			sound TRENTON_BAT_LAUGH
			}
		else
			{
			shoot BLOOD_BLAST
			sound REDMGUN_FIRE
			}
		ai AI_TRENTON_WALK
		}
	}
else ifai AI_TRENTON_PARRY_PROJ
	{
	ifactioncount 2
		{
		seta[].htextra -1
		sound BEAMSABRE_CLASH
		 ifn sprite[].htpicnum -1
			{
			eshootvar sprite[].htpicnum
			ifn RETURN -1 seta[RETURN].ang sprite[].htang
			}
		ifl SKILL_LEVEL 3 set INTERNALCOUNT_2 30 else 
		set INTERNALCOUNT_2 15
		ifn target -1 ifl xydist 1280 ai AI_TRENTON_ATTACK
		else ai AI_TRENTON_WALK
		resetactioncount
		}
	}
else ifai AI_TRENTON_PARRY_MELEE
	{
	
	ifactioncount 2
		{
		seta[].htextra -1
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		getactorvar[target].myowner TEMP4
				ife TEMP4 PLAYER_IDENTITY
				 ifpdistl 1536
				{
				sub SPRINTING 40
				state setknockback
				ifl SKILL_LEVEL 3 set INTERNALCOUNT_2 60 else 
				set INTERNALCOUNT_2 30
				}
				else
				{
				state enemyfindtarget
				set INTERNALCOUNT_2 30
				}
		sound BEAMSABRE_CLASH

		set TEMP2 0
		ai AI_TRENTON_ATTACK
		resetactioncount
		}
	}

ifdead 
	{
	ifspritepal 3
		{
		strength 6000
		set CURBOSS THISACTOR
		set ALLY_MAG 1
		set BOSS_TYPE 8
		quake 104
		globalsound TRENTON_BAT_LAUGH
		palfrom 10 64 0 0
		operateactivators 1000 THISACTOR
		operatemasterswitches 1000
		operaterespawns 1000
		
		ife gp_subt 0
			{
			qputs 7500 ^2Trenton: ^0Enough, enjoy this last sight of Earth before I smash it to pieces!
			set gp_subt 130
			}
		
		espawn TRENTON_SOLARI
		seta[RETURN].pal 10
		setactorvar[RETURN].ALLY_MAG 2
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		set TEMP4 256
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		espawn TRENTON_SOLARI
		seta[RETURN].pal 10
		setactorvar[RETURN].ALLY_MAG 2
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		set TEMP4 -256
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		spritepal 9
		ai AI_TRENTON_WALK
		}
	else
		{
		ifai AI_TRENTON_TELEPORT nullop
		else { set TEMP4 0 ai AI_TRENTON_TELEPORT }
		}
	}


enda

// ******************************************************************************
// Magnus Giesler
// ******************************************************************************

spriteshadow 14233
spriteshadow 14238

spritenoshade 14233
spritenoshade 14238

useractor notenemy 14233 100 0 
	ifaction 0 
		{ 
		sizeat 11 11
		action ACAR
		
		readarrayfromfile IW_COMPLETE 4006
			ife IW_COMPLETE[2] 1 cactor 14238 // Did the player shoot Magnus in IW? Show headinjury if so
		
		} 
enda

useractor notenemy 14238 100 0 ifaction 0 { sizeat 11 11 action ACAR } enda


// ******************************************************************************
// LOST
// ******************************************************************************

action ALOSTFLOAT 0 1 5 1 0
action ALOSTDYING 15 5 1 1 12 
action ALOSTATTACK 5 2 5 1 8

move MLOSTFLOAT 128 0
move MLOSTFLOATUP 128 -128
move MLOSTFLOATDOWN 128 128

ai AILOSTFLOAT ALOSTFLOAT MLOSTFLOAT faceplayer seekplayer
ai AILOSTFLOATUP ALOSTFLOAT MLOSTFLOATUP faceplayer seekplayer getv
ai AILOSTFLOATDOWN ALOSTFLOAT MLOSTFLOATDOWN faceplayer seekplayer getv
ai AILOSTDYING ALOSTDYING STOP faceplayer
ai AILOST_CD ALOSTFLOAT STOP faceplayer
ai AILOSTATTACK ALOSTATTACK MLOSTFLOAT faceplayer

useractor enemy LOST 75 ALOSTFLOAT

ifai 0
	{
	seta[].mdflags 16
	set command 12288
	set MONSTER_FLAGS 8
	cstat 257
	spawn SHOOTME3
	spriteflags NORMAL_ENEMY
	sizeat 24 24
	strength 75
	action ALOSTFLOAT
	ai AILOSTFLOAT
	}

//state SUPERNATURAL_DAMAGE_MODIFIER

ifdead nullop else
{
	ifpdistg 2048
	{
	ifrnd 32 soundonce SPOOKY2
	}
	else
	ifpdistl 2048
	{
	cstat 256
	}
}

ifai AILOSTDYING
	{
	soundonce LOST_DIE
	sizeto 64 64
	ifactioncount 5 killit
	}
else
ifhitweapon
	{
	state NEWGUNEFFECTS
    ifwasweapon RPG seta[].xvel 5
	ifdead
		{
		ai AILOSTDYING
		state rf
		addkills 1
		state thegames_score
		}
	}
else
ifai AILOST_CD
	{
	addvar INTERNALCOUNT 1
	ife SKILL_LEVEL 1 ifg INTERNALCOUNT 90 ai AILOSTFLOAT
	else ife SKILL_LEVEL 2 ifg INTERNALCOUNT 60 ai AILOSTFLOAT
	else ife SKILL_LEVEL 3 ifg INTERNALCOUNT 30 ai AILOSTFLOAT
	else ife SKILL_LEVEL 4 ifg INTERNALCOUNT 15 ai AILOSTFLOAT
	else ifg SKILL_LEVEL 4 ai AILOSTFLOAT
	}
else
ifai AILOSTATTACK
	{
	ifactioncount 2 
		{ 
		ifg P_SPIRIT_ARMOUR 0
			{ 
			sub P_SPIRIT_ARMOUR 20
			soundonce SPARM_PROTECT
			palfrom 20 0 0 40
			ifl P_SPIRIT_ARMOUR 0 set P_SPIRIT_ARMOUR 0
			state setknockback
			}
		else
			ife CHAR 14
			  ifn player[].holoduke_on -1
				{ 
				soundonce SPARM_PROTECT
				palfrom 20 0 0 40
				state setknockback
				}
		else ife player_spooked 0 { set player_spooked 98 addphealth -30 palfrom 40 40 0 0 state setknockback }
		wackplayer 
		set INTERNALCOUNT 0
		soundonce LOST_ATTACK 
		ai AILOST_CD
		resetactioncount 
		}
	ifpdistg 2047 ai AILOSTFLOAT
	}
else
ifai AILOSTFLOAT
{
ifcansee
 ifcanseetarget
  ifpdistl 2048
  {
  	ai AILOSTATTACK
   }
   else
ifrnd 128
	{
	 ifp phigher
        ai AILOSTFLOATUP
      else
		{
		geta[].z z
		getp[].posz TEMP
		ifg TEMP z ai AILOSTFLOATDOWN
		}
	}
}
else
ifai AILOSTFLOATUP
{
ifcansee
 ifcanseetarget
  ifpdistl 2048
  {
  	ai AILOSTATTACK
   }
   else
ifrnd 16 ai AILOSTFLOAT
}
else
ifai AILOSTFLOATDOWN
{
ifg sprite[].z sector[].floorz 
	{
	seta[].z sector[].floorz
	ai AILOSTFLOAT
	}
ifcansee
 ifcanseetarget
  ifpdistl 2048
  {
  	ai AILOSTATTACK
   }
   else
ifrnd 16 ai AILOSTFLOAT
}


enda

// ******************************************************************************
// ZOMBIE
// ******************************************************************************

action AZOMBIE_FROZE 0 1 5 1 10
action AZOMBIEIDLE 0 4 5 1 60
action AZOMBIEWALK 0 4 5 1 20
action ASZOMBIERUN 0 4 5 1 4
action AZOMBIEBITE 21 1 5 1 10
action AZOMBIEDIE 27 6 1 1 10
action AZOMBIEDEAD 32 1 1 1 10
action AZOMBIEHEADSHOT 1114 6 1 1 6
action AZOMBIEHSDEAD 1119

move SUPERZOMRUN 280
move ZOMWALK 60
move ZOMSTOP 0

ai AIZOMBIEWALK AZOMBIEWALK ZOMWALK faceplayerslow
ai AISZOMBIERUN ASZOMBIERUN SUPERZOMRUN faceplayer
ai AIZOMBIEBITE AZOMBIEBITE ZOMSTOP faceplayer
ai AIZOMBIEDIE AZOMBIEDIE ZOMSTOP
ai AIZOMBIEHEADDIE AZOMBIEHEADSHOT ZOMSTOP
ai AIZOMBIE_SHRUNK AZOMBIEWALK ZOMWALK faceplayer
ai AIZOMBIE_GROW AZOMBIEWALK ZOMSTOP faceplayer

useractor enemy ZOMBIE 75 AZOMBIEIDLE
fall

state checksquished

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage

ifai 0
	{
	state monst_glow
	set both_present 1 
	spawn SHOOTME3
	spriteflags NORMAL_ENEMY
	cstat 257
	ifspawnedby APLAYER
		{
		strength 500
		spritepal 25
		sizeat 42 42
		}
	else
		{
		ifspritepal 25 strength 250 else strength 75
		sizeat 38 38
		}
	ifspritepal 25 ai AISZOMBIERUN else ai AIZOMBIEWALK
	}
else
ifaction AZOMBIE_FROZE state frozen_code
else
ifaction AZOMBIEDEAD
	{
	strength 0
	move 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
        killit
      }
	  else
	  ifpdistg 8000
	   {
	   ifcansee nullop else killit
	   }
	}
else
ifaction AZOMBIEHSDEAD
	{
	strength 0
	move 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
        killit
      }
	}
else
ifai AIZOMBIEDIE
	{
		ifactioncount 6
			{
			state BODY_FALL_NOISES
			action AZOMBIEDEAD
			}
	}
else
ifai AIZOMBIE_GROW
state genericgrowcode
else
ifai AIZOMBIE_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIZOMBIEWALK
    else ifcount SHRUNKCOUNT
      {
	  sound ACTOR_UNSHRINK
	ifspritepal 24 sizeto 52 52 else sizeto 46 46
	}
    else
      state genericshrunkcode
    break
}
else
ifai AIZOMBIEHEADDIE
	{
		ifactioncount 6
			{
			state BODY_FALL_NOISES
			action AZOMBIEHSDEAD
			}
	}
else
ifai AIZOMBIEWALK
	{
		ifspritepal 3
		 ifpdistl 2048
			{
				ifrnd 32 sound ZOMBIE_ROAM1 else 
				ifrnd 32 sound ZOMBIE_ROAM2 else 
				ifrnd 32 sound ZOMBIE_ROAM3
			}
		else
		ifrnd 1 sound ZOMBIE_ROAM1 else 
		ifrnd 1 sound ZOMBIE_ROAM2 else 
		ifrnd 1 sound ZOMBIE_ROAM3
		
	ifpdistl 1324
	ifp phigher
	ifrnd 32
		{
		wackplayer
		geta[].ang TEMP
		getp[].ang TEMP
		set knockbackheight 2048
		set knockback2 2
		}

	ifpdistl 1024
	 ifcansee
	  ifcanseetarget
		{
		ai AIZOMBIEBITE
		}
		
	ifnotmoving
	 ifrnd 4 shoot 9902
		
	}
else
ifai AISZOMBIERUN
	{
	
	ifpdistl 8192
	 ifcansee
	  ifcanseetarget
		{
		ifrnd 2 sound SUPER_ZOMBIE1 else
		ifrnd 2 sound SUPER_ZOMBIE2
		}
		else
		{
		ifrnd 1 sound ZOMBIE_ROAM1 else 
		ifrnd 1 sound ZOMBIE_ROAM2 else 
		ifrnd 1 sound ZOMBIE_ROAM3
		}
	
		
	ifpdistl 1024
	 ifcansee
	  ifcanseetarget
		{
		ai AIZOMBIEBITE
		}
	}
else
ifai AIZOMBIEBITE
	{
	ifpdistg 1024 { ifspritepal 25 ai AISZOMBIERUN else ai AIZOMBIEWALK }
	else
	ifcount 16
		{
		ife CHAR 2
		 ifg MERLIJNSHIELD 0
		  ifp pfacing
			{
			sub MERLIJNSHIELD 30
			ifrnd 128 sound SHIELDHIT2 else sound SHIELDHIT
			wackplayer
			}
		else
		ife CHAR 4
		{
			getp[].holoduke_on TEMP
			ifn TEMP -1
			{
			sound ZOMBIE_BITE
			seta[].htextra 20
			soundonce WHOOSH
			}
			else
			{
			sound ZOMBIE_BITE
			palfrom 30 30 0 0
			ifrnd 32 addphealth -30 else ifrnd 32 addphealth -25 else addphealth -20
			wackplayer
			}
		}
		else
			{
			sound ZOMBIE_BITE
			palfrom 30 30 0 0
			ifrnd 32 addphealth -30 else ifrnd 32 addphealth -25 else addphealth -20
			wackplayer
			}
		resetcount
		}
	}
	
ifhitweapon
	{
	state NEWGUNEFFECTS
    ifrnd 128 guts JIBS6 1
    ifrnd 4 guts JIBS5 1
    ifrnd 4 guts JIBS4 1
    ifrnd 4 guts JIBS3 1
    ifrnd 4 guts JIBS2 1
    ifrnd 4 guts JIBS1 1
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIZOMBIE_SHRUNK }
	ifdead
		{
		addkills 1
		state thegames_score
		
		geta[].htpicnum BULLET_HIT_TYPE
		ifand tiledata[BULLET_HIT_TYPE].gameflags 8 getprojectile[BULLET_HIT_TYPE].userdata TEMP4 else set TEMP4 0
		
		ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AZOMBIE_FROZE } 
		else ifg FIRE_DAMAGE 0 { spawn ONFIREGUY set PLAYER_VOICEOVER 21 killit }
		else ifg ENERGY_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 4
		guts JIBS3 2
		spawn DISINTIGRATE_GUY
		killit
		}
		else ifand TEMP4 8 			
			{ 
			ife SWORD_ANIM 1 cstat 4 else cstat 0 
			state sword_kill_sounds
			ai AIZOMBIEDIE
			sound SLASHDIE 
			spawn BLOODPOOL 
			}
		else ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIZOMBIE_GROW break }
		else
			{
			ifrnd 128 sound ZOMBIE_DIE1 else sound ZOMBIE_DIE2
			spawn BLOODPOOL
			geta[].extra TEMP
			ifl TEMP -40
			 ifrnd 200
				{
				spawn 18935
		        state squish_sounds
		        state standard_jibs
		        killit
				}
			else
				{
				ife HEADSHOT 2 
					{
					state rf
					ai AIZOMBIEHEADDIE 
					ifrnd 32 state trigger_showoff 
					sound DECAPITATE shoot NJIB shoot NJIB guts JIBS6 3 guts JIBS2 2 
					}
				else { state rf ai AIZOMBIEDIE }
				}
			}
		}
	}
	

enda

// ******************************************************************************
// DR JEKYLL
// ******************************************************************************

action AJEKYL_DUMMY -92 1 5 1 10

spriteshadow 11266

useractor notenemy 11266
fall

ifaction 0
{
sizeat 22 22
action AJEKYL_DUMMY
}

ifaction AJEKYL_DUMMY
{
ifspritepal 3
	{
	ifn camerasprite -1 cstat 0 else cstat 32768
	}
}

enda

action AJEKYL_IDLE 0 1 5 1 10
action AJEKYL_MOVE 0 4 5 1 20
action AJEKYL_SHOOT 20 2 5 1 4
action AJEKYL_PAIN 30 1 5 1 10
action AJEKYL_DIE 35 5 1 1 24
action AJEKYL_DEAD 39
action AJEKYL_RELOAD 40 1 1 1 4

move JEK_MOVE 120

ai AIJEKYL_IDLE AJEKYL_IDLE STOP
ai AIJEKYL_MOVE AJEKYL_MOVE JEK_MOVE seekplayer
ai AIJEKYL_SHOOT AJEKYL_SHOOT STOP faceplayer
ai AIJEKYL_RELOAD AJEKYL_RELOAD STOP faceplayer
ai AIJEKYL_PAIN AJEKYL_PAIN STOP faceplayer
ai AIJEKYL_DIE AJEKYL_DIE STOP

useractor enemy DOCTORJ
fall

sleeptime 0

ifaction 0
{
	state monst_glow
	sizeat 22 22
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	cstat 257
	strength 500
	ai AIJEKYL_IDLE
	set TEMP7 0
}

ifaction AJEKYL_DEAD
{
	ifn HITAGSAVED 0
		{
		soundonce THUNDER
		add INTERNALCOUNT 1
		quake 130
		ifrnd 8 { flash palfrom 20 64 64 64 globalsound LIGHTNING_SLAP }
		ife INTERNALCOUNT 130
			{
			spawn 8433
			spawn PENTAGRAM
			spawn BURNING2
			}
		ife INTERNALCOUNT 140
			{
			palfrom 64 64 64 64
			globalsound USE_PORTAL
			operateactivators HITAGSAVED THISACTOR
			operatemasterswitches HITAGSAVED
			operaterespawns HITAGSAVED
			killit
			}

		}
		else
		break
}
else
ifai AIJEKYL_DIE
{
ifactioncount 5
	{
	state rf
	state BODY_FALL_NOISES
	spawn BLOODPOOL
	action AJEKYL_DEAD
	globalsound INTIMIDATE_INTRO
	}
}
else
ifai AIJEKYL_IDLE
{
ifcansee 
 ifcanseetarget
  ai AIJEKYL_MOVE
}
else
ifai AIJEKYL_MOVE
{
	ifcanseetarget
	 ifcanshoottarget
	  ifrnd 16
		{
		set TEMP6 0
		ifg TEMP7 5 ai AIJEKYL_RELOAD else
		ai AIJEKYL_SHOOT
		resetactioncount
		}
	ifrnd 2 ai AIJEKYL_IDLE
}
else
ifai AIJEKYL_SHOOT
{
add TEMP6 1
ife TEMP6 2
	{
	sound REVOLVER2FIRE
	shoot ZRIFLESHOTU
	add TEMP7 1
	}
ife TEMP6 4 
	{
	ifg TEMP7 5 { set INTERNALCOUNT 0 ai AIJEKYL_RELOAD } else
	ai AIJEKYL_IDLE 
	set TEMP6 0
	resetcount
	}

}
else
ifai AIJEKYL_RELOAD
{
ifdead ai AIJEKYL_DIE 
add INTERNALCOUNT 1
ife INTERNALCOUNT 3 soundonce R_ROUT
ife INTERNALCOUNT 6 
	{
	shoot SRIFLESHELL shoot SRIFLESHELL shoot SRIFLESHELL shoot SRIFLESHELL shoot SRIFLESHELL shoot SRIFLESHELL
	}
ife INTERNALCOUNT 20 soundonce R_RIN
ife INTERNALCOUNT 23 { set TEMP6 0 set TEMP7 0 }
ife INTERNALCOUNT 26 ai AIJEKYL_MOVE
}
else
ifai AIJEKYL_PAIN
{
sub PAIN_AMOUNT 1
ife PAIN_AMOUNT 0 { ifdead ai AIJEKYL_DIE else ai AIJEKYL_MOVE }
}

ifhitweapon
	{
	state NEWGUNEFFECTS
		//spawn BLOOD
		//guts JIBS6 1
		ifdead
			{
			guts JIBS6 5
			addkills 1
			set INTERNALCOUNT 0
			ai AIJEKYL_DIE			
			}
		else ifg PAIN_AMOUNT 0 ai AIJEKYL_PAIN
		else ifrnd 32 { soundonce CULTIST_PAIN1 state PAIN_SKILL_LEVELADJUST ai AIJEKYL_PAIN }
	}

enda

// ******************************************************************************
// MR HYDE
// ******************************************************************************

action AHYDE_IDLE -156 1 5 1 10
action AHYDE_MOVE 0 4 5 1 20
action AHYDE_PUNCH 20 3 5 1 14
action AHYDE_SHOOT 35 2 5 1 20
action AHYDE_DIE 45 7 1 1 14
action AHYDE_DEAD 52

move HYDE_MOVE 170
move HYDE_SUPER 340

ai AIHYDE_IDLE AHYDE_IDLE STOP faceplayer
ai AIHYDE_MOVE AHYDE_MOVE HYDE_MOVE seekplayer
ai AIHYDE_DODGE AHYDE_MOVE HYDE_SUPER dodgebullet
ai AIHYDE_PUNCH AHYDE_PUNCH STOP faceplayer
ai AIHYDE_SHOOT AHYDE_SHOOT STOP faceplayer
ai AIHYDE_DIE AHYDE_DIE STOP

spritenopal MISTERH

useractor enemy MISTERH
fall

ifaction 0
	{
	state monst_glow
	sizeat 28 28
	strength 4000
	ifspritepal 3 nullop else
	set CURBOSS THISACTOR
	set BOSS_TYPE 5
	cstat 257
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	ai AIHYDE_IDLE
	}
	
sleeptime 0
	
ifaction AHYDE_DEAD break
else
ifai AIHYDE_DIE
{
ifactioncount 7
	{
	state rf
	guts JIBS6 5
	state BODY_FALL_NOISES
	spawn BLOODPOOL
	action AHYDE_DEAD
	palfrom 64 64 64 64
	globalsound USE_PORTAL
	operateactivators 27555 THISACTOR
	operatemasterswitches 27555
	operaterespawns 27555
	}
}
else
ifai AIHYDE_IDLE
	{
	ifcansee
	 ifcanseetarget
	  ai AIHYDE_MOVE
	  else
	  ifrnd 64
	   ife camerasprite -1
	  ai AIHYDE_MOVE
	}
else
ifai AIHYDE_DODGE
	{
	spawn FRAMEEFFECT1
	ifactioncount 2 ai AIHYDE_MOVE
	}
else
ifai AIHYDE_MOVE
	{
	ifbulletnear
	  { soundonce WHOOSH ai AIHYDE_DODGE }

	ifpdistl 1024 ai AIHYDE_PUNCH

	 ifcanseetarget
	  ifcanshoottarget
	   ifrnd 8
	    ai AIHYDE_SHOOT

	ifrnd 4 { soundonce MRH_SEEK ai AIHYDE_IDLE }
	}
else
ifai AIHYDE_SHOOT
	{
	ifactioncount 2 { soundonce MRH_ROAM ai AIHYDE_IDLE }
	else
	ifactioncount 1
		{
		soundonce FLESH_SQUIRT
		shoot BONE_SHARD
		}
	}
else
ifai AIHYDE_PUNCH
	{
	ifpdistg 1024 ai AIHYDE_MOVE
	else
		{
		ifactioncount 3
			{
			soundonce PUNCH2
			state setknockback
			wackplayer
			addphealth -40
			palfrom 40 40 0 0
			ai AIHYDE_MOVE
			resetactioncount
			}
		else ifactioncount 0 soundonce MRH_THROWP
		}
	}
	
ifhitweapon
	{
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
		//spawn BLOOD
		//guts JIBS6 1
		ifdead
			{
			quake 26
			guts JIBS6 5
			addkills 1
			ai AIHYDE_DIE
			}
	seta[].xvel 5
	}
	

enda


// ******************************************************************************
// LILITH
// ******************************************************************************


spritenoshade 10828

useractor notenemy 10828 // Souls
ifaction 0
{
sizeat 48 48
seta[].blend 255
cstat 130
}

ife STORY_TRIGGER3 1 killit

seta[].shade -127

checkactivatormotion TEMP7
ife RETURN 1
	{
	sub NUMBER_OF_SOULS 1
	getactorvar[myowner].myowner TEMP4
	setactorvar[TEMP4].TEMP9 1
	killit
	}

geta[myowner].x TEMP
geta[myowner].y TEMP2

set TEMP3 TEMP
add TEMP3 1024

rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

ifg TEMP4 2048 sub TEMP4 2048

seta[].x TEMP5 
seta[].y TEMP6
geta[myowner].z TEMP8
sub TEMP8 1754
seta[].z TEMP8

ifcount 1 { add TEMP4 32 resetcount }

enda

useractor notenemy 9750 // Protection sphere

ife STORY_TRIGGER3 1 killit

ifaction 0
{
sizeat 48 48
seta[].blend 255
cstat 642
}

ife NUMBER_OF_SOULS 0
{
palfrom 40 0 0 40
operateactivators 1205 THISACTOR
killit
}

geta[myowner].extra TEMP2
ifl TEMP2 1
	killit

geta[myowner].x TEMP
geta[myowner].y TEMP2
geta[myowner].z TEMP3
sub TEMP3 4096
setsprite THISACTOR TEMP TEMP2 TEMP3

enda

action LILITH_IDLE 0 1 5 1 10
action LILITH_HOSTILE 0 1 5 1 10
action LILITH_ATTACK 5 3 5 1 10

useractor enemy LILITH 

ifaction 0
{
spawn 9750
set STORY_TRIGGER2 1
sizeat 23 23
cstat 257
strength 500
set NUMBER_OF_SOULS 4
espawn 10828
setactorvar[RETURN].TEMP7 1201
setactorvar[RETURN].TEMP4 0
espawn 10828
setactorvar[RETURN].TEMP7 1202
setactorvar[RETURN].TEMP4 512
espawn 10828
setactorvar[RETURN].TEMP7 1203
setactorvar[RETURN].TEMP4 1024
espawn 10828
setactorvar[RETURN].TEMP7 1204
setactorvar[RETURN].TEMP4 1536
action LILITH_IDLE
}

geta[myowner].x TEMP
geta[myowner].y TEMP2
geta[myowner].z TEMP3
sub TEMP3 80096
setsprite THISACTOR TEMP TEMP2 TEMP3
geta[myowner].ang TEMP
seta[].ang TEMP

ife STORY_TRIGGER3 1 killit

ifaction LILITH_HOSTILE
ifrnd 16
	{
	action LILITH_ATTACK
	}
	
ifaction LILITH_ATTACK
	{
	ifactioncount 3
		{
		shoot PRIEST_BLAST 
		action LILITH_HOSTILE
		}
	}

ifhitweapon
	{
	ifg NUMBER_OF_SOULS 0
		{
		seta[].extra 500
		seta[].htextra -1
		}
	else
		{
		geta[].htpicnum TEMP
			ife TEMP 9376 // If you hit her with the MIA Gun, 'teleport' her away to safety instead
			{
				  globalsound SAVE_PERSON 
				  espawn TRANSPORTERBEAM
				  seta[RETURN].pal 17
				  cstat 32768
				  seta[myowner].htextra 10000
				  setactorvar[myowner].TEMP8 1
				  killit
			}
			
		ifaction LILITH_IDLE action LILITH_HOSTILE
		spawn BLOOD
		guts JIBS6 1
		setactorvar[myowner].TEMP8 1
		ifdead
			{
			set STORY_TRIGGER2 0 // If lilith is killed, set the story trigger 2 to 0
			palfrom 62 62 0 0
			spawn SKULLEXPLOSION
            guts JIBS6 8 guts JIBS5 3 guts JIBS2 2 guts JIBS4 2 guts JIBS4 1
			seta[myowner].htextra 10000
			setactorvar[myowner].TEMP8 1
			killit
			}
		}
	}

enda


useractor notenemy 9752 
ifaction 0 action DUMMY

ifhitweapon // If the player shoots Lilith before the scene activates, activate the last bit of the cutscene
	{
	operateactivators LOTAGSAVED THISACTOR
	}

ifspritepal 9
	{
		readgamevar SAVED_LILITH
		ife SAVED_LILITH 0 killit
	}
else
ifspritepal 3 nullop else
{
	ifn camerasprite -1
	{
		checkactivatormotion HITAGSAVED
		
			ife RETURN 1
				{
				killit
				}
	}	
}

enda

// ******************************************************************************
// LAVA BEAST (Fire Serpent)
// ******************************************************************************

useractor notenemy 10039

ifaction 0
{
seta[].blend 255
}

ifspawnedby 10752
{
sizeat 128 128
geta[myowner].extra TEMP2
ifl TEMP2 1
	killit
}
else
ifspawnedby LAVA_BEAST
{
sizeat 128 128
geta[myowner].extra TEMP2
ifl TEMP2 1
	killit
}
else
ifspawnedby 10547
{
state getfloordist
ifl z 0  cstat 2 else cstat 32768
sizeat 48 48
geta[myowner].statnum TEMP2
ife TEMP2 1024
	killit
}
else
ifspawnedby 22093
{
sizeat 128 128
geta[myowner].statnum TEMP2
ife TEMP2 1024
	killit
}


ifspawnedby LAVA_BEAST
	{
	geta[myowner].x TEMP
	geta[myowner].y TEMP2
	getsector[].floorz TEMP3
	geta[myowner].cstat TEMP4
	ifand TEMP4 32768 cstat 32768 else cstat 0
	setsprite THISACTOR TEMP TEMP2 TEMP3
	}
else
ifspawnedby 22093
	{
	geta[myowner].x TEMP
	geta[myowner].y TEMP2
	getsector[].floorz TEMP3
	cstat 0
	setsprite THISACTOR TEMP TEMP2 TEMP3
	}
else
	{
	geta[myowner].x TEMP
	geta[myowner].y TEMP2
	geta[myowner].z TEMP3
	sub TEMP3 4096
	setsprite THISACTOR TEMP TEMP2 TEMP3
	}
	
enda

action AENTITY_RISE 0 8 1 1 30
action AENTITY_IDLE 8 1 5 1 10
action AENTITY_MOVE 8 4 5 1 40
action AENTITY_FIREBALL 50 2 5 1 10
action AENTITY_PAIN 61 1 5 1 20
action AENTITY_BIGCAST 29 4 5 1 40
action AENTITY_DIE 67 9 1 1 40

move ENTITY_STOP 0
move ENTITY_MOVE 96 0

ai AI_ENTITY_IDLE AENTITY_IDLE ENTITY_STOP 
ai AI_ENTITY_SEEK AENTITY_MOVE ENTITY_MOVE seekplayer
ai AI_ENTITY_THROW_FIREBALL AENTITY_FIREBALL ENTITY_STOP faceplayersmart
ai AI_ENTITY_BIGCAST AENTITY_BIGCAST ENTITY_STOP faceplayer
ai AI_ENTITY_PAIN AENTITY_PAIN ENTITY_STOP

useractor enemystayput 10752
fall
seta[].htflags 17866787

ifaction AENTITY_DIE
{
ifrnd 2 shoot LAVABALL
ifactioncount 8
	{
	set STORY_TRIGGER3 1
	operateactivators 1305 THISACTOR
	palfrom 62 62 62 62
	killit
	}
}
else
ife TEMP8 1
{
ifdead break else
	{
	quake 26
	ai AI_ENTITY_PAIN
	}
set TEMP8 0
}
else
ife TEMP9 1
{
ifdead break else
	{
	globalsound ENTITY_ANGRY
	quake 26
	ai AI_ENTITY_BIGCAST
	}
set TEMP9 0
}
else
ifaction 0
{
clipdist 255
set TEMP6 0
shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
globalsound ENTITY_AWAKEN
quake 52
set CURBOSS THISACTOR
set BOSS_TYPE 2
ife VOLUME 0 
	{
	starttrackvar 18
	set MIDICHANGES 18
	spawn LILITH 
	}
else set TEMP6 4
spawn 10039
cstat 257
sizeat 60 60
strength 15000
action AENTITY_RISE
}
else
ifaction AENTITY_RISE
{
ifactioncount 8
	{
	shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
	shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
	ai AI_ENTITY_IDLE
	}
}
else
ifai AI_ENTITY_IDLE
{
ifcansee
 ifcanseetarget
  ifrnd 96
	ai AI_ENTITY_SEEK
	else
	ifrnd 8 ai AI_ENTITY_THROW_FIREBALL
}
else
ifai AI_ENTITY_SEEK
{
ifcanseetarget
 ifcanshoottarget
  ifrnd 8
	{
	ife TEMP6 4 ifrnd 128 ai AI_ENTITY_BIGCAST else
	ai AI_ENTITY_THROW_FIREBALL
	}
	else
ifrnd 16 ai AI_ENTITY_IDLE
}
else
ifai AI_ENTITY_BIGCAST
{
ifactioncount 3 
	{
	quake 13
	ife TEMP6 0 { operateactivators 1301 THISACTOR set TEMP6 1 } else
	ife TEMP6 1 { operateactivators 1302 THISACTOR set TEMP6 2 } else
	ife TEMP6 2 { operateactivators 1303 THISACTOR set TEMP6 3 } else
	ife TEMP6 3 { operateactivators 1304 THISACTOR set TEMP6 4 } else
	ife TEMP6 4 
		{
		sound STYGIAN_FIRE
		eshoot STYGIAN_ROCK
		geta[RETURN].z TEMP
		sub TEMP 8196
		seta[RETURN].z TEMP
		}
	ai AI_ENTITY_IDLE
	}
}
else
ifai AI_ENTITY_THROW_FIREBALL
{
	ifactioncount 2
		{
		sound STYGIAN_FIRE
		eshoot BRUISERFIREBALL
		geta[RETURN].z TEMP
		sub TEMP 14196
		seta[RETURN].z TEMP
		geta[RETURN].zvel TEMP
		add TEMP 1024
		seta[RETURN].zvel TEMP
		}
	ifactioncount 3 ai AI_ENTITY_SEEK
}
else
ifai AI_ENTITY_PAIN
{
globalsound ENTITY_PAIN
ifactioncount 5 ai AI_ENTITY_IDLE
}

ifhitweapon
	{
	seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION ifrnd 128 ai AI_ENTITY_PAIN
	ifdead { quake 68 set SLO_MO_SHOWOFF 40 action AENTITY_DIE }
	}

enda

// ******************************************************************************
// BERSERKER
// ******************************************************************************

action ABERSERKER_FROZEN 35 1 1 1 10
action ABERSERKERIDLE 0 1 5 1 10 
action ABERSERKERRUN      0  4 5 1 15
action ABERSERKER_APESHIT   0  4 5 1 5
action ABERSERKERSLASH    20 3 5 1 15
action ABERSERKER_APESLASH    20 3 5 1 5
action ABERSERKER_GOAPE 35 1 5 1 10
action ABERSERKERFLINCH 40 1 1 1 10
action ABERSERKERDYING 40 8 1 1 10

move BERS_RUNVELS 108 
move BERS_APESHIT 450
move BERS_STOP 0

ai AIBERSERKERIDLE ABERSERKERIDLE BERS_STOP seekplayer
ai AIBERSERKERSEEKENEMY ABERSERKERRUN BERS_RUNVELS seekplayer
ai AIBERSERKER_APE ABERSERKER_APESHIT BERS_APESHIT seekplayer
ai AIBERSERKERSLASHENEMY ABERSERKERSLASH BERS_STOP shoottarget
ai AIBERSERKER_APE_SLASHENEMY ABERSERKER_APESLASH BERS_STOP shoottarget
ai AIBERSERKERSHRUNK ABERSERKERRUN  BERS_RUNVELS furthestdir
ai AIBERSERKER_GROW ABERSERKERFLINCH BERS_STOP seekplayer

useractor enemystayput BERSERKER_STAYPUT 150 ABERSERKERIDLE
spawn SHOOTME
state monst_glow
spriteflags NORMAL_ENEMY
sound BERSERK_SIGHT
strength 175
sizeat 28 28
ai AIBERSERKERSEEKENEMY
cstator 257
cactor BERSERKER
enda

useractor enemy BERSERKER 175 ABERSERKERIDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	sound BERSERK_SIGHT
	strength 175 
	sizeat 28 28
	ai AIBERSERKERIDLE
	cstator 257
}

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifaction ABERSERKER_FROZEN
{
state frozen_code
}
else
ifai AIBERSERKER_GROW state genericgrowcode
else
ifaction ABERSERKERDYING
{
move BERS_STOP
	strength 0
	ifactioncount 5 
		{ 
		sound HUGE_GIB 
		spawn 18935 
		geta[].htowner TEMP
        geta[TEMP].picnum TEMP2
		ife TEMP2 1405 // only do big death if killed by player
			{
			state standard_jibs 
			state monst_body_jibs 
			}
		killit 
		}
}
else
ifaction ABERSERKER_GOAPE
{
sizeto 36 36
spritepal 50
	move BERS_STOP
	ifactioncount 6
		{
        guts JIBS6 8
		ai AIBERSERKER_APE
		}

		ifactioncount 1 { sound STEAM_HISSING }
}
else
ifaction ABERSERKERFLINCH
{
sub PAIN_AMOUNT 1
	move BERS_STOP
	ife PAIN_AMOUNT 0
		{
		ifdead break
		ifrnd 64 { quake 13 globalsound BERSERK_APE action ABERSERKER_GOAPE }
		else ai AIBERSERKERSEEKENEMY
		}
}
else
ifai AIBERSERKERSHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AIBERSERKERSEEKENEMY
    else ifcount SHRUNKCOUNT
      {
	sound ACTOR_UNSHRINK
	sizeto 28 28
	}
    else
      state genericshrunkcode
    break
}
else
ifai AIBERSERKERIDLE
{
sizeto 28 28
	state correctcansee
	 ife sightvar YES ai AIBERSERKERSEEKENEMY
}
else
ifai AIBERSERKERSEEKENEMY
{
ifcansee { }
sizeto 28 28
ifn target -1 ldist TEMP THISACTOR target
	ifn target -1 ifl TEMP 1024 { soundonce BERSERK_SWING ai AIBERSERKERSLASHENEMY }
	else ifpdistl 1024 ifcansee ifcanseetarget { soundonce BERSERK_SWING ai AIBERSERKERSLASHENEMY }
	else ifrnd 2 ai AIBERSERKERIDLE
}
else
ifai AIBERSERKER_APE
{
ifcount 6 { sound BOS1_WALK resetcount } 
	ifpdistl 1024 
	  ifcansee
	   { soundonce BERSERK_SWING ai AIBERSERKER_APE_SLASHENEMY }
	   add INTERNALCOUNT 1
	   ifg INTERNALCOUNT 300
		{
		sound STEAM_HISSING
		spritepal 0
		ifstrength 0 strength 1
		ai AIBERSERKERIDLE
		}
}
else
ifai AIBERSERKER_APE_SLASHENEMY
{
	ldist TEMP THISACTOR target
	ife target -1 ai AIBERSERKER_APE else
	ifg TEMP 1536 ai AIBERSERKER_APE else
	ifactioncount 3 
	{ 
	shoot 11742
	ai AIBERSERKER_APE
	}
}
else
ifai AIBERSERKERSLASHENEMY
{
	ldist TEMP THISACTOR target
	ife target -1 ai AIBERSERKERSEEKENEMY else
	ifg TEMP 1536 ai AIBERSERKERSEEKENEMY else
	ifactioncount 3 
	{ 
	shoot 11741
	ai AIBERSERKERSEEKENEMY 
	}
}

ifhitweapon
{
ifaction ABERSERKER_GOAPE { seta[].htextra -1 break }
ifai AIBERSERKER_APE { seta[].htextra -1 break }
	state NEWGUNEFFECTS
	sound BERSERK_PAIN
	spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AIBERSERKER_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action ABERSERKER_FROZEN } 
		else
			{
			sound BERSERK_DIE
			addkills 1
			action ABERSERKERDYING
			spawn BLOODPOOL
			}
		}
	else ifg PAIN_AMOUNT 0 action ABERSERKERFLINCH
	else ifrnd 128 { ifaction ABERSERKERSLASH nullop else { state PAIN_SKILL_LEVELADJUST action ABERSERKERFLINCH } }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AIBERSERKERSHRUNK }
}

state checksquished

enda

// ******************************************************************************
// SIREN
// ******************************************************************************

action ASIREN_FROZEN 5 1 5 1 10
action ASIRENFLOAT 0 1 5 1 10
action ASIRENCAST 5 4 5 1 20
action ASIRENPAIN -4 1 1 1 10
action ASIRENDIE -4 4 1 1 8

ai AISIRENFLOAT ASIRENFLOAT MSORCERERFLOAT seekplayer
ai AISIRENFLOATUP ASIRENFLOAT MSORCERERFLOATUP seekplayer getv
ai AISIRENFLOATDOWN ASIRENFLOAT MSORCERERFLOATDOWN seekplayer getv
ai AISIRENSHOOT ASIRENCAST STOP faceplayer
ai AISIRENPUSH ASIRENCAST STOP faceplayer
ai AISIRENPAIN ASIRENPAIN STOP faceplayer
ai AISIRENTELEPORT ASIRENCAST STOP faceplayer
ai AISIRENDYING ASIRENDIE STOP faceplayer

useractor enemy SIREN 200 ASIRENFLOAT

ifai 0
{
set MONSTER_FLAGS 1
	state monst_glow
ifspritepal 0 spritepal 10
spawn SHOOTME
spriteflags NORMAL_ENEMY
sound SIREN_SIGHT
strength 200
sizeat 24 24
action ASIRENFLOAT
ai AISIRENFLOAT
cstat 257
}

state check_canfloat

// state SUPERNATURAL_DAMAGE_MODIFIER

ifaction ASIREN_FROZEN state frozen_code else
ifai AISIRENDYING
	{
	cstat 0
	spriteflags 39
	ifactioncount 4 { spawn 8433 spawn 18935 state jib_sounds state monst_body_jibs state standard_jibs killit }
	}
else
ifai AISIRENPAIN
	{
	sub PAIN_AMOUNT 1
	move MSORCERERSTOP
	ife PAIN_AMOUNT 0 ai AISIRENFLOAT
	}
else
ifai AISIRENFLOAT
{
sizeto 24 24
spriteflags 35
 ifcanseetarget
  ifcanshoottarget
  ifrnd 8
  {
  sound SIREN_ATTACK
   ai AISIRENSHOOT
   }
   else
   ifpdistl 1024
    ifrnd 32
	ai AISIRENPUSH
   else
ifpdistg 8098
 ifrnd 16
  ife camerasprite -1
	{
	getp[].posx TEMP
	getp[].posy TEMP2
	set TEMP3 TEMP
	add TEMP3 1024
	randvar TEMP4 2048
	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	ifn TEMP7 -1
		{
		set INTERNALCOUNT 0
		ai AISIRENTELEPORT
		resetcount
		}
	}
	else
ifrnd 128
	{
	state check_canfloat
	 // Skip the float detection code if the wizard can't float freely in here
	 ife TEMP9 1
	 {
		 ifp phigher
			ai AISIRENFLOATUP
		  else
		  {
			geta[].z z
			ifg TEMP10 z 
			{
				ai AISIRENFLOATDOWN
			}
		  }
	  }
	}
}
else
ifai AISIRENTELEPORT
{
add INTERNALCOUNT 1
	spawn FRAMEEFFECT1
	ife INTERNALCOUNT 4 { cstat 2 sizeto 2 24 }
	ife INTERNALCOUNT 26
		{
			cstat 32768
			getp[].posx TEMP
			getp[].posy TEMP2
			set TEMP3 TEMP
			add TEMP3 1024
			randvar TEMP4 2048
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			updatesector TEMP5 TEMP6 TEMP7
			ifn TEMP7 -1
				{
				ife sector[TEMP7].lotag 2 { cstat 257 sizeat 24 24 ai AISIRENFLOAT }
				spawn 8433
				seta[].x TEMP5 
				seta[].y TEMP6
				getp[].posz TEMP8
				sub TEMP8 1754
				seta[].z TEMP8
				}
			else { cstat 257 sizeat 24 24 ai AISIRENFLOAT }
		} 
	ife INTERNALCOUNT 27 { soundonce SIREN_TELEP cstat 2 sizeto 24 24 spawn 8433 }
	ife INTERNALCOUNT 40 { spawn SHOOTME cstat 257 sizeat 24 24 sound SIREN_ATTACK ai AISIRENSHOOT }
}
else
ifai AISIRENFLOATUP
{
state thisactor_getzrange
 ifcanseetarget
  ifcanshoottarget
  ifrnd 4
  {
  sound SIREN_ATTACK
   ai AISIRENSHOOT
   }
   else
   ifpdistl 1024
    ifrnd 32
	ai AISIRENPUSH
	else
ifrnd 16 ai AISIRENFLOAT
}
else
ifai AISIRENFLOATDOWN
{
state thisactor_getzrange
 ifcanseetarget
  ifcanshoottarget
  ifrnd 4
  {
  sound SIREN_ATTACK
   ai AISIRENSHOOT
   }
   else
   ifpdistl 1024
    ifrnd 32
	ai AISIRENPUSH
   else
ifrnd 16 ai AISIRENFLOAT

state getfloordist
ifl z 0
	{
	seta[].z sector[].floorz
	ai AISIRENFLOAT
	}

}
else
ifai AISIRENSHOOT
{
spriteflags 39
seta[].shade -64
ifactioncount 3 { shoot 12717 ai AISIRENFLOAT resetactioncount }
}
else
ifai AISIRENPUSH
{
spriteflags 39
seta[].shade -64
ifactioncount 1 
	{ 
	getp[].posx mx
	getp[].posy my
	geta[].x x
	geta[].y y
	sub mx x
	sub my y
	getangle knockbackang mx my
	set knockback 6
	sound FORCE_BLAST
	ifpdistl 1024
		{
		wackplayer 
		palfrom 20 30 0 0 
		addphealth -15
		}
	ai AISIRENFLOAT 
	resetactioncount
	}
}


ifhitweapon
	{
	state NEWGUNEFFECTS
	//spawn BLOOD
	//guts JIBS6 1
	state random_wall_jibs
	ifwasweapon 6875 { set WEP3_BLOODY 3 sound STAB }
    ifwasweapon RPG 
	{ seta[].xvel 5 }
	ifdead
		{
		ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ASIREN_FROZEN } 
		else
			{
			state jib_sounds
			sound SIREN_DEATH
			ai AISIRENDYING
			state rf
			addkills 1
			state thegames_score
			set INTERNALCOUNT 0
			}
		}
	else ifpdistl 1024 { ifai AISIRENPUSH nullop else ai AISIRENPUSH }
	else ifg PAIN_AMOUNT 0 ai AISIRENPAIN
	else ifrnd 16 { state PAIN_SKILL_LEVELADJUST ai AISIRENPAIN }
	}

state ENEMYKNOCKBACKS

enda


// ===========================================
// ALUDRAN
// ============================================

action A_ALUDRAN_IDLE 20 1 5 1 12
action A_ALUDRAN_WALK 0 4 5 1 12
action A_ALUDRAN_ATTACK 20 4 5 1 16
action A_ALUDRAN_SWING 40 3 5 1 16
action A_ALUDRAN_PAIN 55 1 1 1 8
action A_ALUDRAN_DIE 55 5 1 1 16
action A_ALUDRAN_FROZEN 55 1 1 1 8
action A_ALUDRAN_DEAD 60

move ALUDRAN_WALK 190

ai AI_ALUDRAN_IDLE A_ALUDRAN_IDLE STOP seekplayer
ai AI_ALUDRAN_WALK A_ALUDRAN_WALK ALUDRAN_WALK seekplayer
ai AI_ALUDRAN_ATTACK A_ALUDRAN_ATTACK STOP seekplayer
ai AI_ALUDRAN_SWING A_ALUDRAN_SWING STOP seekplayer
ai AI_ALUDRAN_GROW A_ALUDRAN_PAIN STOP
ai AI_ALUDRAN_SHRUNK A_ALUDRAN_WALK fleeenemy
ai AI_ALUDRAN_DIE A_ALUDRAN_DIE STOP

spritenopal ALUDRAN
spritenopal ALUDRAN_STAYPUT

useractor enemystayput ALUDRAN_STAYPUT 1000 A_ALUDRAN_IDLE
fall
ifai 0
	{
	cstat 257
	ifspritepal 10
		{
		strength 3000
		set CURBOSS THISACTOR
		set BOSS_TYPE 7
		sizeat 120 120
		}
    else
		{
		strength 1000
		sizeat 40 40
		}
	spriteflags NORMAL_ENEMY
	state monst_glow
	sound AL_SIG
	spawn SHOOTME
	ai AI_ALUDRAN_IDLE
	cactor ALUDRAN
	}
enda

useractor enemy ALUDRAN 1000 A_ALUDRAN_IDLE
fall
ifai 0
	{
	cstat 257
	ifspritepal 10
		{
		strength 3000
		set CURBOSS THISACTOR
		set BOSS_TYPE 7
		sizeat 120 120
		}
    else
		{
		strength 1000
		sizeat 40 40
		}
	spriteflags NORMAL_ENEMY
	state monst_glow
	sound AL_SIG
	spawn SHOOTME
	ai AI_ALUDRAN_IDLE
	}
	
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage
	
ifaction A_ALUDRAN_FROZEN
	{
	state frozen_code
	}
else
ifai AI_ALUDRAN_GROW state genericgrowcode
else
ifaction A_ALUDRAN_DEAD
	{
	move STOP
    ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
		  spritepal 30
			state squish_sounds
			spawn 2284
		  state standard_jibs
			killit
		  }
		  break
		}
	}
else
ifai AI_ALUDRAN_DIE
	{
	strength 0
	ifactioncount 5 
		{ 
		state rf 
		ifspritepal 10
		{
		espawn BIG_SMOKE2
		espawn BIG_SMOKE2
		espawn BIG_SMOKE2
		quake 46
		sound BOSSFALL
		}
		else
		state BODY_FALL_NOISES 
		spawn 2284 
		action A_ALUDRAN_DEAD 
		}
	}
else
ifaction A_ALUDRAN_PAIN
	{
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0
		{
		ifdead break
		ai AI_ALUDRAN_WALK
		}
	}
else
ifai AI_ALUDRAN_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_ALUDRAN_WALK
    else ifcount SHRUNKCOUNT
      {
	sound ACTOR_UNSHRINK
	sizeto 46 46
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_ALUDRAN_IDLE
	{
	ifcansee ai AI_ALUDRAN_WALK // if can see player
	else ifn target -1 ai AI_ALUDRAN_WALK // or if it has a target
	}
else
ifai AI_ALUDRAN_WALK
	{
	ifrnd 2 sound AL_IDLE
	ifspritepal 10 ifcount 10
		{
		ifrnd 128 sound BIG_BOSS_WALK2 else
		sound BIG_BOSS_WALK1
		ifpdistl 16384 quake 13
		resetcount
		}
	ifrnd 16 state enemyfindtarget // run enemy targetting stuff occasionally to refresh target
	state SKILL_SHOOT_LEVELADJUST // run difficulty level check
	ifl RANDOM_CHANCE SKILLCHANCE // if succesful
		{
		state enemyfindtarget // find enemy target
		ifn target -1 ldist TEMP THISACTOR target // if found, get distance
		ifn target -1 ifl TEMP 4096 ai AI_ALUDRAN_ATTACK // if target is less than distance, attack
		else ifcansee ifcanseetarget ai AI_ALUDRAN_ATTACK // otherwise if can see player, attack
		}
	else ifpdistl 1024 ai AI_ALUDRAN_SWING
	else ifrnd 2 ai AI_ALUDRAN_WALK // reset AI routine every now and then
	}
else
ifai AI_ALUDRAN_ATTACK
	{
	ifactioncount 4
		{
		state shooting_settings // run targetting stuff
		  ifn target -1 getactorvar[target].myowner TEMP4
		ifn target -1 // if shooting at target
		 ifn TEMP4 PLAYER_IDENTITY
			{	
			sound AL_FIRE 
			ifspritepal 10
				{
				geta[].z TEMP
				set TEMP2 TEMP
				sub TEMP 8924
				seta[].z TEMP
				ezshoot TEMP3 6221
				seta[].z TEMP2
				}
			else
			ezshoot TEMP3 6221		
			}
		else // if shooting at player
			{
			sound AL_FIRE 
			ifspritepal 10
				{
				geta[].z TEMP
				set TEMP2 TEMP
				sub TEMP 8924
				seta[].z TEMP
				shoot 6221
				seta[].z TEMP2
				}
			else
			shoot 6221
			}
		ai AI_ALUDRAN_WALK // go back to seeking AI
		}
	}
else
ifai AI_ALUDRAN_SWING
	{
	ifactioncount 3
		{
		state shooting_settings // run targetting stuff
		  ifn target -1 getactorvar[target].myowner TEMP4
		ifn target -1 // if shooting at target
		 ifn TEMP4 PLAYER_IDENTITY
			{
			ezshoot TEMP3 15729
			}
		else // if shooting at player
			{
			shoot 15729
			}
		ai AI_ALUDRAN_WALK // go back to seeking AI
		}
	}
	
ifhitweapon
{
	seta[].xvel 0
	state NEWGUNEFFECTS
	spritepal 30
	spawn BLOOD
	guts JIBS6 1
	getlastpal
	state random_wall_jibs
	ifdead
		{
		addkills 1
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_ALUDRAN_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action A_ALUDRAN_FROZEN } 
		else
			{
			sound AL_DIE
			ai AI_ALUDRAN_DIE
			}
		}
	else ifg PAIN_AMOUNT 0 { sound AL_PAIN action A_ALUDRAN_PAIN }
	else ifrnd 16 { sound AL_PAIN state PAIN_SKILL_LEVELADJUST action A_ALUDRAN_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_ALUDRAN_SHRUNK }
}

state checksquished

enda

// ******************************************************************************
// SCORPIONESS
// ******************************************************************************

action A_SCORP_FROZEN 35 1 5 1 10
action A_SCORP_IDLE 0 1 5 1 8 
action A_SCORP_RUN  0 4 5 1 8
action A_SCORP_CHARGE  0 4 5 1 4
action A_SCORP_RUNBACK 15 4 5 -1 20
action A_SCORP_ATTACK 20 2 5 1 8
action A_SCORP_MELEE 30 5 1 1 10
action A_SCORP_PAIN 35 1 1 1 10
action A_SCORP_DIE 36 7 1 1 32

move MSCORP_RUN 160

ai AI_SCORP_IDLE A_SCORP_IDLE STOP seekplayer
ai AI_SCORP_SEEKENEMY A_SCORP_RUN MSCORP_RUN seekplayer
ai AI_SCORP_DODGE A_SCORP_RUN MSCORP_RUN dodgebullet
ai AI_SCORP_WALKBACK A_SCORP_RUNBACK TROOPWALKVELSBACK faceplayer
ai AI_SCORP_ATTACK A_SCORP_ATTACK STOP shoottarget
ai AI_SCORP_ATTACK2 A_SCORP_ATTACK STOP shoottarget
ai AI_SCORP_MELEE A_SCORP_MELEE STOP faceplayer
ai AI_SCORP_DYING A_SCORP_DIE STOP
ai AI_SCORP_SHRINK A_SCORP_RUN MSCORP_RUN fleeenemy
ai AI_SCORP_GROW A_SCORP_PAIN STOP
ai AI_SCORP_FROZEN A_SCORP_PAIN STOP

useractor enemystayput SCORPIONESS_STAYPUT 1000 A_SCORP_IDLE
spawn SHOOTME
spriteflags NORMAL_ENEMY
globalsound SCORP_SIGHT
	ifspritepal 42
	{
	strength 2500
	sizeat 65 65
	}
	else
	{
	spritepal 36
	strength 1000
	sizeat 50 50
	}
state monst_glow
ai AI_SCORP_SEEKENEMY
cstator 257
cactor SCORPIONESS
enda

useractor enemy SCORPIONESS 1000 A_SCORP_IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	ifspritepal 42
		{
        set CURBOSS THISACTOR
		strength 2500
		sizeat 65 65
		}
	else
		{
		spritepal 36
		strength 1000
		sizeat 50 50
		}
	ai AI_SCORP_IDLE
	cstator 257
}

ifai AI_SCORP_FROZEN
{
state frozen_code
}
else
ifai AI_SCORP_GROW state genericgrowcode
else
ifai AI_SCORP_SHRINK
{
    ifcount SHRUNKDONECOUNT
      ai AI_SCORP_SEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 16 16
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AI_SCORP_DYING
{
ifactorsound THISACTOR SCORP_MOVE stopactorsound THISACTOR SCORP_MOVE
move STOP
	strength 0
	geta[].htg_t 2 TEMP4 
	ife TEMP4 2 { sound SHORT_CIRCUIT shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 }
	
	
	ifactioncount 6
		{
		espawn EXPLOSION2
		sound RPG_EXPLODE
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 512
		randvar TEMP4 2048
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set TEMP6 0
		}
	
	ifactioncount 7 { sound EXPLOSION_BIG spawn EXPLOSION2 sound HUGE_GIB state standard_jibs spawn BLOODPOOL killit }
}
else
ifaction A_SCORP_PAIN
{
ifactorsound THISACTOR SCORP_MOVE stopactorsound THISACTOR SCORP_MOVE
sub PAIN_AMOUNT 1
move 0
ife PAIN_AMOUNT 0
	{
	ife allies_present 1 state enemyfindtarget
	ife both_present 1 state enemyfindtarget2
	ai AI_SCORP_ATTACK2
	}
}
else
ifai AI_SCORP_IDLE
{
 state correctcansee
   ife sightvar YES
    {
	soundonce SCORP_SIGHT
    ai AI_SCORP_SEEKENEMY
	}
}
else
ifai AI_SCORP_MELEE
{
ifactorsound THISACTOR SCORP_MOVE stopactorsound THISACTOR SCORP_MOVE
ifactioncount 1 soundonce BERSERK_SWING
ifactioncount 5
	{
	ifpdistl 1536
			{
			ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 30
				wackplayer
				sound SWORD_CLASH
				}
				else
				{
				sound RIPPER_SCRATCH
				shoot 4609
				}
			}
	ai AI_SCORP_WALKBACK
	}
}
else
ifai AI_SCORP_WALKBACK
{
ifactorsound THISACTOR SCORP_MOVE nullop else sound SCORP_MOVE
ifactioncount 10 ai AI_SCORP_ATTACK
}
else 
ifai AI_SCORP_SEEKENEMY
{
ifactorsound THISACTOR SCORP_MOVE nullop else sound SCORP_MOVE

ifpdistl 1536 ai AI_SCORP_MELEE

state SKILL_SHOOT_LEVELADJUST
  ifl RANDOM_CHANCE SKILLCHANCE
   ifcanshoottarget
	{
	set TEMP9 0
	 state correctcansee
		ife sightvar YES
			{
			state SKILL_SHOOT_LEVELADJUST
			 ifl RANDOM_CHANCE SKILLCHANCE { sound SCORP_SIGHT ai AI_SCORP_ATTACK2 } else
			ai AI_SCORP_ATTACK
			}
	}

}
else
ifai AI_SCORP_ATTACK
{
ifactorsound THISACTOR SCORP_MOVE stopactorsound THISACTOR SCORP_MOVE
ifpdistl 1536 ai AI_SCORP_MELEE

 state correctcansee
   ife sightvar YES
	ifcanseetarget nullop 
	  else ai AI_SCORP_SEEKENEMY
		ifactioncount 1
			{
			sound SCORP_TAIL
			getactorvar[target].IS_PLAYER TEMP2
			ife TEMP2 1 // use built in auto-zaim if shooting at the player
				eshoot MPLASMA
					else
				ezshoot TEMP3 MPLASMA
				
			setthisprojectile[RETURN].extra 3
			setthisprojectile[RETURN].extra_rand 2
				
			ifrnd 32 ai AI_SCORP_SEEKENEMY else
			ifrnd 16 ai AI_SCORP_ATTACK2 else
			resetactioncount
			}
}
else
ifai AI_SCORP_ATTACK2
{
ifactorsound THISACTOR SCORP_MOVE stopactorsound THISACTOR SCORP_MOVE
ifpdistl 1536 ai AI_SCORP_MELEE
	 state correctcansee
		ife sightvar YES
			ifcanseetarget nullop 
			else ai AI_SCORP_SEEKENEMY
		ifactioncount 1
			{
			sound PA_MISSILEL
			shoot HOMING_MISSILE
			ai AI_SCORP_SEEKENEMY
			}
}

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		state rf
		state thegames_score
		ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_SCORP_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE ai AI_SCORP_FROZEN } 
		else
			{
			sound SCORP_DEATH
			addkills 1
			ai AI_SCORP_DYING
			}
		}
	else ifg PAIN_AMOUNT 0 { sound SCORP_PAIN action A_SCORP_PAIN }
	else ifrnd 8 { sound SCORP_PAIN state PAIN_SKILL_LEVELADJUST action A_SCORP_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_SCORP_SHRINK }
}


enda

// ************************************************************************************************************************************************************************************************
// LAVA BEAST
// ************************************************************************************************************************************************************************************************

action A_LAVA_B_MOVE 0 1 5 1 10
action A_LAVA_B_FIREBALL 0 4 5 1 12
action A_LAVA_B_FIRE 15 0 5 1 12
action A_LAVA_B_PAIN 20
action A_LAVA_B_DIE 20 5 1 1 40

move LAVAB_SWIM 240
move LAVAB_MOVE 30

ai AI_LAVA_B_IDLE A_LAVA_B_MOVE STOP 
ai AI_LAVA_B_SUB A_LAVA_B_MOVE STOP
ai AI_LAVA_B_RISE A_LAVA_B_FIRE STOP
ai AI_LAVA_B_SWIM A_LAVA_B_FIRE LAVAB_SWIM faceplayer
ai AI_LAVA_B_SEEK A_LAVA_B_MOVE LAVAB_MOVE seekplayer
ai AI_LAVA_B_FIREBALL A_LAVA_B_FIREBALL STOP faceplayersmart
ai AI_LAVA_B_FIRE A_LAVA_B_FIRE STOP faceplayersmart
ai AI_LAVA_B_PAIN A_LAVA_B_PAIN STOP
ai AI_LAVA_B_DIE A_LAVA_B_DIE STOP

useractor notenemy 22093
ifaction 0
{
sizeat 130 130
action ZERO
}
ifaction ZERO
{
state getfloordist
	ifl z 16 
	{
	ife ALLY_MAG 0 { sound LAV_RIS spawn 10039 set ALLY_MAG 1 }
	geta[].z TEMP
	add TEMP 64
	seta[].z TEMP
	gets[].floorz TEMP2
	add TEMP2 49152
	ifg TEMP TEMP2 
		{
		killit
		}
	}
	else fall
}

enda

spritenoshade LAVA_BEAST
spritenopal LAVA_BEAST

useractor enemy LAVA_BEAST
seta[].htflags 17866787

ifai 0
{
shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
globalsound LAV_RIS
quake 52
set MONSTER_FLAGS 16
set CURBOSS THISACTOR
set BOSS_TYPE 7
spawn 10039
cstat 257
sizeat 130 130
strength 4000
ai AI_LAVA_B_SEEK
}

ifonwater 
	{
	geta[].x CSPAWNPOSX
	geta[].y CSPAWNPOSY
	}
else
	{
	seta[].x CSPAWNPOSX
	seta[].y CSPAWNPOSY
	}

ifstrength 0 nullop else
	{
	ifpdistl 4096 
		{
		   ifg P_FIRE_ARMOUR 0 { sound FIRE_ARM_PROT sub P_FIRE_ARMOUR 2 }
			else
			 {
				ife CHAR 0 sound J_HOTHOT
				 ife CHAR 1 sound Z_LONGTERM_PAIN
				getp[].i TEMP4
				getactorvar[TEMP4].FIRE_DAMAGE TEMP5
				add TEMP5 5
				setactorvar[TEMP4].FIRE_DAMAGE TEMP5
				palfrom 32 32
			 }
		}
	}

ifai AI_LAVA_B_DIE
{
fall
ifrnd 2 shoot LAVABALL
ifactioncount 3
 ifrnd 64
	{
		espawn EXPLOSION2
		sound EXPLOSION_MEDIUM
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		randvar TEMP4 2048
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set TEMP6 0
	}
ifactioncount 4
	{
	ife ALLY_MAG 0
		{
		espawn 22093
		geta[RETURN].z TEMP
		sub TEMP 53248
		seta[RETURN].z TEMP
		set ALLY_MAG 1
		}
	shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL shoot LAVABALL
	}
ifactioncount 5 killit
}
else
ifai AI_LAVA_B_SUB
	{
	soundonce LAV_RIS
	ifrnd 32 shoot LAVABALL
	geta[].z TEMP
	add TEMP 2048
	seta[].z TEMP
	gets[].floorz TEMP2
	add TEMP2 49152
	ifg TEMP TEMP2 
		{
		ai AI_LAVA_B_SWIM
		resetcount
		}
	}
else
ifai AI_LAVA_B_SWIM
	{
	fall
	cstat 32768
	ifstrength 4000 addstrength 8
	ifpdistl 8192 { seta[].z TEMP ai AI_LAVA_B_RISE }
	else ifcount 150 { seta[].z TEMP ai AI_LAVA_B_RISE }
	}
else
ifai AI_LAVA_B_RISE
	{
	cstat 257
	soundonce LAV_RIS
	ifrnd 32 shoot LAVABALL
	geta[].z TEMP
	sub TEMP 2048
	seta[].z TEMP
	ifl TEMP sector[].floorz
		{
		fall
		ai AI_LAVA_B_SEEK
		resetcount
		}
	}
else
ifai AI_LAVA_B_IDLE
{
fall
ifcansee
 ifcanseetarget
  ifrnd 96
	ai AI_LAVA_B_SEEK
	else
	ifrnd 8 ai AI_LAVA_B_FIREBALL
}
else
ifai AI_LAVA_B_SEEK
{
fall
 state correctcansee
   ife sightvar YES
  ifrnd 16
	ai AI_LAVA_B_FIREBALL
	else
ifpdistg 8192 ifrnd 8 
	{
	// ifand sector[].floorstat 1024 ai AI_LAVA_B_SEEK else // don't submerge if in TROR layer
	ai AI_LAVA_B_SUB
	}
}
else
ifai AI_LAVA_B_FIREBALL
{
fall
	ifactioncount 4 ai AI_LAVA_B_FIRE
}
else
ifai AI_LAVA_B_FIRE
{
fall
	ifactioncount 0
		{
		sound LAV_FIRE
		geta[].z TEMP2
		set TEMP TEMP2
		sub TEMP 14196
		seta[].z TEMP
		shoot BRUISERFIREBALL
		seta[].z TEMP2
		}
	ifactioncount 1 
		{
		ifstrength 1000 ifrnd 96 ai AI_LAVA_B_SUB else
		ai AI_LAVA_B_SEEK
		}
}
else
ifai AI_LAVA_B_PAIN
{
fall
globalsound LAV_HURT
ifactioncount 5 ai AI_LAVA_B_IDLE
}

ifhitweapon
	{
	seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION ifrnd 64 { ai AI_LAVA_B_PAIN }
	ifdead { quake 68 sound LAV_DETH ai AI_LAVA_B_DIE }
	}

enda


// ******************************************************************************
// ANUBIS
// ******************************************************************************

action A_ANUBIS_FROZEN 45 1 5 1 10
action A_ANUBIS_IDLE 0 1 5 1 8 
action A_ANUBIS_RUN  0 4 5 1 8
action A_ANUBIS_CHARGE  0 4 5 1 4
action A_ANUBIS_RUNBACK 15 4 5 -1 20
action A_ANUBIS_ATTACK 20 5 5 1 10
action A_ANUBIS_PAIN 45 1 1 1 10
action A_ANUBIS_DIE 45 7 1 1 10
action A_ANUBIS_HEADSHOT_DIE 52 7 1 1 10
action A_ANUBIS_DEAD 51

move ANUB_RUN 120
move ANUB_CHARGE 180

ai AI_ANUBIS_IDLE A_ANUBIS_IDLE STOP seekplayer
ai AI_ANUBIS_SEEKENEMY A_ANUBIS_RUN ANUB_RUN seekplayer
ai AI_ANUBIS_RUSHENEMY A_ANUBIS_CHARGE ANUB_CHARGE seekplayer
ai AI_ANUBIS_DODGE A_ANUBIS_RUN ANUB_RUN dodgebullet
ai AI_ANUBIS_WALKBACK A_ANUBIS_RUNBACK TROOPWALKVELSBACK faceplayer
ai AI_ANUBIS_ATTACK A_ANUBIS_ATTACK STOP shoottarget
ai AI_ANUBIS_DYING A_ANUBIS_DIE STOP
ai AI_ANUBIS_HEADSHOT_DYING A_ANUBIS_HEADSHOT_DIE STOP
ai AI_ANUBIS_SHRINK A_ANUBIS_RUN ANUB_RUN fleeenemy
ai AI_ANUBIS_GROW A_ANUBIS_PAIN STOP
ai AI_ANUBIS_FROZEN A_ANUBIS_PAIN STOP

useractor enemystayput ANUBIS_STAYPUT 100 A_ANUBIS_IDLE
cactor ANUBIS
enda

useractor enemy ANUBIS 100 A_ANUBIS_IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	sound ANUBIS_SIGHT
	ifspritepal 41
		{
		strength 200
		sizeat 45 45
		}
	else
		{
		strength 100
		sizeat 32 32
		}
	
	ai AI_ANUBIS_IDLE
	cstator 257
}

ifai AI_ANUBIS_FROZEN
{
state frozen_code
}
else
ifai AI_ANUBIS_GROW state genericgrowcode
else
ifai AI_ANUBIS_SHRINK
{
    ifcount SHRUNKDONECOUNT
      ai AI_ANUBIS_SEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 16 16
	  }
    else
      state genericshrunkcode
    break
}
else
ifaction A_ANUBIS_DEAD
{
move STOP
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
	  state standard_jibs
        killit
      }
      break
    }
}
else
ifai AI_ANUBIS_DYING
{
move STOP
	strength 0
	ifactioncount 7 { state BODY_FALL_NOISES spawn BLOODPOOL state rf action A_ANUBIS_DEAD }
}
else
ifai AI_ANUBIS_HEADSHOT_DYING
{
move STOP
	strength 0
	ifactioncount 7 { state BODY_FALL_NOISES spawn BLOODPOOL state rf action A_ANUBIS_DEAD }
}
else
ifaction A_ANUBIS_PAIN
{
sub PAIN_AMOUNT 1
move 0
ife PAIN_AMOUNT 0
	{
	ife allies_present 1 state enemyfindtarget
	ife both_present 1 state enemyfindtarget2
	ai AI_ANUBIS_SEEKENEMY
	}
}
else
ifai AI_ANUBIS_IDLE
{
 state correctcansee
   ife sightvar YES
    ai AI_ANUBIS_SEEKENEMY
}
else
ifai AI_ANUBIS_DODGE
{
ifactioncount 8 ai AI_ANUBIS_SEEKENEMY
}
else
ifai AI_ANUBIS_RUSHENEMY
{
ifpdistl 1536 { ifrnd 128 ai AI_ANUBIS_WALKBACK else ai AI_ANUBIS_ATTACK }
ifrnd 2 sound ANUBIS_ROAM

ifbulletnear ifrnd 16 ai AI_ANUBIS_DODGE

state SKILL_SHOOT_LEVELADJUST
  ifl RANDOM_CHANCE SKILLCHANCE
   ifcanshoottarget
	{
	set TEMP9 0
	 state correctcansee
		ife sightvar YES
     ai AI_ANUBIS_ATTACK
	}

}
else
ifai AI_ANUBIS_SEEKENEMY
{
ifpdistl 1536 { ifrnd 128 ai AI_ANUBIS_WALKBACK else ai AI_ANUBIS_ATTACK }
else ifpdistl 8192 ifrnd 16 { sound ANUBIS_SIGHT ai AI_ANUBIS_RUSHENEMY }
ifrnd 2 sound ANUBIS_ROAM

ifbulletnear ifrnd 96 ai AI_ANUBIS_DODGE

state SKILL_SHOOT_LEVELADJUST
  ifl RANDOM_CHANCE SKILLCHANCE
   ifcanshoottarget
	{
	set TEMP9 0
	 state correctcansee
		ife sightvar YES
     ai AI_ANUBIS_ATTACK
	}

}
else
ifai AI_ANUBIS_WALKBACK
{
ifcount 30 ai AI_ANUBIS_ATTACK
}
else
ifai AI_ANUBIS_ATTACK
{
ifactioncount 5 { ifpdistl 1536 ai AI_ANUBIS_WALKBACK else ai AI_ANUBIS_SEEKENEMY set TEMP9 0 }
ifactioncount 4
	{
	ife TEMP9 0
		{
		ifpdistl 1536
			{
			ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 30
				wackplayer
				sound SWORD_CLASH
				}
				else
				{
				sound RIPPER_SCRATCH
				shoot 4609
				ifspritepal 41 shoot 4609
				}
			}
		else
			{
			sound ANUBIS_FIRE
			ife target -1 set TEMP2 1 else getactorvar[target].IS_PLAYER TEMP2
			ife TEMP2 1 // use built in auto-zaim if shooting at the player
				shoot 12712
					else
				ezshoot TEMP3 12712
			}
		set TEMP9 1
		}
	}

}

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifhitweapon
{
	state NEWGUNEFFECTS
	soundonce ANUBIS_PAIN
	//spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_ANUBIS_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE ai AI_ANUBIS_FROZEN } 
		else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
		else ifg ENERGY_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 4
			guts JIBS3 6
			spawn DISINTIGRATE_GUY
			killit
			}
		else ifg FIRE_DAMAGE 0
			{ 		
			sound ANUBIS_DEATH
			set PLAYER_VOICEOVER 21
			spawn ONFIREGUY 
			killit 
			}
		else
			{
			addkills 1
			ife HEADSHOT 2 
				{ 
				ifrnd 32 state trigger_showoff 
				sound DECAPITATE 
				ai AI_ANUBIS_HEADSHOT_DYING shoot NJIB shoot NJIB guts JIBS6 3 guts JIBS2 2 
				} 
			    else
				{
				sound ANUBIS_DEATH
				ai AI_ANUBIS_DYING
				}
			}
		}
	else ifg PAIN_AMOUNT 0 { soundonce ANUBIS_PAIN action A_ANUBIS_PAIN }
	else ifrnd 32 { soundonce ANUBIS_PAIN state PAIN_SKILL_LEVELADJUST action A_ANUBIS_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_ANUBIS_SHRINK }
}

enda

// ******************************************************************************
// ANUBIS MUMMY
// ******************************************************************************

action A_ANUBIS_MUMMY_FROZEN 45 1 5 1 10
action A_ANUBIS_MUMMY_IDLE 0 1 5 1 8 
action A_ANUBIS_MUMMY_RUN  0 4 5 1 8
action A_ANUBIS_MUMMY_CHARGE  5 4 5 1 4
action A_ANUBIS_MUMMY_RUNBACK 20 4 5 -1 20
action A_ANUBIS_MUMMY_ATTACK 20 4 5 1 10
action A_ANUBIS_MUMMY_PAIN 40 1 1 1 10
action A_ANUBIS_MUMMY_DIE 41 5 1 1 12

ai AI_ANUBIS_MUMMY_IDLE A_ANUBIS_MUMMY_IDLE STOP seekplayer
ai AI_ANUBIS_MUMMY_SEEKENEMY A_ANUBIS_MUMMY_RUN ANUB_RUN seekplayer
ai AI_ANUBIS_MUMMY_RUSHENEMY A_ANUBIS_MUMMY_CHARGE ANUB_CHARGE seekplayer
ai AI_ANUBIS_MUMMY_DODGE A_ANUBIS_MUMMY_RUN ANUB_RUN dodgebullet
ai AI_ANUBIS_MUMMY_WALKBACK A_ANUBIS_MUMMY_RUNBACK TROOPWALKVELSBACK faceplayer
ai AI_ANUBIS_MUMMY_ATTACK A_ANUBIS_MUMMY_ATTACK STOP shoottarget
ai AI_ANUBIS_MUMMY_DYING A_ANUBIS_MUMMY_DIE STOP
ai AI_ANUBIS_MUMMY_SHRINK A_ANUBIS_MUMMY_RUN ANUB_RUN fleeenemy
ai AI_ANUBIS_MUMMY_GROW A_ANUBIS_MUMMY_PAIN STOP
ai AI_ANUBIS_MUMMY_FROZEN A_ANUBIS_MUMMY_PAIN STOP

useractor enemystayput ANUBIS_MUMMY_STAYPUT 175 A_ANUBIS_MUMMY_IDLE
cactor ANUBIS_MUMMY
enda

useractor enemy ANUBIS_MUMMY 175 A_ANUBIS_MUMMY_IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	sound ANUBIS_SIGHT
	strength 175
	sizeat 26 26
	ai AI_ANUBIS_MUMMY_IDLE
	cstator 257
}

//ifspritepal 24 state SUPERNATURAL_DAMAGE_MODIFIER // Modifier for supernatural targets

ifai AI_ANUBIS_MUMMY_FROZEN
{
state frozen_code
}
else
ifai AI_ANUBIS_MUMMY_GROW state genericgrowcode
else
ifai AI_ANUBIS_MUMMY_SHRINK
{
    ifcount SHRUNKDONECOUNT
      ai AI_ANUBIS_MUMMY_SEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 16 16
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AI_ANUBIS_MUMMY_DYING
{
move STOP
	strength 0
	ifactioncount 3
		{
		spawn BIG_SMOKE2
		}
	ifactioncount 5 { state jib_sounds killit }
}
else
ifaction A_ANUBIS_MUMMY_PAIN
{
sub PAIN_AMOUNT 1
move 0
ife PAIN_AMOUNT 0
	{
	ife allies_present 1 state enemyfindtarget
	ife both_present 1 state enemyfindtarget2
	ai AI_ANUBIS_MUMMY_SEEKENEMY
	}
}
else
ifai AI_ANUBIS_MUMMY_IDLE
{
 state correctcansee
   ife sightvar YES
    ai AI_ANUBIS_MUMMY_SEEKENEMY
}
else
ifai AI_ANUBIS_MUMMY_DODGE
{
ifactioncount 8 ai AI_ANUBIS_MUMMY_SEEKENEMY
}
else
ifai AI_ANUBIS_MUMMY_RUSHENEMY
{
ifpdistl 1536 { ifrnd 128 ai AI_ANUBIS_MUMMY_WALKBACK else ai AI_ANUBIS_MUMMY_ATTACK }
ifrnd 2 sound ANUBIS_ROAM

ifbulletnear ifrnd 16 ai AI_ANUBIS_MUMMY_DODGE

state SKILL_SHOOT_LEVELADJUST
  ifl RANDOM_CHANCE SKILLCHANCE
   ifcanshoottarget
	{
	set TEMP9 0
	 state correctcansee
		ife sightvar YES
     ai AI_ANUBIS_MUMMY_ATTACK
	}

}
else
ifai AI_ANUBIS_MUMMY_SEEKENEMY
{
ifpdistl 1536 { ifrnd 128 ai AI_ANUBIS_MUMMY_WALKBACK else ai AI_ANUBIS_MUMMY_ATTACK }
else ifpdistl 8192 ifrnd 16 { sound ANUBIS_SIGHT ai AI_ANUBIS_MUMMY_RUSHENEMY }
ifrnd 2 sound ANUBIS_ROAM

ifbulletnear ifrnd 96 ai AI_ANUBIS_MUMMY_DODGE

state SKILL_SHOOT_LEVELADJUST
  ifl RANDOM_CHANCE SKILLCHANCE
   ifcanshoottarget
	{
	set TEMP9 0
	 state correctcansee
		ife sightvar YES
     ai AI_ANUBIS_MUMMY_ATTACK
	}

}
else
ifai AI_ANUBIS_MUMMY_WALKBACK
{
ifcount 30 ai AI_ANUBIS_MUMMY_ATTACK
}
else
ifai AI_ANUBIS_MUMMY_ATTACK
{
ifactioncount 4 { ifpdistl 1536 ai AI_ANUBIS_MUMMY_WALKBACK else ai AI_ANUBIS_MUMMY_SEEKENEMY set TEMP9 0 }
ifactioncount 3
	{
	ife TEMP9 0
		{
		ifpdistl 1536
			{
			sound GUARDIAN_SWING
			ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 30
				wackplayer
				sound SWORD_CLASH
				}
				else
				{
				sound RIPPER_SCRATCH
				shoot 17849
				}
			}
		else
			{
			sound THROWSOMET
			ife target -1 set TEMP2 1 else
			getactorvar[target].IS_PLAYER TEMP2
			ife TEMP2 1 // use built in auto-zaim if shooting at the player
				shoot 12782
					else
				ezshoot TEMP3 12782
			}
		set TEMP9 1
		}
	}

}

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifhitweapon
{
	state NEWGUNEFFECTS
	soundonce ANUBIS_PAIN
	spritepal 5
	//spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	spritepal 0
	ifdead
		{
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_ANUBIS_MUMMY_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE ai AI_ANUBIS_MUMMY_FROZEN } 
		else ifg ENERGY_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 4
			guts JIBS3 6
			spawn DISINTIGRATE_GUY
			killit
			}
		else ifg FIRE_DAMAGE 0
			{ 		
			sound ANUBIS_DEATH
			set PLAYER_VOICEOVER 21
			spawn ONFIREGUY 
			killit 
			}
		else
			{
			addkills 1
			sound ANUBIS_DEATH
			spawn SPIRIT_DEATH_GUY
			ai AI_ANUBIS_MUMMY_DYING
			}
			
		ifphealthl 25
			{
			state SKILL_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE spawn HCUP
			}
			
		}
	else ifg PAIN_AMOUNT 0 { soundonce ANUBIS_PAIN action A_ANUBIS_MUMMY_PAIN }
	else ifrnd 32 { soundonce ANUBIS_PAIN state PAIN_SKILL_LEVELADJUST action A_ANUBIS_MUMMY_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_ANUBIS_MUMMY_SHRINK }
}

enda


// ******************************************************************************
// OGRE
// ******************************************************************************

action A_OGRE__FROZEN 35 1 5 1 10
action A_OGRE_IDLE 0 1 5 1 10 
action A_OGRE_RUN      0  4 5 1 15
action A_OGRE_SLASH    20 3 5 1 15
action A_OGRE_FLINCH 35 1 5 1 10
action A_OGRE_DYING 40 5 1 1 12
action A_OGRE_DEAD 46 1 1 1 10

move OGRE_RUNVELS 148 

ai AI_OGRE_IDLE A_OGRE_IDLE BERS_STOP seekplayer
ai AI_OGRE_SEEKENEMY A_OGRE_RUN OGRE_RUNVELS seekplayer faceplayer
ai AI_OGRE_SLASHENEMY A_OGRE_SLASH BERS_STOP faceplayer
ai AI_OGRE_SHIELD A_OGRE_FLINCH BERS_STOP faceplayer
ai AI_OGRE_DEAD A_OGRE_DEAD BERS_STOP faceplayer
ai AI_OGRE_SHRUNK A_OGRE_RUN OGRE_RUNVELS furthestdir
ai AI_OGRE__GROW A_OGRE_FLINCH BERS_STOP seekplayer

useractor enemystayput OGRE_STAYPUT 225 A_OGRE_IDLE
cactor OGRE
enda

useractor enemy OGRE 225 A_OGRE_IDLE
fall

ifai 0
{
	state monst_glow
	spawn SHOOTME
	spriteflags NORMAL_ENEMY
	sound BERSERK_SIGHT
	ifspritepal 0 spritepal 36
	ifspritepal 24
		{
		strength 400 
		sizeat 32 32
		}
	else
		{
		strength 225 
		sizeat 26 26
		}
	ai AI_OGRE_IDLE
	cstator 257
}

//state MECH_DAMAGE_MODIFIER

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

geta[].htextra HIT_DAMAGE

ifaction A_OGRE__FROZEN
{
state frozen_code
}
else
ifai AI_OGRE__GROW state genericgrowcode
else
ifai AI_OGRE_DEAD
{
strength 0
move BERS_STOP
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
	  state standard_jibs
        killit
      }
      break
    }
}
else
ifaction A_OGRE_DYING
{
move BERS_STOP
	strength 0
	ifactioncount 5 { state BODY_FALL_NOISES state rf ai AI_OGRE_DEAD }
}
else
ifaction A_OGRE_FLINCH
{
move STOP 0
sub PAIN_AMOUNT 1
	seta[].xvel 0
	ife PAIN_AMOUNT 0
		ai AI_OGRE_SEEKENEMY
		
	ifg HIT_DAMAGE -1 // if the actor is set to take some damage from a weapon...
	{
			geta[].htang TEMP3
			geta[].ang TEMP7
			add TEMP7 1024
			getincangle TEMP4 TEMP3 TEMP7
			ifand TEMP4 2147483648
			{
			xorvar TEMP4 4294967295 
			add TEMP4 1
			}
			ifl TEMP4 150 // is angle between them less than 125?
				{
					ifrnd 128 sound SHIELDHIT2 else sound SHIELDHIT
					divvar HIT_DAMAGE 4
					seta[].htextra HIT_DAMAGE
				}
				else
				ai AI_OGRE_SEEKENEMY
	}
		
}
else
ifai AI_OGRE_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_OGRE_SEEKENEMY
    else ifcount SHRUNKCOUNT
      {
	sound ACTOR_UNSHRINK
	sizeto 26 26
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_OGRE_IDLE
{
	state correctcansee
	 ife sightvar YES ai AI_OGRE_SEEKENEMY
}
else
ifai AI_OGRE_SEEKENEMY
{
ifcansee { }
	ifpdistl 1024 ifcansee ifcanseetarget { soundonce BERSERK_SWING ai AI_OGRE_SLASHENEMY }
	else ifbulletnear { state PAIN_SKILL_LEVELADJUST_REV action A_OGRE_FLINCH }
	else ifrnd 2 ai AI_OGRE_IDLE
	
	ifactioncount 8
		{
		randvar FOOTSTEPCOUNT 3
		ife FOOTSTEPCOUNT 0 sound H_ARMOUR_M1 else
		ife FOOTSTEPCOUNT 1 sound H_ARMOUR_M2 else
		ife FOOTSTEPCOUNT 2 sound H_ARMOUR_M3 else
		ife FOOTSTEPCOUNT 3 sound H_ARMOUR_M4 
		}
	
}
else
ifai AI_OGRE_SLASHENEMY
{
	ifpdistg 1024 ai AI_OGRE_SEEKENEMY else
	ifactioncount 3 
	{ 
	shoot 11741
	ai AI_OGRE_SEEKENEMY 
	}
}

ifhitweapon
{
	ifaction A_OGRE_DYING break
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	ifg HIT_DAMAGE -1 
		{
		guts JIBS6 1
		soundonce BERSERK_PAIN
		//spawn BLOOD
		state random_wall_jibs
		}
		state NEWGUNEFFECTS
	ifdead
		{
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_OGRE__GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action A_OGRE__FROZEN } 
		else
			{
			sound BERSERK_DIE
			addkills 1
			geta[].extra TEMP4
			ifl TEMP4 -75 
				{ 
				guts JIBS6 6 
				sound HUGE_GIB 
				spawn 18935 
				geta[].htpicnum TEMP
				ife TEMP 1405 // only do big death if killed by player
					{
					state standard_jibs 
					state monst_body_jibs 
					}
				eshoot 12704
				randvar TEMP5 2048
				seta[RETURN].ang TEMP5
				eshoot 12695 
				randvar TEMP5 2048
				seta[RETURN].ang TEMP5
				killit
				} 
			else
			action A_OGRE_DYING

			spawn BLOODPOOL
			}
		}
	else ifg PAIN_AMOUNT 0 action A_OGRE_FLINCH
	else ifpdistl 1524 { set PAIN_AMOUNT 26 action A_OGRE_FLINCH }
	else ifrnd 32 ife FIRE_DAMAGE 0 { ifaction A_OGRE_SLASH nullop else { state PAIN_SKILL_LEVELADJUST_REV action A_OGRE_FLINCH } }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_OGRE_SHRUNK }
}

state checksquished

enda

// ******************************************************************************
// Phantasm Ball
// ******************************************************************************

spriteshadow PHANTASM_BALL

move PB_ROAM 120 0
move PB_SEEK 275 0
move PB_STUCK 0 0
move MPB_STOP 0

useractor notenemy PHANTASM_BALL

	ifaction 0
	{
	state monst_glow
	sizeat 14 14 
	move PB_ROAM geth
	set INTERNALCOUNT 0
	cstat 256
	action ACAR
	}
	
ifmove PB_ROAM
{
ifactorsound THISACTOR PB_AMBQ nullop else sound PB_AMBQ
ifnotmoving move PB_ROAM randomangle
ifg INTERNALCOUNT 0 sub INTERNALCOUNT 1
else
ife INTERNALCOUNT 0
	{
	ifcansee
	 ifcanseetarget
	  ifcount 26
		{
	    getp[].posx mx
        getp[].posy my
        geta[].x x
        geta[].y y
        sub mx x
        sub my y
        getangle ANGVAR mx my
		geta[].ang TEMP4
		sub ANGVAR TEMP4
		ifg ANGVAR -225
		ifl ANGVAR 225
			{
			stopactorsound THISACTOR PB_AMBQ
			soundonce PB_STOP
			move MPB_STOP
			set TEMP2 0
			resetcount
			}
		}
	}
}
else
ifmove MPB_STOP
{
cstat 256
ifcansee
	{
	add TEMP2 1
	ife SKILL_LEVEL 1 ifg TEMP2 52 { soundonce PB_SPOT move PB_SEEK faceplayer set TEMP2 0 } else
	ife SKILL_LEVEL 2 ifg TEMP2 34 { soundonce PB_SPOT move PB_SEEK faceplayer set TEMP2 0 } else
	ife SKILL_LEVEL 3 ifg TEMP2 26 { soundonce PB_SPOT move PB_SEEK faceplayer set TEMP2 0 } else
	ife SKILL_LEVEL 4 ifg TEMP2 13 { soundonce PB_SPOT move PB_SEEK faceplayer set TEMP2 0 }
	}
	else
	move PB_ROAM randomangle resetcount
}
else
ifmove PB_SEEK
{
cstat 256
spawn FRAMEEFFECT1
soundonce PB_AMB
ifcansee
 ifcanseetarget nullop else add TEMP2 1
	ifg TEMP2 260 { move PB_ROAM randomangle set TEMP2 0 resetcount }
	
ifpdistl 1024
 ifp palive
  ifg SLIDE_KICK 20
	{
	stopactorsound THISACTOR PB_AMB
	sound PB_STIC
	wackplayer
	palfrom 20 20 0 0
	setp[].movement_lock 33
	move MPB_STOP
	set PHANTASM_STICK THISACTOR
	}
	
}
else
ifmove MPB_STOP
{
cstat 32768
ifg INTERNALCOUNT 0 { cstat 256 move PB_ROAM randomangle resetcount }
}
	
enda

useractor notenemy PBALL_WAYPOINT // phantasm ball Waypoint
cstat 32768

ifcount 6
{
findnearactor PHANTASM_BALL 512 TEMP
	ifn TEMP -1
		{
		ifspritepal 2 // If it's spritepal is 2, make it a 'random' waypoint
			{
			 ifrnd 48
				{
				geta[].ang TEMP2
				seta[TEMP].ang TEMP2
				}
			}
		else
			{
			geta[].ang TEMP2
			seta[TEMP].ang TEMP2
			}
		}
resetcount
}

enda

// ******************************************************************************
// HELICOPTER
// ******************************************************************************

action ACOPTER 0 1 7 1 10
action ACOPTER_DIE 0 1 7 1 10


define COPTER_ROTOR 13241
define COPTER_ROTOR2 13242

useractor notenemy COPTER_ROTOR

ifaction 0
{
cstat 34
sizeat 50 50

ifpdistl 1024 addphealth -1000

geta[myowner].extra TEMP6
ifl TEMP6 1 killit

geta[myowner].x TEMP
geta[myowner].y TEMP2
geta[myowner].z TEMP3
ifspawnedby KA_50_BLACK_SHARK sub TEMP3 18000
else ifspawnedby BLACK_HAWK sub TEMP3 16000
else sub TEMP3 22000
setsprite THISACTOR TEMP TEMP2 TEMP3

geta[].ang TEMP4
add TEMP4 256
seta[].ang TEMP4
}
	
enda

useractor notenemy COPTER_ROTOR2

ifaction 0
{
cstat 34
sizeat 50 50

ifpdistl 1024 addphealth -1000

geta[myowner].extra TEMP6
ifl TEMP6 1 killit

geta[myowner].x TEMP
geta[myowner].y TEMP2
geta[myowner].z TEMP3
sub TEMP3 14000
setsprite THISACTOR TEMP TEMP2 TEMP3

geta[].ang TEMP4
sub TEMP4 256
seta[].ang TEMP4
}
	
enda

move CHOPPER_SLOW 120 0
move CHOPPER_STOP 0
move CHOPPER_FALL 200 125

// HITAG = Upper movement
// LOTAG = Lower Movement
// XVEL = Stopping period
// YVEL = Speed
// ZVEL = Troops
// EXTRA = Missiles
// OWNER = Num of Troops

defstate CHOPPER_BOOM
		spawn EXPLOSION2
		ifpdistl 16000 wackplayer
		ifcansee palfrom 60 60 60 60
		flash
		hitradius 6096 100 20 400 500
		globalsound CHOPPER_EXPLODE
		quake 76
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		debris SCRAP1 40 
		debris SCRAP2 32
		debris SCRAP3 32
		debris SCRAP4 32
		debris SCRAP5 32
		strength 0 
		killit
ends

defstate CHOPPER_MOVEMENT
		ifspritepal 5 nullop else
		ifspritepal 3 nullop else
			{
			ife YVELSAVED 0 move CHOPPER_FLYBY geth getv
			else ife YVELSAVED 1 move CHOPPER_SLOW geth getv
			else ife YVELSAVED 2 
				{
				sub XVELSAVED 1 // Take away from the Stopping period
				move CHOPPER_STOP geth getv
				ifg OWNERSAVED 0
				{
				ife XVELSAVED 260 { espawnvar ZVELSAVED sub OWNERSAVED 1 }	
				ife XVELSAVED 234 { espawnvar ZVELSAVED sub OWNERSAVED 1 }	
				ife XVELSAVED 208 { espawnvar ZVELSAVED sub OWNERSAVED 1 }	
				ife XVELSAVED 182 { espawnvar ZVELSAVED sub OWNERSAVED 1 }				
				ife XVELSAVED 156 { espawnvar ZVELSAVED sub OWNERSAVED 1 }
				ife XVELSAVED 130 { espawnvar ZVELSAVED sub OWNERSAVED 1 }
				ife XVELSAVED 104 { espawnvar ZVELSAVED sub OWNERSAVED 1 }
				ife XVELSAVED 78 { espawnvar ZVELSAVED sub OWNERSAVED 1 }
				ife XVELSAVED 52 { espawnvar ZVELSAVED sub OWNERSAVED 1 }
				ife XVELSAVED 26 { espawnvar ZVELSAVED sub OWNERSAVED 1 }
				}
				ife XVELSAVED 0 set YVELSAVED 1 // Once stopping period is over, take off again!
				}
			ifspritepal 9 
			ifrnd 64 { espawn BIG_SMOKE2 geta[RETURN].z TEMP8 sub TEMP8 12000 seta[RETURN].z TEMP8 shoot SPARK }
			ifnotmoving 
				{ 
				ifspritepal 9
					{
					state CHOPPER_BOOM
					}
				else
				ifspawnedby RESPAWN
					{
					stopsound HELI_DIST
					strength 0 
					killit
					}
				}
			ifg HITAGSAVED 0 // If the climb rate is higher than 0
			ifn YVELSAVED 2 // If the chopper isn't stopped...
				{
				geta[].z TEMP5
				sub TEMP5 512
				seta[].z TEMP5
				sub HITAGSAVED 1
				}
			ifg LOTAGSAVED 0 // If the descend rate is higher than 0
			ifn YVELSAVED 2 // If the chopper isn't stopped...
				{
				geta[].z TEMP5
				add TEMP5 512
				seta[].z TEMP5
				sub LOTAGSAVED 1
				
				state getfloordist
				ifl z 16 
					{
					set LOTAGSAVED 0
					}
					
				}
			}
ends

spriteshadow MI_24_HIND

// Spritepals
// 4 = Only take if it has troops left!

spritenopal CHOPPER_WAYPOINT

useractor notenemy CHOPPER_WAYPOINT // Waypoint
ife HIDE_SPRITES 1 cstat 32768 else cstat 0
ife OWNERSAVED -1 set OWNERSAVED 0
enda

useractor notenemy MI_24_HIND
ifaction 0
	{
	ife ZVELSAVED 0 set ZVELSAVED FASCIST
	strength 8000
	sizeat 35 35
	cstat 257
	espawn COPTER_ROTOR
	setactorvar[RETURN].myowner THISACTOR
	action ACOPTER
	resetcount
	}
	
ifhitweapon
ifdead
	{
	strength 1
	action ACOPTER_DIE
	}

ifaction ACOPTER_DIE
	{
	ifrnd 64 { espawn BIG_SMOKE2 geta[RETURN].z TEMP8 sub TEMP8 12000 seta[RETURN].z TEMP8 shoot SPARK }
	move CHOPPER_FALL geth getv spin randomangle
	fall
	ifnotmoving 
		{
		state CHOPPER_BOOM
		}
	iffloordistl 16
		{
		state CHOPPER_BOOM
		}
	}
	
ifaction ACOPTER
	{
	state CHOPPER_MOVEMENT
	ifstrength 1000 ifrnd 32 { espawn BIG_SMOKE2 geta[RETURN].z TEMP8 sub TEMP8 12000 seta[RETURN].z TEMP8 shoot SPARK }
	ifspritepal 3 nullop else
	ifspritepal 5 nullop else
		{
		ifactorsound THISACTOR M_CHOPPER nullop else sound M_CHOPPER
		ifactorsound THISACTOR HELI_DIST nullop else sound HELI_DIST
		}
	ifg OWNERSAVED 6 set OWNERSAVED 6
	
	findnearactorz CHOPPER_WAYPOINT 1024 16000 WAYPOINT
		ifn WAYPOINT -1
		{
			geta[WAYPOINT].pal TEMP4 
			ife TEMP4 8 killit
			ife TEMP4 4 ife OWNERSAVED 0 break // If it has no troops, don't take this path
			ife TEMP4 3 { geta[WAYPOINT].z TEMP7 seta[].z TEMP7 }
				ife TEMP9 0
					{
					geta[WAYPOINT].ang TEMP6
					seta[].ang TEMP6
					getactorvar[WAYPOINT].ZVELSAVED TEMP2 ifn TEMP2 0 set ZVELSAVED TEMP2 // Set it's troop type
					getactorvar[WAYPOINT].HITAGSAVED HITAGSAVED // Set it's ascend rate
					getactorvar[WAYPOINT].LOTAGSAVED LOTAGSAVED // Set it's descend rate
					getactorvar[WAYPOINT].XVELSAVED XVELSAVED // Set it's stopping time
					getactorvar[WAYPOINT].YVELSAVED YVELSAVED // Set it's movement rate
					ifl OWNERSAVED 1 getactorvar[WAYPOINT].OWNERSAVED OWNERSAVED // Set the number of troops!
					set TEMP9 1
					}
		}
		else ife WAYPOINT -1 set TEMP9 0
		
		state getfloordist
		ifl z 32 
		{
		ife TEMP7 0 { set TEMP7 1 break }
		else set TEMP7 0

		geta[].x mx
		set TEMP5 mx
		geta[].y TEMP6
		add mx 512
		randvar TEMP 127
		set TEMP2 0

		whilevarn TEMP2 1
			{
				rotatepoint TEMP5 TEMP6 mx TEMP6 TEMP TEMP3 TEMP4
				add TEMP 128
				ifg TEMP 2047 set TEMP2 1
				ifrnd 128
				{
					espawn BIG_SMOKE
					seta[RETURN].pal 27
					seta[RETURN].x TEMP3
					seta[RETURN].y TEMP4
					seta[RETURN].ang TEMP
					seta[RETURN].cstat 32768
				}
			}
		}
	}
	
enda

spriteshadow KA_50_BLACK_SHARK

useractor notenemy KA_50_BLACK_SHARK
ifaction 0
	{
	strength 2000
	sizeat 35 35
	cstat 257
	ifspritepal 3 nullop else
		{
		espawn COPTER_ROTOR
		setactorvar[RETURN].myowner THISACTOR
		espawn COPTER_ROTOR2
		setactorvar[RETURN].myowner THISACTOR
		}
	action ACOPTER
	}
	
ifaction ACOPTER
	{
	state CHOPPER_MOVEMENT
	ifspritepal 3 nullop else
		{
		ifactorsound THISACTOR M_CHOPPER nullop else sound M_CHOPPER
		}
	ifactorsound THISACTOR HELI_DIST nullop else globalsound HELI_DIST
	set OWNERSAVED 0
	
	
	findnearactorz CHOPPER_WAYPOINT 1024 16096 TEMP
		ifn TEMP -1
		{
			geta[TEMP].pal TEMP4 
			ife TEMP4 4 ifl OWNERSAVED 1 break // If it has no troops, don't take this path
			else
				{
				getactorvar[TEMP].INTERNALCOUNT INTERNALCOUNT
					ife INTERNALCOUNT 0
					{
					geta[TEMP].ang TEMP6
					seta[].ang TEMP6
					getactorvar[TEMP].HITAGSAVED HITAGSAVED // Set it's ascend rate
					getactorvar[TEMP].LOTAGSAVED LOTAGSAVED // Set it's descend rate
					getactorvar[TEMP].XVELSAVED XVELSAVED // Set it's stopping time
					getactorvar[TEMP].YVELSAVED YVELSAVED // Set it's movement rate
					setactorvar[TEMP].INTERNALCOUNT 260
					}
				}
		}
	}
	
enda


spriteshadow BLACK_HAWK

useractor notenemy BLACK_HAWK
ifaction 0
	{
	ife ZVELSAVED 0 set ZVELSAVED MERC
	strength 6000
	sizeat 45 45
	cstat 257
	ifspritepal 3 nullop else
		{
		espawn COPTER_ROTOR
		setactorvar[RETURN].myowner THISACTOR
		}
	action ACOPTER
	resetcount
	}
	
ifhitweapon
ifdead
	{
	strength 1
	action ACOPTER_DIE
	}

ifaction ACOPTER_DIE
	{
	ifrnd 64 { espawn BIG_SMOKE2 geta[RETURN].z TEMP8 sub TEMP8 12000 seta[RETURN].z TEMP8 shoot SPARK }
	move CHOPPER_FALL geth getv spin randomangle
	fall
	ifnotmoving 
		{
		state CHOPPER_BOOM
		}
	iffloordistl 16
		{
		state CHOPPER_BOOM
		}
	}
	
ifaction ACOPTER
	{
	state CHOPPER_MOVEMENT
	ifstrength 1000 ifrnd 32 { espawn BIG_SMOKE2 geta[RETURN].z TEMP8 sub TEMP8 12000 seta[RETURN].z TEMP8 shoot SPARK }
	ifspritepal 3 nullop else
	ifspritepal 5 nullop else
		{
		ifactorsound THISACTOR M_CHOPPER nullop else sound M_CHOPPER
		ifactorsound THISACTOR HELI_DIST nullop else sound HELI_DIST
		}
	ifg OWNERSAVED 10 set OWNERSAVED 10
	
	findnearactorz CHOPPER_WAYPOINT 1024 16000 WAYPOINT
		ifn WAYPOINT -1
		{
			geta[WAYPOINT].pal TEMP4 
			ife TEMP4 4 ife OWNERSAVED 0 break // If it has no troops, don't take this path
			ife TEMP4 3 { geta[WAYPOINT].z TEMP7 seta[].z TEMP7 }
				ife TEMP9 0
					{
					geta[WAYPOINT].ang TEMP6
					seta[].ang TEMP6
					getactorvar[WAYPOINT].ZVELSAVED TEMP2 ifn TEMP2 0 set ZVELSAVED TEMP2 // Set it's troop type
					getactorvar[WAYPOINT].HITAGSAVED HITAGSAVED // Set it's ascend rate
					getactorvar[WAYPOINT].LOTAGSAVED LOTAGSAVED // Set it's descend rate
					getactorvar[WAYPOINT].XVELSAVED XVELSAVED // Set it's stopping time
					getactorvar[WAYPOINT].YVELSAVED YVELSAVED // Set it's movement rate
					ifl OWNERSAVED 1 getactorvar[WAYPOINT].OWNERSAVED OWNERSAVED // Set the number of troops!
					set TEMP9 1
					}
		}
		else ife WAYPOINT -1 set TEMP9 0
		
		state getfloordist
		ifl z 32 
		{
		ife TEMP7 0 { set TEMP7 1 break }
		else set TEMP7 0

		geta[].x mx
		set TEMP5 mx
		geta[].y TEMP6
		add mx 512
		randvar TEMP 127
		set TEMP2 0

		whilevarn TEMP2 1
			{
				rotatepoint TEMP5 TEMP6 mx TEMP6 TEMP TEMP3 TEMP4
				add TEMP 128
				ifg TEMP 2047 set TEMP2 1
				ifrnd 128
				{
					espawn BIG_SMOKE
					seta[RETURN].pal 17
					seta[RETURN].x TEMP3
					seta[RETURN].y TEMP4
					seta[RETURN].ang TEMP
					seta[RETURN].cstat 32768
				}
			}
		}
	}
	
enda

// ******************************************************************************
// PITFIEND
// ******************************************************************************

action APITFBREETH  0  1  5  1  40
action APITFFROZEN  0  1  5
action APITFSPIN    0  1  5  1  12
action APITFGET     0  1  5  1  30
action APITFSHOOT  5 1  5   1 35
action APITFABOUTTOSHOOT 5 1 5 1 30
action APITFDYING  10  1  1  1  12
action APITFDEAD   10  1  1  1  1

move PITFGETUPVELS 128 -64
move PITFGETVELS 128 64
move PITFSLOW 64 24
move PITFSTOPPED 0
move PITFDODGE 180 
move PITFSEEK 128 0

ai AIPITFWAIT APITFBREETH PITFSEEK seekplayer
ai AIPITFGET APITFGET PITFSEEK seekplayer
ai AIPITFSHOOT APITFSHOOT PITFSTOPPED faceplayerslow
ai AIPITFABOUTTOSHOOT APITFABOUTTOSHOOT PITFSTOPPED faceplayerslow
ai AIPITFSPIN APITFSPIN PITFGETVELS spin
ai AIPITFDYING APITFDYING PITFSTOPPED faceplayer
ai AIPITFDODGE APITFGET PITFDODGE dodgebullet geth
ai AIPITFSHRUNK APITFGET PITFSLOW furthestdir
ai AIPITFGROW APITFGET PITFSTOPPED furthestdir

defstate checkPITFhitstate

    ifhitweapon
    {
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
        guts JIBS6 2

        ifdead
        {
		state NEWGUNEFFECTS
		state thegames_score
            addkills 1
			
			globalsound BLOOD_EXPLOSION
			spawn 18935

            ifwasweapon RADIUSEXPLOSION { spawn BLOODPOOL state squish_sounds state standard_jibs state standard_jibs killit }
            else ifwasweapon RPG { state squish_sounds spawn BLOODPOOL state standard_jibs state standard_jibs killit }

			shoot NJIB shoot NJIB shoot NJIB
            sound PITF_DYING
            ai AIPITFDYING
        }
		else
	      ifwasweapon SHRINKSPARK
		  {
			sound ACTOR_SHRINKING
			ai AIPITFSHRUNK
		  }
		  else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
        else
        {
            soundonce PITF_PAIN
            ifrnd 24 ai AIPITFABOUTTOSHOOT
        }
    }



ends

useractor enemystayput PITFIEND_STAYPUT 350 APITFBREETH cactor PITFIEND cstator 257 sizeat 26 26 spawn SHOOTME ai AIPITFABOUTTOSHOOT enda
useractor enemy PITFIEND 350 APITFBREETH

  ifsquished
  {
    addkills 1
	state thegames_score
    state squish_sounds
    state standard_jibs
  ifrnd 128
    spawn OOZ2
  else
    spawn OOZ
    killit
  }
  
state ENEMYKNOCKBACKS
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage


iffloordistl 8 seta[].z sector[].floorz

    ifaction APITFFROZEN
    {
        fall

        ifcount THAWTIME { getlastpal ai AIPITFWAIT }
        else ifcount FROZENDRIPTIME { ifactioncount 26 { spawn WATERDRIP resetactioncount } }

        ifhitweapon
        {
            ifwasweapon FREEZEBLAST { strength 0 break }
            addkills 1

            ifrnd 84 spawn BLOODPOOL
            lotsofglass 20
			  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
			  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
			  sound ICE_SMASH
            killit
        }
        ifp pfacing ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0 pkick
        break
    }
	
    ifai 0 
		{ 
		state monst_glow
		spriteflags NORMAL_ENEMY 
		soundonce PITF_RECOG 
		cstat 257 
		sizeat 26 26
		spawn SHOOTME 
		ai AIPITFSHOOT
		}
    else ifai AIPITFABOUTTOSHOOT
    {
        ifactioncount 1 { ifcansee ai AIPITFSHOOT else { ai AIPITFGET break } }
    }
    else ifai AIPITFSHOOT
    {
        ifcanshoottarget
        {
            ifrnd 2 ai AIPITFGET
            ifactioncount 2 
				{ 
				sound ERPG_SHOOT 
				shoot MICRO_MISSILE
				resetactioncount 
				}
        }
        else ai AIPITFGET
    }
    else ifai AIPITFGET
    {
        ifnotmoving operate
        ifpdistl 1024 ifp palive { sound COMM_SPIN ai AIPITFSPIN break }

          ifp phigher move PITFGETUPVELS getv geth faceplayer

        ifactioncount 8 ifrnd 2 ai AIPITFABOUTTOSHOOT
    }
	else
    ifai AIPITFSHRUNK
  {
    ifcount SHRUNKDONECOUNT
      ai AICOMMGET
    else
      ifcount SHRUNKCOUNT
	    {
		sound ACTOR_UNSHRINK
        sizeto 48 40
		}
    else
      state genericshrunkcode
  }
  else
    ifai AIPITFGROW
      state genericgrowcode
    else ifai AIPITFSPIN
    {
        soundonce COMM_SPIN
        ifcount 16
        {
            ifpdistl 1280 { addphealth CAPTSPINNINGPLAYER sound DUKE_GRUNT palfrom 32 16 resetcount }
            else ifpdistg 2300 ai AIPITFGET
        }
        ifactioncount 52 ai AIPITFGET
        ifnotmoving ifrnd 32 operate
    }

    ifai AIPITFDYING
    {
        fall
        strength 0
		
		
	ifg ICE_DAMAGE 0
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action APITFFROZEN
        strength 0
        break
      }
      else
        ifwasweapon GROWSPARK
      {
        soundonce ACTOR_GROWING
        ai AIPITFGROW
        break
      }
	  
		

        ifhitweapon ifwasweapon RADIUSEXPLOSION
            { state squish_sounds spawn BLOODPOOL state standard_jibs state standard_jibs killit }

        ifaction APITFDYING { iffloordistl 8 sound THUD cstat 0 action APITFDEAD }
    }
    else
    {
        ifrnd 2 soundonce PITF_ROAM
        state checkPITFhitstate
    }
enda

// ******************************************************************************
// VILMOS' ROBOT
// ******************************************************************************

action A_V_ROBOT_IDLE 0 1 5 1 10
action A_V_ROBOT_MOVE 0 4 5 1 20
action A_V_ROBOT_MACHINEG 20 2 5 1 4
action A_V_ROBOT_GRENADES 20 2 5 1 16
action A_V_ROBOT_DIE 30 8 1 1 20
action A_V_ROBOT_DEAD 37 1 1 1 10

move V_ROBOT_STOP 0 0
move V_ROBOT_WALK 160 0

ai AI_V_ROBOT_IDLE A_V_ROBOT_IDLE V_ROBOT_STOP
ai AI_V_ROBOT_MOVE A_V_ROBOT_MOVE V_ROBOT_WALK seekplayer
ai AI_V_ROBOT_MACHINEG A_V_ROBOT_MACHINEG V_ROBOT_STOP faceplayerslow
ai AI_V_ROBOT_GRENADES A_V_ROBOT_GRENADES V_ROBOT_STOP faceplayer
ai AI_V_ROBOT_DIE A_V_ROBOT_DIE V_ROBOT_STOP

useractor enemy VILMOS_ROBOT 9000 A_V_ROBOT_IDLE
fall

ifai 0
	{
	state monst_glow
	spawn SHOOTME
	spriteflags ROBOT_ENEMY
	ifspritepal 50 { sizeat 70 70 strength 4000 }
	else ifspritepal 24 { sizeat 70 70 strength 4000 }
	else ifspritepal 40 { sizeat 85 85 strength 14000 }
	else { sizeat 75 75 strength 9000 }
	
	cstat 257
	ai AI_V_ROBOT_IDLE
	ifspritepal 3 nullop else 
	ifspritepal 24 nullop else
	ifspritepal 40 nullop else
	ifspritepal 50 nullop else
	set CURBOSS THISACTOR
	set BOSS_TYPE 4
	}
	
ifdead nullop else
	{
	ifstrength 2000
		{
		ifrnd 64
			{
			sound SHORT_CIRCUIT
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			}
		}
	}
	
ifaction A_V_ROBOT_DEAD
	{
	break
	}
else
ifai AI_V_ROBOT_DIE
	{
	shoot SPARK2
	ifactioncount 6
		{ 
		ifn XVELSAVED 0 
				{
				operateactivators XVELSAVED THISACTOR
				operatemasterswitches XVELSAVED
				operaterespawns XVELSAVED
				set XVELSAVED 0
				}
				geta[].x TEMP
				geta[].y TEMP2
				set TEMP3 TEMP
				add TEMP3 256
				randvar TEMP4 2048
				rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
				espawn BIG_EXPLOSION
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				espawn BIG_SMOKE2
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				set TEMP6 0
				debris SCRAP1 40 
				debris SCRAP2 32
				debris SCRAP3 32
				debris SCRAP4 32
				debris SCRAP5 32
				ezshoot 4096 19177
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19177
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19172
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19172
				randvar TEMP 2048
				seta[RETURN].ang TEMP
		quake 26 sound RPG_EXPLODE action A_V_ROBOT_DEAD 
		geta[].pal TEMP2 seta[RETURN].pal TEMP2
		}
	}
else
ifai AI_V_ROBOT_IDLE
	{
	ifcansee
	 ifcanseetarget
	  ai AI_V_ROBOT_MOVE
	}
else
ifai AI_V_ROBOT_MOVE
	{
	ifpdistl 16000
		{
		add INTERNALCOUNT 1
		ifg INTERNALCOUNT 16 { quake 13 ifrnd 128 sound PA_FOOTSTEP2 else sound PA_FOOTSTEP1 set INTERNALCOUNT 0 }
		}
		
	ifpdistl 8000
		ifrnd 8
			{
			ai AI_V_ROBOT_MACHINEG
			}
	else
		{
		 ifcanseetarget
		  ifcanshoottarget
			ifrnd 32
			{
			ifrnd 128 ai AI_V_ROBOT_GRENADES else
			ai AI_V_ROBOT_MACHINEG
			}
		}
	}
else
ifai AI_V_ROBOT_MACHINEG
	{
	 ifcanseetarget
	  ifcanshoottarget
		{
		ifspritepal 40
			{
			ifactioncount 1 soundonce RAILGUN_CHARGE
			ifactioncount 10 { shoot HEAVY_RAILGUN flash sound HRAILGUN_FIRE ai AI_V_ROBOT_MOVE }
			}
		else
			{
			ifactioncount 1 { state SKILL_ENEMY_ACCURACY shoot SHOTSPARK1 shoot SHOTSPARK1 sound AUTOTURRET_FIRE resetactioncount }
			ifrnd 16 ai AI_V_ROBOT_MOVE
			}
		}
	else ai AI_V_ROBOT_MOVE
	}
else
ifai AI_V_ROBOT_GRENADES
	{
	 ifcanseetarget
	  ifcanshoottarget
		{
		ifactioncount 2 
			{ 
			ifspritepal 40
				{
				eshoot HOMING_MISSILE
				sound HOVERTANK_MISSILE
				resetactioncount
				}
			else
				{
				eshoot 5375 
				geta[RETURN].z TEMP
				sub TEMP 4096
				seta[RETURN].z TEMP
				sound GRENADELFIRE 
				resetactioncount
				}
			}
		ifrnd 16 ai AI_V_ROBOT_MOVE
		}
	else ai AI_V_ROBOT_MOVE
	}
	
//state MECH_DAMAGE_MODIFIER

ifhitweapon
	{
	
	ifg TEMP6 POINT_AMOUNT
	{
	geta[].htowner TEMP4
	geta[TEMP4].picnum TEMP5
	ife TEMP5 1405
		{
		getactorvar[TEMP4].P_CREDITS TEMP6
		add TEMP6 1
		setactorvar[TEMP4].P_CREDITS TEMP6
		}
	}
	
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	ifwasweapon MICRO_MISSILE seta[].xvel 0
	ifwasweapon HOMING_MISSILE seta[].xvel 0
	geta[].htpicnum TEMP3


		
	ifdead
		{
		ifn YVELSAVED 0 espawnvar YVELSAVED
				soundonce BLOWUP
				geta[].x TEMP
				geta[].y TEMP2
				set TEMP3 TEMP
				add TEMP3 256
				randvar TEMP4 2048
				rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
				espawn BIG_EXPLOSION
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				espawn BIG_SMOKE2
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				set TEMP6 0
		globalsound PA_DIE
		ai AI_V_ROBOT_DIE
		addkills 1
		}
	}

enda

// ******************************************************************************
// TRIAD' ROBOT
// ******************************************************************************

action A_E_ROBOT_IDLE 0 1 5 1 10
action A_E_ROBOT_MOVE 5 4 5 1 20
action A_E_ROBOT_MACHINEG 25 2 5 1 4
action A_E_ROBOT_GRENADES 25 2 5 1 16
action A_E_ROBOT_DIE 35 1 1 1 20
action A_E_ROBOT_DEAD 36 1 1 1 10

move E_ROBOT_STOP 0 0
move E_ROBOT_WALK 160 0

ai AI_E_ROBOT_IDLE A_E_ROBOT_IDLE E_ROBOT_STOP
ai AI_E_ROBOT_MOVE A_E_ROBOT_MOVE E_ROBOT_WALK seekplayer
ai AI_E_ROBOT_MACHINEG A_E_ROBOT_MACHINEG E_ROBOT_STOP faceplayerslow
ai AI_E_ROBOT_GRENADES A_E_ROBOT_GRENADES E_ROBOT_STOP faceplayer
ai AI_E_ROBOT_DIE A_E_ROBOT_DIE E_ROBOT_STOP

useractor enemy EAST_ROBOT 4000 A_E_ROBOT_IDLE
fall

ifai 0
	{
	state monst_glow
	spawn SHOOTME
	spriteflags ROBOT_ENEMY
	strength 6000
	sizeat 50 50
	
	cstat 257
	ai AI_E_ROBOT_IDLE
	ifspritepal 3 nullop else 
	ifspritepal 24 nullop else
	ifspritepal 40 nullop else
	ifspritepal 50 nullop else
	set CURBOSS THISACTOR
	set BOSS_TYPE 6
	}
	
ifdead nullop else
	{
	ifstrength 2000
		{
		ifrnd 64
			{
			sound SHORT_CIRCUIT
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			}
		}
	}
	
ifaction A_E_ROBOT_DEAD
	{
	break
	}
else
ifai AI_E_ROBOT_DIE
	{
	shoot SPARK2
	ifactioncount 0
		{ 
		ifn XVELSAVED 0 
				{
				operateactivators XVELSAVED THISACTOR
				operatemasterswitches XVELSAVED
				operaterespawns XVELSAVED
				set XVELSAVED 0
				}
				geta[].x TEMP
				geta[].y TEMP2
				set TEMP3 TEMP
				add TEMP3 256
				randvar TEMP4 2048
				rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
				espawn BIG_EXPLOSION
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				espawn BIG_SMOKE2
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				set TEMP6 0
				debris SCRAP1 40 
				debris SCRAP2 32
				debris SCRAP3 32
				debris SCRAP4 32
				debris SCRAP5 32
				ezshoot 4096 19177
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19177
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19172
				randvar TEMP 2048
				seta[RETURN].ang TEMP
				ezshoot 4096 19172
				randvar TEMP 2048
				seta[RETURN].ang TEMP
		quake 26 sound RPG_EXPLODE action A_E_ROBOT_DEAD 
		geta[].pal TEMP2 seta[RETURN].pal TEMP2
		}
	}
else
ifai AI_E_ROBOT_IDLE
	{
	ifcansee
	 ifcanseetarget
	  ai AI_E_ROBOT_MOVE
	}
else
ifai AI_E_ROBOT_MOVE
	{
	ifpdistl 16000
		{
		add INTERNALCOUNT 1
		ifg INTERNALCOUNT 16 { quake 13 ifrnd 128 sound PA_FOOTSTEP2 else sound PA_FOOTSTEP1 set INTERNALCOUNT 0 }
		}
		
	ifpdistl 8000
		ifrnd 8
			{
			ai AI_E_ROBOT_MACHINEG
			}
	else
		{
		 ifcanseetarget
		  ifcanshoottarget
			ifrnd 32
			{
			ifrnd 128 ai AI_E_ROBOT_GRENADES else
			ai AI_E_ROBOT_MACHINEG
			}
		}
	}
else
ifai AI_E_ROBOT_MACHINEG
	{
	 ifcanseetarget
	  ifcanshoottarget
		{
		ifspritepal 40
			{
			ifactioncount 1 soundonce RAILGUN_CHARGE
			ifactioncount 10 { shoot HEAVY_RAILGUN flash sound HRAILGUN_FIRE ai AI_E_ROBOT_MOVE }
			}
		else
			{
			ifactioncount 1 { state SKILL_ENEMY_ACCURACY shoot SHOTSPARK1 shoot SHOTSPARK1 sound AUTOTURRET_FIRE resetactioncount }
			ifrnd 16 ai AI_E_ROBOT_MOVE
			}
		}
	else ai AI_E_ROBOT_MOVE
	}
else
ifai AI_E_ROBOT_GRENADES
	{
	 ifcanseetarget
	  ifcanshoottarget
		{
		ifactioncount 2 
			{ 
			ifspritepal 40
				{
				eshoot HOMING_MISSILE
				sound HOVERTANK_MISSILE
				resetactioncount
				}
			else
				{
				eshoot 5375 
				geta[RETURN].z TEMP
				sub TEMP 4096
				seta[RETURN].z TEMP
				sound GRENADELFIRE 
				resetactioncount
				}
			}
		ifrnd 16 ai AI_E_ROBOT_MOVE
		}
	else ai AI_E_ROBOT_MOVE
	}
	
//state MECH_DAMAGE_MODIFIER

ifhitweapon
	{
	
	ifg TEMP6 POINT_AMOUNT
	{
	geta[].htowner TEMP4
	geta[TEMP4].picnum TEMP5
	ife TEMP5 1405
		{
		getactorvar[TEMP4].P_CREDITS TEMP6
		add TEMP6 1
		setactorvar[TEMP4].P_CREDITS TEMP6
		}
	}
	
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	ifwasweapon MICRO_MISSILE seta[].xvel 0
	ifwasweapon HOMING_MISSILE seta[].xvel 0
	geta[].htpicnum TEMP3


		
	ifdead
		{
		ifn YVELSAVED 0 espawnvar YVELSAVED
				soundonce BLOWUP
				geta[].x TEMP
				geta[].y TEMP2
				set TEMP3 TEMP
				add TEMP3 256
				randvar TEMP4 2048
				rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
				espawn BIG_EXPLOSION
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				espawn BIG_SMOKE2
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				set TEMP6 0
		globalsound PA_DIE
		ai AI_E_ROBOT_DIE
		addkills 1
		}
	}

enda

// =====================================================================================================
// MAEPHISTO
// =====================================================================================================

action A_MAEPHISTO_IDLE      0 1 5 1 20
action A_MAEPHISTO_WALK      0 4 5 1 20
action A_MAEPHISTO_READY     20 1 5 1 10
action A_MAEPHISTO_PLASMA    25 2 5 1 4
action A_MAEPHISTO_CHAINGUN 35 2 5 1 4
action A_MAEPHISTO_CHARGE 45 1 5 1 200
action A_MAEPHISTO_FIRE 50 1 5 1 14
action A_MAEPHISTO_DYING 55 7 1 1 12

move MAEP_MOVE 90

ai AI_MAEPHISTO_SEEKENEMY A_MAEPHISTO_WALK MAEP_MOVE seekplayer faceplayer
ai AI_MAEPHISTO_READY A_MAEPHISTO_READY STOP faceplayer
ai AI_MAEPHISTO_PLASMA A_MAEPHISTO_PLASMA STOP faceplayer
ai AI_MAEPHISTO_CHARGE A_MAEPHISTO_CHARGE STOP faceplayerslow
ai AI_MAEPHISTO_STOMP A_MAEPHISTO_WALK STOP faceplayer
ai AI_MAEPHISTO_FIRE A_MAEPHISTO_FIRE STOP faceplayer
ai AI_MAEPHISTO_CHAINGUN A_MAEPHISTO_CHAINGUN STOP faceplayer

spriteflags MAEPHISTO SFLAG_NODAMAGEPUSH

action CHARGE 0

useractor notenemy 14422
cstat 32768

ifaction 0
	{
	ife HITAGSAVED 0 action ZERO // if hitag is zero than go straight to 'ready' phase
	else
		{
		checkactivatormotion HITAGSAVED
		ife RETURN 1 action ZERO // become active once initially triggered
		}
	}
	
ifaction ZERO
	{
	ifpdistl 4096
	 ifcansee
		{
		soundonce MAEPH_CHARGE
		action CHARGE
		}
	}
	
ifaction CHARGE
	{
	ifrnd 32 
		{
		eshoot SPARK
		geta[].ang TEMP8
		randvar TEMP6 256
		ifrnd 128 add TEMP8 TEMP6 else sub TEMP8 TEMP6
		seta[RETURN].ang TEMP8
		}
	add TEMP9 1
		ifg TEMP9 140 
			{ 
			spawn 8433
			shoot MAEPH_BEAM 
			globalsound MAEPH_FIRE 
			palfrom 40 40 40 40 
			shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			operateactivators LOTAGSAVED THISACTOR
			operaterespawns LOTAGSAVED
			operatemasterswitches LOTAGSAVED
			killit
			}
		ifg TEMP9 145 killit
	}

enda

spriteshadow 14418

useractor notenemy 14418 // Foot
ifaction 0
{
spawn BLOODPOOL
sizeat 32 32
action ZERO
}
fall
enda

spriteshadow 14419

useractor notenemy 14419 // Foot

ifaction 0
{
spawn BLOODPOOL
sizeat 32 32
action ZERO
}

fall
enda

useractor enemy MAEPHISTO
fall

ifaction 0
	{
	state monst_glow
	seta[].htflags NORMAL_ENEMY_TRU
	spawn SHOOTME
	sizeat 30 30
	strength 1500
	cstator 257
	globalsound MAEPH_ALERT
	ai AI_MAEPHISTO_SEEKENEMY
	}
	
ifaction A_MAEPHISTO_DYING
	{
	move STOP faceplayer
	add TEMP6 1
	ifg TEMP6 4
		{
		espawn EXPLOSION2
		sound RPG_EXPLODE
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 512
		randvar TEMP4 2048
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set TEMP6 0
		}
	
	ifactioncount 2
		{
		flash
		ifrnd 8 shoot NJIB
		ifrnd 8 shoot SPARK
		quake 13
		soundonce LASERTRIP_EXPLODE
		}

	ifactioncount 3
		{
		state monst_body_jibs
		debris SCRAP1 2
		debris SCRAP2 2
		}

	ifactioncount 6
		{
		espawn 14418
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 256
		set TEMP4 256
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		espawn 14419
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 256
		set TEMP4 -256
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		killit
		}
	}
	else
ifai AI_MAEPHISTO_SEEKENEMY
	{
	ifrnd 8 soundonce MAEPH_IDLE_1
	else ifrnd 8 soundonce MAEPH_IDLE_2
  state correctcansee
  ifpdistl 2048 ifrnd 64 ai AI_MAEPHISTO_STOMP
  else
    ife sightvar YES
	{
		state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE  
			{
			ifpdistg 16384 ifrnd 32 ai AI_MAEPHISTO_CHAINGUN
			else ai AI_MAEPHISTO_READY
			}
	}
	
	ifcount 13 { sound BOS1_WALK resetcount }
	}
else
ifai AI_MAEPHISTO_STOMP
	{
	ifactioncount 2
		{
		ifpdistl 2048
			{
			getp[].posx mx
			getp[].posy my
			geta[].x x
			geta[].y y
			sub mx x
			sub my y
			getangle knockbackang mx my
			set knockback 12
			addphealth -10
			wackplayer
			}
		quake 13
		soundonce BIG_BOSS_WALK1
		ifrnd 32 ai AI_MAEPHISTO_CHAINGUN
		else ai AI_MAEPHISTO_SEEKENEMY
		}
	}
else
ifai AI_MAEPHISTO_CHAINGUN
	{
	ifactioncount 2
		{
		sound ZCHAING_FIRE
		shoot CHAINGUN
				set gunsmoke_z 17544 
				set gunsmoke_angle -270
				state spawn_gunsmoke_z
				set gunsmoke_z 17544
				espawn 16115
				state spawn_muzzleflash
		resetactioncount
		}
	ifrnd 4 ai AI_MAEPHISTO_READY
	else
		{
	  state correctcansee
		ife sightvar YES nullop else ai AI_MAEPHISTO_SEEKENEMY
		}
	}
else
ifai AI_MAEPHISTO_READY
	{
	ifpdistl 2048 ifrnd 64 ai AI_MAEPHISTO_STOMP
	ifrnd 24 ifpdistg 8094 { set TEMP9 0 sound MAEPH_CHARGE ai AI_MAEPHISTO_CHARGE }
	ifcount 6
		{
	  state correctcansee
		ife sightvar YES ai AI_MAEPHISTO_PLASMA else ai AI_MAEPHISTO_SEEKENEMY
		resetcount
		}
	}
else
ifai AI_MAEPHISTO_CHARGE
	{
	add TEMP9 1
	
		
		espawn 23746
		seta[RETURN].pal 7
		set TEMP3 sprite[].x
		randvarvar TEMP4 1024
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		geta[RETURN].z TEMP2
		randvar TEMP 2048
		sub TEMP2 6128
		add TEMP2 TEMP
		seta[RETURN].z TEMP2
	
	ife TEMP9 20 flash
	ife TEMP9 40 flash
	ife TEMP9 60 flash
	ife TEMP9 80 flash
	ife TEMP9 100 flash
	ife TEMP9 120 flash
	ifg TEMP9 140 
		{ 
		set TEMP9 0 
		shoot MAEPH_BEAM 
		globalsound MAEPH_FIRE 
		palfrom 40 40 40 40 
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		ai AI_MAEPHISTO_FIRE
		}
	}
else
ifai AI_MAEPHISTO_FIRE
	{
	ifg sprite[].htextra 0 seta[].htextra -1
	add TEMP9 1
	ifg TEMP9 20 ai AI_MAEPHISTO_SEEKENEMY
	}
else
ifai AI_MAEPHISTO_PLASMA
	{
	ifpdistl 2048 ifrnd 64 ai AI_MAEPHISTO_STOMP
	ifactioncount 2
		{
		sound MAEPH_BOLT
		
		setprojectile[MPLASMA].offset -26
		eshoot MPLASMA // shoots it's left gun
		setthisprojectile[RETURN].extra 5
		setprojectile[MPLASMA].offset 14354
		
		setprojectile[MPLASMA].offset 64
		eshoot MPLASMA // shoots it's right gun
		setthisprojectile[RETURN].extra 5
		setprojectile[MPLASMA].offset 14354
		
			geta[].x TEMP
			geta[].y TEMP2
			set TEMP3 TEMP
			add TEMP3 512
			geta[].ang TEMP4
			add TEMP4 256
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			espawn 16113
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 8844 seta[RETURN].z TEMP
			
			geta[].x TEMP
			geta[].y TEMP2
			set TEMP3 TEMP
			add TEMP3 512
			geta[].ang TEMP4
			sub TEMP4 256
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			espawn 16113
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 8844 seta[RETURN].z TEMP
		
		resetactioncount
		}
	ifrnd 4 ai AI_MAEPHISTO_SEEKENEMY
	else
		{
	  state correctcansee
		ife sightvar YES nullop else ai AI_MAEPHISTO_SEEKENEMY
		}
	}
	

ifg sprite[].htextra 0                            // if the actor is set to take some damage from a weapon...
{
  ife sprite[].htowner THISACTOR  // if the owner of the weapon IS this actor
    seta[].htextra -1       // set the damage to 0
}
	
ifhitweapon
	{
	ifrnd 16 soundonce MAEPH_PAIN
	state NEWGUNEFFECTS
	//spawn BLOOD
	shoot SPARK
	ifrnd 64 { guts JIBS6 2 debris SCRAP6 1 debris SCRAP1 2 } 
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
	state random_wall_jibs
	ifdead
		{
			sound MAEPH_DIE
			state rf
			state thegames_score
			addkills 1
			action A_MAEPHISTO_DYING
		}
	}

enda

// **************************************************************************************************
// NINJA
// **************************************************************************************************

action ANINJAIDLE 0  1 5 1 10
action ANINJAFROZEN 0 1 5 1 10
action ANINJAWALK     0  4 5 1 20
action ANINJARUN      0  4 5 1 11

action ANINJASHOOT 20 2 5 1 11

action ANINJAFLINCH 128 1 1 1 20

action ANINJADYING 95 7 1 1 15
action ANINJADEAD 101 1 1 1 1

action ANINJAHDYING 102 7 1 1 15
action ANINJAHDEAD 108 1 1 1 15

action ANINJACHOPDY 109 10 1 1 12
action ANINJACHOPD 118 1 1 1 1

action ANINJATHROW 30 3 5 1 20

action ANINJAJUMP 45 3 5 1 20
action ANINJAFALL 50 1 5 1 1

action ANINJACHOKE 119 3 1 1 18

action ANINJA_KICK 60 3 5 1 20

action ANINJA_CRAWL 80 3 5 1 20

move NINJAWALKVELS 142
move NINJARUNVELS 188 
move NINJAJUMPVELS 198
move NINJASTOP 0

ai AININJAIDLE ANINJAIDLE NINJASTOP
ai AININJASEEKENEMY ANINJAWALK NINJAWALKVELS seekplayer
ai AININJARUSHENEMY ANINJARUN NINJARUNVELS faceplayer
ai AININJASHOOT ANINJASHOOT NINJASTOP faceplayer

ai AININJADEAD ANINJADEAD NINJASTOP faceplayer
ai AININJA_HEAD_DEAD ANINJAHDEAD NINJASTOP faceplayer
ai AININJACHOPD ANINJACHOPD NINJASTOP faceplayer
ai AININJATHROW ANINJATHROW NINJASTOP faceplayer

ai AININJAJUMP ANINJAJUMP NINJAJUMPVELS jumptoplayer
ai AININJASHRUNK ANINJARUN NINJARUNVELS furthestdir
ai AININJA_KICK ANINJA_KICK NINJASTOP faceplayer

ai AININJA_CRAWL ANINJA_CRAWL NINJAWALKVELS dodgebullet seekplayer
ai AININJAGROW ANINJAIDLE NINJASTOP

useractor enemystayput NINJASTAYPUT
state monst_glow
sizeat 26 26
cactor NINJA
enda

useractor enemy NINJAJUMP 150 ANINJAJUMP
ifai 0
{
set MONSTER_FLAGS 2
state monst_glow
strength 150
sizeat 26 26
sound NINJA_JUMP
ai AININJAJUMP
cstator 257
cactor NINJA
}
enda

useractor enemy NINJA 150 ANINJAIDLE
fall

ifai 0
{
set MONSTER_FLAGS 2
state monst_glow
spawn SHOOTME
spriteflags NORMAL_ENEMY
strength 100
sizeat 26 26
ai AININJAIDLE
cstator 257
}


state spawn_cold_breathe

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifaction ANINJAFROZEN
{
move 0
state frozen_code
}
else
ifaction ANINJAFALL
{
move NINJARUNVELS 0
iffloordistl 16 { soundonce LANDNORMAL2 ai AININJASEEKENEMY }
}
else
ifaction ANINJAFLINCH
{
move 0
sub PAIN_AMOUNT 1
ife PAIN_AMOUNT 0 ai AININJASEEKENEMY
}
else
ifaction ANINJACHOKE
{
move 0
soundonce CHOKING
ifhitweapon { state rf action ANINJADYING }
ifactioncount 6 { guts JIBS6 3 state rf spawn 16368 action ANINJADYING }
}
else
ifaction ANINJAHDYING
{
strength 0
ifactioncount 4 state BODY_FALL_NOISES_SOUNDONCE 
ifactioncount 6 { cstat 0 state rf spawn 16368 ai AININJA_HEAD_DEAD }
}
else
ifaction ANINJADYING
{
strength 0
ifactioncount 4 state BODY_FALL_NOISES_SOUNDONCE 
ifactioncount 7 { spawn 16368 ai AININJADEAD }
}
else
ifaction ANINJACHOPDY
{
strength 0
seta[].xvel -2
ifactioncount 10 { state BODY_FALL_NOISES spawn BLOODPOOL ai AININJACHOPD }
}
else
ifai AININJADEAD
{
strength 0
move 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
		state human_jibs
        killit
      }
      break
    }

}
else
ifai AININJA_HEAD_DEAD
{
strength 0
move 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
		state human_jibs
        killit
      }
      break
    }

}
else
ifai AININJACHOPD
{
strength 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
		state human_jibs
        killit
      }
      break
    }

}
else
ifai AININJAGROW
state genericgrowcode
else
ifai AININJASHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AININJASEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 26 26
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AININJAJUMP
{
ifactioncount 4 action ANINJAFALL
}
else
ifai AININJAIDLE
{
state correctcansee
ife sightvar YES ai AININJASEEKENEMY
}
else
ifai AININJA_CRAWL
{
ifrnd 16 { sizeat 26 26 ai AININJASEEKENEMY resetactioncount }
}
else
ifai AININJASEEKENEMY
{

geta[].htmovflag TEMP
ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
{
         andvar TEMP 49152
         ife TEMP 32768 // the actor is pushing on a wall
         {
           geta[].htmovflag TEMP2 // need to get the info again
           andvar TEMP2 16383 // temp now stores the wall number
                   getwall[TEMP2].nextsector sect
                   ifn sect -1
				   {
				   ifand wall[TEMP2].cstat 1 break
				   ife sector[sect].lotag 20 operate
				   ife sector[sect].lotag 21 operate
				   ife sector[sect].lotag 22 operate
				   ife sector[sect].lotag 23 operate
                      ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
						{
                        sound NINJA_JUMP
						ai AININJAJUMP
                        }
					}
          }
}

ifpdistl 1024
 ifcansee
    {
	sound KICK_SWING
	ai AININJA_KICK
	}
  else
ifpdistl 5120
 ifrnd 32
  {
   ai AININJARUSHENEMY
  }
 else
   ifcanshoottarget
   {
   ifrnd 16 shoot 14975
   ife THROW_GRENADE 1 { ai AININJATHROW set THROW_GRENADE 0 } else
  ifrnd 8 ai AININJASHOOT
	}
else ifrnd 2 ai AININJAIDLE
state SKILL_SHOOT_LEVELADJUST
ifbulletnear ifl RANDOM_CHANCE SKILLCHANCE { sizeat 26 16 ai AININJA_CRAWL resetactioncount }
}
else
ifai AININJARUSHENEMY
{

geta[].htmovflag TEMP
ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
{
         andvar TEMP 49152
         ife TEMP 32768 // the actor is pushing on a wall
         {
           geta[].htmovflag TEMP2 // need to get the info again
           andvar TEMP2 16383 // temp now stores the wall number
                   getwall[TEMP2].nextsector sect
                   ifn sect -1
				   {
				   ifand wall[TEMP2].cstat 1 break
				   ife sector[sect].lotag 20 operate
				   ife sector[sect].lotag 21 operate
				   ife sector[sect].lotag 22 operate
				   ife sector[sect].lotag 23 operate
                      ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
						{
                        sound NINJA_JUMP
						ai AININJAJUMP
                        }
					}
          }
}


state correctcansee
	ife sightvar YES
	{
   ifrnd 16 shoot 14975
   ife THROW_GRENADE 1 { ai AININJATHROW set THROW_GRENADE 0 } 
	else
	ifrnd 32
		{
		ai AININJASHOOT
		}
	}
	
state SKILL_SHOOT_LEVELADJUST
ifbulletnear ifl RANDOM_CHANCE SKILLCHANCE { sizeat 26 16 ai AININJA_CRAWL resetactioncount }
	
}
else
ifai AININJATHROW
{
ifactioncount 2 
	{ 
	ifpdistg 4096
	 ifrnd 64
		{
		geta[].htlastvx mx
		geta[].htlastvy my
		geta[].x x
		geta[].y y
		sub mx x
		sub my y
		getangle ANGVAR mx my
		getp[].i TEMP
		dist TEMP2 THISACTOR TEMP
			seta[].ang ANGVAR 
			sound THROWSOMET 
			shoot FL_GRENADE 
		}
	else
		{
		sound THROWSOMET
		shoot 14970
		eshoot 14970
		geta[RETURN].ang TEMP add TEMP 32 seta[RETURN].ang TEMP
		eshoot 14970
		geta[RETURN].ang TEMP sub TEMP 32 seta[RETURN].ang TEMP
		}
	ai AININJASEEKENEMY 
	}
} 
else
ifai AININJASHOOT
{
	ifactioncount 1 
	{
	state correctcansee
	ife sightvar YES
		{ 
		shoot CHAINGUN 
		sound SMAC10FIRE 
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 8944 
			set gunsmoke_angle 270
			state spawn_gunsmoke_z
			randvar TEMP 1024 
			zshoot TEMP 13772
			}
		ifrnd 16 ai AININJASEEKENEMY
		resetactioncount 
		}
	else ai AININJASEEKENEMY
	}
	
state SKILL_SHOOT_LEVELADJUST
ifbulletnear ifl RANDOM_CHANCE SKILLCHANCE { sizeat 26 16 ai AININJA_CRAWL resetactioncount }
	
}
else
ifai AININJA_KICK
{
add INTERNALCOUNT 1
ifpdistg 1524 ai AININJASEEKENEMY
ifg INTERNALCOUNT 14
	{
	ifpdistl 1524 { addphealth -25 palfrom 10 10 0 0 soundonce PUNCHHIT wackplayer state setknockback }
	resetactioncount
	set INTERNALCOUNT 0
	}
ifg INTERNALCOUNT 20 ai AININJASEEKENEMY
}

ifhitweapon
{
state NEWGUNEFFECTS
ifaction ANINJADYING break
ifaction ANINJADEAD break
ifaction ANINJAHDEAD break
ifai AININJA_CRAWL sizeat 26 26
ifaction ANINJAHDYING break
//spawn BLOOD
//guts JIBS6 1
state random_wall_jibs

      ifwasweapon RADIUSEXPLOSION
	ifstrength 0
	{
        state squish_sounds
        state standard_jibs
		state human_jibs
        killit
      }

ifdead 
	{ 
	ifaction ANINJAHDYING break
	ifaction ANINJADYING break
	addkills 1  
     ifstrength -175
      {
        state squish_sounds
        state standard_jibs
		state human_jibs
        killit
      }
	  
	geta[].htpicnum BULLET_HIT_TYPE
	ifand tiledata[BULLET_HIT_TYPE].gameflags 8 getprojectile[BULLET_HIT_TYPE].userdata TEMP4 else set TEMP4 0
	
	ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AININJAGROW break }
	else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ANINJAFROZEN } 
	else ifwasweapon 7163 	
	{ 		
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		spawn ONFIREGUY 
		killit 
	}
	else
	ifg FIRE_DAMAGE 0 
	{ 		
		ifrnd 64 sound MERC_ONFIRE1
		else ifrnd 64 sound MERC_ONFIRE2
		else ifrnd 64 sound MERC_ONFIRE3
		else sound MERC_ONFIRE4
		set PLAYER_VOICEOVER 21
		spawn ONFIREGUY 
		killit 
	}
	else
	ifg ENERGY_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 4
		guts JIBS3 6
		spawn DISINTIGRATE_GUY
		killit
		}
	else
	ifg SPIRIT_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 1
		guts JIBS3 6
		spawn SPIRIT_DEATH_GUY
		killit
		}
	else ifand TEMP4 8 // slicing anim
	{ state sword_kill_sounds ifrnd 32 state trigger_showoff cstat 4 sound SLASHDIE action ANINJACHOPDY } 
	else ife HEADSHOT 2 
		{ 
		ifrnd 32 state trigger_showoff 
		sound DECAPITATE 
		state jib_sounds
		action ANINJAHDYING shoot NJIB shoot NJIB guts JIBS6 3 guts JIBS2 2 
		} 
	else ifrnd 16 action ANINJACHOKE else { ifrnd 128 sound NINJA_DIE1 else sound NINJA_DIE2 state rf action ANINJADYING }
	state thegames_score
	} 
else 
ifg PAIN_AMOUNT 0 action ANINJAFLINCH else
ifrnd 32 { sound NINJA_PAIN state PAIN_SKILL_LEVELADJUST action ANINJAFLINCH }
ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AININJASHRUNK }
}
state checksquished
enda

// MAJESTIC 12 ASSASSIN

action A_MJ12_ASSASSIN_RUN 0 4 5 1 8
action A_MJ12_ASSASSIN_JUMP 20 2 1 1 8
action A_MJ12_ASSASSIN_JUMPING 21 1 1 1 8
action A_MJ12_ASSASSIN_FALL 22 1 1 1 8
action A_MJ12_ASSASSIN_LAND 23 1 1 1 8
action A_MJ12_ASSASIN_SLASH 24 4 1 1 16
action A_MJ12_ASSASSIN_PAIN 28 1 1 1 16
action A_MJ12_ASSASSIN_DYING 28 7 1 1 8
action A_MJ12_ASSASSIN_DEAD 34

move ASSASSIN_MOVE 180 0
move ASSASSIN_JUMP 180 -48

ai AI_MJ12_ASSASSIN_SEEK A_MJ12_ASSASSIN_RUN ASSASSIN_MOVE seekplayer
ai AI_MJ12_ASSASSIN_JUMP A_MJ12_ASSASSIN_JUMP ASSASSIN_JUMP jumptoplayer
ai AI_MJ12_ASSASSIN_JUMPING A_MJ12_ASSASSIN_JUMPING ASSASSIN_JUMP jumptoplayer
ai AI_MJ12_ASSASSIN_FALL A_MJ12_ASSASSIN_FALL ASSASSIN_MOVE faceplayer
ai AI_MJ12_ASSASSIN_LAND A_MJ12_ASSASSIN_LAND STOP faceplayer
ai AI_MJ12_ASSASSIN_SLASH A_MJ12_ASSASIN_SLASH STOP faceplayer
ai AI_MJ12_ASSASSIN_DYING A_MJ12_ASSASSIN_DYING STOP

useractor enemy MJ12_ASSASSIN_JUMP

ifaction 0
	{
	set MONSTER_FLAGS 6
	ifspritepal 0 spritepal 12
	strength 200
	sizeat 24 24
	state monst_glow
	cstat 257
	spawn SHOOTME
	ai AI_MJ12_ASSASSIN_JUMP
	cactor MJ12_ASSASSIN
	}

enda

useractor enemy MJ12_ASSASSIN

fall

ifaction 0
	{
	set MONSTER_FLAGS 6
	ifspritepal 0 spritepal 12
	strength 200
	sizeat 24 24
	state monst_glow
	set ALLY_MAG SKILL_LEVEL
	cstat 257
	spawn SHOOTME
	ai AI_MJ12_ASSASSIN_SEEK
	}
	

	
ifai AI_MJ12_ASSASSIN_DYING nullop
else
{

ife INTERNALCOUNT_2 0
 ife CLOAK_COUNT 0
	{
	ifdead break
	ifcansee
	ifrnd 4
		{
		soundonce CLOAK
		ife SKILL_LEVEL 1 set CLOAK_COUNT 150
		else ife SKILL_LEVEL 2 set CLOAK_COUNT 300
		else ife SKILL_LEVEL 3 set CLOAK_COUNT 450
		else ife SKILL_LEVEL 4 set CLOAK_COUNT 600
		else ife SKILL_LEVEL 5 set CLOAK_COUNT 900
		set INTERNALCOUNT_2 1
		}
	}

ifg CLOAK_COUNT 0 sub CLOAK_COUNT 1
	
ife INTERNALCOUNT_2 1
	{
	ifdead break
	ifl CLOAK_FADE 254 add CLOAK_FADE 8
	set alpha CLOAK_FADE
	state SPRITE_FADE
	ifg CLOAK_FADE 253 set INTERNALCOUNT_2 2
	}
	
ife INTERNALCOUNT_2 2
	{
	ifdead set CLOAK_COUNT 0
	ife CLOAK_COUNT 1 sound UNCLOAK
	ife CLOAK_COUNT 0
		{
		ifdead shoot SPARK2
		ifg CLOAK_FADE 0 sub CLOAK_FADE 8
		set alpha CLOAK_FADE
		state SPRITE_FADE
		ifl CLOAK_FADE 1 set INTERNALCOUNT_2 0
		}
	}
}
	
	ifaction A_MJ12_ASSASSIN_DEAD
	{
	seta[].blend 0
	strength 0
		ifhitweapon
		{
			state standard_jibs
			state human_jibs
			sound SQUISHED
			killit
		}
		break
	}
	else
	ifai AI_MJ12_ASSASSIN_DYING
	{
	ifactioncount 6 
		{ 
		cstat 0
		state rf 
		seta[].blend 0 
		set CLOAK_COUNT 0
		action A_MJ12_ASSASSIN_DEAD 
		iffloordistl 4 state BODY_FALL_NOISES 
		move STOP 
		}
	}
	else
	ifaction A_MJ12_ASSASSIN_PAIN
	{
	ife INTERNALCOUNT_2 2
		{
		set INTERNALCOUNT_2 0
		set CLOAK_COUNT 1
		cstat 257
		seta[].blend 0
		sound UNCLOAK
		}
	ifactioncount 2 ai AI_MJ12_ASSASSIN_SEEK
	}
else
ifai AI_MJ12_ASSASSIN_SEEK
	{
	ifpdistl 1024 { set INTERNALCOUNT_3 0 ai AI_MJ12_ASSASSIN_SLASH }
	else ifrnd 8 
		{
		state SKILL_SHOOT_LEVELADJUST
		ifcansee ifl RANDOM_CHANCE SKILLCHANCE ifg ALLY_MAG 0 { shoot FL_GRENADE sub ALLY_MAG 1 }
		ai AI_MJ12_ASSASSIN_JUMP
		}
	ifnotmoving operate
	}
else
ifai AI_MJ12_ASSASSIN_JUMP
	{
	ifactioncount 2 { sound NINJA_JUMP ai AI_MJ12_ASSASSIN_JUMPING }
	}
else	
ifai AI_MJ12_ASSASSIN_JUMPING
	{
	ifactioncount 8 ai AI_MJ12_ASSASSIN_FALL
	}
else
ifai AI_MJ12_ASSASSIN_FALL
	{
	gets[].floorpicnum FLOORTEX
	state CHECKSTEPS
	iffloordistl 4 { ife STEPSOUNDFX 9 { soundonce WATER_SPLASH spawn 8435 } stopsound THUD sound JLAND ai AI_MJ12_ASSASSIN_LAND }
	}
else
ifai AI_MJ12_ASSASSIN_LAND
	{
	ifactioncount 4 ai AI_MJ12_ASSASSIN_SEEK
	}
else
ifai AI_MJ12_ASSASSIN_SLASH
	{
	ife INTERNALCOUNT_2 2
	 ifl SKILL_LEVEL 3
		{
		set INTERNALCOUNT_2 0
		set CLOAK_COUNT 0
		cstat 257
		seta[].blend 0
		sound UNCLOAK
		}
	add INTERNALCOUNT_3 1
	ife INTERNALCOUNT_3 5 sound SWING
	ife INTERNALCOUNT_3 10 shoot 15729
	ife INTERNALCOUNT_3 15 sound SWING
	ife INTERNALCOUNT_3 20 shoot 15729
	ifg INTERNALCOUNT_3 20 set INTERNALCOUNT_3 0
	ifpdistg 1024 ai AI_MJ12_ASSASSIN_JUMP
	}
	
ifhitweapon
{
state NEWGUNEFFECTS

	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0

state random_wall_jibs
   ifwasweapon RADIUSEXPLOSION
	ifstrength 0
	{
        state squish_sounds
        state standard_jibs
		state human_jibs
        killit
      }

ifdead 
	{ 
	set CLOAK_FADE 0
	seta[].blend 0
	cstat 0
	xorvar ENEMY_KILLED 16
	addkills 1  
	spawn 2284 
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
		state human_jibs
        killit
      }
	
	// ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action AMJ12_FROZEN } 
	// else ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_FASCIST_GROW break }
		ifwasweapon 7163 	
		{ 		
			sound MJ12_FLAME_DIE
			spawn ONFIREGUY 
			killit 
		}
	else ifg SPIRIT_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 1
		guts JIBS3 6
		spawn SPIRIT_DEATH_GUY
		killit
		}
	else ifg ENERGY_DAMAGE 0
		{
		shoot SPARK2 shoot SPARK2 shoot SPARK2 
		spritepal 4
		guts JIBS3 6
		spawn DISINTIGRATE_GUY
		killit
		}
	else ifg FIRE_DAMAGE 0
		{ 		
		sound MJ12_FLAME_DIE
		spawn ONFIREGUY 
		set PLAYER_VOICEOVER 21
		killit 
		}
	else
		{
		ifrnd 128 sound MJ12_DIE1
		else ifrnd 128 sound MJ12_DIE2
		else sound MJ12_DIE3		
		ai AI_MJ12_ASSASSIN_DYING		
		resetactioncount
		}
	state thegames_score
	} 
else ifg PAIN_AMOUNT 0 action A_MJ12_ASSASSIN_PAIN
else ifrnd 4 { state PAIN_SKILL_LEVELADJUST action A_MJ12_ASSASSIN_PAIN }
}

enda

// **************************************************************************************************
// RIPPER
// **************************************************************************************************

action A_RIPPER_RUN 0 4 5 1 8
action A_RIPPER_TROT -25 4 5 1 12
action A_RIPPER_BITE 40 4 5 1 10
action A_RIPPER_STAND 55 1 5 1 1
action A_RIPPER_JUMP 20 4 5 1 15
action A_RIPPER_FALL 35 1 5 1 15
action A_RIPPER_LAND 20 1 5 1 15
action A_RIPPER_DIE 62 7 1 1 18
action A_RIPPER_FLINTCH 61 1 1 1 20
action A_RIPPER_DEAD 68 1 1 1 1
action A_RIPPER_ALERT 69 3 5 1 20

move RIPPER_VELS 300
move RIPPER_SEARCHVEL 160

move RIPPER_JUMPVEL 256 -24
move RIPPER_FALLVEL 256
move RIPPER_SHRUNKVEL 40

ai AI_RIPPER_FROZEN A_RIPPER_STAND STOP geth
ai AI_RIPPER_SHRUNK A_RIPPER_RUN RIPPER_SHRUNKVEL fleeenemy
ai AI_RIPPER_CHARGE A_RIPPER_RUN RIPPER_VELS faceplayersmart
ai AI_RIPPER_BITE A_RIPPER_BITE STOP faceplayer
ai AI_RIPPER_SEEK A_RIPPER_TROT RIPPER_SEARCHVEL seekplayer
ai AI_RIPPER_WAIT A_RIPPER_STAND STOP geth
ai AI_RIPPER_JUMP A_RIPPER_JUMP RIPPER_JUMPVEL jumptoplayer
ai AI_RIPPER_DYING A_RIPPER_DIE STOP geth
ai AI_RIPPER_ALERT A_RIPPER_ALERT STOP faceplayer

defstate ripperalertstate

soundonce RIPPER_BEATCHEST
ifactioncount 8 ai AI_RIPPER_SEEK

ends

defstate rippershrunkstate
  ifcount SHRUNKDONECOUNT
    ai AI_RIPPER_SEEK
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 34 34
	  }
  else
    state genericshrunkcode
ends

defstate ripperdyingstate 

	strength 0
	ifaction A_RIPPER_DEAD
	{
		ifhitweapon
		{
			ife MELEE_RESEARCH[4] 2
				{
				ifspritepal 3
					spawn 17980
				else
				 ifrnd 48
					spawn 17980
				}
			state standard_jibs
			state monst_body_jibs
			sound SQUISHED
			killit
		}
		break
	}
	ifaction A_RIPPER_DIE
	{
		ifactioncount 7 { action A_RIPPER_DEAD spawn 16368 ifspritepal 100 { sound BOSSFALL quake 13 } else state BODY_FALL_NOISES }
	}

ends

defstate ripperjumpstate

	ifaction A_RIPPER_JUMP
	{
		ifactioncount 3
		{
			action A_RIPPER_FALL
			move RIPPER_FALLVEL geth
		}
	}
	else
	ifaction A_RIPPER_FALL
	{
		iffloordistl 8
		{
			action A_RIPPER_LAND
			ifspritepal 100 ifpdistl 8096 quake 13
			move RIPPER_SEARCHVEL geth
			ifspritepal 100 sound BOSSFALL else sound MONSTER_LAND
		}
	}
	else
	ifaction A_RIPPER_LAND
	{
		ifactioncount 2 
		{ 
			ai AI_RIPPER_CHARGE 

		}
	}

ends

defstate ripperchargestate

	ifn target -1
	ifl xydist2 1280
	{
		ai AI_RIPPER_BITE
		break
	}
	
	ifcansee
	{
		ifpdistl 1280
		{
			ai AI_RIPPER_BITE
			break
		}
	}
	else ifcount 30
	ife target -1 ai AI_RIPPER_SEEK
	
	ifpdistg 8192 ifrnd 1 ai AI_RIPPER_SEEK
	else
	ifcount 10
	{
	geta[].htmovflag TEMP
		ifn TEMP 0 // this is the same as ifnotmoving, but now we have info about what is hit in the temp var
		{
				 andvar TEMP 49152
				 ife TEMP 32768 // the actor is pushing on a wall
				 {
				   geta[].htmovflag TEMP2 // need to get the info again
				   andvar TEMP2 16383 // temp now stores the wall number
						   getwall[TEMP2].nextsector sect
						   ifn sect -1
						   {
						   ifand wall[TEMP2].cstat 1 break
							  ifl sector[sect].floorz sector[].floorz // assumes floors are not sloped!
								ai AI_RIPPER_JUMP
							}
				  }
		}
		else
		ai AI_RIPPER_WAIT 
	}
	
	ifrnd 1 sound RIPPER_ROAM

ends

defstate ripperseekstate

	ifp phigher ifrnd 2
	{
		ai AI_RIPPER_JUMP
		break
	}
	ifcount 60 
	{
		ifcansee ai AI_RIPPER_CHARGE
		ifn target -1 ai AI_RIPPER_CHARGE
	}
	
	ifcount 10
	ifnotmoving
	{
		ifrnd 128 ai AI_RIPPER_JUMP
		else
		ai AI_RIPPER_WAIT 
	}
	
	ifrnd 1 sound RIPPER_ROAM

ends

defstate ripperwaitstate

	ifcount 10
	{
		ai AI_RIPPER_SEEK
	}

ends

defstate ripperbitestate

	ifn target -1
	{
		ifg xydist2 1024 { ifmove STOP move RIPPER_SEARCHVEL geth } else
		move STOP geth
	}
	else
	{
		ifpdistg 1024 { ifmove STOP move RIPPER_SEARCHVEL faceplayer } else
		move STOP faceplayer
	}
	
	ifactioncount 4
	{
		resetactioncount
		ifn target -1 
		{
			ifg xydist2 1280 ai AI_RIPPER_CHARGE
			shoot 17663
		} 
		else
		ifpdistl 1526
		{
		ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 40
				wackplayer
				sound SWORD_CLASH
				ai AI_RIPPER_WAIT
				}
			else
			  shoot 17663
		}
			ifpdistg 1280 ai AI_RIPPER_CHARGE
	}


ends

useractor enemy RIPPERJUMP 300 A_RIPPER_JUMP 	
	state monst_glow
	ai AI_RIPPER_JUMP 
	sound RIPPER_ALERT 
	spawn SHOOTME 
	sizeat 42 40 
	cstat 257
	cactor RIPPER
enda

useractor enemy RIPPER 200 A_RIPPER_STAND

fall

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage


  ifai AI_RIPPER_FROZEN
  {
state frozen_code
  }

ifai 0
{
	readarrayfromfile MELEE_RESEARCH 4020
	state monst_glow
	sound RIPPER_ALERT
	spawn SHOOTME
	ifrnd 128 ai AI_RIPPER_CHARGE else 
	ai AI_RIPPER_ALERT
	geta[].htflags temp
	orvar temp SFLAG_NODAMAGEPUSH
	seta[].htflags temp
	ifspritepal 50
		{
		sizeat 64 64
		strength 500
		}
	else
		{
		sizeat 40 40
		strength 200
		}
	cstat 257
}

ifai AI_RIPPER_DYING { state ripperdyingstate break }

ifai AI_RIPPER_SHRUNK state rippershrunkstate else
ifai AI_RIPPER_CHARGE state ripperchargestate else
ifai AI_RIPPER_SEEK state ripperseekstate else
ifai AI_RIPPER_WAIT state ripperwaitstate else
ifai AI_RIPPER_BITE state ripperbitestate else
ifai AI_RIPPER_ALERT state ripperalertstate else
ifai AI_RIPPER_JUMP state ripperjumpstate

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AI_RIPPER_SHRUNK
      break
    }
    ifrnd 32 sound RIPPER_PAIN
	guts JIBS6 1
    ifai AI_RIPPER_ALERT ai AI_RIPPER_CHARGE
    state random_wall_jibs
	ifdead
	{
	stopactorsound THISACTOR RIPPER_PAIN
		ifg ICE_DAMAGE 0
		{
			sound SOMETHINGFROZE
	        spritepal 1
	        ai AI_RIPPER_FROZEN
	        strength 0
	        break
        }	
		guts JIBS6 5
		addkills 1
		state thegames_score

		ifrnd 128 cstat 0 else cstat 4
		ifstrength -100
		{
			ife MELEE_RESEARCH[4] 2
			{
			ifspritepal 3
				spawn 17980
			else
			ifspritepal 50
				spawn 17980
			else
			 ifrnd 48
				spawn 17980
			}
			state standard_jibs
			state monst_body_jibs
			// state randsquishsound
			sound SQUISHED
			killit
		}
		sound RIPPER_DYING
		ai AI_RIPPER_DYING
	}
}
else
    ifrnd 1
    {        
      
        ifai AI_RIPPER_SEEK ai AI_RIPPER_ALERT
        ifai AI_RIPPER_CHARGE ai AI_RIPPER_ALERT
    	
    }
	
state checksquished

enda

// **************************************************************************************************
// MAMANO
// **************************************************************************************************

action A_MAMANO_RUN 5 4 5 1 8
action A_MAMANO_TROT 5 4 5 1 12
action A_MAMANO_BITE 40 3 5 1 10
action A_MAMANO_STAND 0 1 5 1 1
action A_MAMANO_POUND 25 3 5 1 15
action A_MAMANO_DIE 55 6 1 1 18
action A_MAMANO_FLINTCH 55 1 1 1 20
action A_MAMANO_DEAD 60 1 1 1 1

ai AI_MAMANO_FROZEN A_MAMANO_FLINTCH STOP geth
ai AI_MAMANO_SHRUNK A_MAMANO_RUN RIPPER_SHRUNKVEL fleeenemy
ai AI_MAMANO_CHARGE A_MAMANO_RUN RIPPER_VELS faceplayersmart
ai AI_MAMANO_BITE A_MAMANO_BITE STOP faceplayer
ai AI_MAMANO_SEEK A_MAMANO_TROT RIPPER_SEARCHVEL seekplayer
ai AI_MAMANO_WAIT A_MAMANO_STAND STOP geth
ai AI_MAMANO_POUND A_MAMANO_POUND STOP faceplayer
ai AI_MAMANO_DYING A_MAMANO_DIE STOP geth

defstate MAMANOshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AI_MAMANO_SEEK
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 34 34
	  }
  else
    state genericshrunkcode
ends

defstate MAMANOdyingstate 

	strength 0
	ifaction A_MAMANO_DEAD
	{
		ifhitweapon
		{
			state standard_jibs
			state monst_body_jibs
			sound SQUISHED
			killit
		}
		break
	}
	ifaction A_MAMANO_DIE
	{
		ifactioncount 6 { sound BOSSFALL ifpdistl 4096 quake 13 action A_MAMANO_DEAD }
	}

ends

defstate MAMANOpoundstate

	ifaction A_MAMANO_POUND
	{
		ifactioncount 3
		{
		quake 46
		sound BOSSFALL
		sound SPUNCHHIT
		ifpdistl 16384
		 ifp ponground
		  ife knockback2 0
			{
			getp[].posz TEMP
			sub TEMP 1024
			setp[].posz TEMP
			getp[].ang knockbackang
			set knockbackheight -2048
			set knockback2 8
			wackplayer			
			}
			ifpdistl 1280 ai AI_MAMANO_BITE else
			ai AI_MAMANO_SEEK
		}
	}

ends

defstate MAMANOchargestate

	ifn target -1
	ifl xydist2 1280
	{
		ai AI_MAMANO_BITE
		break
	}
	
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 13
		{
		sound BOS1_WALK
		ifpdistl 4096 quake 6
		set INTERNALCOUNT 0
		}
	
	ifcansee
	{
		ifpdistl 1280
		{
			ai AI_MAMANO_BITE
			break
		}
		else
		ifpdistl 8192
		 ifrnd 16
			ai AI_MAMANO_POUND
	}
	else ifcount 30
	ife target -1 ai AI_MAMANO_SEEK
	
	ifpdistg 8192 ifrnd 1 ai AI_MAMANO_SEEK
	else
	ifcount 10
	ifnotmoving
	{
		ifrnd 128 ai AI_MAMANO_SEEK
		else
		ai AI_MAMANO_WAIT 
	}
	
	ifrnd 1 sound MAMANO_ROAM

ends

defstate MAMANOseekstate

	ifcount 60 
	{
	set INTERNALCOUNT 0
		ifcansee ai AI_MAMANO_CHARGE
		ifn target -1 ai AI_MAMANO_CHARGE
	}
	
	ifcount 10
	ifnotmoving
	{
		ifpdistl 8192 ifrnd 16 ai AI_MAMANO_POUND else
		ifrnd 32 ai AI_MAMANO_SEEK
	}
	
	ifrnd 1 sound MAMANO_ROAM

ends

defstate MAMANOwaitstate

	ifcount 5
	{
		ai AI_MAMANO_SEEK
	}

ends

defstate MAMANObitestate

	ifn target -1
	{
		ifg xydist2 1024 { ifmove STOP move RIPPER_SEARCHVEL geth } else
		move STOP geth
	}
	else
	{
		ifpdistg 1024 { ifmove STOP move RIPPER_SEARCHVEL faceplayer } else
		move STOP faceplayer
	}
	
	ifactioncount 3
	{
		resetactioncount
		ifn target -1 
		{
			ifg xydist2 1280 ai AI_MAMANO_CHARGE
			shoot 15729
		} 
		else
		ifpdistl 1280
		{
		ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 50
				wackplayer
				sound SWORD_CLASH
				ai AI_MAMANO_WAIT
				}
			else
			 shoot 15729
		}
			ifpdistg 1280 { cstat 257 ai AI_MAMANO_CHARGE }
	}


ends

useractor enemy MAMANOJUMP 750 A_MAMANO_STAND
	state monst_glow
	ai AI_MAMANO_SEEK 
	sound MAMANO_ALERT 
	spawn SHOOTME 
	sizeat 25 25
	cstat 257 
	cactor MAMANO 
enda

useractor enemy MAMANO 750 A_MAMANO_STAND

fall

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage


  ifai AI_MAMANO_FROZEN
  {
state frozen_code
  }

ifai 0
{
	state monst_glow
	sound MAMANO_ALERT
	spawn SHOOTME
	ifrnd 128 ai AI_MAMANO_CHARGE
	ifg SKILL_LEVEL 2
		{
		geta[].htflags temp
		orvar temp SFLAG_NODAMAGEPUSH
		seta[].htflags temp
		}
	sizeat 25 25
	strength 750
	cstat 257
}

ifai AI_MAMANO_DYING { state MAMANOdyingstate break }

ifai AI_MAMANO_SHRUNK state MAMANOshrunkstate else
ifai AI_MAMANO_CHARGE state MAMANOchargestate else
ifai AI_MAMANO_SEEK state MAMANOseekstate else
ifai AI_MAMANO_WAIT state MAMANOwaitstate else
ifai AI_MAMANO_BITE state MAMANObitestate else
ifai AI_MAMANO_POUND state MAMANOpoundstate

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AI_MAMANO_SHRUNK
      break
    }
    ifrnd 32 sound MAMANO_PAIN
	guts JIBS6 1
    state random_wall_jibs
	ifdead
	{
	stopactorsound THISACTOR MAMANO_PAIN
		ifg ICE_DAMAGE 0
		{
			sound SOMETHINGFROZE
	        spritepal 1
	        ai AI_MAMANO_FROZEN
	        strength 0
	        break
        }	
		spawn 16368
		guts JIBS6 5
		addkills 1
		state thegames_score

		ifrnd 128 cstat 0 else cstat 4
		ifstrength -100
		{
			state standard_jibs
			state monst_body_jibs
			// state randsquishsound
			sound SQUISHED
			killit
		}
		sound MAMANO_DYING
		ai AI_MAMANO_DYING
	}
}
	
state checksquished

enda



// **************************************************************************************************
// GUARDIAN
// **************************************************************************************************

action A_GUARDIAN_IDLE 0 1 5 1 20
action A_GUARDIAN_WALK 0 4 5 1 20
action A_GUARDIAN_RUN 0 4 5 1 6
action A_GUARDIAN_SLASH 20 3 5 1 16
action A_GUARDIAN_PREP_BLAST 35 1 5 1 20
action A_GUARDIAN_BLAST 40 1 5 1 16
action A_GUARDIAN_FLINCH 45 1 1 1 12 

action A_GUARDIAN_DYING 45 9 1 1 16
action A_GUARDIAN_DEAD 53 1 1 1
action A_GUARDIAN_HEADSHOT_DYING 54 6 1 1 16
action A_GUARDIAN_HEADSHOT_DEAD 59 1 1 1
action A_GUARDIAN_SLICED_DYING 60 6 1 1 20
action A_GUARDIAN_SLICED_DEAD 65 1 1 1

move GUARDIAN_WALKVELS 120
move GUARDIAN_RUSHVELS 280

ai AI_GUARDIAN_SEEK A_GUARDIAN_WALK GUARDIAN_WALKVELS seekplayer
ai AI_GUARDIAN_RUSH A_GUARDIAN_RUN GUARDIAN_RUSHVELS seekplayer faceplayer
ai AI_GUARDIAN_DISTANCE A_GUARDIAN_RUN GUARDIAN_RUSHVELS fleeenemy
ai AI_GUARDIAN_DODGE A_GUARDIAN_RUN GUARDIAN_RUSHVELS dodgebullet
ai AI_GUARDIAN_CHOP A_GUARDIAN_SLASH STOP faceplayer
ai AI_GUARDIAN_PREP_BLAST A_GUARDIAN_PREP_BLAST STOP seekplayer
ai AI_GUARDIAN_BLAST A_GUARDIAN_BLAST STOP faceplayer
ai AI_GUARDIAN_FROZEN A_GUARDIAN_FLINCH STOP faceplayer
ai AI_GUARDIAN_GROW A_GUARDIAN_FLINCH STOP faceplayer
ai AI_GUARDIAN_SHRUNK A_GUARDIAN_RUN GUARDIAN_WALKVELS fleeenemy

ai AI_GUARDIAN_DYING A_GUARDIAN_DYING STOP faceplayer
ai AI_GUARDIAN_HEADSHOT_DYING A_GUARDIAN_HEADSHOT_DYING STOP faceplayer
ai AI_GUARDIAN_SLICED_DYING A_GUARDIAN_SLICED_DYING STOP faceplayer

useractor enemystayput GUARDIANSTAYPUT 250 A_GUARDIAN_IDLE
ifai 0
	{
	state monst_glow
	cstat 257
	ifspritepal 36 { strength 500 sizeat 50 50 } else
	{ strength 250 sizeat 40 40 }
	ifspritepal 0 spritepal 11
	spawn SHOOTME
	sound GUARDIAN_ALERT
	ai AI_GUARDIAN_SEEK
	cactor GUARDIAN
	}
enda

useractor enemy GUARDIAN 250 A_GUARDIAN_IDLE
fall

state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

ifai 0
	{
	state monst_glow
	cstat 257
	ifspritepal 36 { strength 500 sizeat 50 50 } else
	{ strength 250 sizeat 40 40 }
	ifspritepal 0 spritepal 11
	spawn SHOOTME
	sound GUARDIAN_ALERT
	ai AI_GUARDIAN_SEEK
	}
	
ifai AI_GUARDIAN_FROZEN
{
move 0
state frozen_code
}
else
ifaction A_GUARDIAN_FLINCH
{
move 0
sub PAIN_AMOUNT 1
ife PAIN_AMOUNT 0 ai AI_GUARDIAN_SEEK
}
else
ifaction A_GUARDIAN_DEAD
{
strength 0
move 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
	  ifrnd 64 spawn GOROHEADSPRITE
        state squish_sounds
		state monst_body_jibs
        state standard_jibs
        killit
      }
      break
    }

}
else
ifai AI_GUARDIAN_DYING
{
move 0
	ifactioncount 7 state BODY_FALL_NOISES
	ifactioncount 9 { state BODY_FALL_NOISES spawn 16368 state rf action A_GUARDIAN_DEAD }
}
else
ifaction A_GUARDIAN_HEADSHOT_DEAD
{
strength 0
move 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
		state monst_body_jibs
        state standard_jibs
        killit
      }
      break
    }

}
else
ifai AI_GUARDIAN_HEADSHOT_DYING
{
move 0
ifactioncount 6 { state BODY_FALL_NOISES spawn 16368 cstat 0 action A_GUARDIAN_HEADSHOT_DEAD }
}
else
ifaction A_GUARDIAN_SLICED_DEAD
{
strength 0
move 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
	  state SKILL_LEVELADJUST
	  ifl RANDOM_CHANCE SKILLCHANCE spawn GOROHEADSPRITE
        state squish_sounds
		state monst_body_jibs
        state standard_jibs
        killit
      }
      break
    }

}
else
ifai AI_GUARDIAN_SLICED_DYING
{
move 0
ifactioncount 6 { state BODY_FALL_NOISES spawn 16368 action A_GUARDIAN_SLICED_DEAD }
}
else
ifai AI_GUARDIAN_GROW
state genericgrowcode
else
ifai AI_GUARDIAN_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_GUARDIAN_SEEK
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 40 40
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AI_GUARDIAN_DODGE
	{
	ifpdistl 1536 ifcanseetarget ai AI_GUARDIAN_CHOP
	else
	 ifrnd 32 
	  ifcanseetarget 
	  ai AI_GUARDIAN_SEEK
	
	ifrnd 1 sound GUARDIAN_ROAM
	}
else
ifai AI_GUARDIAN_SEEK
	{
	state enemyfindtarget
	ifpdistl 1536 ifcanseetarget ai AI_GUARDIAN_CHOP
	else
	ifbulletnear ifrnd 128 ai AI_GUARDIAN_DODGE
	else
	ifpdistl 8192
	 ifrnd 32 
	  ifcanseetarget 
	  ai AI_GUARDIAN_RUSH
	else
		ifcanshoottarget ifrnd 4 ai AI_GUARDIAN_PREP_BLAST
	
	ifrnd 1 sound GUARDIAN_ROAM
	}
else
ifai AI_GUARDIAN_RUSH
	{
	state enemyfindtarget
	ifrnd 1 sound GUARDIAN_ROAM
	ifpdistl 1536 ifcanseetarget ai AI_GUARDIAN_CHOP
	else ifpdistg 1536 ifcanshoottarget ifrnd 4 ai AI_GUARDIAN_PREP_BLAST
	else ifrnd 16 ai AI_GUARDIAN_SEEK
	}
else
ifai AI_GUARDIAN_CHOP
	{
	ifactioncount 1 soundonce GUARDIAN_SWING
	 ifactioncount 3
		{
		ifpdistl 1536
			{
			ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 40
				wackplayer
				sound SWORD_CLASH
				set PAIN_AMOUNT 16
				action A_GUARDIAN_FLINCH
				break
				}
			else
				shoot 17849
			}
		ai AI_GUARDIAN_RUSH
		}
	}
else
ifai AI_GUARDIAN_PREP_BLAST
	{
	ifpdistl 1536 ai AI_GUARDIAN_CHOP
	 ifactioncount 2
		{
		ai AI_GUARDIAN_BLAST
		resetactioncount
		}
	}
else
ifai AI_GUARDIAN_BLAST
	{
	state enemyfindtarget
	ife target -1 ai AI_GUARDIAN_SEEK
	 ifactioncount 1
		{
		ifcanseetarget
		 {
		flash
		soundonce GUARDIAN_FLAME
		
		ldist TEMP THISACTOR target
        geta[].z TEMP2
        sub TEMP2 4096 // Offset the Z. Assumes the center of the actor is the same as the player
        geta[target].z TEMP3
        sub TEMP3 TEMP2
        shiftvarl TEMP3 9
        divvarvar TEMP3 TEMP
		
		getactorvar[target].IS_PLAYER TEMP2
		ife TEMP2 1 // use built in auto-zaim if shooting at the player
		{
		setprojectile[GORO_FLAME].OFFSET -224
		geta[].z TEMP sub TEMP 3072 seta[].z TEMP
		shoot GORO_FLAME setprojectile[GORO_FLAME].OFFSET -128
		shoot GORO_FLAME setprojectile[GORO_FLAME].OFFSET 224
		geta[].z TEMP add TEMP 3072 seta[].z TEMP
		}
		else
		{
		setprojectile[GORO_FLAME].workslike 36866
		setprojectile[GORO_FLAME].OFFSET -224
		ezshoot TEMP3 GORO_FLAME geta[RETURN].z TEMP sub TEMP 3072 seta[RETURN].z TEMP
		setprojectile[GORO_FLAME].OFFSET -128
		ezshoot TEMP3 GORO_FLAME geta[RETURN].z TEMP sub TEMP 3072 seta[RETURN].z TEMP
		setprojectile[GORO_FLAME].OFFSET 224
		setprojectile[GORO_FLAME].workslike 32770
		}
		

		ifrnd 32 ai AI_GUARDIAN_SEEK
		}
		else ai AI_GUARDIAN_SEEK
		resetactioncount
		}
	}
	
ifhitweapon
{
	ifai AI_GUARDIAN_DYING break
	ifai AI_GUARDIAN_HEADSHOT_DYING break
	state NEWGUNEFFECTS
	//spawn BLOOD
    guts JIBS6 1
	ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AI_GUARDIAN_SHRUNK
      break
    }
	guts JIBS6 1
    state random_wall_jibs
	ifdead
		{
		
		geta[].htpicnum BULLET_HIT_TYPE
		ifand tiledata[BULLET_HIT_TYPE].gameflags 8 getprojectile[BULLET_HIT_TYPE].userdata PROJ_UDATA else set PROJ_UDATA 0
		
			addkills 1
			state thegames_score
			ifg ICE_DAMAGE 0
			{
				sound SOMETHINGFROZE
				spritepal 1
				ai AI_GUARDIAN_FROZEN
				strength 0
				break
			}	
			else
			ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_GUARDIAN_GROW resetcount break }
		else ifand PROJ_UDATA 8 // sliced
		{ ifrnd 32 state trigger_showoff set FIRE_DAMAGE 0 cstat 4 sound SLASHDIE ai AI_GUARDIAN_SLICED_DYING } 
		  else
		  ifwasweapon RADIUSEXPLOSION
			  {
				ifrnd 64 spawn GOROHEADSPRITE
				state standard_jibs
				state monst_body_jibs
				// state randsquishsound
				spawn 16368
				sound SQUISHED
				killit
			  }
		else
		ife HEADSHOT 2 
			{ 
			cstat 0 
			ifrnd 32 state trigger_showoff 
			sound DECAPITATE 
			state jib_sounds
			ai AI_GUARDIAN_HEADSHOT_DYING shoot NJIB shoot NJIB guts JIBS6 3 guts JIBS2 2 
			} 
			else
			{
			cstat 0
			ai AI_GUARDIAN_DYING
			sound GUARDIAN_DIE
			}
			guts JIBS6 5
		}
	else
	ifg PAIN_AMOUNT 0 action A_GUARDIAN_FLINCH else
	ifrnd 16 { soundonce GUARDIAN_PAIN state PAIN_SKILL_LEVELADJUST set PAIN_AMOUNT 5 action A_GUARDIAN_FLINCH }
}
	
state checksquished
	
enda

// ##############################################################################################################################################################
// SERPENT GOD
// ##############################################################################################################################################################

// SERPENT GOD RING OF SKULLS===============================================================================================================

useractor notenemy 16764

ifaction 0
{
sizeat 32 32
seta[].shade -64
cstator 129
action ZERO
}

ifaction ZERO
{
geta[myowner].x TEMP
geta[myowner].y TEMP2

set TEMP3 TEMP
add TEMP3 2048
ife INTERNALCOUNT 0
	{
	add TEMP7 16
	ifg TEMP7 512
	set INTERNALCOUNT 1
	}
else
ife INTERNALCOUNT 1
	{
	sub TEMP7 16
	ifl TEMP7 16
	set INTERNALCOUNT 0
	}
add TEMP3 TEMP7

rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

add TEMP4 32

ifg TEMP4 2048 sub TEMP4 2048

seta[].x TEMP5 
seta[].y TEMP6
getp[].posz TEMP8
sub TEMP8 2048
seta[].z TEMP8

ifl sprite[myowner].extra 1
	{
	soundonce EXPLOSION_SMALL
	spawn GORO_FLAME_EX
	killit
	}

add INTERNALCOUNT_2 1
ifg INTERNALCOUNT_2 130
	{
	ifrnd 32
	ifcansee
		{
		sound SERPGOD_HEADS
		action BREAK
		}
	set INTERNALCOUNT_2 0
	}
	
}

ifaction FORM
	{
	move FLYFORWARD geth getv
		add INTERNALCOUNT 1
		ifg INTERNALCOUNT 10
		{
		findnearactor3d SERPENT_GOD 1024 target
		ifn target -1
			dist TEMP4 THISACTOR target
			ifl TEMP4 1500
				{
				spawn EXPLOSION2
				hitradius 2048 200 350 500 500
				soundonce EXPLOSION_LARGE
				spawn GORO_FLAME_EX
				killit
				}
		}

		ifg INTERNALCOUNT 200
			 {
			hitradius 512 10 15 20 25
			soundonce EXPLOSION_SMALL
			spawn GORO_FLAME_EX
			killit
			 }
	}

ifaction BREAK
	{
	move FLYFORWARD geth getv faceplayer
	ifpdistl 1536
		{
		 ifn SWORD_BLOCK 0
			 {
			 ifp pfacing
				 {
				 seta[].ang player[].ang
				 move FLYFORWARD geth getv
				 set INTERNALCOUNT 0
				 set TEMP4 2000
				 action FORM
				 }
			 else
				{
				soundonce EXPLOSION_SMALL
				spawn GORO_FLAME_EX
				killit
				}
			 }
		 else
			 {
			spawn EXPLOSION2
			hitradius 2048 10 15 20 25
			soundonce EXPLOSION_MEDIUM
			spawn GORO_FLAME_EX
			killit
			 }
		}
		add INTERNALCOUNT 1
		ifg INTERNALCOUNT 200
			 {
			hitradius 512 10 15 20 25
			soundonce EXPLOSION_SMALL
			spawn GORO_FLAME_EX
			killit
			 }
	}

enda

action ASG_IDLE 0 1 5 1 10
action ASG_MOVE 0 4 5 1 20
action ASG_RUSH 0 4 5 1 10
action ASG_CHOP 20 5 5 1 12
action ASG_BLAST 45 4 5 1 12
action ASG_DYING 65 10 1 1 20
action ASG_DEAD 74 1 1 1 10

move SERP_MOVE 140 0
move SERP_RUSH 260 0

ai AI_SG_IDLE ASG_IDLE STOP faceplayer
ai AI_SG_MOVE ASG_MOVE SERP_MOVE seekplayer
ai AI_SG_RUSH ASG_RUSH SERP_RUSH seekplayer
ai AI_SG_CHOP ASG_CHOP STOP faceplayer
ai AI_SG_BLAST ASG_BLAST STOP seekplayer
ai AI_SG_MAGIC ASG_BLAST STOP seekplayer
ai AI_SG_DYING ASG_DYING STOP faceplayer

spriteflags SERPENT_GOD NORMAL_ENEMY_TRU

useractor enemy SERPENT_GOD 5000 ASG_IDLE
fall

ifai 0
	{
	state monst_glow
	cstat 257
	strength 8000 
	sizeat 140 140
	spawn SHOOTME
	set CURBOSS THISACTOR
	set BOSS_TYPE 6
	sound SERPGOD_ALERT
	
				spawn 16764
				espawn 16764 setactorvar[RETURN].TEMP4 205
				espawn 16764 setactorvar[RETURN].TEMP4 510
				espawn 16764 setactorvar[RETURN].TEMP4 715
				espawn 16764 setactorvar[RETURN].TEMP4 920
				espawn 16764 setactorvar[RETURN].TEMP4 1125
				espawn 16764 setactorvar[RETURN].TEMP4 1330
				espawn 16764 setactorvar[RETURN].TEMP4 1535
				espawn 16764 setactorvar[RETURN].TEMP4 1740
				espawn 16764 setactorvar[RETURN].TEMP4 1945
	
	ai AI_SG_MOVE
	}
	
ifaction ASG_DEAD
	{
	move STOP
	}
else
ifai AI_SG_DYING
	{
	quake 52
	ifactioncount 10
		{
		ifn HITAGSAVED 0
			{
			operateactivators HITAGSAVED THISACTOR
			operaterespawns HITAGSAVED
			operatemasterswitches HITAGSAVED
			}
		action ASG_DEAD
		}
	}
else
ifai AI_SG_MOVE
	{
	ifrnd 2 soundonce SERPGOD_TAUNT
	
	ifpdistl 16000
	 ifcansee
	{
	state SKILL_SHOOT_LEVELADJUST
	 ifl RANDOM_CHANCE SKILLCHANCE 
	ai AI_SG_RUSH
	}
	else
	ifrnd 64
	 ifcansee
	  ifcanshoottarget
		{
		state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE 
		ai AI_SG_BLAST
		}
	
	}
else
ifai AI_SG_RUSH
	{
	ifrnd 2 soundonce SERPGOD_TAUNT
	
	ifpdistl 1536
	 ifcansee
	{
	ai AI_SG_CHOP
	}
	else
	ifrnd 32
	 ifcansee
	  ifcanshoottarget
		{
		state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE 
		ai AI_SG_BLAST
		}
	else ifrnd 4 ai AI_SG_MOVE
	
	}
else
ifai AI_SG_CHOP
	{
	ifpdistg 1535 { ai AI_SG_MOVE resetactioncount }
	ifactioncount 4
		{
		resetactioncount
		ai AI_SG_MOVE
		}
	ifactioncount 3
		{
		sound GUARDIAN_SWING
			ifn SWORD_BLOCK 0 
			 ifp pfacing
				{
				shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
				sub SPRINTING 60
				wackplayer
				sound SWORD_CLASH
				set PAIN_AMOUNT 16
				action A_GUARDIAN_FLINCH
				break
				}
			else
				{
				addphealth -60
				wackplayer 
				sound GUARDIAN_HIT
				palfrom 40 40
				}
		}
	}
else
ifai AI_SG_BLAST
	{
	state enemyfindtarget
	ifactioncount 4
		{
		resetactioncount
		ai AI_SG_MOVE
		}
	ifactioncount 3
		{
		sound SERPGOD_MAGIC
		ldist TEMP THISACTOR target
        geta[].z TEMP2
        sub TEMP2 4096 // Offset the Z. Assumes the center of the actor is the same as the player
        geta[target].z TEMP3
        sub TEMP3 TEMP2
        shiftvarl TEMP3 9
        divvarvar TEMP3 TEMP
		
		getactorvar[target].IS_PLAYER TEMP2
		ife TEMP2 1 // use built in auto-zaim if shooting at the player
			{
			setprojectile[GORO_FLAME].OFFSET -296
			geta[].z TEMP sub TEMP 3072 seta[].z TEMP
			setprojectile[GORO_FLAME].xrepeat 20
			setprojectile[GORO_FLAME].yrepeat 20
			eshoot GORO_FLAME 
			setthisprojectile[RETURN].pal 8 
			setthisprojectile[RETURN].extra 40
			setprojectile[GORO_FLAME].OFFSET -64
			eshoot GORO_FLAME 
			setprojectile[GORO_FLAME].xrepeat 6
			setprojectile[GORO_FLAME].yrepeat 6
			setthisprojectile[RETURN].pal 8 
			setthisprojectile[RETURN].extra 40
			setprojectile[GORO_FLAME].OFFSET 224
			geta[].z TEMP add TEMP 3072 seta[].z TEMP
			}
		else
			{
			setprojectile[GORO_FLAME].workslike 36866
			setprojectile[GORO_FLAME].OFFSET -224
			setprojectile[GORO_FLAME].xrepeat 20
			setprojectile[GORO_FLAME].yrepeat 20
			ezshoot TEMP3 GORO_FLAME geta[RETURN].z TEMP sub TEMP 3072 seta[RETURN].z TEMP
			setthisprojectile[RETURN].pal 8 
			setthisprojectile[RETURN].extra 40
			setprojectile[GORO_FLAME].OFFSET -128
			ezshoot TEMP3 GORO_FLAME geta[RETURN].z TEMP sub TEMP 3072 seta[RETURN].z TEMP
			setthisprojectile[RETURN].pal 8 
			setprojectile[GORO_FLAME].xrepeat 6
			setprojectile[GORO_FLAME].yrepeat 6
			setthisprojectile[RETURN].extra 40
			setprojectile[GORO_FLAME].OFFSET 224
			setprojectile[GORO_FLAME].workslike 32770
			}
		}
	}
else
ifai AI_SG_MAGIC
	{
	ifactioncount 4
		{
		resetactioncount
		ai AI_SG_MOVE
		}
	ifactioncount 3
	 ifn INTERNALCOUNT 0
		{
		globalsound USE_PORTAL 
		palfrom 64 64 64 64
		operateactivators INTERNALCOUNT THISACTOR
		operaterespawns INTERNALCOUNT
		operatemasterswitches INTERNALCOUNT
		
				spawn 16764
				espawn 16764 setactorvar[RETURN].TEMP4 205
				espawn 16764 setactorvar[RETURN].TEMP4 510
				espawn 16764 setactorvar[RETURN].TEMP4 715
				espawn 16764 setactorvar[RETURN].TEMP4 920
				espawn 16764 setactorvar[RETURN].TEMP4 1125
				espawn 16764 setactorvar[RETURN].TEMP4 1330
				espawn 16764 setactorvar[RETURN].TEMP4 1535
				espawn 16764 setactorvar[RETURN].TEMP4 1740
				espawn 16764 setactorvar[RETURN].TEMP4 1945
		
		set INTERNALCOUNT 0
		}
	}
	
	
ifhitweapon
{
	//spawn BLOOD
	guts JIBS6 1
    state random_wall_jibs
	
	ifstrength 6000 ifn XVELSAVED 0 
	{ 
	set INTERNALCOUNT XVELSAVED
	set XVELSAVED 0
	ai AI_SG_MAGIC
	}
	
	ifstrength 3000 ifn YVELSAVED 0 
	{ 
	set INTERNALCOUNT YVELSAVED
	set YVELSAVED 0
	ai AI_SG_MAGIC
	}
	
	ifdead
		{
		geta[].htpicnum BULLET_HIT_TYPE
		ifand tiledata[BULLET_HIT_TYPE].gameflags 8 getprojectile[BULLET_HIT_TYPE].userdata TEMP4 else set TEMP4 0
		addkills 1
		state thegames_score
		ai AI_SG_DYING
		sound SERPGOD_SCREAM
		guts JIBS6 5
		}
	else
	ifrnd 16 soundonce SERPGOD_PAIN
}
	
enda

// ##############################################################################################################################################################
// PIG COP RIOT SHIELD
// ##############################################################################################################################################################

action APIG_RS_WALK     0  4 5 1 20
action APIG_RS_RUN      0  4 5 1 11
action APIG_RS_SHOOT    20 2 5 1 24

action APIG_RS_STAND    20 1 5 1 1

action APIG_RS_DYING    30 5 1 1 15
action APIG_RS_HIT      30 1 1 1 10
action APIG_RS_DEAD     35 1 1 1 1

action APIG_RS_FROZEN    30 1 1
action APIG_RS_GROW      30

ai AIPIG_RS_SEEKENEMY APIG_RS_WALK PIGWALKVELS seekplayer
ai AIPIG_RS_SHOOTENEMY APIG_RS_SHOOT STOP faceplayerslow
ai AIPIG_RS_FLEEENEMY APIG_RS_WALK PIGWALKVELS fleeenemy
ai AIPIG_RS_SHOOT APIG_RS_SHOOT STOP faceplayerslow
ai AIPIG_RS_DODGE APIG_RS_RUN PIGRUNVELS dodgebullet
ai AIPIG_RS_CHARGE APIG_RS_RUN PIGRUNVELS seekplayer
ai AIPIG_RS_DYING APIG_RS_DYING STOP faceplayer
ai AIPIG_RS_SHRINK APIG_RS_WALK SHRUNKVELS fleeenemy
ai AIPIG_RS_GROW APIG_RS_GROW STOP faceplayerslow
ai AIPIG_RS_HIT APIG_RS_HIT STOP faceplayer

defstate pig_rs_seekenemystate

  ifai AIPIG_RS_CHARGE
  {
  state correctcansee
    ife sightvar YES
	{
	state SKILL_SHOOT_LEVELADJUST
	ifl RANDOM_CHANCE SKILLCHANCE  ai AIPIG_RS_SHOOTENEMY
	}
  }
  else iffloordistl 32
  {
	state SKILL_SHOOT_LEVELADJUST
      ifl RANDOM_CHANCE SKILLCHANCE ai AIPIG_RS_SHOOTENEMY else ai AIPIG_RS_CHARGE

    ifrnd 8
    {
      ifbulletnear
        ai AIPIG_RS_DODGE
    }
  }
state correctcansee
  ifrnd 128
    ife sightvar YES
  {
    ifai AIPIG_RS_DODGE
    {
      ifcount 32
        ifrnd 128 ai AIPIG_RS_CHARGE else ai AIPIG_RS_SHOOTENEMY
          break
    }
    iffloordistl 32
    {
      ifcount 24
      {
        ifrnd 32
          ifp palive
        {
		state SKILL_SHOOT_LEVELADJUST
		  ifl RANDOM_CHANCE SKILLCHANCE ai AIPIG_RS_SHOOTENEMY
        }
      }
    }
  }
ends

defstate pig_rs_cop_shoot_stuff
		state shooting_settings
sound PISTOL_FIRE
			ifn target -1
				{
				state SKILL_ENEMY_ACCURACY
				ife PERFMODE 1
				 ifcansee
					{
					set gunsmoke_z 7644 
					set gunsmoke_angle 256
					state spawn_gunsmoke_z
					set gunsmoke_z 5044
					espawn 16115
					state spawn_muzzleflash
					randvar TEMP 1024 
					zshoot TEMP 13772
					}
				ezshoot TEMP3 ZRIFLESHOT
				}
				else
				{
				state SKILL_ENEMY_ACCURACY
				ife PERFMODE 1
				 ifcansee
					{
					set gunsmoke_z 7644 
					set gunsmoke_angle 256
					state spawn_gunsmoke_z
					set gunsmoke_z 5044
					espawn 16115
					state spawn_muzzleflash
					randvar TEMP 1024 
					zshoot TEMP 13772
					}
				shoot ZRIFLESHOT
				}
ends

defstate pig_rs_shootenemystate
state correctcansee

ife sightvar YES
  {
    ifcount 6 nullop
    else
      ifcount 5
    {
	  state pig_rs_cop_shoot_stuff
    }
    ifcount 12 nullop
    else
      ifcount 11
    {
	state pig_rs_cop_shoot_stuff
    }
    ifcount 14
    {
      ifrnd 64
        resetcount
      else
      {
        ifpdistl 768
          ai AIPIG_RS_FLEEENEMY
        else
          ai AIPIG_RS_SEEKENEMY
      }
    }
  }
  else
    ai AIPIG_RS_SEEKENEMY
ends

defstate pig_rs_fleeenemystate
  ifactioncount 8
    ai AIPIG_RS_SEEKENEMY
  else
    ifnotmoving
      ai AIPIG_RS_SEEKENEMY
ends

defstate checkpig_rs_hitstate

state NEWGUNEFFECTS
seta[].xvel 0

  ifdead
  {
    state random_wall_jibs

	    addkills 1
	state thegames_score

    ifwasweapon GROWSPARK
    {
      sound ACTOR_GROWING
      ai AIPIG_RS_GROW
      break
    }
	else
    ifg ICE_DAMAGE 0
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action APIG_RS_FROZEN
      strength 0
      break
    }
	else
    ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
    else
      ifwasweapon RPG
    {
      state squish_sounds
      state standard_jibs
      killit
    }
	
	ifg FIRE_DAMAGE 0
		{
		sound ENGULF_FIRE
		spritepal 27
		spriteflags 5
		seta[].shade 20
		set PLAYER_VOICEOVER 21
		}
      ai AIPIG_RS_DYING
        ifrnd 128 sound PIG_DYING2 else sound PIG_DYING
  }
  else
  {
    sound PIG_PAIN
    state random_wall_jibs

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIPIG_RS_SHRINK
    }
    else
      ifwasweapon GROWSPARK
        sound EXPANDERHIT
	else
	 ifg PAIN_AMOUNT 0
		{
        ai AIPIG_RS_HIT
		}
    else
      ifrnd 32
		{
		state PAIN_SKILL_LEVELADJUST
        ai AIPIG_RS_HIT
		}
    else
      ifrnd 64
       { sizeat 40 40 ai AIPIG_RS_SHOOTENEMY }

  }
ends

defstate pig_rs_shrinkstate

	ifrnd 4
		{
		soundonce PIG_DYING
		setactorsoundpitch THISACTOR PIG_DYING 512
		}

  ifcount SHRUNKDONECOUNT
    ai AIPIG_RS_SEEKENEMY
  else
    ifcount SHRUNKCOUNT
	  {
      sizeto 48 40
	  sound ACTOR_UNSHRINK
	  }
  else
    state genericshrunkcode
ends

defstate pig_rs_dyingstate
cstat 0

ifspritepal 27 
	{ 
	ifrnd 8 { shoot SPARK espawn BIG_SMOKE seta[RETURN].pal 17 }
	seta[].shade 20
	}

  ifactioncount 5
  {
    ifrnd 64
      spawn BLOODPOOL
    state rf
    iffloordistl 8
      state BODY_FALL_NOISES
    action APIG_RS_DEAD
    move STOP
    break
  }
ends


useractor enemystayput PIGCOP_RIOTSHIELD_STAYPUT PIGCOPSTRENGTH
	state monst_glow
  ai AIPIG_RS_SEEKENEMY
  spawn SHOOTME
  sizeat 40 40
  cactor PIGCOP_RIOTSHIELD
enda

defstate pig_rs_DEADSTATE

ifspritepal 27 
	{ 
	ifrnd 8 { espawn BIG_SMOKE seta[RETURN].pal 17 }
	seta[].shade 20
	}

      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
        killit
      }
      break
ends

defstate pig_rs_cop_maincode
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

  state checksquished
  ifaction APIG_RS_STAND
    ai AIPIG_RS_SEEKENEMY
  else ifaction APIG_RS_DEAD state pig_rs_DEADSTATE
  else
    ifaction APIG_RS_FROZEN
  {
    ifcount THAWTIME
    {
      ai AIPIG_RS_SEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
        ifrnd 8
          spawn WATERDRIP

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      lotsofglass 20
      ifrnd 84 spawn BLOODPOOL
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else
    ifai AIPIG_RS_DYING
      state pig_rs_dyingstate
  else
    ifai AIPIG_RS_HIT
    {
	sub PAIN_AMOUNT 1
      ife PAIN_AMOUNT 0
      ai AIPIG_RS_SEEKENEMY
    }
  else
    ifai AIPIG_RS_SHRINK
      state pig_rs_shrinkstate
  else
  {
    ifai AIPIG_RS_SEEKENEMY
      state pig_rs_seekenemystate
    else
      ifai AIPIG_RS_DODGE
        state pig_rs_seekenemystate
    else
      ifai AIPIG_RS_SHOOTENEMY
        state pig_rs_shootenemystate
    else
      ifai AIPIG_RS_GROW
        state genericgrowcode
    else
      ifai AIPIG_RS_FLEEENEMY
        state pig_rs_fleeenemystate
    else
      ifai AIPIG_RS_CHARGE
        state pig_rs_seekenemystate
		
geta[].ang TEMP7
xorvar TEMP7 1024
geta[].htextra HIT_DAMAGE
		
	ifg HIT_DAMAGE 0 // if the actor is set to take some damage from a weapon...
	{
			geta[].htang TEMP3
			getincangle TEMP4 TEMP3 TEMP7			
			ifl TEMP4 250 // is angle between them less than 125?
				{
					ifrnd 128 sound SHIELDHIT2 else sound SHIELDHIT
					set TEMP5 HIT_DAMAGE
					divvar TEMP5 8
					seta[].xvel 0
					seta[].htextra TEMP5
					set HIT_DAMAGE 0
				}
				else
				guts JIBS6 2
				setvar HIT_DAMAGE 0
	}
		
    ifhitweapon
      state checkpig_rs_hitstate
    ifrnd 1
    {
	randvar TEMP 3
		ife TEMP 0 soundonce PIG_ROAM else
		ife TEMP 1 soundonce PIG_ROAM2 else
		ife TEMP 2 soundonce PIG_ROAM3 else
		ife TEMP 3 soundonce PIG_ROAM4 
    }
  }
ends

useractor enemy PIGCOP_RIOTSHIELD 
  fall
  
	ifaction 0 
		{ 
		state monst_glow
		globalsound PIG_RECOG
		spawn SHOOTME 
		spriteflags NORMAL_ENEMY_TRU
		cstat 257
		sizeat 40 40 
		strength PIGCOPSTRENGTH
		action APIG_RS_STAND
		}  

	state pig_rs_cop_maincode
enda

// **************************************************************************************************
// ZOMBIE PIGCOP
// **************************************************************************************************

action AZPIGWALK     0  4 5 1 20
action AZPIGRUN      0  4 5 1 11
action AZPIGSHOOT    25 2 5 1 24
action AZPIGCOCK     20 1 5 1 16
action AZPIGSTAND    20 1 5 1 1
action AZPIGDIVE     30 2 5 1 40
action AZPIGDIVESHOOT  35 2 5 1 24
action AZPIGDYING    45 5 1 1 15
action AZPIGHIT      45 1 1 1 10
action AZPIGDEAD     50 1 1 1 1
action AZPIGFROZEN    0 1 5
action AZPIGGROW      0

action AZPIGHEADDIE     51 5 1 1 15
action AZPIGHEADDEAD      56 1 1 1 1

ai AIZPIGSEEKENEMY AZPIGWALK PIGWALKVELS seekplayer
ai AIZPIGSHOOTENEMY AZPIGSHOOT STOP faceplayer
ai AIZPIGFLEEENEMY AZPIGWALK PIGWALKVELS fleeenemy
ai AIZPIGSHOOT AZPIGSHOOT STOP faceplayer
ai AIZPIGDODGE AZPIGRUN PIGRUNVELS dodgebullet
ai AIZPIGCHARGE AZPIGRUN PIGRUNVELS seekplayer
ai AIZPIGDIVING AZPIGDIVE STOP faceplayer
ai AIZPIGDYING AZPIGDYING STOP faceplayer
ai AIZPIGSHRINK AZPIGWALK SHRUNKVELS fleeenemy
ai AIZPIGGROW AZPIGGROW STOP faceplayerslow
ai AIZPIGHIT AZPIGHIT STOP faceplayer

ai AIZPIGHDYING AZPIGHEADDIE STOP faceplayer



state zpigseekenemystate
  ifai AIZPIGCHARGE
  {
  state correctcansee
    ife sightvar YES
	{
		ifpdistl 3084
		{
		  ifnotmoving
			ai AIZPIGSEEKENEMY
		  else
			ai AIZPIGDIVING
		}
		else 
		{
		state SKILL_SHOOT_LEVELADJUST
		ifl RANDOM_CHANCE SKILLCHANCE ai AIZPIGSHOOTENEMY
		}
	}
  }
  else iffloordistl 32
  {
    ifpdistg 4096
    {
	state SKILL_SHOOT_LEVELADJUST
      ifl RANDOM_CHANCE SKILLCHANCE ai AIZPIGSHOOTENEMY else ai AIZPIGCHARGE
    }
    ifrnd 8
    {
      ifbulletnear
        ai AIZPIGDODGE
    }
  }
state correctcansee
  ifrnd 128
    ife sightvar YES
  {
    ifai AIZPIGDODGE
    {
      ifcount 32
        ifrnd 128 ai AIZPIGCHARGE else ai AIZPIGSHOOTENEMY
          break
    }
    iffloordistl 32
    {
      ifcount 24
      {
        ifrnd 32
          ifp palive
        {
		state SKILL_SHOOT_LEVELADJUST
		  ifl RANDOM_CHANCE SKILLCHANCE ai AIZPIGSHOOTENEMY
          else
            ai AIZPIGDIVING
          break
        }
      }
    }
  }
ends

state zpigcop_shoot_stuff
		state shooting_settings
		 ifspritepal 13
			{
			sound EXPL_SHELL_FIRE
			shoot 9359
			}
			else
			{
        	sound GLOCKFIRE
			ifn target -1
				{
				ezshoot TEMP3 ZRIFLESHOT
				}
				else
				shoot ZRIFLESHOT
			}
			ife PERFMODE 1
			 ifcansee
			{
			set gunsmoke_z 7844 
			set gunsmoke_angle 400
			state spawn_gunsmoke_z
			ifaction AZPIGDIVESHOOT set gunsmoke_z 512
			else set gunsmoke_z 4644
			espawn 16114
			state spawn_muzzleflash
			}
ends


defstate zpigshootenemystate
state correctcansee

ife sightvar YES
  {
    ifcount 12 nullop
    else
      ifcount 11
    {
	  state zpigcop_shoot_stuff
    }
    ifcount 23 nullop
    else
      ifcount 22
    {
	  state zpigcop_shoot_stuff
    }
    ifcount 35 nullop
    else
      ifcount 34
    {
	  state zpigcop_shoot_stuff
    }
    ifcount 48 nullop
    else
      ifcount 47
    {
	state zpigcop_shoot_stuff
    }
    ifcount 58 nullop
    else
      ifcount 57
    {
	state zpigcop_shoot_stuff
    }
    ifcount 72
    {
      ifrnd 64
        resetcount
      else
      {
        ifpdistl 768
          ai AIZPIGFLEEENEMY
        else
          ai AIZPIGSEEKENEMY
      }
    }
    ifaction AZPIGCOCK
      ifactioncount 2
        action AZPIGSHOOT
  }
  else
    ai AIZPIGSEEKENEMY
ends

defstate zpigfleeenemystate
  ifactioncount 8
    ai AIZPIGSEEKENEMY
  else
    ifnotmoving
      ai AIZPIGSEEKENEMY
ends

defstate zpigdivestate
  ifaction AZPIGDIVESHOOT
  {
  sizeat 40 24
  state correctcansee
    ife sightvar YES
    {
      ifcount 6 nullop
      else
        ifcount 5
      {
	    state zpigcop_shoot_stuff
      }
      ifcount 18 nullop
      else
        ifcount 17
      {
		state zpigcop_shoot_stuff
      }
      ifcount 24 nullop
      else
        ifcount 23
      {
        ifgapzl 32
          ai AIZPIGDIVING
        else
        {
		sizeat 40 40
          ifpdistl 4096
            ai AIZPIGFLEEENEMY
          else
            ai AIZPIGSEEKENEMY
        }
      }
    }
    else
	 {
      ifgapzl 32
        ai AIZPIGDIVING
      else
        ai AIZPIGSEEKENEMY
	 sizeat 40 40
	}
  }
  else
    ifactioncount 2
    ifp palive
    {
	sizeat 40 24
      resetcount
      action AZPIGDIVESHOOT
    }
ends

state zcheckpighitstate

state NEWGUNEFFECTS

  ifdead
  {
    state random_wall_jibs
	  
	    addkills 1

    ifwasweapon GROWSPARK
    {
      sound ACTOR_GROWING
      ai AIZPIGGROW
      break
    }
	else
    ifg ICE_DAMAGE 0
    {
	ifaction AZPIGDIVESHOOT sizeat 40 40
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action AZPIGFROZEN
      strength 0
      break
    }
	else
    ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
      killit
    }
    else
      ifwasweapon RPG
    {
      state squish_sounds
      state standard_jibs
      killit
    }

      ife HEADSHOT 2
	   ifstrength -50
     {
	  ifrnd 32 state trigger_showoff
      sound DECAPITATE
      state jib_sounds
      guts JIBS6 4
      guts JIBS2 2
      guts JIBS5 1
	  ifaction AZPIGDIVESHOOT sizeat 40 40
      ai AIZPIGHDYING
     }
      else
	  {
	ifg FIRE_DAMAGE 0
		{
		sound ENGULF_FIRE
		spritepal 27
		spriteflags 5
		seta[].shade 20
		}
	 ifaction AZPIGDIVESHOOT sizeat 40 40
      ai AIZPIGDYING
        ifrnd 128 
			{  sound PIG_DYING2 setactorsoundpitch THISACTOR PIG_DYING2 -256 } else 
			{ sound PIG_DYING setactorsoundpitch THISACTOR PIG_DYING -256 }
		}
  }
  else
  {
    sound PIG_PAIN
    state random_wall_jibs
    ifrnd 64 guts JIBS6 1
    ifrnd 64 guts JIBS6 1

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIZPIGSHRINK
    }
    else
      ifwasweapon GROWSPARK
        sound EXPANDERHIT
	else
	 ifg PAIN_AMOUNT 0
		{
		ifaction AZPIGDIVE nullop else
		ifaction AZPIGDIVESHOOT nullop else
        ai AIZPIGHIT
		}
    else
      ifrnd 32
		{
		state PAIN_SKILL_LEVELADJUST
		ifaction AZPIGDIVE nullop else
		ifaction AZPIGDIVESHOOT nullop else
        ai AIZPIGHIT
		}
    else
      ifrnd 64
       { sizeat 40 40 ai AIZPIGSHOOTENEMY }
    else
      ifrnd 64
      {
        ai AIZPIGDIVING
		sizeat 40 24
        action AZPIGDIVESHOOT
      }
  }
ends

state zpigshrinkstate

	ifrnd 4
		{
		soundonce PIG_DYING
		setactorsoundpitch THISACTOR PIG_DYING 512
		}

  ifcount SHRUNKDONECOUNT
    ai AIZPIGSEEKENEMY
  else
    ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 48 40
	  }
  else
    state genericshrunkcode
ends

state zpigdyingstate
cstat 0

ifspritepal 27 
	{ 
	ifrnd 8 { shoot SPARK espawn BIG_SMOKE seta[RETURN].pal 17 }
	seta[].shade 20
	}

  ifactioncount 5
  {
    ifrnd 64
      spawn BLOODPOOL
    state rf
    iffloordistl 8
      state BODY_FALL_NOISES
    action AZPIGDEAD
    move STOP
    break
  }
ends

defstate zpighdyingstate
  ifactioncount 5
  {
    ifrnd 64
      spawn BLOODPOOL
      state rf
    iffloordistl 8
      state BODY_FALL_NOISES
   action AZPIGHEADDEAD
    move STOP
    break
  }
ends


useractor enemy ZPIGCOP_STAYPUT 150
  sizeat 40 40
	state monst_glow
	cstat 257
  ai AIZPIGSEEKENEMY
  spawn SHOOTME
  cactor ZPIGCOP
enda

defstate ZPIGDEADSTATE

ifspritepal 27 
	{ 
	ifrnd 8 { espawn BIG_SMOKE seta[RETURN].pal 17 }
	seta[].shade 20
	}

      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        state squish_sounds
        state standard_jibs
        killit
      }
      break
ends

state zpigcop_maincode
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

  state checksquished
  ifaction AZPIGSTAND
    ai AIZPIGSEEKENEMY
  else ifaction AZPIGDEAD state ZPIGDEADSTATE
  else ifaction AZPIGHEADDEAD state ZPIGDEADSTATE
  else
    ifaction AZPIGFROZEN
  {
    ifcount THAWTIME
    {
      ai AIZPIGSEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
        ifrnd 8
          spawn WATERDRIP

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
	  state thegames_score

      lotsofglass 20
      ifrnd 84 spawn BLOODPOOL
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
	  shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS shoot ICE_DEBRIS
      sound ICE_SMASH
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST ife MELEE_WEAPON_LOADOUT[CHAR] 0
        pkick
    break
  }
  else
    ifai AIZPIGDYING
      state zpigdyingstate
  else
    ifai AIZPIGHDYING
      state zpighdyingstate
  else
    ifai AIZPIGHIT
    {
	sub PAIN_AMOUNT 1
      ife PAIN_AMOUNT 0
      ai AIZPIGSEEKENEMY
    }
  else
    ifai AIZPIGSHRINK
      state zpigshrinkstate
  else
  {
    ifai AIZPIGSEEKENEMY
      state zpigseekenemystate
    else
      ifai AIZPIGDODGE
        state zpigseekenemystate
    else
      ifai AIZPIGSHOOTENEMY
        state zpigshootenemystate
    else
      ifai AIZPIGGROW
        state genericgrowcode
    else
      ifai AIZPIGFLEEENEMY
        state zpigfleeenemystate
    else
      ifai AIZPIGDIVING
        state zpigdivestate
    else
      ifai AIZPIGCHARGE
        state zpigseekenemystate
    ifhitweapon
      state zcheckpighitstate
    ifrnd 1
    {
	randvar TEMP 3
		ife TEMP 0 { soundonce PIG_ROAM setactorsoundpitch THISACTOR PIG_ROAM -512 } else
		ife TEMP 1 { soundonce PIG_ROAM2 setactorsoundpitch THISACTOR PIG_ROAM2 -512 } else
		ife TEMP 2 { soundonce PIG_ROAM3 setactorsoundpitch THISACTOR PIG_ROAM3 -512 } else
		ife TEMP 3 { soundonce PIG_ROAM4 setactorsoundpitch THISACTOR PIG_ROAM4 -512 }
    }
  }
ends

useractor enemy ZPIGCOP 150
  fall
  
	ifaction 0 
		{ 
		sizeat 40 40
		state monst_glow
		cstat 257
		soundonce PIG_RECOG
		setactorsoundpitch THISACTOR PIG_RECOG -512
		spawn SHOOTME 
		action AZPIGSTAND 
		}  
	
	state zpigcop_maincode
enda

// ************************************************************************************
// PARADIGM ESCHATON SENTRY BOT
// ************************************************************************************

action A_PESENTRY_FLOAT 0 1 5 1 10
action A_PESENTRY_SHOOT 0 2 5 1 5
action A_PESENTRY_DIE 10 6 1 1 15
action A_PESENTRY_FALL 13 1 1 1 10
action A_PESENTRY_DEAD 16 1 1 1 10

ai AI_PESENTRY_FLOAT A_PESENTRY_FLOAT MSORCERERFLOAT seekplayer
ai AI_PESENTRY_FLOATUP A_PESENTRY_FLOAT MSORCERERFLOATUP seekplayer getv
ai AI_PESENTRY_FLOATDOWN A_PESENTRY_FLOAT MSORCERERFLOATDOWN seekplayer getv
ai AI_PESENTRY_SHOOT A_PESENTRY_SHOOT STOP faceplayer
ai AI_PESENTRY_DYING A_PESENTRY_DIE STOP faceplayer

useractor enemy PE_SENTRY
//state ROBOT_DAMAGE_MODIFIER

ifai 0
{
state monst_glow
spawn SHOOTME
strength 750
sizeat 30 30
spriteflags ROBOT_ENEMY
action A_PESENTRY_FLOAT
ai AI_PESENTRY_FLOAT
ifrnd 64 soundonce PES_ONLINE1
else ifrnd 64 soundonce PES_ONLINE2
set TEMP8 0 // weapon heat
set TEMP9 10 // heat sinks
cstat 257
}

state check_metal_squished

ifdead nullop else 
{
soundonce COMM_AMB
state getfloordist_sbs
ifl z 32
state smokering

ifstrength 100
 ifrnd 32
	{
	sound SHORT_CIRCUIT
	shoot SPARK shoot SPARK
	ifrnd 8 soundonce PES_CRITICALD
	}
	
	ifai AI_PESENTRY_SHOOT nullop else sub TEMP8 1
	
	ifg TEMP8 100
	 ifrnd 96
		{
		espawn 18360
		geta[].z TEMP7
		sub TEMP7 512
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 256
		geta[].ang TEMP4
		sub TEMP4 512
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		seta[RETURN].z TEMP7
		espawn 18360
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 256
		geta[].ang TEMP4
		add TEMP4 512
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		seta[RETURN].z TEMP7
		}

}

ifaction A_PESENTRY_DEAD
{
fall
cstat 256

 ifhitweapon
  {
  sound HITMETAL
	  ifdead
	  {
	  sound VENT_BUST
	  debris SCRAP1 3           
	  debris SCRAP2 3           
	  debris SCRAP5 3
	  killit
	  }
  }

}
else
ifaction A_PESENTRY_FALL
{
fall
	state getfloordist
	ifl z 16
	{
	quake 13
	soundonce CARSMASH
	action A_PESENTRY_DEAD
	set PLAYER_VOICEOVER 33
	}
	
	ifrnd 160
		{
		espawn 14040
		geta[].x TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].x TEMP
		
		geta[].y TEMP
		randvar TEMP2 128
		ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
		seta[RETURN].y TEMP
		
		geta[].z TEMP
		sub TEMP 4096
		randvar TEMP2 2048
		sub TEMP TEMP2
		seta[RETURN].z TEMP
		}
	
}
else
ifai AI_PESENTRY_DYING
{
stopactorsound THISACTOR COMM_AMB
cstat 0
fall
state getfloordist
ifactioncount 4 
{ ifl z 16 nullop else action A_PESENTRY_FALL }
ifactioncount 5 soundonce CARSMASH
ifactioncount 6 { quake 13 action A_PESENTRY_DEAD set PLAYER_VOICEOVER 33 }


	add TEMP6 1
	ifg TEMP6 4
		{
		espawn EXPLOSION2
		sound RPG_EXPLODE
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 512
		randvar TEMP4 2048
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set TEMP6 0
		}

}
else
ifai AI_PESENTRY_FLOAT
{
 ifcanseetarget
  ifcanshoottarget
  ifrnd 4
  {
   ai AI_PESENTRY_SHOOT
   }
   
   state getfloordist
   ifl z 0 seta[].z sector[].floorz

ifrnd 128
	{
	geta[].z z
	 ifl player[].posz z ai AI_PESENTRY_FLOATUP
      else
		ifg player[].posz z ai AI_PESENTRY_FLOATDOWN
	}
}
else
ifai AI_PESENTRY_FLOATUP
{
state thisactor_getzrange
 ifcanseetarget
  ifcanshoottarget
  ifrnd 8
  {
   ai AI_PESENTRY_SHOOT
   }
	else
ifrnd 16 ai AI_PESENTRY_FLOAT
}
else
ifai AI_PESENTRY_FLOATDOWN
{
state thisactor_getzrange
 ifcanseetarget
  ifcanshoottarget
  ifrnd 8
  {
   ai AI_PESENTRY_SHOOT
   }
   else
ifrnd 16 ai AI_PESENTRY_FLOAT

state getfloordist
ifl z 5
	ai AI_PESENTRY_FLOAT

}
else
ifai AI_PESENTRY_SHOOT
{
ifg TEMP8 175
	{
	soundonce PES_OVERHEAT
	ifg TEMP9 0
		{
		sub TEMP9 1
		soundonce HEAT_SINK_EJECT
		shoot HEAT_SINK
		set TEMP8 0
		}
	ai AI_PESENTRY_FLOAT
	}
	else
ifactioncount 2 
	{ 
	ifcansee ifcanshoottarget 
		{
		randvar TEMP7 10
		add TEMP8 TEMP7
		add TEMP8 5
		sound PES_SHOOT
		setprojectile[MDF_PLASMA].extra 3
		setprojectile[MDF_PLASMA].extra_rand 2
		eshoot MDF_PLASMA
		setthisprojectile[RETURN].pal 2
		setthisprojectile[RETURN].vel 300
		setthisprojectile[RETURN].spawns BIG_SMOKE
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 128
		geta[].ang TEMP4
		sub TEMP4 512
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		eshoot MDF_PLASMA
		setprojectile[MDF_PLASMA].extra 15
		setprojectile[MDF_PLASMA].extra_rand 25
		setthisprojectile[RETURN].pal 2
		setthisprojectile[RETURN].vel 300
		setthisprojectile[RETURN].spawns BIG_SMOKE
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 128
		geta[].ang TEMP4
		add TEMP4 512
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		}
	resetactioncount 
	}
ifrnd 2 ai AI_PESENTRY_FLOAT
}

ifhitweapon
{
shoot SPARK
	ifwasweapon RPG seta[].xvel 0
	ifwasweapon RADIUSEXPLOSION seta[].xvel 0
ifdead 
	{
	sound PES_DEAD
	spawn 8433
	quake 13
	flash
	spawn BIG_EXPLOSION
	sound EXPLOSION_BIG
	shoot SPARK shoot SPARK
	move STOP
	addkills 1
	state thegames_score
	debris SCRAP2 10
	ai AI_PESENTRY_DYING
	}
}

enda

// ******************************************************************************
// GHOST SHIP BIG FUCKING BOSS
// ******************************************************************************

defstate disappear_when_triggered
checkactivatormotion LOTAGSAVED
ife RETURN 1 killit
ends

defstate appear_when_triggered
state disappear_when_triggered
ifaction 0
{
cstat 32768
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	seta[].cstat CSTATSAVED
	action BREAK
	}
}
ends

defstate tentacle_joint
state appear_when_triggered
ifaction BREAK
{
sizeto 64 64
ifcount 30 { action ZERO  resetcount }
}
ifaction ZERO
{
sizeto 65 65
ifcount 30 { action BREAK resetcount }
}
ends

useractor notenemy 17367 state appear_when_triggered enda
useractor notenemy 17373 state appear_when_triggered enda

useractor notenemy 17376 state tentacle_joint enda
useractor notenemy 17377 state tentacle_joint enda
useractor notenemy 17378 state tentacle_joint enda
useractor notenemy 17379 state tentacle_joint enda
useractor notenemy 17380 state tentacle_joint enda
useractor notenemy 17381 state tentacle_joint enda
useractor notenemy 17382 state tentacle_joint enda


useractor notenemy 17368
state appear_when_triggered
ifaction BREAK
{
sizeto 64 64
ifcount 30 { action ZERO resetcount }
}
ifaction ZERO
{
sizeto 64 66
ifcount 30 { action BREAK resetcount }
}

enda

useractor notenemy 17369 // head
state appear_when_triggered

ifaction 0 nullop else
{
	ifl HUGE_BOSS_HEALTH 500 action ONE
	ife TEMP6 0
	{
	geta[].z TEMP
	add TEMP 32
	seta[].z TEMP
	ifcount 30 { set TEMP6 1 resetcount }
	}
	ife TEMP6 1
	{
	geta[].z TEMP
	sub TEMP 32
	seta[].z TEMP
	ifcount 30 { set TEMP6 0 resetcount }
	}
}

enda

action ROAR 0

useractor notenemy 17371 // jaw
state appear_when_triggered
ifaction BREAK
{
geta[].z TEMP
add TEMP 32
seta[].z TEMP
ifcount 30 { action ZERO  resetcount }
ifrnd 2 ife camerasprite -1 { action ROAR set INTERNALCOUNT 0 globalsound GSHIP_BOSS_SCREAM }
}
ifaction ZERO
{
geta[].z TEMP
sub TEMP 32
seta[].z TEMP
ifcount 30 { action BREAK resetcount }
}
ifaction ROAR
{
	add INTERNALCOUNT 1
	ifl INTERNALCOUNT 31
	{
	geta[].z TEMP
	add TEMP 128
	seta[].z TEMP
	quake 256
	}
	ifg INTERNALCOUNT 40
	{
	sub SHIP_INTEGRITY 1
	geta[].z TEMP
	sub TEMP 64
	seta[].z TEMP
	}
	ifg INTERNALCOUNT 60
	{
	seta[].z TEMP5
	set INTERNALCOUNT 0
	action BREAK
	}

}

enda

useractor notenemy 16618 // Pulse battery computer

ifaction 0
	{
	ifand TEMP2 1 nullop else 
		{
		checkactivatormotion HITAGSAVED
		ife RETURN 1 xorvar TEMP2 1
		}	
	ifand TEMP2 2 nullop else 
		{
		checkactivatormotion LOTAGSAVED
		ife RETURN 1 xorvar TEMP2 2
		}		
	ifand TEMP2 4 nullop else 
		{
		checkactivatormotion XVELSAVED
		ife RETURN 1 xorvar TEMP2 4
		}
	ifand TEMP2 8 nullop else 
		{
		checkactivatormotion YVELSAVED
		ife RETURN 1 xorvar TEMP2 8
		}
	ife TEMP2 15 action ONE
	}

enda

useractor notenemy 16620 // pulse battery icon
ifaction 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		spritepal 8
		action ZERO
		}
	}
enda

useractor notenemy 16615 // pulse battery
ifaction 0
	{
	checkactivatormotion HITAGSAVED
	 ife RETURN 1
		{
		action ZERO
		}
	}
	
ifaction BREAK
	{
	ifg HUGE_BOSS_HEALTH -1
		{
		ife INTERNALCOUNT 0
			{
			sound PULSE_CAN_FIRE
			
			sub HUGE_BOSS_HEALTH 5
			geta[].x TEMP
			geta[].y TEMP2

			set TEMP3 TEMP
			add TEMP3 1024

			geta[].ang TEMP4

			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

			updatesector TEMP5 TEMP6 TEMP7
			espawn 8433
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			
			geta[].z TEMP
			sub TEMP 12192
			seta[RETURN].z TEMP
		
			
			set INTERNALCOUNT 300
			}
		sub INTERNALCOUNT 1
		}
		
	}
	
ifaction ZERO
	{
	geta[].ang TEMP
	ifl TEMP 520
	ifg TEMP 500
		{
		seta[].ang 512
		stopsound TANK_ROTATE
		sound HITECH_DOOR4
		action BREAK
		set INTERNALCOUNT 0
		}
		else
	ifl TEMP 512
		{
		add TEMP 16
		ifactorsound THISACTOR TANK_ROTATE nullop else sound TANK_ROTATE
		seta[].ang TEMP
		}
	else
	ifg TEMP 512
		{
		sub TEMP 16
		ifactorsound THISACTOR TANK_ROTATE nullop else sound TANK_ROTATE
		seta[].ang TEMP
		}
	}
	
enda

useractor notenemy 16595
ifaction 0
	{
	checkactivatormotion HITAGSAVED
	 ife RETURN 1
		{
		cactor 16621
		}
	}
enda

useractor notenemy 16878
ife BIG_GUN_CHARGE 1200 action ONE else action ZERO
enda

useractor notenemy 16621
ife BIG_GUN_CHARGE 1200 action ONE else action ZERO
enda

useractor notenemy 16617
ife BIG_GUN_CHARGE 1200 spritepal 8 else spritepal 2
enda

useractor notenemy 16616 // BIG GUN

ifaction ZERO
{
add INTERNALCOUNT 1
ifspritepal 3 spritepal 102
ifspritepal 102
	{
	sizeto 2 75
	geta[].shade TEMP8
	sub TEMP8 1
	seta[].shade TEMP8
	
		set TEMP3 sprite[].x
		randvarvar TEMP4 2048
		add TEMP3 TEMP4
		randvar TEMP4 2048

		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6

		espawn 18574

		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6

		seta[RETURN].pal 1
	
	ifg INTERNALCOUNT 60 { sound SOMETHINGHITFORCE spawn 8433 operateactivators LOTAGSAVED THISACTOR killit }
	}
ifspritepal 103
	{
	cstat 257
	sizeto 75 75
	ifg INTERNALCOUNT 600 { spritepal 0 action 0 }
	}
}

ifspritepal 3 
	{ 
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		set INTERNALCOUNT 0
		action ZERO
		}
	}
	else
ifspritepal 103
 ifaction 0 
	{
	cstat 32768
	sizeat 2 75
	checkactivatormotion HITAGSAVED
	ife RETURN 1
		{
		globalsound SOMETHINGHITFORCE
		spawn 8433
		set INTERNALCOUNT 0
		action ZERO
		}
	}
	else
ifspritepal 0
	{
		ifg HUGE_BOSS_HEALTH -1
			{
			ife BIG_GUN_CHARGE -1
				{
				stopallsounds
				screensound BIG_GUN_FIRE
				wackplayer
				quake 52
				
				set TEMP3 sprite[].x
				add TEMP3 2048

				rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6

				updatesector TEMP5 TEMP6 TEMP7
				
				geta[].z TEMP
				sub TEMP 18192
				
				espawn 8433
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				seta[RETURN].z TEMP
				
				espawn BIG_SMOKE2
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				seta[RETURN].z TEMP
				
				espawn BIG_SMOKE2
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				seta[RETURN].z TEMP
				
				espawn BIG_SMOKE2
				seta[RETURN].x TEMP5 
				seta[RETURN].y TEMP6
				seta[RETURN].z TEMP
				
				set BIG_GUN_CHARGE -5
				}
			else ifl BIG_GUN_CHARGE 1200 add BIG_GUN_CHARGE 1
			ife BIG_GUN_CHARGE 800 globalsound ALIENSHIP_CHARGE
			}
	}
		
enda

useractor notenemy 16596
cstat 32768

ifaction 0
 ife BIG_GUN_CHARGE -5
	{
	action ZERO
	set BIG_GUN_CHARGE 0
	set INTERNALCOUNT 0
	}
	
ifaction ZERO
	{
	add INTERNALCOUNT 1
	ifg INTERNALCOUNT 90
		{
		spawn 8433
		globalsound BIG_GUN_HIT 
		spawn 15954
		sub HUGE_BOSS_HEALTH 200
		wackplayer
		action 0
		}
	}
	
enda

useractor notenemy 16597

ifaction 0
	{
	checkactivatormotion HITAGSAVED
	 ife RETURN 1
		{
		action ONE
		}
	}
	
ifaction BREAK
	{
	ifp pfacing
	 ifpdistl 2048
	 ifg SHIP_INTEGRITY -1
		{
		set player_use 0
		 ifhitspace
		  ife BIG_GUN_CHARGE 1200
			{
			sound IW_SWITCH
			set BIG_GUN_CHARGE -1
			action ONE
			}
		}
	}
	
ifaction ONE
	{
	ife BIG_GUN_CHARGE 1200 { sound IW_SWITCH action BREAK }
	}

enda

useractor notenemy 16599 // SHIP BATTLE STARTER
cstat 32768
ifaction 0
	{
	checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			set SHIP_INTEGRITY 1000
			set HUGE_BOSS_HEALTH 1000
			set TEMP6 0
			action ZERO
			}
	}
	
ifaction ZERO
	{
	ifl HUGE_BOSS_HEALTH 800 ife TEMP6 0
		{
		operaterespawns 7500
		set TEMP6 1 
		}
	ifl HUGE_BOSS_HEALTH 600 ife TEMP6 1
		{
		operaterespawns 7501
		set TEMP6 2 
		}
	ifl HUGE_BOSS_HEALTH 400 ife TEMP6 2
		{
		operaterespawns 7502
		set TEMP6 3 
		}
	ifl HUGE_BOSS_HEALTH 200 ife TEMP6 3
		{
		operaterespawns 7503
		set TEMP6 4
		}
		
	ifl SHIP_INTEGRITY 800 ife TEMP7 0
		{
		operateactivators 7600 THISACTOR
		operatemasterswitches 7600
		operaterespawns 7600
		set TEMP7 1 
		}
	ifl SHIP_INTEGRITY 600 ife TEMP7 1
		{
		operateactivators 7601 THISACTOR
		operatemasterswitches 7601
		operaterespawns 7601
		set TEMP7 2 
		}
	ifl SHIP_INTEGRITY 400 ife TEMP7 2
		{
		operateactivators 7602 THISACTOR
		operatemasterswitches 7602
		operaterespawns 7602
		set TEMP7 3 
		}
	ifl SHIP_INTEGRITY 200 ife TEMP7 3
		{
		operateactivators 7603 THISACTOR
		operatemasterswitches 7603
		operaterespawns 7603
		set TEMP7 4
		}
	
	ifl SHIP_INTEGRITY 1
		{
		operateactivators 7604 THISACTOR
		operatemasterswitches 7604
		operaterespawns 7604
		palfrom 64 64 64 64
		killit
		}
	else
	ifl HUGE_BOSS_HEALTH 0
		{
		operateactivators LOTAGSAVED THISACTOR
		operatemasterswitches LOTAGSAVED 
		operaterespawns LOTAGSAVED
		killit
		}
	}
	
enda

// ************************************************************************************
// WASP_DRONE
// ************************************************************************************

action WASP_DRONEFRAMES   0   1   1   1   1
action WASP_DRONESCREAM   0   1   1   1   1
move WASP_DRONERUNVELS 128 64
move WASP_DRONERUNUPVELS 128 -64
move WASP_DRONEBULLVELS 252 -64
move WASP_DRONEBACKWARDS -64 -64
move WASP_DRONERISE 32 -32
move WASP_DRONESTOPPED -16

ai AIWASP_DRONEGETE WASP_DRONESCREAM WASP_DRONERUNVELS faceplayerslow getv
ai AIWASP_DRONEMGUN WASP_DRONESCREAM WASP_DRONESTOPPED seekplayer
ai AIWASP_DRONEWAIT WASP_DRONEFRAMES WASP_DRONESTOPPED seekplayer
ai AIWASP_DRONEGETUP WASP_DRONESCREAM WASP_DRONERUNUPVELS faceplayer getv
ai AIWASP_DRONEPULLBACK WASP_DRONEFRAMES WASP_DRONEBACKWARDS faceplayerslow
ai AIWASP_DRONEHIT WASP_DRONESCREAM WASP_DRONEBACKWARDS faceplayer
ai AIWASP_DRONEDODGE WASP_DRONEFRAMES WASP_DRONEBULLVELS dodgebullet geth
ai AIWASP_DRONEDODGEUP WASP_DRONEFRAMES WASP_DRONERISE getv geth


defstate checkwasp_dronehitstate

  ifdead { stopactorsound THISACTOR HOVER_CRAFT state dronedead }
  else ifsquished { stopactorsound THISACTOR HOVER_CRAFT sound METAL_CRUSH state dronedead }
  else
  {
	geta[].htpicnum TEMP
	ife TEMP 6197 addstrength -75
	ife TEMP 6464 addstrength -10

    ifbulletnear
    {
      ifceilingdistl 64
        ifrnd 48
          ai AIWASP_DRONEDODGE
      ai AIWASP_DRONEDODGEUP
    }
    else
      ai AIWASP_DRONEGETE
  }
ends


defstate wasp_droneattack
state enemyfindtarget
	ifactioncount 3
	ifn target -1
	{ 
	state SKILL_SHOOT_LEVELADJUST
	divvar SKILLCHANCE 2
	ifl RANDOM_CHANCE SKILLCHANCE // randomly fire a homing missile
		{
		state shoot_target
				sound Z_MISSILE_FIRE
				ezshoot TEMP3 HOMING_MISSILE

			ife PERFMODE 1
			 ifcansee
				{
				set gunsmoke_z 244 
				set gunsmoke_angle -64
				state spawn_gunsmoke_z
				set gunsmoke_z 344
				espawn 16114
				state spawn_muzzleflash
				}
			ai AIWASP_DRONEPULLBACK
		}
	else
		{
		add ALLY_MAG 1
		state shoot_target
				sound GLOCKFIRE
				globalsound DISTANT_RIFLE
				ezshoot TEMP3 SHOTSPARK1

			ife PERFMODE 1
			 ifcansee
				{
				set gunsmoke_z 244 
				set gunsmoke_angle -64
				state spawn_gunsmoke_z
				set gunsmoke_z 344
				espawn 16115
				state spawn_muzzleflash
				}
			ifrnd 32 ai AIWASP_DRONEPULLBACK
			ifg ALLY_MAG 10 ai AIWASP_DRONEPULLBACK
		}
		resetactioncount
	}
	else ife target -1 ai AIWASP_DRONEPULLBACK

ends

defstate wasp_dronegetstate
state enemyfindtarget
sub ALLY_MAG 1
 ifn target -1
  ifrnd 32
  {
 ai AIWASP_DRONEMGUN
  }
  else
  ifrnd 192
  {
  state correctcansee
    ife sightvar YES
    {
      ifbulletnear
      {
        ai AIWASP_DRONEDODGE
        break
      }
      ifmove WASP_DRONEBULLVELS
      {
        ifcount 64
          ai AIWASP_DRONEPULLBACK
        else
          ifnotmoving
            ifcount 16
              ai AIWASP_DRONEPULLBACK
      }
      else
        ifcount 32
      {
        ifp phigher
          move WASP_DRONEBULLVELS geth getv
        else
          move WASP_DRONEBULLVELS geth
      }
    }
    else
      ifrnd 1
        operate
  }
ends

defstate wasp_dronedodgestate
  ifai AIWASP_DRONEDODGEUP
  {
  state thisactor_getzrange
     ifcount 8
       ai AIWASP_DRONEGETE
     else
       ifnotmoving
         ai AIWASP_DRONEGETE
  }
  else
  {
    ifcount 8
      ai AIWASP_DRONEGETE
    else
      ifnotmoving
        ai AIWASP_DRONEGETE
  }
ends

spriteflags WASP_DRONE SFLAG_NOWATERSECTOR

useractor enemy WASP_DRONE 100

ifinwater state dronedead

  ifrnd 2
    fall
  else
    {
	ifactorsound THISACTOR HOVER_CRAFT nullop else sound HOVER_CRAFT
    setactorsoundpitch THISACTOR HOVER_CRAFT 1024
	}

  ifaction 0
    { 
	state monst_glow
	sound WASP_DR_RECOG
	spriteflags 3153923
	set MONSTER_FLAGS 1
	ifspritepal 3 sizeat 48 48 else
	sizeat 24 24
	cstat 257
	seta[].mdzoff 4096
	spawn SHOOTME 
	ai AIWASP_DRONEGETE
	}

  else
    ifai AIWASP_DRONEWAIT
  {
    ifactioncount 4
      ifrnd 16
        ifcansee
    {
      ifp phigher
        ai AIWASP_DRONEGETUP
      else ai AIWASP_DRONEGETE
    }
  }
  else
    ifai AIWASP_DRONEGETE
      state wasp_dronegetstate
  else
    ifai AIWASP_DRONEGETUP
      state wasp_dronegetstate
  else
    ifai AIWASP_DRONEMGUN
	  state wasp_droneattack
  else
    ifai AIWASP_DRONEPULLBACK
  {
    ifcount 32
    ai AIWASP_DRONEWAIT
  }
  else
    ifai AIWASP_DRONEHIT
  {
    ifcount 8
      ai AIWASP_DRONEWAIT
  }
  else
    ifai AIWASP_DRONEDODGE
      state wasp_dronedodgestate
  else
    ifai AIWASP_DRONEDODGEUP
      state wasp_dronedodgestate

  ifhitweapon
    state checkwasp_dronehitstate

enda

// ==================================================================================================
// Big turret
// ==================================================================================================

useractor notenemy 21602
sleeptime 0

ifaction 0
{
cstator 257
strength 1000
set TEMP6 0
ifn HITAGSAVED 0
	{
	checkactivatormotion HITAGSAVED
	ife RETURN 1 set HITAGSAVED 0
	}
else
action ZERO
}

ife camerasprite -1
ifpdistg 65536 seta[].mdflags 1 else seta[].mdflags 0

ifaction BREAK
{
move STOP
    add INTERNALCOUNT 1
	ifg INTERNALCOUNT 0
		{
		espawn EXPLOSION2
		sound RPG_EXPLODE
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 512
		randvar TEMP4 2048
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		}
	ifg INTERNALCOUNT 30
		{
		 debris SCRAP1 18
		  debris SCRAP2 14
		  debris SCRAP3 17
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  shoot SPARK
		  quake 26 spawn BIG_EXPLOSION sound BLOWUP 
		killit
		}
}
else
ifaction ZERO
{
ifpdistl 65386
	{
	move STOP faceplayerslow
	}
ifg INTERNALCOUNT 0 sub INTERNALCOUNT 1
ifcansee
 ifcanseetarget
  ife INTERNALCOUNT 0
	{
	sound TANK_FIRE
	
			set gunsmoke_z 14488 
			set gunsmoke_angle 96
			state spawn_gunsmoke_z
			set TEMP3 sprite[].x
			add TEMP3 2048
			geta[].ang TEMP4
			add TEMP4 gunsmoke_angle
			randvar TEMP5 16
			ifrnd 128 add TEMP4 TEMP5 else sub TEMP4 TEMP5
			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
			espawn 16115
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 14488 seta[RETURN].z TEMP
			eshoot MISSILE
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6 seta[RETURN].z TEMP
			
			set gunsmoke_z 14488 
			set gunsmoke_angle -96
			state spawn_gunsmoke_z
			set TEMP3 sprite[].x
			add TEMP3 2048
			geta[].ang TEMP4
			add TEMP4 gunsmoke_angle
			randvar TEMP5 16
			ifrnd 128 add TEMP4 TEMP5 else sub TEMP4 TEMP5
			rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
			espawn 16115
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6
			geta[].z TEMP sub TEMP 14488 seta[RETURN].z TEMP
			eshoot MISSILE
			seta[RETURN].x TEMP5 seta[RETURN].y TEMP6 seta[RETURN].z TEMP
			
		set INTERNALCOUNT 120
	}
}


  ifstrength 200
	{
	ifrnd 16 { sound SHORT_CIRCUIT shoot SPARK shoot SPARK }
	geta[].x TEMP
	geta[].y TEMP2

	set TEMP3 TEMP
	randvarvar TEMP4 512
	add TEMP3 TEMP4
	randvar TEMP4 2048

	rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6

	espawn GUNSMOKE

	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6
	
	geta[].z TEMP7
	sub TEMP7 6144
	randvar TEMP8 2048
	ifrnd 128 mulvar TEMP8 -1
	add TEMP7 TEMP8
	seta[RETURN].z TEMP7
	}

ifmove STOP soundonce TANK_ROTATE

//state MECH_DAMAGE_MODIFIER

ifhitweapon
{
seta[].xvel 0
ifdead { set INTERNALCOUNT 0 resetcount action BREAK }
}

enda

// ==================================================================================================
// 50. cal turret
// ==================================================================================================

useractor notenemy 17637

ifaction 0
{
strength 20
action ZERO
}

ifaction ZERO
{
	ifhitweapon
		{
		debris SCRAP1 3
		debris SCRAP2 3
		sound VENT_BUST
		sound SHORT_CIRCUIT
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK
		spawn 8433
		ifn HITAGSAVED 0
			{
			operateactivators HITAGSAVED THISACTOR
			operatemasterswitches HITAGSAVED
			operaterespawns HITAGSAVED
			}
		killit
		}
}

enda

action ATURRET_IDLE 0 1 5 1 10
action ATURRET_EMPTY 584 1 5 1 10
action ATURRET_FIRE 0 2 5 1 2

useractor notenemy 17638

ifaction 0
{
state monst_glow
sleeptime 0
strength 250
set ALLY_MAG 500
sizeat 45 45
ifn LOTAGSAVED 0 action ACAR else
action ATURRET_IDLE
}

ifg targetlock 0 sub targetlock 1

ifaction ACAR
{
sleeptime 0
checkactivatormotion LOTAGSAVED
ife RETURN 1
	{
	action ATURRET_IDLE
	}
}


ifaction ATURRET_IDLE
{
ife ALLY_MAG 0 action ATURRET_EMPTY
ifspritepal 0 { ifactorsound THISACTOR AUTOTURRET_SCAN nullop else sound AUTOTURRET_SCAN }
}

ifaction ATURRET_FIRE
{
	ifactioncount 3
	ifn target -1
			{ 
			sound FIFTY_T_FIRE
			ldist TEMP THISACTOR target
			geta[].z TEMP2
			sub TEMP2 8192 // Offset the Z. Assumes the center of the actor is the same as the player
			geta[target].z TEMP3
			sub TEMP3 8592 // Offset the Z. assumes the center of the actor is the same as the player
			sub TEMP3 TEMP2
			shiftvarl TEMP3 8
			divvarvar TEMP3 TEMP
			zshoot TEMP3 RMAXREVOLVERSHOT
			ife PERFMODE 1
			 ifcansee
				{
				set gunsmoke_z 256
				set gunsmoke_angle 0
				state spawn_gunsmoke_z
				set gunsmoke_z 128
				espawn 16115
				state spawn_muzzleflash
				randvar TEMP 1024 
				zshoot TEMP RIFLESHELL 
				}
			add INTERNALCOUNT 1
			sub ALLY_MAG 1
			resetactioncount
			}
	ife target -1
		{
		action ATURRET_IDLE
		}
	ifg INTERNALCOUNT 25
		{
		action ATURRET_IDLE
		}
}

ifg SEEK_ENEMY_COUNT 0 sub SEEK_ENEMY_COUNT 1

	ife SEEK_ENEMY_COUNT 0
	{
	ifaction ACAR break
	ifaction ATURRET_EMPTY break
	state enemyfindtarget
	ifn target -1 ifg ALLY_MAG 0 { sound FIFTY_T_BEEP set INTERNALCOUNT 0 action ATURRET_FIRE }
	set SEEK_ENEMY_COUNT 13
	}

	
ifhitweapon
{
debris SCRAP1 2
	ifdead
	{
	spawn EXPLOSION2
	sound PIPEBOMB_EXPLODE
	debris SCRAP1 4
	debris SCRAP2 5
	debris SCRAP3 6
	ifn HITAGSAVED 0
		{
	operateactivators HITAGSAVED THISACTOR
	operatemasterswitches HITAGSAVED
	operaterespawns HITAGSAVED		
		}
	killit
	}
}


enda

// ==================================================================================================
// Psychobrain
// ==================================================================================================

spritenvg 20144
spriteshadow 20144

useractor notenemy 20144

ifaction 0
	{
	strength 100
	cstat 257
	action ZERO
	}
	
ifaction ZERO
	{
	soundonce PSYCHOBRAIN_PULSE
	ifsquished
		{
		state squish_sounds
		state standard_jibs
		state random_ooz
		stopallsounds
		globalsound PSYCHOBRAIN_DIE
		quake 52
		ifn HITAGSAVED 0
			{
			operateactivators HITAGSAVED THISACTOR
			operatemasterswitches HITAGSAVED
			operaterespawns HITAGSAVED
			}
		killit
		}
	}

enda

// ************************************************************************************
// CYBER ALIEN
// ************************************************************************************

action ACYBERA_IDLE 0 1 5 1 10
action ACYBERA_WALK 0 3 5 1 20
action ACYBERA_RUN 0 3 5 1 8
action ACYBERA_PREPARE 15 1 5 1 12
action ACYBERA_MISSILE 20 3 5 1 12
action ACYBERA_MORTER 30 3 5 1 12
action ACYBERA_PAIN 45 1 5 1 10
action ACYBERA_DYING 50 5 1 1 20
action ACYBERA_DEAD 54 

move CYBERA_MOVE 120
move CYBERA_RUN 180

ai AI_CYBERA_IDLE ACYBERA_IDLE STOP
ai AI_CYBERA_WALK ACYBERA_WALK CYBERA_MOVE seekplayer
ai AI_CYBERA_RUSH ACYBERA_RUN CYBERA_RUN seekplayer
ai AI_CYBERA_PREPARE ACYBERA_PREPARE STOP shoottarget
ai AI_CYBERA_MISSILE ACYBERA_MISSILE STOP shoottarget
ai AI_CYBERA_MORTER ACYBERA_MORTER STOP faceplayer
ai AI_CYBERA_DIE ACYBERA_DYING

useractor enemystayput CYBERALIEN_STAYPUT fall cactor CYBERALIEN enda

useractor enemy CYBERALIEN 600 ACYBERA_IDLE

ifai 0
	{
	spawn SHOOTME
	state monst_glow
	spriteflags NORMAL_ENEMY
	sizeat 45 45
	cstat 257
	strength 600
	sound CYBERA_RECOG
	ai AI_CYBERA_IDLE
	}
	
//state MECH_DAMAGE_MODIFIER

ifaction ACYBERA_DEAD
	{
	move STOP
		  strength 0
		  ifhitweapon
			ifwasweapon RADIUSEXPLOSION
		  {
			state squish_sounds
			guts JIBS2 5              // Instead of the normal "standard_jibs"
			guts JIBS3 5              // amount, I found that ,because these
			guts JIBS4 5              // bodies are so huge, they should spawn
			guts JIBS5 15             // a more realistic amount of gutter!
			guts JIBS6 15
			debris SCRAP1 5           // There are also spawned some metal
			debris SCRAP2 5           // scraps, since this boss has a lot
			debris SCRAP5 5           // of metalware with him.
			state standard_jibs
			killit
		  }
		  break
	}
else
ifai AI_CYBERA_DIE
	{
	ifactioncount 5 { spawn BLOODPOOL sound CYBERDEMON_METAL action ACYBERA_DEAD }
	}
else
ifaction ACYBERA_PAIN
	{
	ifdead ai AI_CYBERA_DIE else ifactioncount 2 ai AI_CYBERA_IDLE
	}
else
ifai AI_CYBERA_IDLE
	{
	ai AI_CYBERA_WALK
	}
else
ifai AI_CYBERA_WALK
	{
	ifrnd 2 soundonce CYBERA_ROAM
	state SKILL_SHOOT_LEVELADJUST
	ife target -1 ifrnd 4 { ai AI_CYBERA_WALK }
	ifrnd 2 ai AI_CYBERA_RUSH
	ifl xydist 8012 ai AI_CYBERA_RUSH
	else ifg xydist 8012
		ifl RANDOM_CHANCE SKILLCHANCE
				ai AI_CYBERA_PREPARE

	}
else
ifai AI_CYBERA_RUSH
	{
	ifrnd 2 soundonce CYBERA_ROAM
	state SKILL_SHOOT_LEVELADJUST
	ife target -1 ifrnd 4 { ai AI_CYBERA_WALK }
	ifg xydist 8012 ifrnd 16 ai AI_CYBERA_WALK
	else ifl xydist 8012
		ifl RANDOM_CHANCE SKILLCHANCE
				ai AI_CYBERA_PREPARE
	}
else
ifai AI_CYBERA_PREPARE
	{
	ifactioncount 2
		{
		ifrnd 128 
			{
			state SKILL_SHOOT_LEVELADJUST
			ifl RANDOM_CHANCE SKILLCHANCE 
			{ sound CYBERA_RECOG set TEMP4 1 } else set TEMP4 0
			ai AI_CYBERA_MISSILE
			}
		else ai AI_CYBERA_MORTER
		resetactioncount
		}
	}
else
ifai AI_CYBERA_MISSILE
{
ifactioncount 1
	{
	ife INTERNALCOUNT 0
		{
		ife TEMP4 1 shoot HOMING_MISSILE else
			{
			setprojectile[MICRO_MISSILE].offset -512
			shoot MICRO_MISSILE
			setprojectile[MICRO_MISSILE].offset 224
			}
		sound CYBERT_FIRE
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 5244 
			set gunsmoke_angle -356
			state spawn_gunsmoke_z
			set gunsmoke_z 5244
			espawn 16114
			seta[RETURN].pal 2
			state spawn_muzzleflash
			}
		set INTERNALCOUNT 1
		}
	}
ifactioncount 2
	{
	set INTERNALCOUNT 0
	resetactioncount
	ai AI_CYBERA_RUSH
	}
}
else
ifai AI_CYBERA_MORTER
{
ifactioncount 1
	{
	ife INTERNALCOUNT_2 0
		{
		sound BOS1_ATTACK2
		shoot MORTER
		ai AI_CYBERA_RUSH
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 5244 
			set gunsmoke_angle 356
			state spawn_gunsmoke_z
			set gunsmoke_z 5244
			espawn 16114
			seta[RETURN].pal 2
			state spawn_muzzleflash
			}
		set INTERNALCOUNT_2 1
		}
	}
ifactioncount 2
	{
	set INTERNALCOUNT_2 0
	resetactioncount
	ai AI_CYBERA_RUSH
	}
}
	
ifhitweapon
{
//spawn BLOOD
ifrnd 128 guts JIBS6 1
ifrnd 128 debris SCRAP1 1
state NEWGUNEFFECTS
ifdead
	{
	state rf
	sound CYBERA_DYING
	state thegames_score
	shoot NJIB shoot NJIB shoot NJIB shoot NJIB shoot NJIB
	debris SCRAP1 5
	shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	ifrnd 4 spawn HEAT_SEEK_CARD_PICKUP
	ai AI_CYBERA_DIE
	}
else ifrnd 16 { sound CYBERA_PAIN action ACYBERA_PAIN }
}
state checksquished

enda

// NAZI ENEMY ===============================================

action ANAZI_FROZE 0 1 5 1 10
action ANAZI_GROW 30 1 1 1 10
action ANAZI_IDLE 0 1 5 1 20
action ANAZIRUN  0  4 5 1 12
action ANAZIRUSH  0  4 5 1 8
action ANAZIFIRE 20 2 5 1 4
action ANAZIFLINCH 30 1 1 1 10

action ANAZIDYING 30 6 1 1 12
action ANAZIDEAD 35 1 1 1 10

action ANAZI_HEADSHOT 37 6 1 1 12
action ANAZI_HEADDEAD 43 1 1 1 10


ai AINAZISEEKENEMY ANAZIRUN MERCRUN seekplayer
ai AINAZIRUSHENEMY ANAZIRUSH MERCRUN seekplayer
ai AINAZISHOOTENEMY ANAZIFIRE STOP faceplayer
ai AINAZIDEAD ANAZIDEAD STOP faceplayer
ai AINAZI_HEADDEAD ANAZI_HEADDEAD STOP faceplayer
ai AINAZISHRUNK ANAZIRUN MERCRUN furthestdir
ai AINAZI_GROW ANAZI_GROW STOP faceplayer

useractor enemystayput NAZI_STAYPUT 75 ANAZI_IDLE
cactor NAZI
enda

useractor enemy NAZI 75 ANAZI_IDLE
fall

ifai 0
	{
	set MONSTER_FLAGS 2
	state monst_glow
	spriteflags NORMAL_ENEMY_TRU
	spawn SHOOTME
	strength 75 
	sizeat 24 24
	action ANAZIRUN
	ai AINAZISEEKENEMY
	ifrnd 96 sound NAZI_SPOT1 else
	ifrnd 96 sound NAZI_SPOT2 else
	sound NAZI_SPOT3
	cstat 257
	}

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage

//ifspritepal 24 state BODYA_DAMAGE_MODIFIER

ifaction ANAZI_FROZE state frozen_code 
else
ifaction ANAZIFLINCH
{
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0 ai AINAZISEEKENEMY
}
else
ifai AINAZIDEAD
{
move STOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
			state human_jibs
	        killit
	      }
	      break
	    }
}
else
ifai AINAZI_HEADDEAD
{
move STOP
    ifhitweapon
	    {
	      ifwasweapon RADIUSEXPLOSION
	      {
	        state squish_sounds
			state standard_jibs
			state human_jibs
	        killit
	      }
	      break
	    }
}
else
ifaction ANAZIDYING
{
strength 0
	ifactioncount 6 { state BODY_FALL_NOISES spawn BLOODPOOL ai AINAZIDEAD }
}
else
ifaction ANAZI_HEADSHOT
{
strength 0
	ifactioncount 6 { state BODY_FALL_NOISES spawn BLOODPOOL ai AINAZI_HEADDEAD }
}
else
ifai AINAZI_GROW state genericgrowcode
else
ifai AINAZISHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AINAZISEEKENEMY
    else ifcount SHRUNKCOUNT
	  {
	  sound ACTOR_UNSHRINK
      sizeto 24 24
	  }
    else
      state genericshrunkcode
    break
}
else
ifai AINAZISEEKENEMY
{	
ifrnd 1
	{
	ifrnd 96 sound NAZI_SPOT1 else
	ifrnd 96 sound NAZI_SPOT2 else
	sound NAZI_SPOT3
	}
state SKILL_SHOOT_LEVELADJUST
ifg shoot_countdown 0 sub shoot_countdown 1
	ife shoot_countdown 0 ifcansee ifcanshoottarget ifl RANDOM_CHANCE SKILLCHANCE ai AINAZISHOOTENEMY
}
else
ifai AINAZISHOOTENEMY
{
	ifactioncount 2
	{ 
			state SKILL_ENEMY_ACCURACY
			sound VLAD_RIFLE
			shoot SHOTSPARK1
		ife PERFMODE 1
		 ifcansee
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			shoot 13772
			set gunsmoke_z 7044
			espawn 16115
			state spawn_muzzleflash
			}
		ifrnd 32 ai AINAZISEEKENEMY
		// ife target -1 ai AINAZISEEKENEMY
		resetactioncount
	}
}

ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	guts JIBS6 1	
	state random_wall_jibs
	ifdead
		{
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AINAZI_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 1 sound SOMETHINGFROZE action ANAZI_FROZE } 
		else
			{
			state rf
			addkills 1
			state thegames_score
			ifg FIRE_DAMAGE 0 
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			ifrnd 64 sound MERC_ONFIRE1
			else ifrnd 64 sound MERC_ONFIRE2
			else ifrnd 64 sound MERC_ONFIRE3
			else sound MERC_ONFIRE4
			spawn ONFIREGUY
			killit
			}
			else
			ife HEADSHOT 2 
			{
			ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				action ANAZI_HEADSHOT
			}
			else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
			else
			ifg ENERGY_DAMAGE 0
				{
				shoot SPARK2 shoot SPARK2 shoot SPARK2 
				spritepal 4
				guts JIBS3 6
				spawn DISINTIGRATE_GUY
				killit
				}
			else
				{
				ifrnd 128 sound NAZI_DEATH1
				else sound NAZI_DEATH2
				action ANAZIDYING
				}
			}
		ifrnd 32
			{ 
			espawn MP40SPRITE randvar TEMP 10 
			add TEMP 20
			setactorvar[RETURN].YVELSAVED TEMP 
			}
		}
else
	ifg PAIN_AMOUNT 0 action ANAZIFLINCH 
	else ifrnd 16 
		{ 
		ifrnd 128 sound NAZI_PAIN1 else sound NAZI_PAIN2
		state PAIN_SKILL_LEVELADJUST 
		action ANAZIFLINCH 
		}
	else ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AINAZISHRUNK }
}

state checksquished

enda

// ===============================================================================================================================================================
// MADRAX 
// ===============================================================================================================================================================

action MADRAX_IDLE 0 1 1 1 0
action MADRAX_READY 1 1 5 1 16
action MADRAX_FIRE 1 2 5 1 0
action MADRAX_COAT_THROW 11 6 1 1 20

action MADRAX_NC_IDLE 16 1 1 1 0
action MADRAX_NC_READY 17 1 5 1 16
action MADRAX_NC_FIRE 17 2 5 1 0

action MADRAX_NC_HUTHUT 27 1 1 1 1
action MADRAX_NC_CHARGE 27 2 1 1 16
action MADRAX_NC_DASH 29 2 1 1 8
action MADRAX_NC_BASH 31 2 1 1 16

action MADRAX_NC_DIE 33 4 1 1 20
action MADRAX_NC_DEAD 36

move MADRAX_MOVE 320 0

ai AIMADRAX_STARTUP MADRAX_IDLE STOP
ai AIMADRAX_IDLE MADRAX_IDLE STOP
ai AIMADRAX_READY MADRAX_READY STOP faceplayer
ai AIMADRAX_FIRE MADRAX_FIRE STOP faceplayerslow
ai AIMADRAX_COAT_THROW MADRAX_COAT_THROW

ai AIMADRAX_NC_IDLE MADRAX_NC_IDLE STOP
ai AIMADRAX_NC_READY MADRAX_NC_READY STOP faceplayer
ai AIMADRAX_NC_FIRE MADRAX_NC_FIRE STOP faceplayerslow

ai AIMADRAX_NC_HUTHUT MADRAX_NC_HUTHUT STOP faceplayer
ai AIMADRAX_NC_CHARGE MADRAX_NC_CHARGE STOP faceplayer
ai AIMADRAX_NC_DASH MADRAX_NC_DASH MADRAX_MOVE faceplayer
ai AIMADRAX_NC_BASH MADRAX_NC_BASH STOP faceplayer

ai AIMADRAX_NC_DIE MADRAX_NC_DIE STOP
ai AIMADRAX_NC_DEAD MADRAX_NC_DEAD STOP
ai AIMADRAX_NC_DEAD2 MADRAX_NC_DEAD STOP

useractor enemy MADRAX
fall
ifai 0
	{ 
	sizeat 40 40
	cstat 257
	state monst_glow
	strength 5000
	set ALLY_MAG 1
	spriteflags 1056803 // --> SFLAG_BADGUY = 0
	ai AIMADRAX_STARTUP
	}
	
//ife ALLY_MAG 1
//    state BODYA_DAMAGE_MODIFIER

ifai AIMADRAX_NC_DEAD
	{
	cstat 0
	ifcount 140
		{
		operateactivators HITAGSAVED THISACTOR
		operatemasterswitches HITAGSAVED
		operaterespawns HITAGSAVED
		ai AIMADRAX_NC_DEAD2
		}
	}
	
ifai AIMADRAX_NC_DEAD2
	{
	cstat 0
	}
	
ifai AIMADRAX_NC_DIE
	{
	ifactioncount 4
		{
		ai AIMADRAX_NC_DEAD
		sound BOSSFALL
		quake 13
		spawn BLOODPOOL
		}
	}
	
ifai AIMADRAX_STARTUP
	{
	
	checkactivatormotion 129
	ife RETURN 1
		{
		set CURBOSS THISACTOR
		set BOSS_TYPE 0
		seta[].mdflags TEMP 
		set command 8192
		spawn SHOOTME 
		set ENEMY_TALKING 300
		ai AIMADRAX_IDLE
		}
	}

ifai AIMADRAX_COAT_THROW
	{
	ifactioncount 3 soundonce BIGTHROW
	ifactioncount 6 ai AIMADRAX_NC_IDLE
	}
	
ifai AIMADRAX_IDLE
	{
	ifp pdead break
	state correctcansee
	ife sightvar YES
	 ifcanshoottarget 
	  ifrnd 32
		{
		ai AIMADRAX_READY
		resetcount
		}
	}
	
ifai AIMADRAX_READY
	{
	
	ifand ALLY_VOICE 16 nullop else ife ENEMY_TALKING 0 
		{ 
		globalsound MX_ATTACK1
		ife gp_subt 0
			{
			qputs 7500 ^2Maddrax: ^0Eat lead!
			set gp_subt 112
			}
		xorvar ALLY_VOICE 16 
		set ENEMY_TALKING 600 
		}
	ifand ALLY_VOICE 32 nullop else ife ENEMY_TALKING 0 
		{ 
		globalsound MX_ATTACK2
		ife gp_subt 0
			{
			qputs 7500 ^2Maddrax: ^0Chew on this!
			set gp_subt 117
			}
		xorvar ALLY_VOICE 32 
		set ENEMY_TALKING 600
		}
	
ifg ENEMY_TALKING 0 sub ENEMY_TALKING 1
	
	soundonce MINIGUN3_START
	state correctcansee
	ife sightvar YES 
	 ifcanshoottarget
		{
		ifcount 15 ai AIMADRAX_FIRE
		}
		else ai AIMADRAX_IDLE
	}
	
	
ifai AIMADRAX_FIRE
	{
	soundonce MINIGUN3_FIRE
	shoot SHOTSPARK1
	
		ife PERFMODE 1
		 ifcount 3
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			set gunsmoke_z 5044
			espawn 16115
			state spawn_muzzleflash
			shoot RIFLESHELL
			shoot SHELL_LINK
			resetcount
			}
	
	flash
	ifrnd 2
		{
		stopsound MINIGUN3_FIRE
		soundonce MINIGUN3_STOP
		ai AIMADRAX_READY
		}
	state correctcansee
	ife sightvar YES
	 ifcanshoottarget nullop else ifrnd 64 		
		{
		stopsound MINIGUN3_FIRE
		soundonce MINIGUN3_STOP
		ai AIMADRAX_READY
		}
	ifp pdead ai AIMADRAX_IDLE
	}
	
ifai AIMADRAX_NC_IDLE
	{
	ifp pdead break
	state correctcansee
	ife sightvar YES
	 ifcanshoottarget 
	  ifrnd 32
		{
		ai AIMADRAX_NC_READY
		resetcount
		}
	ifrnd 128 ai AIMADRAX_NC_HUTHUT
	}
	
ifai AIMADRAX_NC_READY
	{
	soundonce MINIGUN3_START
	ifcansee ifcanshoottarget
		{
		ifcount 15 ai AIMADRAX_NC_FIRE
		}
		else ai AIMADRAX_NC_HUTHUT
	}
	

ifai AIMADRAX_NC_HUTHUT
	{
	ifand ALLY_VOICE 1 nullop else ife ENEMY_TALKING 0 
		{ 
		globalsound MX_CHARGE1
		ife gp_subt 0
			{
			qputs 7500 ^2Maddrax: ^0I'm gonna squash you!
			set gp_subt 112
			}
		xorvar ALLY_VOICE 1 
		set ENEMY_TALKING 300 
		}
	ifand ALLY_VOICE 2 nullop else ife ENEMY_TALKING 0 
		{ 
		globalsound MX_CHARGE2
		ife gp_subt 0
			{
			qputs 7500 ^2Maddrax: ^0Touchdown motherfucker!
			set gp_subt 117
			}
		xorvar ALLY_VOICE 2 
		set ENEMY_TALKING 300
		}
	ifand ALLY_VOICE 4 nullop else ife ENEMY_TALKING 0 
		{ 
		globalsound MX_CHARGE3
		ife gp_subt 0
			{
			qputs 7500 ^2Maddrax: ^0I used to play college football!
			set gp_subt 82
			}
		xorvar ALLY_VOICE 4 
		set ENEMY_TALKING 300
		}
	
	ifactioncount 8 ai AIMADRAX_NC_CHARGE
	}
	
	ifg ENEMY_TALKING 0 sub ENEMY_TALKING 1
	
ifai AIMADRAX_NC_CHARGE
	{
	ifactioncount 2 ai AIMADRAX_NC_DASH
	}
	
ifai AIMADRAX_NC_DASH
	{
	ifcount 6
		{
		ife FOOTSTEPCOUNT 0 { sound BOSS_STOMP1 set FOOTSTEPCOUNT 1 }
		else { sound BOSS_STOMP2 set FOOTSTEPCOUNT 0 }
		quake 13
		resetcount
		}
	ifpdistl 1536
		{
		state setknockback
		wackplayer 
		sound BOSS_WHACK
		palfrom 20 30 0 0 
		addphealth -15
		ai AIMADRAX_NC_BASH
		}
	else ifnotmoving ai AIMADRAX_NC_READY 
	else ifactioncount 90 ai AIMADRAX_NC_READY
	}
	
ifai AIMADRAX_NC_BASH
	{
	ifactioncount 2 ai AIMADRAX_NC_READY
	}
	
ifai AIMADRAX_NC_FIRE
	{
	soundonce MINIGUN3_FIRE
	shoot SHOTSPARK1
	
		ife PERFMODE 1
		 ifcount 3
			{
			set gunsmoke_z 7644 
			set gunsmoke_angle 256
			state spawn_gunsmoke_z
			set gunsmoke_z 5044
			espawn 16115
			state spawn_muzzleflash
			shoot RIFLESHELL
			shoot SHELL_LINK
			resetcount
			}
	
	flash
	ifrnd 2
		{
		stopsound MINIGUN3_FIRE
		soundonce MINIGUN3_STOP
		ai AIMADRAX_NC_HUTHUT
		}
	state correctcansee
	ife sightvar YES
	 ifcanshoottarget nullop else ifrnd 48		
		{
		stopsound MINIGUN3_FIRE
		soundonce MINIGUN3_STOP
		ai AIMADRAX_NC_READY
		}
	ifp pdead ai AIMADRAX_NC_IDLE
	}
	
ifhitweapon
	{
	ife ALLY_MAG 0 
		{
		state random_wall_jibs
		//spawn BLOOD
		guts JIBS6 1
		ifrnd 16 soundonce MX_PAIN2
		else ifrnd 16 soundonce MX_PAIN3
		else ifrnd 16 soundonce MX_PAIN4
		} 

	ifstrength 3000 ife ALLY_MAG 1 
		{
		sound JMOVE3
		globalsound MX_THROWD
		ife gp_subt 0
			{
			qputs 7500 ^2Maddrax: ^0You know what, fuck this I'm bringing the big guns now!
			set gp_subt 60
			}
		xorvar ALLY_VOICE 1 
		set ENEMY_TALKING 150 
		set SLO_MO_SHOWOFF 45
		ai AIMADRAX_COAT_THROW
		resetactioncount
		set ALLY_MAG 0
		}
		
	ifdead
		{
		 addkills 1
		 globalsound MX_DIE
		 state thegames_score
		 resetcount
		 resetactioncount
		 ai AIMADRAX_NC_DIE
		}
		
	}

enda

// ******************************************************************************
// SPIDER - original code by Dan Gaskil aka DeeperThought
// ******************************************************************************

useractor notenemy 23526 0

ifspritepal 3
{
	sizeto 20 255
	sizeto 20 255
	sizeto 20 255
	sizeto 20 255
}
else
{
	sizeto 40 255
	sizeto 40 255
	sizeto 40 255
	sizeto 40 255
}
ifcount 780 killit

enda

action SPIDER2STAND 5 1 5 1 10
action SPIDER2WALK 5 4 5 1 6
action SPIDER2SHOOT 0 1 5 1 20
action SPIDER2FLIP 6 6 1 1 10
action SPIDER2DIE 30 6 1 1 10
action SPIDER2JUMP 25 1 5 1 10
action SPIDER2DEAD 35 1 1 1 1
action ASPIDER2FROZEN 5 1 5 1 10

move SPIDER2VELS 128
move SPIDER2CEILVELS 128 -15
move SPIDER2VELSUP 128 -64
move SPIDER2CHARGEVELS 192
move SPIDER2SHRUNKVELS 24
move SPIDER2UP 0 -160


ai AISPIDER2WAIT SPIDER2STAND STOP geth
ai AISPIDER2SEEK SPIDER2WALK SPIDER2VELS seekplayer faceplayerslow
ai AISPIDER2SHOOT SPIDER2STAND STOP faceplayersmart
ai AISPIDER2CHARGE SPIDER2WALK SPIDER2CHARGEVELS faceplayer
ai AISPIDER2SUFFER SPIDER2FLIP STOP geth
ai AISPIDER2DYING SPIDER2DIE STOP geth
ai AISPIDER2FLIPUP SPIDER2FLIP SPIDER2UP getv
ai AISPIDER2FLIPDOWN SPIDER2FLIP STOP geth
ai AISPIDER2FROZEN SPIDER2STAND STOP geth
ai AISPIDER2SHRUNK SPIDER2WALK SPIDER2SHRUNKVELS fleeenemy
ai AISPIDER2JUMP SPIDER2JUMP SPIDER2CHARGEVELS jumptoplayer

useractor enemy SPIDER2 60

ifai 0
{
	sound SPIDER_SIGHT
	spawn SHOOTME
	ai AISPIDER2WAIT
	state monst_glow
	spriteflags NORMAL_ENEMY
	ifspritepal 0 { strength 80 sizeat 36 36 }
	ifspritepal 11 { strength 40 sizeat 24 24 }
	ifspritepal 21 { strength 20 sizeat 16 16 }
	ifspritepal 36 { strength 160 sizeat 40 40 }
	ifspritepal 56 { strength 160 sizeat 60 60 }
	ifspritepal 12 { strength 800 sizeat 60 60 }
}

state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage


ife ALLY_MAG 0 fall // don't fall if on the ceiling

ifaction SPIDER2DEAD
{
	cstat 0
	strength 0
	ifhitweapon  { guts JIBS6 5 killit }
	break
}
ifaction ASPIDER2FROZEN
{
	move 0
	state frozen_code
}
ifai AISPIDER2DYING
{
	ifactioncount 6 
		action SPIDER2DEAD
	break
}

ifai AISPIDER2SUFFER cstat 265 else
{
	cstat 257
	ife ALLY_MAG 3 cstator 8
}

ife ALLY_MAG 3
{
	ifceilingdistl 4
	{
		ifpdistl 8192 ifrnd 1
		{
			set ALLY_MAG 0
			ai AISPIDER2FLIPDOWN
		}
		ifbulletnear
		{
			set ALLY_MAG 0
			ai AISPIDER2FLIPDOWN
		}
	}
}

ifai AISPIDER2SUFFER
{
ifrnd 4 sound SPIDER_PAIN
	strength 0
	ifaction SPIDER2FLIP
	{
		ifactioncount 6
		{
			action SPIDER2WALK
			resetcount
		}
		break
	}
	
	ifpdistl 1024 ifl sprite[].yrepeat 25 { sound SMALL_CRUSH pstomp }
	
	ifhitweapon
	ifcount 12  
	{
		addkills 1	
		state thegames_score
		shoot NJIB2 shoot NJIB2 shoot NJIB2
		sound SPIDER_DIE
		ai AISPIDER2DYING
		cstat 0
		break
    }
	ifcount 208
	  ai AISPIDER2SEEK
	break
}

// ifaction SPIDER2WALK ifactioncount 2 { resetactioncount sound SPIDWALK }

geta[].htextra TEMP
ifhitweapon
{
state NEWGUNEFFECTS
	ife ALLY_MAG 0 nullop else
	{
		set ALLY_MAG 0
		ai AISPIDER2FLIPDOWN
	}
	ifai AISPIDER2WAIT ai AISPIDER2SEEK
	ifdead
	{
	ifg ICE_DAMAGE 0
		{
		  sound SOMETHINGFROZE
		  spritepal 1
		  move 0
		  action ASPIDER2FROZEN
		  strength 0
		  break
		}
		ifg FIRE_DAMAGE 0
		{
		shoot NJIB2 shoot NJIB2 shoot NJIB2
		sound ENGULF_FIRE
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			addkills 1	
			state thegames_score
			ai AISPIDER2DYING
			cstat 0
			break
    	}
		ifg sprite[].htextra 60
		{
		shoot NJIB2 shoot NJIB2 shoot NJIB2
			addkills 1	
			state thegames_score
			ai AISPIDER2DYING
			cstat 0
			break
    	}
		ai AISPIDER2SUFFER
		ifwasweapon RPG 
		{
		shoot NJIB2 shoot NJIB2 shoot NJIB2
			addkills 1	
			state thegames_score
			ai AISPIDER2DYING
			cstat 0
			break
    	}
		ifwasweapon RADIUSEXPLOSION 
		{
		shoot NJIB2 shoot NJIB2 shoot NJIB2
			addkills 1	
			state thegames_score
			ai AISPIDER2DYING
			cstat 0
			break
    	}
		break
	}
}

ifai AISPIDER2SHOOT
{
	ifcount 18 action SPIDER2SHOOT
	
	ifcount 21
	{
		resetcount
		action SPIDER2STAND
		ifcansee
		{
			ifpdistg 8192 ai AISPIDER2SEEK else
			ifrnd 64 ai AISPIDER2WAIT
		}
		else ai AISPIDER2SEEK
	}
	ifcount 20
	{
	ifspritepal 12
	 ifl INTERNALCOUNT 40
		{
		espawn SPIDER2
		add INTERNALCOUNT 1
		ifrnd 128 { seta[RETURN].xrepeat 24 seta[RETURN].yrepeat 24 seta[RETURN].pal 11 }
		else { seta[RETURN].xrepeat 16 seta[RETURN].yrepeat 16 seta[RETURN].pal 21 }
		}
	else shoot SPIT
	}
	ifp pstanding 0 ai AISPIDER2CHARGE
	
}

ifai AISPIDER2CHARGE
{
	ife ALLY_MAG 0 nullop else
	{
		getp[].i spriteid
		ldist xydist THISACTOR spriteid
		ifl xydist 2048
		{
			set ALLY_MAG 0
			ai AISPIDER2FLIPDOWN
			break
		}
		ifnotmoving
		{
			set ALLY_MAG 0
			ai AISPIDER2FLIPDOWN
			break
		}
	}
	ifpdistl 1536 
	{
		ifcount 13 ifrnd 64
		{
			sound SCRATCHS
			ifspritepal 11 shoot 23533 else
			ifspritepal 21 shoot 23533 else
			ifspritepal 56 addphealth -100 else
			shoot 4609
			// resetcount
			move STOP faceplayer
		}
		
	}
	else ifmove STOP move SPIDER2CHARGEVELS faceplayer
	ifnotmoving ifcount 14 iffloordistl 4 ai AISPIDER2JUMP else
	ifcount 52 ai AISPIDER2WAIT
}

ifai AISPIDER2JUMP
	ifcount 8 ai AISPIDER2SEEK


ifai AISPIDER2WAIT
{
	 ifoutside 
	 {
		 ife ALLY_MAG 0 nullop else
		 {
			 set ALLY_MAG 0
			 ai AISPIDER2FLIPDOWN
			 break
		 }
	 }
	    
	 else ife ALLY_MAG 0
	    iffloordistl 8
	       	 ifrnd 6
     {
	     ifgapzl 512
	     {
		     ifgapzl 48 nullop else
		     {
			     set ALLY_MAG 3
			     ai AISPIDER2FLIPUP
			     espawn 23526
			     ifl sprite[].xrepeat 30 seta[RETURN].pal 3
	     		 break
     		 }
 		 }
	 }    
    
	ifcount 32 ifrnd 8
	{
		ifcansee
		    move SPIDER2VELS faceplayer
		ai AISPIDER2SEEK
	}
	
}


ifai AISPIDER2FLIPUP
{
	ifaction SPIDER2FLIP
	{
		ifactioncount 6
			action SPIDER2STAND
	}
	
	ifceilingdistl 48
		ai AISPIDER2WAIT
}

ifai AISPIDER2FLIPDOWN
	ifactioncount 6
		ai AISPIDER2SEEK
	
ifai AISPIDER2SEEK
{
ifrnd 4 sound SPIDER_ROAM
    ifp palive
      	ifcansee
        	ifcount 20
        	{

        		ifpdistl 3072 ifrnd 8
        		{
	        		ai AISPIDER2CHARGE
	        		break
        		}

    			ifpdistl 10240 ifg sprite[].xrepeat 24
    			{
				  ai AISPIDER2SHOOT
				  break
			    }
    		}

    ife ALLY_MAG 0 ifnotmoving ifcount 24 iffloordistl 4
	{
		ai AISPIDER2JUMP
		break
	}
	ife ALLY_MAG 3 
	{
		ifmove SPIDER2VELS move SPIDER2CEILVELS seekplayer faceplayerslow getv
		fall
		
		ifnotmoving ifcount 6 ifrnd 16
		{
			set ALLY_MAG 0
			ai AISPIDER2FLIPDOWN
			break
		}
		ifceilingdistl 48 nullop else 
		{
			ai AISPIDER2FLIPDOWN
			set ALLY_MAG 0
		}
		ifoutside
		{
			ai AISPIDER2FLIPDOWN
			set ALLY_MAG 0
		}
	}
	
	ifcount 52
     	ifrnd 16
     		ai AISPIDER2WAIT
}

enda

// ******************************************************************************
// SHAMBLER
// ******************************************************************************

action ASHAMBLER_IDLE 0 2 5 1 30
action ASHAMBLER_MOVE 10 6 5 1 6
action ASHAMBLER_DIE 80 5 1 1 20
action ASHAMBLER_MELEE 40 3 5 1 12
action ASHAMBLER_CHARGE 55 2 5 1 8
action ASHAMBLER_FIRE 65 2 5 1 2
action ASHAMBLER_PAIN 75 1 5 1 10
action ASHAMBLER_DEAD 85 1 1 1 10

move SHAMBLER_MOVE 196 0

ai AISHAMBLER_IDLE ASHAMBLER_IDLE STOP
ai AISHAMBLER_MOVE ASHAMBLER_MOVE SHAMBLER_MOVE seekplayer
ai AISHAMBLER_MELEE ASHAMBLER_MELEE STOP faceplayer
ai AISHAMBLER_CHARGE ASHAMBLER_CHARGE STOP faceplayer
ai AISHAMBLER_FIRE ASHAMBLER_FIRE STOP faceplayer
ai AISHAMBLER_PAIN ASHAMBLER_PAIN STOP
ai AISHAMBLER_DIE ASHAMBLER_DIE STOP

useractor enemystayput SHAMBLER_STAYPUT 3000 ASHAMBLER_IDLE state monst_glow cactor SHAMBLER enda

spriteshadow SHAMBLER

useractor enemy SHAMBLER 3000 ASHAMBLER_IDLE
fall

ifai 0
{
	cstat 257
	spawn SHOOTME
	globalsound SHAMB_SIGHT
	ai AISHAMBLER_MOVE
    set CURBOSS THISACTOR
	state monst_glow
	spriteflags NORMAL_ENEMY
	sizeat 60 60
	strength 3000
}

state enemyfloordamage
state enemy_fire_damage

ifaction ASHAMBLER_DEAD
{
move STOP
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state squish_sounds
      state standard_jibs
	  state standard_jibs
	  state monst_body_jibs
      killit
    }
}
else
ifai AISHAMBLER_DIE
{
move STOP
ifactioncount 5
	{
	quake 26
	sound BOSSFALL
	action ASHAMBLER_DEAD
	}
}
else
ifai AISHAMBLER_IDLE
{
move STOP
ifp palive ai AISHAMBLER_MOVE
}
else
ifai AISHAMBLER_MOVE
{
ifrnd 4 sound SHAMB_ROAM
ifp pdead ai AISHAMBLER_IDLE
ifpdistl 1536
 ifrnd 96
   ifp palive
		{
		soundonce SHAMB_MELEE
		ai AISHAMBLER_MELEE
		}
	else
	{
	state correctcansee
	ife sightvar YES
		ifrnd 16
			{
			ai AISHAMBLER_CHARGE
			}
		else ifrnd 8 ai AISHAMBLER_MOVE
	}
}
else
ifai AISHAMBLER_CHARGE
{
soundonce SPELL2AMB
ife SKILL_LEVEL 1 ifactioncount 15 ai AISHAMBLER_FIRE
ife SKILL_LEVEL 2 ifactioncount 10 ai AISHAMBLER_FIRE
ife SKILL_LEVEL 3 ifactioncount 8 ai AISHAMBLER_FIRE
ife SKILL_LEVEL 4 ifactioncount 6 ai AISHAMBLER_FIRE
ife SKILL_LEVEL 5 ifactioncount 4 ai AISHAMBLER_FIRE
}
else
ifai AISHAMBLER_FIRE
{
stopactorsound THISACTOR SPELL2AMB
ifactioncount 2 
	{
	ifpdistg 16384
		{
		flash
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		globalsound SHAMB_ATTACK
		globalsound LIGHTNING_SLAP2
		shoot 20834
		}
	else
		{
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		globalsound SHAMB_ATTACK
		shoot 22610
		shoot 22610
		shoot 22610
		shoot 22610
		shoot 22610
		shoot 22610
		shoot 22610
		}
	}
ifactioncount 3 ai AISHAMBLER_MOVE
}
else
ifai AISHAMBLER_MELEE
{
ifactioncount 4 nullop
 else ifactioncount 3
	{
	sound SHAMB_SCRATCH
	eshoot 17849 
	resetactioncount
	}
ifpdistg 1536 ai AISHAMBLER_MOVE
}
else
ifai AISHAMBLER_PAIN
{
    ifrnd 128 guts JIBS6 2 
   sub PAIN_AMOUNT 1
    ifl PAIN_AMOUNT 1 ai AISHAMBLER_MOVE
}

geta[].htextra TEMP
ifhitweapon
{
state NEWGUNEFFECTS
    ifrnd 32 guts JIBS6 1 
	ifwasweapon RPG 
		{
		divvar TEMP 2
		seta[].htextra TEMP
		set PAIN_AMOUNT 0
    	}
	ifwasweapon RADIUSEXPLOSION 
		{
		divvar TEMP 2
		seta[].htextra TEMP
		set PAIN_AMOUNT 0
    	}

	ifai AISHAMBLER_IDLE ai AISHAMBLER_MOVE
	ifdead
	{
		sound SHAMB_DIE
		ifg FIRE_DAMAGE 0
		{
		shoot NJIB2 shoot NJIB2 shoot NJIB2
		sound ENGULF_FIRE
		shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
			addkills 1	
			state thegames_score
			state rf
			ai AISHAMBLER_DIE
			break
    	}
		ifwasweapon RPG 
		{
		shoot NJIB2 shoot NJIB2 shoot NJIB2
			addkills 1	
			state thegames_score
			state rf
			ai AISHAMBLER_DIE
			break
    	}
		ifwasweapon RADIUSEXPLOSION 
		{
		shoot NJIB2 shoot NJIB2 shoot NJIB2
			addkills 1	
			state thegames_score
			state rf
			ai AISHAMBLER_DIE
			break
    	}
		addkills 1	
		state thegames_score
		ai AISHAMBLER_DIE
		cstat 0
		break
	}
	else ifg PAIN_AMOUNT 0 ai AISHAMBLER_PAIN
	else ifrnd 16 { state PAIN_SKILL_LEVELADJUST sound SHAMB_PAIN ai AISHAMBLER_PAIN }
}

enda

// =============================================================================================================
// PIGCOP BOSS version .91, Jan 29, 2018
// sprites by sebabdukeboss20, code by Dan Gaskill
// thanks to JBlade for extracting and arranging sprites
// =============================================================================================================

spriteshadow PIGBOSSGUN

define PIGBOSSSTRENGTH 4500
define PIGBOSSPALSTRENGTH 1000
define PIGBMELEEDAMAGE 80
define PALPIGBMELEEDAMAGE 40

spriteflags PIGBOSS 5251072
// HURTSPAWNBLOOD + NODAMAGEPUSH + SMOOTHMOVE

action APIGBOSSSTAND	0  1 5 1 10
action APIGBOSSWALK     0  4 5 1 20
action APIGBOSSRUN      0  4 5 1 11
action APIGBOSSSHOOT1    20 1 5 1 17
action APIGBOSSSHOOT2    25 1 5 1 17
action APIGBOSSSHOOT3    30 1 5 1 17
action APIGBOSSSHOOT4    35 1 5 1 17
action APIGBOSSMELEE	40 3 1 1 15
action APIGBOSSTAUNTFORW    43 3 1 1 6
action APIGBOSSTAUNTBACK    45 3 1 -1 12
action APIGBOSSROAR		46 3 1 1 30
action APIGBOSSSTOMP1	50 1 1 1 30
action APIGBOSSSTOMP2   49 1 1 1 30
action APIGBOSSDYING    51 6 1 1 18
action APIGBOSSHIT      51 1 1 1 12
action APIGBOSSDEAD     56 1 1 1 1
action APIGBOSSFROZEN    20 1 5 1 10
action APIGBOSSGROW      51 1 5 1 10

move PIGBOSSWALKVELS 112
move PIGBOSSRUNVELS 212
move PIGBOSSRUNFACEVELS 288
move PIGBOSSSTOPPED
move PIGBOSSSRUNKVELS 32

ai AIPIGBOSSWAIT APIGBOSSSTAND PIGBOSSSTOPPED geth
ai AIPIGBOSSROAR APIGBOSSROAR PIGBOSSSTOPPED faceplayer
ai AIPIGBOSSSEEK APIGBOSSWALK PIGBOSSWALKVELS seekplayer
ai AIPIGBOSSSHOOT APIGBOSSSHOOT1 PIGBOSSSTOPPED faceplayer
ai AIPIGBOSSCHARGE APIGBOSSRUN PIGBOSSRUNVELS seekplayer
ai AIPIGBOSSMELEE APIGBOSSMELEE PIGBOSSWALKVELS faceplayer
ai AIPIGBOSSTAUNT APIGBOSSTAUNTFORW PIGBOSSSTOPPED faceplayer

ai AIPIGBOSSDYING APIGBOSSDYING PIGBOSSSTOPPED geth
ai AIPIGBOSSFROZEN APIGBOSSFROZEN PIGBOSSSTOPPED geth
ai AIPIGBOSSSHRUNK APIGBOSSWALK PIGBOSSSRUNKVELS fleeenemy
ai AIPIGBOSSGROW APIGBOSSGROW PIGBOSSSTOPPED geth
ai AIPIGBOSSHIT APIGBOSSHIT PIGBOSSSTOPPED faceplayer

defstate spawngunstate
	espawn PIGBOSSGUN
	setactor[RETURN].xrepeat sprite[THISACTOR].xrepeat
	setactor[RETURN].yrepeat sprite[THISACTOR].yrepeat
	setactor[RETURN].pal sprite[THISACTOR].pal
	getactor[RETURN].z PIGBVAR
	subvar PIGBVAR 6144
	setactor[RETURN].z PIGBVAR
ends

defstate pigbosshitstate

	ifactioncount 2 
	{
		ifrnd 32
		{
			ai AIPIGBOSSROAR
			ifrnd 128 globalsound PIGBROAR else globalsound PIGBROAR2
		}
		else
		ai AIPIGBOSSCHARGE
	}

ends

defstate pigbossroarstate

	// damage resistance during roar to prevent cheap kills
	ifvarg sprite[THISACTOR].htextra 0
	{
		getactor[THISACTOR].htextra PIGBVAR
		divvar PIGBVAR 2
		setactor[THISACTOR].htextra PIGBVAR
	}
	ifactioncount 6 ai AIPIGBOSSCHARGE

ends

defstate pigbosstauntstate

	ifvarg sprite[THISACTOR].htextra 0
	{
		getactor[THISACTOR].htextra PIGBVAR
		divvar PIGBVAR 2
		setactor[THISACTOR].htextra PIGBVAR
	}
	
	ifaction APIGBOSSSTOMP1
	{
		ifactioncount 1 
		{
			sound PGBSTOMP
			action APIGBOSSSTOMP2
			add PIGBRESET 1
			set PIGBVAR NO
			ifspritepal 0 ifpdistl 8192 set PIGBVAR YES
			else ifpdistl 6144 set PIGBVAR YES
			ife PIGBVAR YES
			{
				wackplayer
				setp[].poszv -2048
				getp[].posz PIGBVAR
				sub PIGBVAR 1024
				setp[].posz PIGBVAR
			}
			ifpdistl 10240 quake 15
			
		}
		break
	}
	ifaction APIGBOSSSTOMP2
	{
		ifactioncount 1
		{
			ifvarg PIGBRESET 1
			{
				setvar PIGBRESET 0
				ai AIPIGBOSSCHARGE
				break
			}
			else action APIGBOSSSTOMP1
		}
	}
	
	ifaction APIGBOSSTAUNTFORW ifactioncount 3 
	{
		action APIGBOSSTAUNTBACK		
		ifspritepal 0 { quake 30 sound BIGDOORSLAM3 } else sound INTRO4_5
		addvar PIGBRESET 1
	}
	ifaction APIGBOSSTAUNTBACK ifactioncount 3 
	{
		ifvarg PIGBRESET 1
		{
			setvar PIGBRESET 0
			ai AIPIGBOSSCHARGE
			break
		}
		action APIGBOSSTAUNTFORW
	}
ends

defstate pigbossgrowstate

	state genericgrowcode
	sizeto 255 192

ends

defstate pigbossshrunkstate

  ifcount SHRUNKDONECOUNT
    ai AIPIGBOSSSEEK
  else
    ifcount SHRUNKCOUNT
	{
	  ifspritepal 0 { sizeto 90 80 sizeto 90 80 }
	  else
      sizeto 48 40
	}
  else
    state genericshrunkcode

ends

defstate pigbossfrozenstate

    ifcount THAWTIME
    {
      ai AIPIGBOSSSEEK
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
	  state spawngunstate
      addkills 1 
	  // state enemy_death

      ifrnd 84
        spawn BLOODPOOL
	  lotsofglass 30
      // state standard_jibs
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
  
ends

defstate pigbossseekstate

	ifrnd 1 sound PIGBROAM1
	else
	ifrnd 1
	{
		ai AIPIGBOSSROAR
		ifrnd 128 globalsound PIGBROAR else globalsound PIGBROAR2
		break
	}

	ifcount 20 
		ifcansee
	{
		ifrnd 32
			ifpdistl 8192
				ai AIPIGBOSSCHARGE
					
		ifrnd 3
		{
			ifrnd 128
			ai AIPIGBOSSSHOOT
			else
			ai AIPIGBOSSCHARGE
		}
	}
ends

defstate pigbossfire
	ifrnd 128 sound M4A1_FIRE
	else
	sound PIG_ATTACK
	spawn SHOTGUNSHELL
	shoot SHOTSPARK1
	shoot SHOTSPARK1
	shoot SHOTSPARK1
	shoot SHOTSPARK1
	ifspritepal 0
	{
		shoot SHOTSPARK1
		shoot SHOTSPARK1
		shoot SHOTSPARK1
	}
ends

defstate pigbossshootstate

	ifaction APIGBOSSSHOOT1
	{
		ifactioncount 1 
		{
			action APIGBOSSSHOOT2
			state pigbossfire
			move PIGBOSSSTOPPED faceplayerslow
		}
	}
	
	ifaction APIGBOSSSHOOT2
	{
		ifactioncount 1 
		{
			action APIGBOSSSHOOT3
			state pigbossfire
		}
	}
	
	ifaction APIGBOSSSHOOT3
	{
		ifactioncount 1 
		{
			action APIGBOSSSHOOT4
			ifrnd 128
				state pigbossfire
			else
			{
				geta[].x bossx
				geta[].y bossy
				geta[].ang bossang
				sub bossang 512
				set PIGBVAR bossx
				add PIGBVAR 384
				rotatepoint sprite[].x sprite[].y PIGBVAR sprite[].y bossang newx newy
				seta[].x newx
				seta[].y newy
				
				sound RPG_SHOOT
				eshoot MORTER2
				getactor[RETURN].zvel PIGBVAR
				subvar PIGBVAR 1280
				setactor[RETURN].zvel PIGBVAR
		
				seta[].x bossx
				seta[].y bossy
			}
			
			
		}
	}
	
	ifaction APIGBOSSSHOOT4
	{
		ifactioncount 1
		{
			addvar PIGBRESET 1
			ifvarg PIGBRESET 1
			ifrnd 192
			{
				setvar PIGBRESET 0
				ai AIPIGBOSSWAIT
			}
			else 
			{
				action APIGBOSSSHOOT2
				state pigbossfire
			}
		}
	}

ends

defstate pigbosswaitstate

	ifactioncount 2 ai AIPIGBOSSSEEK

ends

defstate pigbossmeleestate

	ifactioncount 1
	{
		ifpdistl 1816
		ifcansee ifcanshoottarget
		ifvare PIGBRESET NO
		{
			set PIGBRESET YES
			ifactorsound THISACTOR PIGBSMACK nullop else
			sound PIGBSMACK
			palfrom 48 63
			wackplayer
			setplayer[THISACTOR].weapon_pos -9
			setplayer[THISACTOR].kickback_pic 0
			getplayer[THISACTOR].i PIGBVAR
			ifspritepal 0
			setactor[PIGBVAR].htextra PIGBMELEEDAMAGE
			else setactor[PIGBVAR].htextra PALPIGBMELEEDAMAGE
			setactor[PIGBVAR].htpicnum KNEE
			setactor[PIGBVAR].htowner THISACTOR
			setactor[PIGBVAR].htang sprite[THISACTOR].ang
			
			getp[].ang PIGBVAR
			add PIGBVAR 1024
			cos PIGBVAR2 PIGBVAR
			sin PIGBVAR3 PIGBVAR
			shiftvarl PIGBVAR2 9
			shiftvarl PIGBVAR3 9
			ifspritepal 0 { shiftvarl PIGBVAR2 1 shiftvarl PIGBVAR3 1 }
			setplayer[THISACTOR].posxv PIGBVAR2
			setplayer[THISACTOR].posyv PIGBVAR3
			// push player backwards
		}
		
	}
	ifactioncount 3 { ai AIPIGBOSSWAIT set PIGBRESET NO }

ends

defstate pigbosschargestate

	ifrnd 1 sound PIGBROAM2

	ifcansee
		ifcanshoottarget
	{
		ifmove PIGBOSSRUNVELS move PIGBOSSRUNFACEVELS faceplayersmart
		ifmove PIGBOSSRUNFACEVELS ifpdistl 1560 ifcansee
		{
			ai AIPIGBOSSMELEE
			sound PIGBMELEE
			sound PIGBSWING
			break
		}
		
		ifcount 40 ifrnd 12 ai AIPIGBOSSSHOOT
	}
	
	ifcount 30 ifrnd 6 
	{
		ai AIPIGBOSSTAUNT
		ifrnd 96 action APIGBOSSSTOMP1
	}
	else
	ifcount 90 ifrnd 6 ai AIPIGBOSSSEEK

ends

useractor enemystayput PIGBOSSSTAYPUT PIGBOSSSTRENGTH cactor PIGBOSS enda

useractor enemy PIGBOSS PIGBOSSSTRENGTH

fall
ifai 0 
{
	spawn SHOOTME
	ai AIPIGBOSSROAR
	quake 26 
	ifrnd 128 globalsound PIGBROAR 
	else globalsound PIGBROAR2 
	ifspritepal 0 
		{
		set CURBOSS THISACTOR
		set BOSS_TYPE 1
		sizeat 90 80
		}
	else
	{
		sizeat 48 40
		strength PIGBOSSPALSTRENGTH
	}
	cstat 257
}

ifai AIPIGBOSSDYING
{
	strength 0
	
	ifaction APIGBOSSDYING
	{
		ifactioncount 5
		{
			globalsound BOSSFALL
			quake 90
			cstat 0
			action APIGBOSSDEAD
			state spawngunstate
			ifrnd 128 setactor[RETURN].cstat 4
			ifhitweapon { }
			break
		}
	}
	ifaction APIGBOSSDEAD
	{
		ifn HITAGSAVED 0
			{
			operateactivators HITAGSAVED THISACTOR
			set HITAGSAVED 0
			}
		ifhitweapon
		{
			ifwasweapon RPG
			{
				sound SQUISHED
				spawn BLOODPOOL
				state standard_jibs
				state standard_jibs
				killit
			}
			ifwasweapon RADIUSEXPLOSION
			{
				sound SQUISHED
				spawn BLOODPOOL
				state standard_jibs
				state standard_jibs
				killit
			}
		}
	}
	
	break
}

ifai AIPIGBOSSFROZEN { state pigbossfrozenstate break }
ifai AIPIGBOSSGROW { state pigbossgrowstate break }

ifai AIPIGBOSSHIT state pigbosshitstate else
ifai AIPIGBOSSSHRUNK state pigbossshrunkstate else
ifai AIPIGBOSSROAR state pigbossroarstate else
ifai AIPIGBOSSTAUNT state pigbosstauntstate else
ifai AIPIGBOSSSEEK state pigbossseekstate else
ifai AIPIGBOSSCHARGE state pigbosschargestate else
ifai AIPIGBOSSMELEE state pigbossmeleestate else
ifai AIPIGBOSSSHOOT state pigbossshootstate else
ifai AIPIGBOSSWAIT state pigbosswaitstate


ifhitweapon
{

state NEWGUNEFFECTS
    ifwasweapon SHRINKSPARK
	{
		ifstrength 600
		{
		  sound ACTOR_SHRINKING
		  ai AIPIGBOSSSHRUNK
		  // set shrunken 1
		  break
		}
		else addstrength -60
	}
	else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
	ifdead
	{
		ifwasweapon FREEZEBLAST
		{
		  sound SOMETHINGFROZE
		  spritepal 1
		  ai AIPIGBOSSFROZEN
		  strength 0
		  // state freezeme
		  break
		}
		ifwasweapon GROWSPARK
		{
		  cstat 0
		  sound ACTOR_GROWING
		  ai AIPIGBOSSGROW
		  break
		}
		addkills 1
		ai AIPIGBOSSDYING
		guts JIBS6 8
		ifspritepal 0 { globalsound PIGBDIE break }
		ifwasweapon RPG
		{
			state spawngunstate
			sound SQUISHED
			spawn BLOODPOOL
			state standard_jibs
			state standard_jibs
			killit
        }
		ifwasweapon RADIUSEXPLOSION
		{
			state spawngunstate
			sound SQUISHED
			spawn BLOODPOOL
			state standard_jibs
			state standard_jibs
			killit
        }
		sound PIGBDIE
		break
	}
	ifrnd 2
		spawn BLOODPOOL
	ifai AIPIGBOSSHIT nullop else
	ifai AIPIGBOSSMELEE nullop else
	ifai AIPIGBOSSSHRUNK nullop else
	{
		ifrnd 16 { sound PIGBPAIN ai AIPIGBOSSHIT setvar PIGBRESET 0 break }
		ifrnd 64 
		{
			sound PIGBPAIN
			ifai AIPIGBOSSSHOOT nullop else ai AIPIGBOSSSHOOT
		}
	}
}

// animation test code
// ifaction APIGBOSSTAUNTFORW ifactioncount 3 action APIGBOSSTAUNTBACK
// ifaction APIGBOSSTAUNTBACK ifactioncount 3 action APIGBOSSTAUNTFORW

// ifhitspace ifcount 10
// {
	// resetcount
	// ifaction APIGBOSSSTAND action APIGBOSSWALK else
	// ifaction APIGBOSSWALK action APIGBOSSRUN else
	// ifaction APIGBOSSRUN action APIGBOSSSHOOT else
	// ifaction APIGBOSSSHOOT action APIGBOSSMELEE else
	// ifaction APIGBOSSMELEE action APIGBOSSROAR else
	// ifaction APIGBOSSROAR action APIGBOSSHIT else
	// ifaction APIGBOSSHIT action APIGBOSSDYING else
	// ifaction APIGBOSSDYING action APIGBOSSDEAD else
	// ifaction APIGBOSSDEAD action APIGBOSSSTAND
// }

enda

move PIGBOSSGUNSLIDE 192
move PIGBOSSGUNSTOP

useractor notenemy PIGBOSSGUN 0

fall
ifmove 0 move PIGBOSSGUNSLIDE randomangle
ifcount 10 ifmove PIGBOSSGUNSLIDE move PIGBOSSGUNSTOP

ifmove PIGBOSSGUNSTOP
ifp palive     
    ifpdistl RETRIEVEDISTANCE
        ifcanseetarget
{
	state randgetweapsnds
    palfrom 24 0 32
	spawn FIRSTGUNSPRITE
	spawn SHOTGUNSPRITE
	spawn CHAINGUNSPRITE
	killit
}

enda

appendevent EVENT_LOADACTOR

ifactor PIGBOSS
{
	geta[].hitag HITAGSAVED
	seta[].hitag 0
	action APIGBOSSSTAND
	ifspritepal 0 
		sizeat 90 80
	else
	{
		sizeat 48 40
		strength PIGBOSSPALSTRENGTH
	}
	cstat 257
}
ifactor PIGBOSSSTAYPUT
{
	geta[].hitag HITAGSAVED
	seta[].hitag 0
	ifspritepal 0 
		sizeat 90 80
	else
	{
		sizeat 48 40
		strength PIGBOSSPALSTRENGTH
	}
	cstat 257
}

endevent

appendevent EVENT_KILLIT

ifactor MORTER2 { debris SCRAP1 3 debris SCRAP2 3 }

endevent


// =====================================================================================================
// CYBER ENFORCER BOSS
// sprites by sebabdukeboss20, code by Dan Gaskill
// =====================================================================================================

define LIZBOSSSTRENGTH 6000
define LIZBOSSPALSTRENGTH 2000

spriteshadow LIZMINE

spriteflags LIZBOSS 5251072
// HURTSPAWNBLOOD + NODAMAGEPUSH + SMOOTHMOVE

action ALIZBOSSWALKING     	0   4  5  1  22
action ALIZBOSSRUNNING     	0   4  5  1  14
action ALIZBOSSSTARTSHOOT	20  1  5  1  20
action ALIZBOSSSHOOT1		25	1  5  1  5
action ALIZBOSSSHOOT2		30  1  5  1  5
action ALIZBOSSFLY      	63  1  5  1  10
action ALIZBOSSFALL      	35  1  5  1  10
action ALIZBOSSSTAND     	40  1  5  1  10
action ALIZBOSSSQUAT     	45  1  5  1  60
action ALIZSQUATDONE		50  1  5  1  30
action ALIZBOSSFROZEN     	50  1  5  1  10
action ALIZBOSSFLINTCH 		55  1  1  1  10
action ALIZBOSSGROW 		55  1  1  1  10
action ALIZBOSSDYING     	55  6  1  1  20
action ALIZBOSSLYINGDEAD   	60  1  1  1  10

move LIZBOSSSTOPPED
move LIZBOSSSHRUNKVELS 32
move PALLIZBOSSWALKVEL 96
move LIZBOSSWALKVEL 132
move LIZBOSSRUNVEL 280
move LIZBOSSJUMPVEL 416 -208
move LIZBOSSFALLVEL 416

ai AILIZBOSSWAIT			ALIZBOSSSTAND LIZBOSSSTOPPED geth
ai AILIZBOSSSEEK			ALIZBOSSWALKING LIZBOSSWALKVEL seekplayer
ai AILIZBOSSCHARGE			ALIZBOSSRUNNING LIZBOSSRUNVEL faceplayersmart
ai AILIZBOSSSHOOT			ALIZBOSSSTARTSHOOT LIZBOSSSTOPPED faceplayer
ai AILIZBOSSDYING			ALIZBOSSDYING LIZBOSSSTOPPED geth
ai AILIZBOSSHIT				ALIZBOSSFLINTCH LIZBOSSSTOPPED faceplayer
ai AILIZBOSSFROZEN			ALIZBOSSFROZEN LIZBOSSSTOPPED geth
ai AILIZBOSSSHRUNK			ALIZBOSSRUNNING LIZBOSSSHRUNKVELS fleeenemy
ai AILIZBOSSGROW			ALIZBOSSGROW LIZBOSSSTOPPED geth
ai AILIZBOSSJUMP			ALIZBOSSFLY LIZBOSSJUMPVEL geth getv
ai AILIZLAYMINE				ALIZBOSSSTAND LIZBOSSSTOPPED geth

defstate lizbosshitstate
	ifcount 9 ai AILIZBOSSWAIT
ends

defstate lizbosschargestate

	ifrnd 2
	{
		ifrnd 128
		sound CYBOSS_ROAM1
		else
		sound CYBOSS_ROAM2
	}
	ifcount 30
	{
		ifcansee { ai AILIZBOSSSHOOT sound CYBOSS_ATTK }
		ifcount 60 ai AILIZBOSSSEEK
	}

ends

defstate lizbossseekstate

	ifrnd 2
	{
		ifrnd 128
		sound CYBOSS_ROAM1
		else
		sound CYBOSS_ROAM2
	}
	ifcount 10
	ifcansee ifpdistl 6144
	{
		ifrnd 8 { ai AILIZBOSSSHOOT sound CYBOSS_ATTK }
		else ifrnd 12 ai AILIZBOSSCHARGE
	}
	
	ifrnd 4 ifpdistg 6144 ai AILIZBOSSWAIT
	

ends

defstate lizbossshootstate

	ifaction ALIZBOSSSTARTSHOOT
	{
		ifactioncount 2
		{
			action ALIZBOSSSHOOT1
			globalsound DISTANT_RIFLE
			sound BOS1_ATTACK1
			shoot SHOTSPARK1
			ifspritepal 0 shoot SHOTSPARK1
			move LIZBOSSSTOPPED faceplayerslow
		}
	}
	ifaction ALIZBOSSSHOOT1
	{
		ifactioncount 1
		{
			action ALIZBOSSSHOOT2
			ifpdistg 10240 ifrnd 64
			{
				geta[].x bossx
				geta[].y bossy
				geta[].ang bossang
				sub bossang 512
				set LIZBVAR bossx
				ifspritepal 0 add LIZBVAR 1024
				else
				add LIZBVAR 512
				rotatepoint sprite[].x sprite[].y LIZBVAR sprite[].y bossang newx newy
				seta[].x newx
				seta[].y newy
				sound ERPG_SHOOT
				
				eshoot RPG
				ifspritepal 0
				{
					seta[RETURN].xrepeat 40
					seta[RETURN].yrepeat 40
					seta[RETURN].extra 65
				}
				seta[].x bossx
				seta[].y bossy
				break
			}
			sound M4A1_FIRE
			globalsound DISTANT_RIFLE
			shoot SHOTSPARK1
			shoot SHOTSPARK1
			ifspritepal 0 
			{
				shoot SHOTSPARK1
				shoot SHOTSPARK1
			}
		}
	}
	ifaction ALIZBOSSSHOOT2
	{
		ifactioncount 1
		{
			ifcount 60
			{
				ai AILIZBOSSSEEK
				break
			}
			action ALIZBOSSSHOOT1
			globalsound DISTANT_RIFLE
			sound BOS1_ATTACK1
		}
	}

ends

defstate lizbossjumpstate
	
	ifaction ALIZBOSSFLY
	{
		ifrnd 8 { sound RPG_SHOOT shoot MORTER }
		espawn EXPLOSION2
		set LIZBVAR 514
		ifrnd 128 orvar LIZBVAR 4
		seta[RETURN].cstat LIZBVAR
		ifspritepal 0 nullop else
		{
			seta[RETURN].xrepeat 28
			seta[RETURN].yrepeat 28
		}
		set LIZBVAR lizjumpx
		set LIZBVAR2 lizjumpy
		sub LIZBVAR sprite[].x
		sub LIZBVAR2 sprite[].y
		getangle LIZBVAR3 LIZBVAR LIZBVAR2
		seta[].ang LIZBVAR3
		
		set LIZBVAR2 sprite[].x
		sub LIZBVAR2 lizjumpx
		mul LIZBVAR2 LIZBVAR2
		
		set LIZBVAR3 sprite[].y
		sub LIZBVAR3 lizjumpy
		mul LIZBVAR3 LIZBVAR3
		add LIZBVAR2 LIZBVAR3
		sqrt LIZBVAR2 LIZBVAR2
		set LIZBVAR lizjumpdist
		div LIZBVAR 2
		ifl LIZBVAR2 LIZBVAR // more than halfway to destination
		{
			action ALIZBOSSFALL
			globalsound CYBOSS_SWOOP
			move LIZBOSSFALLVEL geth
		}
		else
		ifcount 60 
		{
			action ALIZBOSSFALL
			globalsound CYBOSS_SWOOP
			move LIZBOSSFALLVEL geth
		}
	}
	
	ifaction ALIZBOSSFALL
	{
		iffloordistl 8
		{
			globalsound CYBOSS_LAND
			quake 90
			ifspritepal 0
			{
				debris SCRAP1 4
				debris SCRAP2 4
				debris SCRAP3 4
				debris SCRAP4 4
				debris SCRAP5 4
				hitradius 5120 35 50 70 1000
				ifpdistl 7168
				{
					setp[].poszv -2048
					getp[].posz LIZBVAR
					sub LIZBVAR 1024
					setp[].posz LIZBVAR
				}
			}
			else hitradius 4096 20 30 40 50
			
			set LIZBVAR 0
			whilevarn LIZBVAR 48
			{
				add LIZBVAR 1
				espawn SMALLSMOKE
				rand LIZBVAR2 12288
				sub LIZBVAR2 6144
				add LIZBVAR2 sprite[].x
				seta[RETURN].x LIZBVAR2
				rand LIZBVAR2 12288
				sub LIZBVAR2 6144
				add LIZBVAR2 sprite[].y
				seta[RETURN].y LIZBVAR2
			}
			sound CYBOSS_LAYMINE
			ai AILIZLAYMINE
		}
	}

ends

defstate lizbosswaitstate

	ifrnd 16
	ifcansee
		ifpdistg 6144
			ifpdistl 32768
				iffloordistl 8
{
	getplayer[].posx lizjumpx
	getplayer[].posy lizjumpy
	findplayer lizjumpdist
	ai AILIZBOSSJUMP
	globalsound CYBOSS_LAUNCH
}

ifcount 30 ai AILIZBOSSSEEK

ends

defstate lizlayminestate

ifaction ALIZBOSSSTAND
{
	ifactioncount 5
		action ALIZBOSSSQUAT
}
ifaction ALIZBOSSSQUAT
{
	ifactioncount 2
	{
		action ALIZSQUATDONE
		espawn LIZMINE
		seta[RETURN].xrepeat sprite[].xrepeat
		seta[RETURN].yrepeat sprite[].yrepeat
		seta[RETURN].pal sprite[].pal
	}
}
ifaction ALIZSQUATDONE
{
	ifactioncount 2
		ai AILIZBOSSCHARGE
}

ends

defstate lizbossgrowstate

	state genericgrowcode
	sizeto 255 192

ends

defstate lizbossshrunkstate

  ifcount SHRUNKDONECOUNT
    ai AILIZBOSSWAIT
  else
    ifcount SHRUNKCOUNT
	{
	  ifspritepal 0 { sizeto 96 80 sizeto 96 80 }
	  else
      sizeto 48 40
	}
  else
    state genericshrunkcode

ends

defstate lizbossfrozenstate

    ifcount THAWTIME
    {
      ai AILIZBOSSWAIT
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1 
	  // state enemy_death

      ifrnd 84
        spawn BLOODPOOL
	  lotsofglass 30
      // state standard_jibs
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
  
ends

useractor enemy LIZBOSS_JUMP LIZBOSSSTRENGTH

ifai 0
{
	spawn SHOOTME
	quake 26
	globalsound CYBOSS_RECOG
	ai AILIZBOSSJUMP
	cstat 257
	cactor LIZBOSS
	ifspritepal 0 
		{
		sizeat 96 80 
		set CURBOSS THISACTOR
		set BOSS_TYPE 1
		}
		else 
	{ 
		sizeat 48 40
		strength LIZBOSSPALSTRENGTH
	}
}

enda

useractor enemy LIZBOSS LIZBOSSSTRENGTH

fall
ifai 0
{
	spawn SHOOTME
	quake 26
	globalsound CYBOSS_RECOG
	ai AILIZBOSSWAIT
	cstat 257
	ifspritepal 0 
		{
		sizeat 96 80 
        set BOSS_TYPE 1
		set CURBOSS THISACTOR
		}
		else 
	{ 
		sizeat 48 40
		strength LIZBOSSPALSTRENGTH
	}
}

ifai AILIZBOSSDYING
{
	strength 0
	
	ifaction ALIZBOSSDYING
	{
		ifactioncount 5
		{
			globalsound BOSSFALL
			quake 90
			cstat 0
			action ALIZBOSSLYINGDEAD
			ifhitweapon { }
			break
		}
	}
	ifaction ALIZBOSSLYINGDEAD
	{
		ifhitweapon
		{
			ifwasweapon RPG
			{
				sound SQUISHED
				spawn BLOODPOOL
				state standard_jibs
				state standard_jibs
				debris SCRAP1 4
				debris SCRAP2 4
				debris SCRAP3 4
				debris SCRAP4 4
				debris SCRAP5 4
				debris SCRAP6 4
				killit
			}
			ifwasweapon RADIUSEXPLOSION
			{
				sound SQUISHED
				spawn BLOODPOOL
				state standard_jibs
				state standard_jibs
				debris SCRAP1 4
				debris SCRAP2 4
				debris SCRAP3 4
				debris SCRAP4 4
				debris SCRAP5 4
				debris SCRAP6 4
				killit
			}
		}
		ifcount RESPAWNACTORTIME
		ifrespawn
		{
		  addkills -1
		  spawn TRANSPORTERSTAR
		  cstat 257
		  strength PIGCOPSTRENGTH
		  ai AILIZBOSSWAIT
		  // ifrnd 128 globalsound PIGBROAR else globalsound PIGBROAR2
		}
	}
	
	break
}


ifp palive
	ifspritepal 0
	  ifpdistl 1280
{
  addphealth -1000
  palfrom 63 63
}


ifai AILIZBOSSGROW { state lizbossgrowstate break }
ifai AILIZBOSSFROZEN { state lizbossfrozenstate break }
ifai AILIZBOSSSHRUNK state lizbossshrunkstate else
ifai AILIZBOSSHIT state lizbosshitstate else
ifai AILIZBOSSWAIT state lizbosswaitstate else
ifai AILIZBOSSJUMP state lizbossjumpstate else
ifai AILIZLAYMINE state lizlayminestate else
ifai AILIZBOSSCHARGE state lizbosschargestate else
ifai AILIZBOSSSHOOT state lizbossshootstate else
ifai AILIZBOSSSEEK state lizbossseekstate

ifhitweapon
{
state NEWGUNEFFECTS
    ifwasweapon SHRINKSPARK
	{
		ifstrength 600
		{
		  sound ACTOR_SHRINKING
		  ai AILIZBOSSSHRUNK
		  // set shrunken 1
		  break
		}
		else addstrength -60
	}
	else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
	ifdead
	{
		ifwasweapon FREEZEBLAST
		{
		  sound SOMETHINGFROZE
		  spritepal 1
		  ai AILIZBOSSFROZEN
		  strength 0
		  // state freezeme
		  break
		}
		ifwasweapon GROWSPARK
		{
		  cstat 0
		  sound ACTOR_GROWING
		  ai AILIZBOSSGROW
		  break
		}
		addkills 1
		sound CYBOSS_DEATH
		ai AILIZBOSSDYING
		guts JIBS6 8
		ifspritepal 0 break
		ifwasweapon RPG
		{
			sound SQUISHED
			spawn BLOODPOOL
			state standard_jibs
			state standard_jibs
			debris SCRAP1 4
			debris SCRAP2 4
			debris SCRAP3 4
			debris SCRAP4 4
			debris SCRAP5 4
			debris SCRAP6 4
			killit
        }
		ifwasweapon RADIUSEXPLOSION
		{
			sound SQUISHED
			spawn BLOODPOOL
			state standard_jibs
			state standard_jibs
			debris SCRAP1 4
			debris SCRAP2 4
			debris SCRAP3 4
			debris SCRAP4 4
			debris SCRAP5 4
			debris SCRAP6 4
			killit
        }
		break
	}
	
	sound CYBOSS_PAIN
	ifrnd 2
		spawn BLOODPOOL
	ifai AILIZBOSSHIT nullop else
	ifai AILIZLAYMINE nullop else
	ifai AILIZBOSSJUMP nullop else
	ifai AILIZBOSSSHRUNK nullop else
	{
		ifrnd 16 
		 ai AILIZBOSSHIT 	
	}
}

enda

defstate mineexplode

	espawn EXPLOSION2
	seta[RETURN].xrepeat sprite[].xrepeat
	seta[RETURN].yrepeat sprite[].yrepeat
	sound PIPEBOMB_EXPLODE
	ifspritepal 0
	hitradius 4096 35 50 65 80
	else
	hitradius 3072 25 30 35 40
	killit

ends

move IFRAMES
move READY
move DETONATE
useractor notenemy LIZMINE 0

	fall
	ifmove 0
		move IFRAMES
		
	ifmove IFRAMES 
	{
		ifcount 30 move READY
		break
	}
	
	cstator 256
	ifhitweapon
		state mineexplode
	
	ifpdistl 1280
		state mineexplode
	
	ifmove READY
	ifpdistl 2048
	ifcansee 
	{
		move DETONATE
		sound LASERTRIP_ARMING
	}
	ifmove DETONATE
		ifcount 8
		state mineexplode
enda

// ***************************************************************************************************************************************************
// LITTLE SCORPION =======================================================================================================
// ***************************************************************************************************************************************************

action A_LSC_MOVE 0 2 5 1 8
action A_LSC_LEAP 10 1 5 1 8

move LIL_SCORP_MOVE 90

ai AI_LSC_MOVE A_LSC_MOVE LIL_SCORP_MOVE seekplayer
ai AI_LSC_LEAP A_LSC_LEAP LIL_SCORP_MOVE faceplayer jumptoplayer

useractor enemy LIL_SCORP_LEAP
ifai 0
	{
	cstat 257
	sizeat 30 30
	strength 10
	ai AI_LSC_LEAP
	sound SC_JMP
	cactor LIL_SCORP
	}
enda

useractor enemy LIL_SCORP
fall

ifai 0
	{
	cstat 256
	sizeat 30 30
	strength 10
	ai AI_LSC_MOVE
	}
	
ifai AI_LSC_MOVE
	{
	ifcansee { }
	ifrnd 5 ai AI_LSC_MOVE
	ifpdistl 2048 ifrnd 32 { sound SC_JMP ai AI_LSC_LEAP }
	else
	ifpdistl 1024
	 ifcount 15
		{
		sound SC_ATK
		shoot 23533
		resetcount
		}
	}
	
ifai AI_LSC_LEAP
	{
    cstat 256
	ifcansee { }
	ifpdistl 1024 ifcount 22
		{
		sound SC_ATK
        shoot 23533
        count 20
		//ai AI_LSC_MOVE
		}
	else
	ifcount 20 iffloordistl 8 { ai AI_LSC_MOVE resetcount }
	}
	
ifhitweapon
	{
    spritepal 8
    guts JIBS6 1
    getlastpal
	//espawn BLOOD
	//seta[RETURN].pal 8
		ifdead
			{
			spritepal 8
			espawn BLOODPOOL
			seta[RETURN].pal 8
			sound SC_DIE
			guts JIBS6 3
            ifrnd 128 guts JIBS4 1
            ifrnd 128 guts JIBS3 1
			addkills 1
			killit
			}
	}

enda

// ***************************************************************************************************************************************************
// SCARAB
// ***************************************************************************************************************************************************

useractor notenemy 22261
ifaction 0
	{
	sleeptime 0
	ifspritepal 3 ifpdistl 34768 spawn 22262 else
	ifpdistl 131072 spawn 22262
	}
enda

action SCAR_SCUT 0 2 5 1 8

move SCAR_MOVE 120 0

useractor notenemy 22262
fall
ifaction 0
	{
	sizeat 20 20
	ifpdistl 131073
		{
		randvar GTEMP 64
		ifrnd 128 mul GTEMP -1
		add GTEMP sprite[].ang
		seta[].ang GTEMP
		}
	action SCAR_SCUT
	}

ifaction SCAR_SCUT
	{
	move SCAR_MOVE geth
	ifpdistl 512 ifcansee ifg sprite[PLAYER_IDENTITY].shade 5 { soundonce SCRATCHS setactorsoundpitch THISACTOR SCRATCHS 1024 palfrom 40 60 0 0 addphealth -5 }
	ifnotmoving { espawn SMALLSMOKE seta[RETURN].pal 7 killit }
	}

enda

// DUKINATOR ==========================================================================================================================================================================
// sprites by sebabdukeboss20, code by Dan Gaskill
// ====================================================================================================================================================================================

move TERMLEGSTOP
defstate termlegcode

ifmove 0
{
	move TERMLEGSTOP
	ifactor TERMLEGPART1GROUND cstat 8
}
fall

ends

defineprojectile TERMLEGPART1 PROJ_WORKSLIKE 34822
defineprojectile TERMLEGPART1 PROJ_HITRADIUS 0
defineprojectile TERMLEGPART1 PROJ_EXTRA 0
defineprojectile TERMLEGPART1 PROJ_XREPEAT 42
defineprojectile TERMLEGPART1 PROJ_YREPEAT 36
defineprojectile TERMLEGPART1 PROJ_BOUNCES 3
defineprojectile TERMLEGPART1 PROJ_VEL 192
defineprojectile TERMLEGPART1 PROJ_DROP -208
defineprojectile TERMLEGPART1 PROJ_TRAIL SMALLSMOKE
defineprojectile TERMLEGPART1 PROJ_SPAWNS TERMLEGPART1GROUND
defineprojectile TERMLEGPART1 PROJ_SXREPEAT 28
defineprojectile TERMLEGPART1 PROJ_SYREPEAT 28
defineprojectile TERMLEGPART1 PROJ_TXREPEAT 16
defineprojectile TERMLEGPART1 PROJ_TYREPEAT 16
defineprojectile TERMLEGPART1 PROJ_BSOUND M_BOUNCE1
defineprojectile TERMLEGPART1 PROJ_RANGE 60


defineprojectile TERMLEGPART2 PROJ_WORKSLIKE 34822
defineprojectile TERMLEGPART2 PROJ_HITRADIUS 0
defineprojectile TERMLEGPART2 PROJ_EXTRA 0
defineprojectile TERMLEGPART2 PROJ_XREPEAT 42
defineprojectile TERMLEGPART2 PROJ_YREPEAT 36
defineprojectile TERMLEGPART2 PROJ_BOUNCES 3
defineprojectile TERMLEGPART2 PROJ_VEL 192
defineprojectile TERMLEGPART2 PROJ_DROP -208
defineprojectile TERMLEGPART2 PROJ_TRAIL SMALLSMOKE
defineprojectile TERMLEGPART2 PROJ_SPAWNS TERMLEGPART2GROUND
defineprojectile TERMLEGPART2 PROJ_SXREPEAT 28
defineprojectile TERMLEGPART2 PROJ_SYREPEAT 28
defineprojectile TERMLEGPART2 PROJ_TXREPEAT 16
defineprojectile TERMLEGPART2 PROJ_TYREPEAT 16
defineprojectile TERMLEGPART2 PROJ_BSOUND M_BOUNCE2
defineprojectile TERMLEGPART2 PROJ_RANGE 60


defineprojectile TERMLEGPART3 PROJ_WORKSLIKE 34822
defineprojectile TERMLEGPART3 PROJ_HITRADIUS 0
defineprojectile TERMLEGPART3 PROJ_EXTRA 0
defineprojectile TERMLEGPART3 PROJ_XREPEAT 42
defineprojectile TERMLEGPART3 PROJ_YREPEAT 36
defineprojectile TERMLEGPART3 PROJ_BOUNCES 3
defineprojectile TERMLEGPART3 PROJ_VEL 192
defineprojectile TERMLEGPART3 PROJ_DROP -208
defineprojectile TERMLEGPART3 PROJ_TRAIL SMALLSMOKE
defineprojectile TERMLEGPART3 PROJ_SPAWNS TERMLEGPART3GROUND
defineprojectile TERMLEGPART3 PROJ_SXREPEAT 28
defineprojectile TERMLEGPART3 PROJ_SYREPEAT 28
defineprojectile TERMLEGPART3 PROJ_TXREPEAT 16
defineprojectile TERMLEGPART3 PROJ_TYREPEAT 16
defineprojectile TERMLEGPART3 PROJ_BSOUND M_BOUNCE3
defineprojectile TERMLEGPART3 PROJ_RANGE 60

useractor notenemy TERMLEGPART1GROUND 0 state termlegcode enda
useractor notenemy TERMLEGPART2GROUND 0 state termlegcode enda
useractor notenemy TERMLEGPART3GROUND 0 state termlegcode enda

define CARXPLODE 1342
defineprojectile CARXPLODE PROJ_WORKSLIKE 34822
defineprojectile CARXPLODE PROJ_HITRADIUS 0
defineprojectile CARXPLODE PROJ_EXTRA 0
defineprojectile CARXPLODE PROJ_XREPEAT 28
defineprojectile CARXPLODE PROJ_YREPEAT 28
defineprojectile CARXPLODE PROJ_BOUNCES 2
defineprojectile CARXPLODE PROJ_VEL 400
defineprojectile CARXPLODE PROJ_DROP -256
defineprojectile CARXPLODE PROJ_TRAIL SMALLSMOKE
defineprojectile CARXPLODE PROJ_SPAWNS -1
defineprojectile CARXPLODE PROJ_SXREPEAT 28
defineprojectile CARXPLODE PROJ_SYREPEAT 28
defineprojectile CARXPLODE PROJ_TXREPEAT 16
defineprojectile CARXPLODE PROJ_TYREPEAT 16
defineprojectile CARXPLODE PROJ_BSOUND M_BOUNCE3
defineprojectile CARXPLODE PROJ_RANGE 32

useractor notenemy TERMHEAD 0

ifaction 0
{
	action ZERO
	sizeat 29 29
	ifrnd 128 cstator 4
}

ifaction ZERO
{
ifcount 60
	{
	ifrnd 64 action ONE
	else resetcount
	}
}

ifaction ONE
{
ifcount 30
	{
	ifrnd 64 action TWO
	else resetcount
	}
}

fall

enda

action ATERMINATOROFF			0  1  5  1  10
action ATERMINATORON			5  1  5  1  10
action ATERMINATORWALK			10 4  5  1  20
action ATERMINATORSHOOT			30 2  5  1  6
action ATERMINATORDUCK1			0 1  5  1  10 // 40
action ATERMINATORDUCKSHOOT		0 2  5  1  6
action ATERMINATORCRAWL			0 4  5  1  20 // 50
action ATERMINATORCRAWLSHOOT	20 2  5  1  6
action ATERMINATORHIT			80 1  1  1  10
action ATERMINATORDIE			80 3  1  1  12
action ATERMINATORCRAWLDIE		37 2  1  1  12 // 87
action ATERMINATOR_DESTRUCT		37 2  1  1  12 // 87

move TERMINATORSTOP
move TERMINATORWALKVELS 71
move TERMINATORCRAWLVELS 38
move TERMCRAWLVELS 24

ai AITERMOFF ATERMINATOROFF TERMINATORSTOP geth
ai AITERMWAIT ATERMINATORON TERMINATORSTOP geth
ai AITERMSEEK ATERMINATORWALK TERMINATORWALKVELS seekplayer
ai AITERMSHOOT ATERMINATORSHOOT TERMINATORSTOP geth shoottarget
ai AITERMDUCK ATERMINATORDUCK1 TERMINATORSTOP geth
ai AITERMCRAWL ATERMINATORCRAWL TERMINATORCRAWLVELS faceplayerslow
ai AITERMHIT ATERMINATORHIT TERMINATORSTOP faceplayer
ai AITERMDYING ATERMINATORDIE TERMINATORSTOP geth

defstate spawnpartset

	seta[RETURN].xrepeat sprite[].xrepeat
	seta[RETURN].yrepeat sprite[].yrepeat
	seta[RETURN].pal sprite[].pal

ends

defstate termspawnlegparts

	rand z 3072
	mul z -1
	ezshoot z TERMLEGPART1
	randvar temp  2047
	setactor[RETURN].ang temp 
	randvar temp  128 add temp 128
	setactor[RETURN].xvel temp
	state spawnpartset
	
	ifrnd 128
	{
	rand z 3072
	mul z -1
	ezshoot z TERMLEGPART1
	randvar temp  2047
	setactor[RETURN].ang temp 
	randvar temp  128 add temp 128
	setactor[RETURN].xvel temp
	state spawnpartset
	}
	
	rand z 3072
	mul z -1
	ezshoot z TERMLEGPART2
	randvar temp  2047
	setactor[RETURN].ang temp 
	randvar temp  128 add temp 128
	setactor[RETURN].xvel temp
	state spawnpartset
	
	ifrnd 128
	{
	rand z 3072
	mul z -1
	ezshoot z TERMLEGPART2
	randvar temp  2047
	setactor[RETURN].ang temp 
	randvar temp  128 add temp 128
	setactor[RETURN].xvel temp
	state spawnpartset
	}
	
	rand z 3072
	mul z -1
	ezshoot z TERMLEGPART3
	randvar temp  2047
	setactor[RETURN].ang temp 
	randvar temp  128 add temp 128
	setactor[RETURN].xvel temp
	state spawnpartset
	
	ifrnd 128
	{
	rand z 3072
	mul z -1
	ezshoot z TERMLEGPART3
	randvar temp  2047
	setactor[RETURN].ang temp 
	randvar temp  128 add temp 128
	setactor[RETURN].xvel temp
	state spawnpartset
	}

ends

defstate termtaunt

ifsound TERMBALLS nullop else
ifsound TERMGUTS nullop else
ifsound	TERMTAUNT1 nullop else
ifsound	TERMTAUNT2 nullop else
ifsound	TERMTAUNT3 nullop else
{
	rand temp 4
	switch temp
	case 0 sound TERMBALLS break
	case 1 sound TERMGUTS break
	case 2 sound TERMTAUNT1 break
	case 3 sound TERMTAUNT2 break
	case 4 sound TERMTAUNT3 break
	endswitch
}

ends


defstate termdyingstate

	seta[].shade -127
	ifaction ATERMINATORDIE
		ifactioncount 6
	{
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		geta[].z z
		sub z 4096
		seta[].z z
		ifl sprite[].extra -100 
			{
			shoot SPARK2
			shoot SPARK2
			state spawnpartset
			espawn EXPLOSION2
			globalsound ROBOT_EXPLODE
			set PLAYER_VOICEOVER 33
			state spawnpartset
			addkills 1
			}
			else
		espawn TERMTORSO
		state spawnpartset
		seta[RETURN].pal sprite[].pal
		add z 4096
		seta[].z z
		state termspawnlegparts
		killit
	}

ends

defstate squishterm

	setp[].sound_pitch 512
	spawn EXPLOSION2
	debris SCRAP1 3
	debris SCRAP2 3
	sound PIPEBOMB_EXPLODE
	addkills 1
	setp[].sound_pitch 0
	set PLAYER_VOICEOVER 33
	killit
ends

defstate termwaitstate

	ifcount 25 
	{
		ai AITERMSEEK
		state termtaunt
		// sound TERMBALLS
	}
	
ends

defstate termhitstate
	ifcount 10 ai AITERMSEEK
	
ends

gamevar initsprite 0 2

defstate termshootstate
state enemyfindtarget
	ifaction ATERMINATORSHOOT
	{
		ife mtype 0
		{
			ife initsprite 0
			{
			state shooting_settings
			}
			ifactioncount 1 
			{
				ife initsprite 5
				{
					set initsprite 0
					set mtype 0
					ai AITERMSEEK
					break
				}
				sound LASERSHOOT
				geta[].z TEMP6
				sub TEMP6 2048
				seta[].z TEMP6
				eshoot PLASMAPROJ
				seta[RETURN].ang sprite[].ang
				add TEMP6 2048
				seta[].z TEMP6
				set mtype 1
				add initsprite 1
			}
		}
		ife mtype 1
		{
			ifactioncount 2
			{
				set mtype 0
				resetactioncount
			}
		}
	}

	ifaction ATERMINATORDUCKSHOOT
	{
		ife mtype 0
		{
			ife initsprite 0
			{
				state shooting_settings
			}
			ifactioncount 1 
			{
				ife initsprite 5
				{
					set initsprite 0
					set mtype 0
					cactor TERMINATOR
					ai AITERMSEEK
					break
				}
				sound LASERSHOOT
				eshoot PLASMAPROJ
				seta[RETURN].ang sprite[].ang
				set mtype 1
				add initsprite 1
			}
		}
		ife mtype 1
		{
			ifactioncount 2
			{
				set mtype 0
				resetactioncount
			}
		}
	}

	

ends

defstate termseekstate

ifg player[].curr_weapon CHAINGUN_WEAPON
ifp pfacing
	ifbulletnear
{
	cactor TERMINATORDUCKING ai AITERMDUCK
	break
}

ifrnd 1 ifrnd 128 state termtaunt

ife mtype 0
	ifcount 60	
ifcansee
	ifcanshoottarget
	ifp palive
	{
		set mtype 0
		set initsprite 0
		ifrnd 128 { cactor TERMINATORDUCKING ai AITERMDUCK }
		else
		ai AITERMSHOOT
	}

ends

defstate termduckstate
	
	ifaction ATERMINATORDUCK1
	{
		state shooting_settings
		ifcount 8
		{
			ifcansee ifcanshoottarget
			ifp palive
			{
				action ATERMINATORDUCKSHOOT
				set initsprite 0
				set mtype 0
			}
			else
			{
				cactor TERMINATOR
				ai AITERMSEEK
			}
		}
	}
	ifaction ATERMINATORDUCKSHOOT
		state termshootstate

ends

defstate terminatorcode

ifai 0
{
	ifn EXTRASAVED 0 
		{
		ai AITERMOFF 
		}
		else
		{
		spawn SHOOTME
		sound TERMBEEP
		ai AITERMWAIT
		}
	sizeat 29 25
	set command 8192
	cstat 257
	spriteflags ROBOT_ENEMY
}
fall

//ifspritepal 51 nullop else // all old and rusty, armour has eroded to near useless
//state ROBOT_DAMAGE_MODIFIER

ifai AITERMDYING { state termdyingstate break }


ifsquished	
{ geta[].htextra temp add temp 10 seta[].htextra temp seta[].htpicnum RPG }
	
ifhitweapon
{
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
	
	ifdead
	{
		ifactor TERMINATORDUCKING cactor TERMINATOR
		ai AITERMDYING
		globalsound TERMELECT
		break
	}
	
	ifai AITERMHIT nullop else
	ifn sprite[].picnum TERMINATORDUCKING
	ifn sprite[].picnum TERMINATORCRAWLING
	{
		ifrnd 16 
		{ 
			// sound TERMPAIN 
			ai AITERMHIT 
			break 
		}
		ifrnd 64 
		{
			// sound TERMPAIN
			ifai AITERMSHOOT nullop else 
			{
				set mtype 0
				set initsprite 0
				ifrnd 128 { cactor TERMINATORDUCKING ai AITERMDUCK }
				else
				ai AITERMSHOOT
			}
		}
	}
}

ifai AITERMOFF
	{
	checkactivatormotion EXTRASAVED
	ife RETURN 1
		{
		spawn SHOOTME
		sound TERMBEEP
		ai AITERMWAIT
		}
	}
	else
ifai AITERMWAIT state termwaitstate else
ifai AITERMHIT state termhitstate else
ifai AITERMSEEK state termseekstate else
ifai AITERMSHOOT state termshootstate else
ifai AITERMDUCK state termduckstate

ifaction ATERMINATORWALK
{
	ife mtype 0 // first step
	{
		ifactioncount 1
		{
			sound TERMSTEP
			set mtype 1
		}
	}
	else ife mtype 1
	{
		ifactioncount 2
		{
		ifspritepal 51 sound TERM_RUST else sound SERVOSND
			set mtype 2
		}
	}
	else ife mtype 2
	{
		ifactioncount 3
		{
			sound TERMSTEP
			set mtype 3
		}
	}
	else ife mtype 3
	{
		ifactioncount 4
		{
			set mtype 0
			resetactioncount
			ifspritepal 51 sound TERM_RUST else sound SERVOSND
		}
	}
}

ends

useractor enemy TERMINATOR 200 state terminatorcode enda

useractor enemystayput TERMINATORSTAYPUT 200 cactor TERMINATOR state terminatorcode enda

useractor enemy TERMINATORDUCKING 200 state terminatorcode enda

defstate termcrawlstate

//ifspritepal 51 nullop else // all old and rusty, armour has eroded to near useless
//state ROBOT_DAMAGE_MODIFIER

ifaction ATERMINATORCRAWLSHOOT
{
state enemyfindtarget
	ife mtype 0
	{
		ife initsprite 0
		{
			state shooting_settings
		}
		ifactioncount 1 
		{
			ife initsprite 3
			{
				set initsprite 0
				set mtype 0
				action ATERMINATORCRAWL
				move TERMINATORCRAWLVELS seekplayer
				break
			}
			
			sound LASERSHOOT
			geta[].z TEMP4
			add TEMP4 2048
			seta[].z TEMP4
			eshoot PLASMAPROJ
			seta[RETURN].ang sprite[].ang
			sub TEMP4 2048
			seta[].z TEMP4
			set mtype 1
			add initsprite 1
		}
	}
	ife mtype 1
	{
		ifactioncount 2
		{
			set mtype 0
			resetactioncount
		}
	}
	break
}

ifaction ATERMINATORCRAWL
{
soundonce TERMCRAWL
	ife mtype 0 // first step
	{
		ifactioncount 1
		{
		ifspritepal 51 sound TERM_RUST 
			sound TERMCRAWL
			set mtype 1
		}
	}
	else ife mtype 1
	{
		ifactioncount 2
		{
		ifspritepal 51 sound TERM_RUST 
			sound TERMCRAWL
			set mtype 2
		}
	}
	else ife mtype 2
	{
		ifactioncount 3
		{
		ifspritepal 51 sound TERM_RUST 
			sound TERMCRAWL
			set mtype 3
		}
	}
	else ife mtype 3
	{
		ifactioncount 4
		{
		ifspritepal 51 sound TERM_RUST 
			set mtype 0
			resetactioncount
			sound TERMCRAWL
		}
	}
}

ife mtype 0
	ifcount 60	
ifcansee
	ifcanshoottarget
		ifp palive
	{
		set mtype 0
		set initsprite 0
		action ATERMINATORCRAWLSHOOT
		move TERMINATORSTOP geth
	}

ends

useractor enemy TERMINATORCRAWLING 100 
  
ifai 0
{
	ai AITERMCRAWL
	spriteflags ROBOT_ENEMY
	sizeat 29 25
	set command 8192
	cstat 257
	spawn SHOOTME
}
fall

ifaction ATERMINATOR_DESTRUCT
{
ifrnd 4 shoot SPARK2
	seta[].shade -127
	ifactioncount 18
	{
		espawn EXPLOSION2
		globalsound ROBOT_EXPLODE
		seta[RETURN].xrepeat 64
		seta[RETURN].yrepeat 64
		set INTERNALCOUNT_2 0
		whilevarn INTERNALCOUNT_2 4
		{
		   rand z 3072
		   add z 2048
		   mul z -1
		   ezshoot z CARXPLODE
		   randvar temp  2047
		   setactor[RETURN].ang temp 
		   randvar temp  192 add temp 128
		   setactor[RETURN].xvel temp 
		   add INTERNALCOUNT_2 1
		}
		hitradius 1536 10 20 30 40
		debris SCRAP1 3
		debris SCRAP2 3
		debris SCRAP6 3
		killit
	}
	break
}

ifaction ATERMINATORCRAWLDIE
{
	seta[].shade -127
	ifactioncount 6
	{
		espawn EXPLOSION2
		set PLAYER_VOICEOVER 33
		globalsound ROBOT_EXPLODE
		seta[RETURN].xrepeat 32
		seta[RETURN].yrepeat 32
		set INTERNALCOUNT_2 0
		whilevarn INTERNALCOUNT_2 4
		{
		   rand z 3072
		   add z 2048
		   mul z -1
		   ezshoot z CARXPLODE
		   randvar temp  2047
		   setactor[RETURN].ang temp 
		   randvar temp  192 add temp 128
		   setactor[RETURN].xvel temp 
		   add INTERNALCOUNT_2 1
		}
		hitradius 1024 5 10 15 20
		debris SCRAP1 3
		debris SCRAP2 3
		debris SCRAP6 3
		spawn TERMHEAD
		killit
	}
	break
}

state termcrawlstate

ifpdistl 1024
 ifrnd 16
	{
	ifrnd 128 sound TERM_SELFD
	else sound TERM_SELFD2
	addkills 1
	action ATERMINATOR_DESTRUCT
	move TERMINATORSTOP
	globalsound TERMELECT
	}

ifsquished	
{ geta[].htextra temp add temp 10 seta[].htextra temp seta[].htpicnum RPG }

ifhitweapon
{
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
	
	ifdead
	{
		addkills 1
		action ATERMINATORCRAWLDIE
		move TERMINATORSTOP
		globalsound TERMELECT
	}	
}

enda


useractor enemy TERMTORSO 100

fall
iffloordistl 2
{
	sound LANDMETAL
	cactor TERMINATORCRAWLING
	strength 100
	sizeat 29 25
	cstat 257
}
enda

// ****************************************************************************************************************************************************************************************
// ARCHER =================== DANGER ZONE! ================================================================================================================================================
// ****************************************************************************************************************************************************************************************

action A_ARCHER_IDLE 0 1 5 1 12
action A_ARCHER_WALK 0 4 5 1 12
action A_ARCHER_PREP 20 1 5 1 12
action A_ARCHER_ATTACK 25 1 5 1 12
action A_ARCHER_ATTACK2 30 1 5 1 12
action A_ARCHER_PAIN 35 1 1 1 8
action A_ARCHER_DIE 35 6 1 1 16
action A_ARCHER_FROZEN 35 1 1 1 8
action A_ARCHER_DEAD 40

move ARCHER_WALK 126

ai AI_ARCHER_IDLE A_ARCHER_IDLE STOP seekplayer
ai AI_ARCHER_WALK A_ARCHER_WALK ARCHER_WALK seekplayer
ai AI_ARCHER_PREP A_ARCHER_PREP STOP faceplayer
ai AI_ARCHER_ATTACK A_ARCHER_ATTACK STOP seekplayer
ai AI_ARCHER_ATTACK2 A_ARCHER_ATTACK2 STOP seekplayer
ai AI_ARCHER_GROW A_ARCHER_PAIN STOP
ai AI_ARCHER_SHRUNK A_ARCHER_WALK fleeenemy
ai AI_ARCHER_DIE A_ARCHER_DIE STOP

useractor enemystayput ARCHER_STAYPUT 150 A_ARCHER_IDLE cactor ARCHER enda

useractor enemy ARCHER 150 A_ARCHER_IDLE
fall
ifai 0
	{
	cstat 257
	strength 150
	sizeat 26 26
	ifrnd 96 sound ARCH_SIGHT1
	else ifrnd 96 sound ARCH_SIGHT2
	else sound ARCH_SIGHT3
	state monst_glow
	spawn SHOOTME
	ai AI_ARCHER_WALK
	}
	
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage
	
ifaction A_ARCHER_FROZEN
	{
	state frozen_code
	}
else
ifai AI_ARCHER_GROW state genericgrowcode
else
ifaction A_ARCHER_DEAD
	{
	move STOP
    ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
			state squish_sounds
		  state standard_jibs
			killit
		  }
		  break
		}
	}
else
ifai AI_ARCHER_DIE
	{
	strength 0
	ifactioncount 5 { state rf state BODY_FALL_NOISES action A_ARCHER_DEAD }
	}
else
ifaction A_ARCHER_PAIN
	{
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0
		{
		ifdead ai AI_ARCHER_DIE else
		ai AI_ARCHER_WALK
		}
	}
else
ifai AI_ARCHER_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_ARCHER_WALK
    else ifcount SHRUNKCOUNT
      {
	sound ACTOR_UNSHRINK
	sizeto 26 26
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_ARCHER_IDLE
	{
	ifcansee ai AI_ARCHER_WALK // if can see player
	else ifn target -1 ai AI_ARCHER_WALK // or if it has a target
	}
else
ifai AI_ARCHER_WALK
	{
	ifrnd 2 sound ARCH_IDLE
	ifrnd 16 state enemyfindtarget // run enemy targetting stuff occasionally to refresh target
	state SKILL_SHOOT_LEVELADJUST // run difficulty level check
	ifl RANDOM_CHANCE SKILLCHANCE // if succesful
		{
		state correctcansee
		state enemyfindtarget // find enemy target
		ifn target -1 ldist TEMP THISACTOR target // if found, get distance
		ifn target -1 ifl TEMP 4096 { state SKILL_LEVELADJUST sound BOWDRAW ai AI_ARCHER_PREP } // if target is less than distance, attack
		else ife sightvar YES { state SKILL_LEVELADJUST sound BOWDRAW ai AI_ARCHER_PREP } // otherwise if can see player, attack
		resetactioncount
		}
	else ifrnd 2 ai AI_ARCHER_WALK // reset AI routine every now and then
	}
else
ifai AI_ARCHER_PREP
	{
	geta[].htg_t 2 TEMP
	ifactioncount 4
		{
		ife target -1 ai AI_ARCHER_ATTACK else
			{
			getactorvar[target].myowner TEMP4
			ife TEMP4 PLAYER_IDENTITY
			 ifg PARMOUR 0 ai AI_ARCHER_ATTACK2 else // shoot anti-armour bolt
			ai AI_ARCHER_ATTACK
			}
		}
	ifg TEMP 4 ai AI_ARCHER_WALK
	}
else
ifai AI_ARCHER_ATTACK
	{
	ifactioncount 2
		{
		state shooting_settings // run targetting stuff
		ifn target -1 // if shooting at target
			{
			sound ARCH_FIRE 
			ezshoot TEMP3 24489
			}
		else // if shooting at player
			{
			sound ARCH_FIRE 
			shoot 24489
			}
		ai AI_ARCHER_WALK // go back to seeking AI
		}
	}
else
ifai AI_ARCHER_ATTACK2
	{
	ifactioncount 2
		{
		state shooting_settings // run targetting stuff
		ifn target -1 // if shooting at target
			{
		    sound ARCH_FIRE 
			ezshoot TEMP3 24490
			}
		else // if shooting at player
			{
		    sound ARCH_FIRE
			shoot 24490
			}
		ai AI_ARCHER_WALK // go back to seeking AI
		}
	}
	
ifhitweapon
{
	state NEWGUNEFFECTS
	sound ARCH_PAIN
	//spawn BLOOD
	//guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		addkills 1
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_ARCHER_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action A_ARCHER_FROZEN } 
		else ifg FIRE_DAMAGE 0 
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			ifrnd 128 sound ZSOLD_DIE1
			else sound ZSOLD_DIE2
			spawn ONFIREGUY
			killit
			}
			else 
		ife HEADSHOT 2 
			{
			ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				ai AI_ARCHER_DIE
			}
		else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
		else ifg ENERGY_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 4
			guts JIBS3 6
			spawn DISINTIGRATE_GUY
			killit
			}
		else
			{
			sound ARCH_DIE
			ai AI_ARCHER_DIE
			spawn BLOODPOOL
			}
		}
	else ifg PAIN_AMOUNT 0 action A_ARCHER_PAIN
	else ifrnd 32 { state PAIN_SKILL_LEVELADJUST action A_ARCHER_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_ARCHER_SHRUNK }
}

state checksquished

enda


action A_GOBLIN_IDLE 0 1 5 1 12
action A_GOBLIN_WALK 0 4 5 1 12
action A_GOBLIN_ATTACK 20 3 5 1 12
action A_GOBLIN_PAIN 35 1 1 1 8
action A_GOBLIN_DIE 35 5 1 1 12
action A_GOBLIN_FROZEN 35 1 1 1 8
action A_GOBLIN_DEAD 40

move GOBLIN_WALK 126

ai AI_GOBLIN_IDLE A_GOBLIN_IDLE STOP seekplayer
ai AI_GOBLIN_WALK A_GOBLIN_WALK GOBLIN_WALK seekplayer
ai AI_GOBLIN_ATTACK A_GOBLIN_ATTACK STOP seekplayer
ai AI_GOBLIN_GROW A_GOBLIN_PAIN STOP
ai AI_GOBLIN_SHRUNK A_GOBLIN_WALK fleeenemy
ai AI_GOBLIN_DIE A_GOBLIN_DIE STOP

useractor enemystayput ORC_STAYPUT cactor ORC enda

useractor enemy ORC 150 A_GOBLIN_IDLE
fall
ifai 0
	{
	cstat 257
	strength 150
	sizeat 26 26
	state monst_glow
	spawn SHOOTME
	sound GOBLIN_SIGHT
	ai AI_GOBLIN_WALK
	}
	
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage
	
ifaction A_GOBLIN_FROZEN
	{
	state frozen_code
	}
else
ifai AI_GOBLIN_GROW state genericgrowcode
else
ifaction A_GOBLIN_DEAD
	{
	move STOP
    ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
		  spritepal 8
			state squish_sounds
		  state standard_jibs
			killit
		  }
		  break
		}
	}
else
ifai AI_GOBLIN_DIE
	{
	strength 0
	ifactioncount 5 { state rf state BODY_FALL_NOISES action A_GOBLIN_DEAD }
	}
else
ifaction A_GOBLIN_PAIN
	{
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0
		{
		ifdead break
		ai AI_GOBLIN_WALK
		}
	}
else
ifai AI_GOBLIN_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_GOBLIN_WALK
    else ifcount SHRUNKCOUNT
      {
	sound ACTOR_UNSHRINK
	sizeto 46 46
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_GOBLIN_IDLE
	{
	ifcansee ai AI_GOBLIN_WALK // if can see player
	else ifn target -1 ai AI_GOBLIN_WALK // or if it has a target
	}
else
ifai AI_GOBLIN_WALK
	{
	ifrnd 8 sound GOBLIN_IDLE
	state enemyfindtarget // find enemy target
	ifn target -1 dist TEMP THISACTOR target // if found, get distance
	ifpdistl 1024 ai AI_GOBLIN_ATTACK // otherwise if can see player, attack}
	ifn target -1 ifl TEMP 1024 ai AI_GOBLIN_ATTACK // if target is less than distance, attack
	 ifrnd 2 ai AI_GOBLIN_WALK // reset AI routine every now and then
	}
else
ifai AI_GOBLIN_ATTACK
	{
	ldist TEMP THISACTOR target
	ife target -1 ai AI_GOBLIN_WALK else
	ifg TEMP 1536 ai AI_GOBLIN_WALK else
	ifactioncount 3 
		{ 
		shoot 4963
		ai AI_GOBLIN_WALK 
		}
	}
	
ifhitweapon
{
	state NEWGUNEFFECTS
	spritepal 8
	espawn BLOOD
	seta[].pal 8
	guts JIBS6 1
	state random_wall_jibs
	getlastpal
	ifdead
		{
		addkills 1
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_GOBLIN_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action A_GOBLIN_FROZEN } 
		else ifg FIRE_DAMAGE 0 
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			ifrnd 128 sound GOBLIN_DIE
			else sound GOBLIN_DIE
			spawn ONFIREGUY
			killit
			}
			else ife HEADSHOT 2 
			{
			ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				sound GOBLIN_DIE
				spritepal 8
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				getlastpal
				ai AI_GOBLIN_DIE
			}
		else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
		else ifg ENERGY_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 4
			guts JIBS3 6
			spawn DISINTIGRATE_GUY
			killit
			}
		else
			{
			sound GOBLIN_DIE
			ai AI_GOBLIN_DIE
			espawn BLOODPOOL
			seta[RETURN].pal 8
			}
		}
	else ifg PAIN_AMOUNT 0 action A_GOBLIN_PAIN
	else ifrnd 32 { state PAIN_SKILL_LEVELADJUST action A_GOBLIN_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_GOBLIN_SHRUNK }
}

state checksquished

enda

// ===========================================
// NETHER BRUTE
// ============================================

action A_NBRUTE_IDLE 0 1 5 1 12
action A_NBRUTE_WALK 0 4 5 1 12
action A_NBRUTE_ATTACK 25 2 5 1 12
action A_NBRUTE_PAIN 20 1 1 1 8
action A_NBRUTE_DIE 35 5 1 1 12
action A_NBRUTE_FROZEN 20 1 1 1 8
action A_NBRUTE_DEAD 39

move NBRUTE_WALK 126

ai AI_NBRUTE_IDLE A_NBRUTE_IDLE STOP seekplayer
ai AI_NBRUTE_WALK A_NBRUTE_WALK NBRUTE_WALK seekplayer
ai AI_NBRUTE_ATTACK A_NBRUTE_ATTACK STOP seekplayer
ai AI_NBRUTE_GROW A_NBRUTE_PAIN STOP
ai AI_NBRUTE_SHRUNK A_NBRUTE_WALK fleeenemy
ai AI_NBRUTE_DIE A_NBRUTE_DIE STOP

useractor enemy NETHERBRUTE 600 A_NBRUTE_IDLE
fall
ifai 0
	{
	cstat 257
	strength 600
	sizeat 40 40
	spriteflags NORMAL_ENEMY
	sound NBRUTE_SIGHT
	state monst_glow
	spawn SHOOTME
	ai AI_NBRUTE_IDLE
	}
	
state enemyfloordamage
state enemy_ice_damage
state enemy_spirit_damage
	
ifaction A_NBRUTE_FROZEN
	{
	state frozen_code
	}
else
ifai AI_NBRUTE_GROW state genericgrowcode
else
ifaction A_NBRUTE_DEAD
	{
	move STOP
    ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
			state squish_sounds
		  state standard_jibs
		  state monst_body_jibs
			killit
		  }
		  break
		}
	}
else
ifai AI_NBRUTE_DIE
	{
	strength 0
	ifactioncount 5 ife ALLY_MAG 0 { quake 26 sound BOSSFALL set ALLY_MAG 1 }
	ifactioncount 5 action A_NBRUTE_DEAD
	}
else
ifaction A_NBRUTE_PAIN
	{
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0
		{
		ifdead break
		ai AI_NBRUTE_WALK
		}
	}
else
ifai AI_NBRUTE_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_NBRUTE_WALK
    else ifcount SHRUNKCOUNT
      {
	sound ACTOR_UNSHRINK
	sizeto 40 40
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_NBRUTE_IDLE
	{
	ifcansee ai AI_NBRUTE_WALK // if can see player
	else ifn target -1 ai AI_NBRUTE_WALK // or if it has a target
	}
else
ifai AI_NBRUTE_WALK
	{
	ifrnd 8
		{
		ifrnd 128 sound NBRUTE_IDLE1
		else sound NBRUTE_IDLE2
		}
	ifrnd 16 state enemyfindtarget // run enemy targetting stuff occasionally to refresh target
	ifrnd 64
		{
		state SKILL_SHOOT_LEVELADJUST // run difficulty level check
		ifl RANDOM_CHANCE SKILLCHANCE // if succesful
			{
			state enemyfindtarget // find enemy target
			ifn target -1 ldist TEMP THISACTOR target // if found, get distance
			ifn target -1 ifl TEMP 16384 ai AI_NBRUTE_ATTACK // if target is less than distance, attack
			else ifcansee ifcanseetarget ai AI_NBRUTE_ATTACK // otherwise if can see player, attack
			}
		}
	else ifrnd 2 ai AI_NBRUTE_WALK // reset AI routine every now and then
	}
else
ifai AI_NBRUTE_ATTACK
	{
	ifactioncount 2
		{
		ifpdistl 1536
			{
			sound NBRUTE_BITE
			shoot 15729
			}
		else
			{
			state shooting_settings // run targetting stuff
			ifn target -1 // if shooting at target
				{
				sound NBRUTE_FIRE 
				getactorvar[target].myowner TEMP4
				ife TEMP4 PLAYER_IDENTITY shoot 15175
				else ezshoot TEMP3 15175
				}
			else // if shooting at player
				{
				sound NBRUTE_FIRE 
				shoot 15175
				}
			ai AI_NBRUTE_WALK // go back to seeking AI
			}
		}
	}
	
ifhitweapon
{
	state NEWGUNEFFECTS
	//spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		addkills 1
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_NBRUTE_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action A_NBRUTE_FROZEN } 
		else
			{
			sound NBRUTE_DIE
			ai AI_NBRUTE_DIE
			spawn BLOODPOOL
			}
		}
	else ifg PAIN_AMOUNT 0 action A_NBRUTE_PAIN
	else ifrnd 8 { sound NBRUTE_PAIN state PAIN_SKILL_LEVELADJUST action A_NBRUTE_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_NBRUTE_SHRUNK }
}

state checksquished

enda

/*

// ===========================================
// DUMMY ACTOR FOR EASE OF ADDING IN ENEMIES
// ============================================

action A_DUMMY_IDLE 0 1 5 1 12
action A_DUMMY_WALK 0 4 5 1 12
action A_DUMMY_ATTACK 20 2 5 1 12
action A_DUMMY_PAIN 35 1 1 1 8
action A_DUMMY_DIE 35 7 1 1 16
action A_DUMMY_FROZEN 35 1 1 1 8
action A_DUMMY_DEAD 41

move DUMMY_WALK 126

ai AI_DUMMY_IDLE A_DUMMY_IDLE STOP seekplayer
ai AI_DUMMY_WALK A_DUMMY_WALK DUMMY_WALK seekplayer
ai AI_DUMMY_ATTACK A_DUMMY_ATTACK STOP seekplayer
ai AI_DUMMY_GROW A_DUMMY_PAIN STOP
ai AI_DUMMY_SHRUNK A_DUMMY_WALK fleeenemy
ai AI_DUMMY_DIE A_DUMMY_DIE STOP

useractor enemy 24447 150 A_DUMMY_IDLE
fall
ifai 0
	{
	cstat 257
	strength 150
	sizeat 50 50
	state monst_glow
	spawn SHOOTME
	ai AI_DUMMY_IDLE
	}
	
state ENEMYKNOCKBACKS
state enemyfloordamage
state enemy_fire_damage
state enemy_ice_damage
state enemy_spirit_damage
	
ifaction A_DUMMY_FROZEN
	{
	state frozen_code
	}
else
ifai AI_DUMMY_GROW state genericgrowcode
else
ifaction A_DUMMY_DEAD
	{
	move STOP
    ifhitweapon
		{
		  ifwasweapon RADIUSEXPLOSION
		  {
			state squish_sounds
		  state standard_jibs
			killit
		  }
		  break
		}
	}
else
ifai AI_DUMMY_DIE
	{
	strength 0
	ifactioncount 5 { state rf state BODY_FALL_NOISES action A_DUMMY_DEAD }
	}
else
ifaction A_DUMMY_PAIN
	{
	sub PAIN_AMOUNT 1
	move STOP
	ife PAIN_AMOUNT 0
		{
		ifdead break
		ai AI_DUMMY_WALK
		}
	}
else
ifai AI_DUMMY_SHRUNK
{
    ifcount SHRUNKDONECOUNT
      ai AI_DUMMY_WALK
    else ifcount SHRUNKCOUNT
      {
	sound ACTOR_UNSHRINK
	sizeto 46 46
	}
    else
      state genericshrunkcode
    break
}
else
ifai AI_DUMMY_IDLE
	{
	ifcansee ai AI_DUMMY_WALK // if can see player
	else ifn target -1 ai AI_DUMMY_WALK // or if it has a target
	}
else
ifai AI_DUMMY_WALK
	{
	ifrnd 16 state enemyfindtarget // run enemy targetting stuff occasionally to refresh target
	state SKILL_SHOOT_LEVELADJUST // run difficulty level check
	ifl RANDOM_CHANCE SKILLCHANCE // if succesful
		{
		state enemyfindtarget // find enemy target
		ifn target -1 ldist TEMP THISACTOR target // if found, get distance
		ifn target -1 ifl TEMP 4096 ai AI_DUMMY_ATTACK // if target is less than distance, attack
		else ifcansee ifcanseetarget ai AI_DUMMY_ATTACK // otherwise if can see player, attack
		}
	else ifrnd 2 ai AI_DUMMY_WALK // reset AI routine every now and then
	}
else
ifai AI_DUMMY_ATTACK
	{
	ifactioncount 2
		{
		state shooting_settings // run targetting stuff
	    ifn target -1 getactorvar[target].myowner TEMP4
		ifn target -1 // if shooting at target
		 ifn TEMP4 PLAYER_IDENTITY
			{
		    sound SHORT_CIRCUIT 
			ezshoot TEMP3 SPELL9
			}
		else // if shooting at player
			{
			sound TURR_ATTACK 
			shoot 5394
			}
		ai AI_DUMMY_WALK // go back to seeking AI
		}
	}
	
ifhitweapon
{
	state NEWGUNEFFECTS
	sound BERSERK_PAIN
	//spawn BLOOD
	guts JIBS6 1
	state random_wall_jibs
	ifdead
		{
		addkills 1
		state rf
		state thegames_score
		ifwasweapon GROWSPARK { cstat 0 sound ACTOR_GROWING ai AI_DUMMY_GROW break }
		else ifg ICE_DAMAGE 0 { spritepal 1 strength 0 sound SOMETHINGFROZE action A_DUMMY_FROZEN } 
		else ifg FIRE_DAMAGE 0 
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			ifrnd 128 sound ZSOLD_DIE1
			else sound ZSOLD_DIE2
			spawn ONFIREGUY
			killit
			}
			else ife HEADSHOT 2 
			{
			ifg FIRE_DAMAGE 0 set FIRE_DAMAGE 0
				ifrnd 32 state trigger_showoff
				state jib_sounds
				sound DECAPITATE 
				shoot NJIB 
				shoot NJIB 
				guts JIBS6 3 
				guts JIBS2 2 
				ai AI_DUMMY_DIE
			}
		else ifg SPIRIT_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 1
			guts JIBS3 6
			spawn SPIRIT_DEATH_GUY
			killit
			}
		else ifg ENERGY_DAMAGE 0
			{
			shoot SPARK2 shoot SPARK2 shoot SPARK2 
			spritepal 4
			guts JIBS3 6
			spawn DISINTIGRATE_GUY
			killit
			}
		else
			{
			sound BERSERK_DIE
			ai AI_DUMMY_DIE
			spawn BLOODPOOL
			}
		}
	else ifg PAIN_AMOUNT 0 action A_DUMMY_PAIN
	else ifrnd 32 { state PAIN_SKILL_LEVELADJUST action A_DUMMY_PAIN }
	ifwasweapon SHRINKSPARK { sound ACTOR_SHRINKING ai AI_DUMMY_SHRUNK }
}

state checksquished

enda

*/

