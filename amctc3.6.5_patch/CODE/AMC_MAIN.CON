 
 /*
AMC TC CON FILES----------------------------------------
By James Stanfield (With Exercepts of code by DeeperThought and 3DR, as well as others)

Please feel free to plunder this treasure trove 'o fun for yer own ship durr I mean mod.

In other words, feel free to use any code in the AMC TC for your own uses; just make
sure to mention me and/or the AMC TC in your credits.

Yaaargh!

--------------------------------------------------------------------------------
*/

scriptsize 16777216

dynamicremap

move STOP 0

move SUP 0 -5
move SDOWN 0 5

include CODE/AMCVARS.CON // Variables
include CODE/AMCDEFS.CON // Defs
include CODE/AMCUSER.CON // User
include CODE/AMC_SOUNDS.CON // Sounds
include CODE/AMC_EPS.CON // Episodes

action ACAR 0 1 5 1 1

defstate SPRITE_FADE
		ife alpha 0
		{
		geta[].cstat TEMP
		andvar TEMP 0xfdfe
		seta[].cstat TEMP
		}
		else
		{
			geta[].cstat TEMP
			orvar TEMP 2
			seta[].cstat TEMP

			// Assume blending tables [1 .. 128] are installed, like generated by
			// shadexfog.lua:create_128_trans(1).
			ifg alpha 128
			{
				set TEMP 257
				sub TEMP alpha
				set alpha TEMP

				// Set "reverse translucent" cstat bit
				geta[].cstat TEMP
				orvar TEMP 512
				seta[].cstat TEMP
			}
			else
			{
				// Clear cstat bit 512
				geta[].cstat TEMP
				andvar TEMP 0xfdff
				seta[].cstat TEMP
			}
			seta[].blend alpha
		}
ends

defstate rf
geta[].cstat TEMP4
ife TEMP4 259 cstat 2 else
ife TEMP4 771 cstat 514 else
{ 
  ifrnd 128
    cstat 4
  else
    cstat 0
}
ends

defstate squish_sounds
ife TIMEZONE 8 { stopallsounds globalsound RETRO_DEAD } else
	{
	ifrnd 128 sound SQUISHED2 
	else ifrnd 128 sound SQUISHED3 
	else sound SQUISHED
	}
ends

defstate animate_sprite_event
	seta[].mdflags 16
ends

defstate monst_glow
	state animate_sprite_event
	ifand sprite[].cstat 2 nullop else setactor[].blend 0
	set command 8192
ends

defstate NOEVENTNOCLIPPING
	geta[].htflags TEMP2
	xorvar TEMP2 128
	xorvar TEMP2 2048
	seta[].htflags TEMP2
ends

gamevar spawntmp 0 0

onevent EVENT_ENDLEVELSCREEN
set RETURN -1
endevent

onevent EVENT_NEWGAMESCREEN
set RETURN -1
endevent

onevent EVENT_SPAWN
    geta[].cstat spawntmp	
    andvar spawntmp 48

    ife spawntmp 32  // if it's floor-aligned
    {
        geta[].mdflags spawntmp
        orvar spawntmp 1  // SPREXT_NOTMD
        seta[].mdflags spawntmp
    }
	ifactor ACCESSSWITCH
	{
	ife sprite[].xvel 1
		{
        geta[].mdflags spawntmp
        orvar spawntmp 1  // SPREXT_NOTMD
        seta[].mdflags spawntmp
		}
	}
	ifactor SLOTDOOR
	{
	ife sprite[].xvel 1
		{
        geta[].mdflags spawntmp
        orvar spawntmp 1  // SPREXT_NOTMD
        seta[].mdflags spawntmp
		}
	}
	ifactor LIGHTSWITCH
	{
	ife sprite[].xvel 1
		{
        geta[].mdflags spawntmp
        orvar spawntmp 1  // SPREXT_NOTMD
        seta[].mdflags spawntmp
		}
	}
	ifactor DIPSWITCH
	{
	ife sprite[].xvel 1
		{
        geta[].mdflags spawntmp
        orvar spawntmp 1  // SPREXT_NOTMD
        seta[].mdflags spawntmp
		}
	}
	ifactor LIGHTSWITCH2
	{
	ife sprite[].hitag 0 seta[].hitag 44
	}
endevent

gamevar randomstart 7 0
gamevar DONE 0 0

onevent EVENT_CHECKFLOORDAMAGE
ife player_in_vehicle 1 set RETURN 0
ife RETURN 200 set RETURN 0

endevent

// following code by Dan Gaskil

appendevent EVENT_LOADACTOR

ifactor 2298 seta[].picnum 14300

ife DONE NO
{
     readgamevar randomstart
     add randomstart 1
     andvar randomstart 65535
     set TEMP randomstart
     xorvar TEMP 43690
     whilevarn TEMP 0
     {
     ifrnd 1 { }
     sub TEMP 1
     }
     savegamevar randomstart
     set DONE YES
}
endevent

move FORWARD 10

// Reverse shade

defstate reverse_shade
  set WEAP_DISP_TEMP5 shade
  ifg WEAP_DISP_TEMP5 30 set WEAP_DISP_TEMP5 30
  ifl WEAP_DISP_TEMP5 0 set WEAP_DISP_TEMP5 0
  sub WEAP_DISP_TEMP5 30
  mulvar WEAP_DISP_TEMP5 -1
ends

defstate SWITCH_INFO_CODE
	ife sprite[].hitag 1 espawn 10351 else espawn 10350

	set TEMP3 sprite[].x
	add TEMP3 64

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6
	
	updatesectorz TEMP5 TEMP6 sprite[].z TEMP7
	ife TEMP7 -1 // if it's in an empty sector, trying checking backwards
	{
	set TEMP3 sprite[].x
	sub TEMP3 64

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6
	updatesectorz TEMP5 TEMP6 sprite[].z TEMP8
	ifn TEMP8 -1
		{
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		}
	}
	else
	ifvarvarl sector[TEMP7].floorz sprite[].z // if floor is above this sprite, spawn 'behind'
	{
	set TEMP3 sprite[].x
	sub TEMP3 64

	rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y sprite[].ang TEMP5 TEMP6
	updatesectorz TEMP5 TEMP6 sprite[].z TEMP8
	ifn TEMP8 -1
		{
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		}
	}
	else
	{
	seta[RETURN].x TEMP5 
	seta[RETURN].y TEMP6
	}
	geta[].z TEMP
	sub TEMP 2048
	seta[RETURN].z TEMP
ends

include AMC_SETTINGS.INI // User definable stuff
include CODE/AMC_LOADA.CON // Load actor
include CODE/AMC_SUBTITLES.CON // subtitles for player one-liners .etc
include CODE/AMC_CUT_SUB.CON // subtitles for cutscenes
include CODE/GETZRANGE.CON // helixhorned's get range code
include CODE/PSTATS.CON // Player code
include CODE/EBIKE.CON // Bike code by Lezing
include CODE/AMCEXTRA.CON // Extra stuff
include CODE/AMCSTEPS.CON // Footsteps
include CODE/AMCWEPS.CON // Weapon display

// Enemy code => TODO separate specific enemy code in various files, keep common logic in AMCENEMY.CON
include CODE/AMCENEMY.CON // Enemies

include CODE/AMC_COM.CON // AMC Command interface
include CODE/AMCCOMP.CON // Computer and mission code
include CODE/AMCSCENE.CON // Cutscene cam code
include CODE/AMCALLY.CON // AMC Ally and fighting code
include CODE/AMCFOXTANK.CON // Fox tank code
include CODE/AMCDISP.CON // display stuff
include CODE/AMCITEMS.CON // Items
include CODE/AMC_OBJECTS.CON // Breakable objects
include CODE/AMCINPUT.CON // Inputable stuff
include CODE/LENSFLARE.CON
include CODE/AMC_ZAX.CON // CON file for Zaxtor to put his stuff in
include CODE/AMC_MIKKO.CON // CON file for Mikko to put his stuff in
include CODE/AMC_DMGSPRITE_DEFS.CON // Damagetile definitions for the below
include CODE/AMC_DMGSPRITE_MODS.CON // Sprite damage events and modifiers

onevent EVENT_INIT
echo 9000 // sadly not over 9000...
endevent

onevent EVENT_SETDEFAULTS 
	xorvar LOGO_FLAGS 33554432
	xorvar LOGO_FLAGS 67108864
	setuserdef[].menubackground 0
	setuserdef[].show_level_text 0
	setuserdef[].screenfade 0
	setuserdef[].menutext_paldisabled 13
	setuserdef[].menutext_paldeselected 5
	// setuserdef[].menutext_zoom 49152
	// setuserdef[].gametext_zoom 49152
	setuserdef[].gametext_pal 2
	setuserdef[].gametext_palselected 0
	setuserdef[].minitext_paldisabled 22
	cheatkeys 30 20
	setuserdef[].menu_scrollbartilenum 3064
	readarrayfromfile BEAT_EPISODES 4053
	ifand BEAT_EPISODES[1] 128 setuserdef[].default_volume 1
	ifand BEAT_EPISODES[2] 1024  setuserdef[].default_volume 2
endevent

onevent EVENT_OPENMENUSOUND
set RETURN ENTMENUSOUND
endevent

onevent EVENT_SOUND
	ifand player[].gm 1
	{	
	switch RETURN
			case LASERTRIP_EXPLODE
			case DUKE_GRUNT
			case DUKE_LAND_HURT
			case CHAINGUN_FIRE
			case SQUISHED
			case PISTOL_RICOCHET
			case PISTOL_FIRE
			case SHOTGUN_FIRE
			case BOS1_WALK
			case RPG_EXPLODE
			case PIPEBOMB_BOUNCE
			case PIPEBOMB_EXPLODE
			case NITEVISION_ONOFF
			case RPG_SHOOT
			case SELECT_WEAPON
			 set RETURN 4
			 screensound INTERFACE_2
			break
			case PISTOL_BODYHIT
			 set RETURN 4
			 screensound INTERFACE_1
			break
			case KICK_HIT
			 set RETURN 4
			 screensound COMP_SELECT
			break
			case 227
			case UNDER_HALL
			case 195
			case 226
			 set RETURN 4
			 screensound COMP_SELECT
			break
		endswitch	
	}
	
ife RETURN MISSILE_EXPLODE
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}

ife RETURN RPG_EXPLODE
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}
	
ife RETURN PIPEBOMB_EXPLODE
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}
	
ife RETURN LASERTRIP_EXPLODE
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}

ife RETURN EXPLOSION_HUGE
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}
	
ife RETURN EXPLOSION_BIG
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}
	
ife RETURN EXPLOSION_LARGE
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}
	
ife RETURN EXPLOSION_MEDIUM
	{
	ifinwater set RETURN UNDERWATER_EXP
	else ifonwater set RETURN WATER_EXPLOSION
	}
	
ife RETURN DUKE_TAKEPILLS
	{
	ifp pboosted set RETURN 4
	}
	
ife RETURN DUKE_GRUNT
	{
	ife CHAR 0 set RETURN JEXERT
	else ife CHAR 1 set RETURN ZEXERT
	else ife CHAR 10 set RETURN BS_GRUNT
	else set RETURN 4
	}
	
ife RETURN DUKE_LOOKINTOMIRROR
	{ 
	set RETURN 4
	state MIRROR_QUOTES
	soundoncevar playsound
	ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR playsound 512 
	}
	
ife RETURN DUKE_GASP
	{
	set RETURN 4
	ife CHAR 0 set playsound JGASP2
	ife CHAR 1 set playsound ZGASP2 
	ife CHAR 3 set playsound R_GASP
	ife CHAR 4 set playsound SGASP
	ife CHAR 6 set playsound G_GASP1
	ife CHAR 13 set playsound MC_GASP
	soundoncevar playsound
	ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR playsound 512 
	}
	
ife RETURN DUKE_KILLED5 
	{ 
	set RETURN 4
	state PISSED_QUOTES
	}
	
ife RETURN DUKE_GOTHEALTHATLOW 
	{ 
	set RETURN 4
	state FIRSTAID_QUOTES
	}
	
ife RETURN DUKE_PISSRELIEF
	{ 
	set RETURN 4
	state RELIEVED_QUOTES
	}

ife RETURN DUKE_JETPACK_ON
	{
	ife CHAR 1 nullop else set RETURN 4
	ife CHAR 0 soundonce JJETPAKON
	ife CHAR 2 soundonce FLYBOOTS_ACTIVE
	ife CHAR 3 soundonce MC_JETPAKON
	ife CHAR 4 soundonce SPITCHFORK
	ife CHAR 5 soundonce RNWATCH
	ife CHAR 6 soundonce GSANDAL
	ife CHAR 7 soundonce MC_JETPAKON
	ife CHAR 10 soundonce JJETPAKON
	ife CHAR 11 soundonce FLYBOOTS_ACTIVE
	ife CHAR 13 soundonce MC_JETPAKON
	ife CHAR 14 { soundonce SF_JETPACK_ON ifrnd 32 soundonce SF_JP }
	}
ife RETURN DUKE_JETPACK_IDLE
	{
	ifn player_using_fighter -1 set RETURN 4
	else ifn player_using_hovertank -1 set RETURN 4
	 else ifn player_using_VR_tank -1 set RETURN 4
		else
		{
		ife CHAR 1 nullop else set RETURN 4
		ife CHAR 0 soundonce JJETPAKIDLE
		ife CHAR 2 soundonce FLYBOOTS_HUM
		ife CHAR 3 soundonce MC_JETPAKIDLE
		ife CHAR 7 soundonce MC_JETPAKIDLE
		ife CHAR 10 soundonce JJETPAKIDLE 
		ife CHAR 11 soundonce FLYBOOTS_HUM
		ife CHAR 13 soundonce MC_JETPAKIDLE
		}
	}
	
ife RETURN DUKE_JETPACK_OFF
	{
	ife CHAR 1 nullop else set RETURN 4
	ife CHAR 0 { stopsound JJETPAKIDLE soundonce JJETPAKOFF } 
	ife CHAR 2 { stopsound FLYBOOTS_HUM soundonce FLYBOOTS_ACTIVE }
	ife CHAR 3 soundonce MC_JETPAKOFF
	ife CHAR 4 soundonce SPITCHFORK
	ife CHAR 5 soundonce RNWATCH
	ife CHAR 6 soundonce GSANDAL2
	ife CHAR 7 soundonce MC_JETPAKOFF
	ife CHAR 10 { stopsound JJETPAKIDLE soundonce JJETPAKOFF } 
	ife CHAR 11 { stopsound FLYBOOTS_HUM soundonce FLYBOOTS_ACTIVE }
	ife CHAR 13 soundonce MC_JETPAKOFF
	ife CHAR 14 soundonce SF_JETPACK_OFF
	}
	
ife RETURN DUKE_SEARCH set RETURN 4

ife RETURN DUKE_SEARCH2 set RETURN 4
		
ife RETURN DUKE_SCREAM 
		{ 
		set RETURN 4
		state FALL_SCREAM_QUOTES
		}
	
endevent

gamevar TSPRITE_STATNUM 0 2

defstate SHELL_ROT		
		geta[].xvel TSPRITE_TEMP4
		div TSPRITE_TEMP4 5
		set TSPRITE_TEMP5 25
		sub TSPRITE_TEMP5 TSPRITE_TEMP4
		gettspr[].tsprpicnum TSPRITE_TEMP
		add TSPRITE_TEMP2 1
		ifg TSPRITE_TEMP2 TSPRITE_TEMP5
			{
			add TSPRITE_TEMP3 1
			set TSPRITE_TEMP2 0		
			}
		ifg TSPRITE_TEMP3 6 set TSPRITE_TEMP3 0
		add TSPRITE_TEMP TSPRITE_TEMP3
		settspr[].tsprpicnum TSPRITE_TEMP
ends

defstate SHELL_ROT_BACK
		geta[].xvel TSPRITE_TEMP4
		div TSPRITE_TEMP4 5
		set TSPRITE_TEMP5 25
		sub TSPRITE_TEMP5 TSPRITE_TEMP4
		gettspr[].tsprpicnum TSPRITE_TEMP
		add TSPRITE_TEMP2 1
		ifg TSPRITE_TEMP2 TSPRITE_TEMP5
			{
			sub TSPRITE_TEMP3 1
			set TSPRITE_TEMP2 0		
			}
		ifl TSPRITE_TEMP3 -6 set TSPRITE_TEMP3 0
		add TSPRITE_TEMP TSPRITE_TEMP3
		settspr[].tsprpicnum TSPRITE_TEMP
ends

onevent EVENT_ANIMATESPRITES
gettspr[].tsprpicnum TSPRITE_PICNUM
gettspr[].tsprstatnum TSPRITE_STATNUM

ife sprite[].htflags 32
  ifn tspr[].tsprpal 4
	{
	ifg sector[].floorpal 127
		{
		settspr[].tsprpal sector[].floorpal
		}
	}

ife TSPRITE_STATNUM 99
{
getsector[].floorz TSPRITE_TEMP
settspr[].tsprz TSPRITE_TEMP
 ifl sprite[].extra 1 // needs to be fixed at some point
  ifn tspr[].tsprpal 4
	{
	ifg sector[].floorpal 127
		{
		settspr[].tsprpal sector[].floorpal
		settspr[].tsprshade 32
		}
	}
}

	// Floating code by DeeperThought
	ifand actorvar[].command 32768
	{
		gettspr[].tsprpal pal
		ifn pal 4
		{
			geta[].z z
			sub z 1024		
			set TSPRITE_TEMP player[].player_par
			set TSPRITE_TEMP2 THISACTOR
			ifand TSPRITE_TEMP2 1 add TSPRITE_TEMP2 4096
			add TSPRITE_TEMP TSPRITE_TEMP2
			shiftvarl TSPRITE_TEMP 6
			sin TSPRITE_TEMP2 TSPRITE_TEMP
			shiftvarr TSPRITE_TEMP2 4	
			sub z TSPRITE_TEMP2
			settspr[].tsprz z	
		}
	}
	
	ifand actorvar[].command 128
	{
	getactor[THISACTOR].ang TSPRITE_TEMP
    setvarvar TSPRITE_TEMP2 totalclock
    shiftvarl TSPRITE_TEMP2 1
	divvar TSPRITE_TEMP2 2
    add TSPRITE_TEMP TSPRITE_TEMP2
    settspr[THISACTOR].tsprang TSPRITE_TEMP
	}
	
	ifand actorvar[].command 256
	{
	getactor[THISACTOR].ang TSPRITE_TEMP
    setvarvar TSPRITE_TEMP2 totalclock
    shiftvarl TSPRITE_TEMP2 2
    add TSPRITE_TEMP TSPRITE_TEMP2
    settspr[THISACTOR].tsprang TSPRITE_TEMP
	}
	
	ifand actorvar[].command 512
	{
	getactor[THISACTOR].ang TSPRITE_TEMP
    setvarvar TSPRITE_TEMP2 totalclock
    shiftvarl TSPRITE_TEMP2 6
    add TSPRITE_TEMP TSPRITE_TEMP2
    settspr[THISACTOR].tsprang TSPRITE_TEMP
	}
	
	ifand actorvar[].command 1024 // counter-clockwise
	{
	getactor[THISACTOR].ang TSPRITE_TEMP
    setvarvar TSPRITE_TEMP2 totalclock
    shiftvarl TSPRITE_TEMP2 1
	divvar TSPRITE_TEMP2 2
    sub TSPRITE_TEMP TSPRITE_TEMP2
    settspr[THISACTOR].tsprang TSPRITE_TEMP
	}
	
	ifand actorvar[].command 2048 // counter-clockwise
	{
	getactor[THISACTOR].ang TSPRITE_TEMP
    setvarvar TSPRITE_TEMP2 totalclock
    shiftvarl TSPRITE_TEMP2 2
    sub TSPRITE_TEMP TSPRITE_TEMP2
    settspr[THISACTOR].tsprang TSPRITE_TEMP
	}
	
	ifand actorvar[].command 131072
	{
	ife player[].heat_on 1 
		ife HELMET_LOADOUT[CHAR] 4 // ghost vision	
			{
			settspr[].tsprpal 33
			settspr[].tsprshade -127
			}
	}
	
	ifand actorvar[].command 65536
	{
		gettspr[].tsprpal pal
		ifn pal 4
		{
			geta[].z z
			sub z 128		
			set TSPRITE_TEMP player[].player_par
			set TSPRITE_TEMP2 THISACTOR
			ifand TSPRITE_TEMP2 1 add TSPRITE_TEMP2 256
			add TSPRITE_TEMP TSPRITE_TEMP2
			shiftvarl TSPRITE_TEMP 2
			sin TSPRITE_TEMP2 TSPRITE_TEMP
			shiftvarr TSPRITE_TEMP2 4	
			sub z TSPRITE_TEMP2
			settspr[].tsprz z	
		}
	}
	
	ifand actorvar[].command 8192
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	ife TSPRITE_TEMP2 4 break // If the shadow actor, break
	ifl SKILL_LEVEL 3
		{
		geta[].shade TSPRITE_TEMP
		sub TSPRITE_TEMP 5
		ifl TSPRITE_TEMP -120 set TSPRITE_TEMP -120
		settspr[].tsprshade TSPRITE_TEMP
		}
	ife player[].heat_on 1 
		{
		ife HELMET_LOADOUT[CHAR] 2 // heat vision
			{
			ifand MONSTER_FLAGS 4
				{
				settspr[].tsprblend 0
				settspr[].tsprcstat sprite[].cstat
				}
			ifl sprite[].extra 1
				{
				settspr[].tsprpal sprite[].pal
				settspr[].tsprshade sector[].floorshade
				}
			else
				{
				settspr[].tsprpal 107
				settspr[].tsprshade -127
				}
			}
		else
		ife HELMET_LOADOUT[CHAR] 4 // ghost vision
			{
			ifand MONSTER_FLAGS 8
				{
				settspr[].tsprblend 0
				settspr[].tsprcstat 0
				settspr[].tsprpal 67
				}
			else
				{
				settspr[].tsprpal sprite[].pal
				settspr[].tsprshade sector[].floorshade
				}
			}
		else // night vision
			{
			gets[].floorpal TSPRITE_TEMP3
			switch TSPRITE_TEMP3
				case 1
				case 2
				case 4
				case 6
				case 7
				case 8
				case 17
				case 19
				case 26
				case 27
				case 28
				case 29
				case 30
				case 31
				case 32
				case 33
				case 34
				case 35
					settspr[].tsprpal sector[].floorpal
					break
				default
					settspr[].tsprpal sprite[].pal
					break
			endswitch
			
			settspr[].tsprshade sector[].floorshade
			}
		ifl sprite[].extra 1
				{
					gets[].floorpal TSPRITE_TEMP3
					switch TSPRITE_TEMP3
						case 1
						case 2
						case 4
						case 6
						case 7
						case 8
						case 17
						case 19
						case 26
						case 27
						case 28
						case 29
						case 30
						case 31
						case 32
						case 33
						case 34
						case 35
							settspr[].tsprpal sector[].floorpal
							break
						default
							settspr[].tsprpal sprite[].pal
							break
					endswitch
				settspr[].tsprshade sector[].floorshade
				}
		}
	}
	
	// fade in and out code by helixhorned
	ifand actorvar[].command 16384
	{
		set TSPRITE_TEMP totalclock
		shiftvarl TSPRITE_TEMP 2

		sin alpha TSPRITE_TEMP   // alpha is now in [-2^14 .. 2^14]
		shiftvarr alpha 7  // [-2^7 .. 2^7]
		add alpha 128  // [0 .. 256]

		ife alpha 0
		{
			// clear translucent bits, 0xfdfe == 0xffff-(1+512)
			gettspr[].tsprcstat TSPRITE_TEMP
			andvar TSPRITE_TEMP 0xfdfe
			settspr[].tsprcstat TSPRITE_TEMP
		}
		else
		{
			gettspr[].tsprcstat TSPRITE_TEMP
			orvar TSPRITE_TEMP 2
			settspr[].tsprcstat TSPRITE_TEMP

			// Assume blending tables [1 .. 128] are installed, like generated by
			// shadexfog.lua:create_128_trans(1).
			ifg alpha 128
			{
				set TSPRITE_TEMP 257
				sub TSPRITE_TEMP alpha
				set alpha TSPRITE_TEMP

				// Set "reverse translucent" cstat bit
				gettspr[].tsprcstat TSPRITE_TEMP
				orvar TSPRITE_TEMP 512
				settspr[].tsprcstat TSPRITE_TEMP
			}
			else
			{
				// Clear cstat bit 512
				gettspr[].tsprcstat TSPRITE_TEMP
				andvar TSPRITE_TEMP 0xfdff
				settspr[].tsprcstat TSPRITE_TEMP
			}

			settspr[].tsprblend alpha
		}
	}
	
	ifand actorvar[].command 2048
	{
	gettspr[].tsprstatnum TSPRITE_TEMP
		{
		ife TSPRITE_TEMP 99 nullop else settspr[].tsprpicnum 3587
		}
	}
		
	ifand actorvar[].command 4096
	{
	ifn CHAR -1
	ife ARTIFACTS_LOADOUT[CHAR] 9 // player has spirit shawl?
		{
		gettspr[].tsprpal TSPRITE_TEMP2
		ifn TSPRITE_TEMP2 4
			{
			settspr[].tsprshade -127
			settspr[].tsprblend 254
			settspr[].tsprpal 103
			}
		}
		else
		ifn CHAR -1
		ife HELMET_LOADOUT[CHAR] 4 // ghost vision
		 ife player[].heat_on 1
			{
				settspr[].tsprblend 0
				settspr[].tsprshade -127
				settspr[].tsprcstat 0
				settspr[].tsprpal 109
			}
		else
		{
			set TSPRITE_TEMP totalclock
			shiftvarl TSPRITE_TEMP 2

			sin alpha TSPRITE_TEMP   // alpha is now in [-2^14 .. 2^14]
			shiftvarr alpha 7  // [-2^7 .. 2^7]
			add alpha 128  // [0 .. 256]

			ife alpha 0
			{
				// clear translucent bits, 0xfdfe == 0xffff-(1+512)
				gettspr[].tsprcstat TSPRITE_TEMP
				andvar TSPRITE_TEMP 0xfdfe
				settspr[].tsprcstat TSPRITE_TEMP
			}
			else
			{
				gettspr[].tsprcstat TSPRITE_TEMP
				orvar TSPRITE_TEMP 2
				settspr[].tsprcstat TSPRITE_TEMP

				// Assume blending tables [1 .. 128] are installed, like generated by
				// shadexfog.lua:create_128_trans(1).
				ifg alpha 128
				{
					set TSPRITE_TEMP 257
					sub TSPRITE_TEMP alpha
					set alpha TSPRITE_TEMP

					// Set "reverse translucent" cstat bit
					gettspr[].tsprcstat TSPRITE_TEMP
					orvar TSPRITE_TEMP 512
					settspr[].tsprcstat TSPRITE_TEMP
				}
				else
				{
					// Clear cstat bit 512
					gettspr[].tsprcstat TSPRITE_TEMP
					andvar TSPRITE_TEMP 0xfdff
					settspr[].tsprcstat TSPRITE_TEMP
				}

				settspr[].tsprblend alpha
			}
		}
		
	}
		
ifactor CAMERA1
{
ifvare ALLY_MAG 1 settspr[].tsprpicnum 3625
ifl sprite[].xrepeat 8
 ifl sprite[].xrepeat 8
  settspr[].tsprpicnum 3625
}

ifactor TRIPBOMB
{
ifspawnedby APLAYER
 ife CHAR 1
	settspr[].tsprpicnum 5449
}


ifactor BULLETHOLE
{
ife COSMETIC_FLAME 0 // no point making new variables
	{
	 geta[].x x
	geta[].y y
	geta[].sectnum TEMP
	geta[].ang TEMP3
	add TEMP3 1024

	sin my TEMP3
	cos mx TEMP3
	geta[].z z

	hitscan x y z TEMP mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280
	ifn hitwall -1
		{
	   getwall[hitwall].picnum FLOORTEX
	   settspr[].tsprpal wall[hitwall].pal
	   settspr[].tsprshade wall[hitwall].shade
	   state CHECKSTEPS
	   ife STEPSOUNDFX 1 set COSMETIC_FLAME 2
	   ife STEPSOUNDFX 2 set COSMETIC_FLAME 5
	   ife STEPSOUNDFX 3 set COSMETIC_FLAME 5
	   ife STEPSOUNDFX 24 set COSMETIC_FLAME 5
	   ife STEPSOUNDFX 14 set COSMETIC_FLAME 5
	   ife STEPSOUNDFX 23 set COSMETIC_FLAME 2
	   ife STEPSOUNDFX 11 set COSMETIC_FLAME 3
	   ife STEPSOUNDFX 18 set COSMETIC_FLAME 4
	   ife STEPSOUNDFX 26 set COSMETIC_FLAME 4
		}
		else set COSMETIC_FLAME 1
		
	}
	
ife COSMETIC_FLAME 2
	settspr[].tsprpicnum 3778
	
	
ife COSMETIC_FLAME 3
	settspr[].tsprpicnum 3780
	
ife COSMETIC_FLAME 4
    {
	settspr[].tsprpicnum 3068
	settspr[].tsprblend 255
	gettspr[].tsprcstat TEMP
	xorvar TEMP 18
	settspr[].tsprcstat 18
	}
	
ife COSMETIC_FLAME 5
	settspr[].tsprpicnum 3645
	
ifn hitwall -1 settspr[].tsprshade wall[hitwall].shade
	
}

ifactor AMCSHIP
{
ifoutside
	{
	settspr[].tsprpal sector[].floorpal
	}
}

ifactor AMCSHIP2
{
ifoutside
	{
	settspr[].tsprpal sector[].floorpal
	}
}

ifactor 21612
{
ifspritepal 143 nullop else
settspr[].tsprpal 49
}
	
ifactor 14302
{
ife HIGHRES_CLOUDS OFF settspr[].tsprpicnum 3625
ife HIGHRES_CLOUDS YES
	{
	settspr[].tsprpicnum 14309
	  gettspr[].tsprcstat TSPRITE_TEMP
	  ifand TSPRITE_TEMP 2 nullop else
		  xorvar TSPRITE_TEMP 2
	  settspr[].tsprcstat TSPRITE_TEMP
	}
}

ifactor FIRELASER settspr[].tsprcstat 130

ifactor 12263
{
ifn player[].newowner -1 settspr[].tsprpicnum 3625
else ifn camerasprite -1 settspr[].tsprpicnum 3625
else ife SPEECH_BUBBLE NO settspr[].tsprpicnum 3625
else settspr[].tsprpicnum 12263
}

ifactor 22877
{
ifand sprite[].pal 3 
	{
	settspr[].tsprcstat 8
	}
}

ifactor PIGCOP
{
		  geta[].htdispicnum TSPRITE_TEMP
		  ifg TSPRITE_TEMP 2044
		  ifl TSPRITE_TEMP 2055
		  {
		  settspr[].tsprxrepeat 40
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 40
		  }

}

ifactor PIG_SF
{
		  geta[].htdispicnum TSPRITE_TEMP
		  ifg TSPRITE_TEMP 24108
		  ifl TSPRITE_TEMP 24119
		  {
		  settspr[].tsprxrepeat 40
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 40
		  }

}

ifactor ZPIGCOP
{
		  geta[].htdispicnum TSPRITE_TEMP
		  ifg TSPRITE_TEMP 16809
		  ifl TSPRITE_TEMP 16820
		  {
		  settspr[].tsprxrepeat 40
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 40
		  }

}

ifactor NINJA
{
		  geta[].htdispicnum TSPRITE_TEMP
		  ifg TSPRITE_TEMP 14917
		  ifl TSPRITE_TEMP 14943
		  {
		  settspr[].tsprxrepeat 26
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 26
		  }

}

ifactor MS_CORP_MECH
{
getp[].i TSPRITE_TEMP
ife player_using_mech THISACTOR
ife player[].over_shoulder_on 0
	{
	settspr[].tsprpicnum 11950
	}
}

ifactor CULTIST
{
		  geta[].htdispicnum TSPRITE_TEMP
		  ifg TSPRITE_TEMP 15244
		  ifl TSPRITE_TEMP 15275
		  {
		  settspr[].tsprxrepeat 28
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 28
		  }

}

ifactor LIZMAN
{

		  geta[].htdispicnum TSPRITE_TEMP
		  ifg TSPRITE_TEMP 2139
		  ifl TSPRITE_TEMP 2165
		  {
		  settspr[].tsprxrepeat 40
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 40
		  }

}

ifactor APLAYER
{
  gettspr[].tsprcstat TSPRITE_TEMP
    gettspr[].tsprpal TSPRITE_TEMP2
  ifn TSPRITE_TEMP2 4
   ifand TSPRITE_TEMP 2
      xorvar TSPRITE_TEMP 2
  settspr[].tsprcstat TSPRITE_TEMP
  
  ifg INVINC 0 ifn TSPRITE_TEMP2 4 settspr[].tsprpal 121
  
  ifmultiplayer nullop
  else
  {
  

  
	  ife CHAR 0 // If the player's James, make him the default colour
	  {
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 0
		}
	  }
	  ife CHAR 1 // If the player's Zaxtor, make him the default colour
	  {
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 0
		}
	  }
  	ife CHAR 2 // If the player's Merlijn and is the default colour, make him red
	  { 
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		  ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 21
		}
	  }
	ife CHAR 3 // If the player's Highwire and is the default colour, make him green
	  { 
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		  ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 11
		}
	  }
	  ife CHAR 4 // If the player's Sang and is the default colour, make him red
	  { 
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		  ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 21
		}
	  }
	  ife CHAR 5 // If the player's Rusty, make him the default colour
	  {
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 12
		}
	  }
	  ife CHAR 6 // If the player's Geoffrey, size the player sprite up and make him the default colour
	  { 
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		 ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 21
		}
	  }
	  ife CHAR 7 // If the player's Mikko, make him the default colour
	  {
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 11
		}
	  }
	  ife CHAR 12 // If the player's Jane, make her the default colour
	  {
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 3
		}
	  }
	  ife CHAR 13 // If the player's Micky, make him the default colour
	  {
	  gettspr[].tsprpal TSPRITE_TEMP2
	  ifn TSPRITE_TEMP2 4
		{
		ifn TSPRITE_TEMP2 0 nullop else settspr[].tsprpal 3
		}
	  }  
  }
  
ifn CUSTOMKEYCARDPOS 0
	{
	set SHIELDUP 0
	set MSHIELDUP 0
	}
  
ifp pshrunk nullop else
{
		  geta[].htdispicnum TSPRITE_TEMP
		  ifg TSPRITE_TEMP 5244 // If the player's James, size the player sprite down
		  ifl TSPRITE_TEMP 5359
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 25639 // If the player's James, size the player sprite down
		  ifl TSPRITE_TEMP 25731
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 5500 // If the player's Zaxtor, size the player sprite down
		  ifl TSPRITE_TEMP 5615
		  {
		  settspr[].tsprxrepeat 22
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 22
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6012 // If the player's Highwire, size the player sprite down
		  ifl TSPRITE_TEMP 6127
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 9269 // If the player's Highwire, size the player sprite down
		  ifl TSPRITE_TEMP 9280
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6335 // If the player's Sang, size the player sprite down
		  ifl TSPRITE_TEMP 6364
		  {
		  settspr[].tsprxrepeat 25
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 25
			}
		  }
		  else
		  ifg TSPRITE_TEMP 10281 // If the player's Sang, size the player sprite down
		  ifl TSPRITE_TEMP 10292
		  {
		  settspr[].tsprxrepeat 25
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 25
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17554 // If the player's Sang, size the player sprite down
		  ifl TSPRITE_TEMP 17590
		  {
		  settspr[].tsprxrepeat 25
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 25
			}
		  }
		  else
		  ifg TSPRITE_TEMP 23807 // If the player's Sang, size the player sprite down
		  ifl TSPRITE_TEMP 23834
		  {
		  settspr[].tsprxrepeat 22
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 22
			}
		  }
		  else
		  ifg TSPRITE_TEMP 23965 // If the player's Sang, size the player sprite down
		  ifl TSPRITE_TEMP 24011
		  {
		  settspr[].tsprxrepeat 22
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 22
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6680 // If the player's Geoffrey, size the player sprite down
		  ifl TSPRITE_TEMP 6686
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6655 // If the player's Rusty, size the player sprite down
		  ifl TSPRITE_TEMP 6755
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 11131 // If the player's Geoffrey, size the player sprite down
		  ifl TSPRITE_TEMP 11142
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6399 // If the player's Merlijn, size the player sprite down
		  ifl TSPRITE_TEMP 6425
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 9224 // If the player's Merlijn, size the player sprite down
		  ifl TSPRITE_TEMP 9270
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 10479 // If the player's Merlijn, size the player sprite down
		  ifl TSPRITE_TEMP 10495
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6429 // If the player's Geoffrey, size the player sprite down
		  ifl TSPRITE_TEMP 6458
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6584 // If the player's Geoffrey, size the player sprite down (more tiles)
		  ifl TSPRITE_TEMP 6619
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 11131 // If the player's Geoffrey, size the player sprite down (more tiles)
		  ifl TSPRITE_TEMP 11142
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 6911 // If the player's Mikko, size the player sprite down
		  ifl TSPRITE_TEMP 6957
		  {
		  settspr[].tsprxrepeat 25
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 25
			}
		  }
		  else
		  ifg TSPRITE_TEMP 7142 // If the player's Mikko crouching, size the player sprite down
		  ifl TSPRITE_TEMP 7158
		  {
		  settspr[].tsprxrepeat 25
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 25
			}
		  }
		  else
		  ifg TSPRITE_TEMP 14398 // If the player's Mikko crouching, size the player sprite down
		  ifl TSPRITE_TEMP 14409
		  {
		  settspr[].tsprxrepeat 25
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 25
			}
		  }
		  else
		  ifg TSPRITE_TEMP 11120 // If the player's Mikko kicking, size the player sprite down
		  ifl TSPRITE_TEMP 11131
		  {
		  settspr[].tsprxrepeat 25
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 25
			}
		  }
		  else
		  ifg TSPRITE_TEMP 7679 // If the player's the cultist, size the player sprite down
		  ifl TSPRITE_TEMP 7782
		  {
		  settspr[].tsprxrepeat 28
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 28
			}
		  }
		  else
		  ifg TSPRITE_TEMP 15244 // If the player's the cultist, size the player sprite down
		  ifl TSPRITE_TEMP 15275
		  {
		  settspr[].tsprxrepeat 28
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 28
			}
		  }
		  else
		  ifg TSPRITE_TEMP 11141 // If the player's Bombshell, size the player sprite down
		  ifl TSPRITE_TEMP 11152
		  {
		  settspr[].tsprxrepeat 26
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 26
			}
		  }
		  else
		  ifg TSPRITE_TEMP 9902 // If the player's Bombshell, size the player sprite down
		  ifl TSPRITE_TEMP 9948
		  {
		  settspr[].tsprxrepeat 26
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 26
			}
		  }
		  else
		  ifg TSPRITE_TEMP 10364 // If the player's Bombshell, size the player sprite down
		  ifl TSPRITE_TEMP 10385
		  {
		  settspr[].tsprxrepeat 26
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 26
			}
		  }
		  else
		  ifg TSPRITE_TEMP 26279 // If the player's Maarten, size the player sprite down
		  ifl TSPRITE_TEMP 26401
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 14463 // If the player's JANE, size the player sprite down
		  ifl TSPRITE_TEMP 14475
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 12800 // If the player's JANE, size the player sprite down
		  ifl TSPRITE_TEMP 12877
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 12943 // If the player's JANE, size the player sprite down
		  ifl TSPRITE_TEMP 12954
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 16383 // If the player's Micky, size the player sprite down
		  ifl TSPRITE_TEMP 16430
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17514 // If the player's Micky, size the player sprite down
		  ifl TSPRITE_TEMP 17555
		  {
		  settspr[].tsprxrepeat 23
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 23
			}
		  }
		  else
		  ifg TSPRITE_TEMP 19128 // If the player's suitless Micky, size the player sprite down
		  ifl TSPRITE_TEMP 19154
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 20735 // If the player's Snowfall, size the player sprite down
		  ifl TSPRITE_TEMP 20776
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 20892 // If the player's Snowfall, size the player sprite down
		  ifl TSPRITE_TEMP 20950
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17924 // If the player's Cassandra, size the player sprite down
		  ifl TSPRITE_TEMP 17973
		  {
		  settspr[].tsprxrepeat 22
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 22
			}
		  }
		  else
		  ifg TSPRITE_TEMP 15399 // If the player's human snowfall, size the player sprite down
		  ifl TSPRITE_TEMP 15604
		  {
		  settspr[].tsprxrepeat 21
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tsprpal 18
			  settspr[].tspryrepeat 21
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17444 // If the player's on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17450
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17499 // If the player's on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17505
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17454 // If the player's James on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17460
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17459 // If the player's Sang on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17465
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17464 // If the player's on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17470
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17469 // If the player's on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17480
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17479 // If the player's on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17490
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17489 // If the player's on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17495
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 17494 // If the player's on a bike, size the player sprite down
		  ifl TSPRITE_TEMP 17500
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 13676 // If the player's in the envirosuit, size the player sprite down
		  ifl TSPRITE_TEMP 13758
		  {
		  settspr[].tsprxrepeat 24
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 24
			}
		  }
		  else
		  ifg TSPRITE_TEMP 23044 // If the player's in a spacesuit
		  ifl TSPRITE_TEMP 23113
		  {
		  settspr[].tsprxrepeat 22
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 22
			}
		  }
		  else
		  ifg TSPRITE_TEMP 23921 // If the player's in the juggernaut suit, size the player sprite down
		  ifl TSPRITE_TEMP 23957
		  {
		  settspr[].tsprxrepeat 19
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 19
			}
		  }
		  else
		  {
		  settspr[].tsprxrepeat 34
		  gettspr[].tsprpal TSPRITE_TEMP2
		  ifn TSPRITE_TEMP2 4
			{
			  settspr[].tspryrepeat 34
			}
		  }		
	}
	
  ifn player_using_fighter -1
  {
  geta[player_using_fighter].z TSPRITE_TEMP
  settspr[].tsprz TSPRITE_TEMP
  settspr[].tsprxrepeat 80
  settspr[].tspryrepeat 80
  }
  
  ifn player_using_hovertank -1
  {
  geta[player_using_hovertank].z TSPRITE_TEMP
  settspr[].tsprz TSPRITE_TEMP
  settspr[].tsprshade sprite[player_using_hovertank].shade
  settspr[].tsprpal sprite[player_using_hovertank].pal
  settspr[].tsprxrepeat 64
  settspr[].tspryrepeat 64
  }
  
  ifn player_using_VR_tank -1
  {
  geta[player_using_VR_tank].z TSPRITE_TEMP
  settspr[].tsprz TSPRITE_TEMP
  settspr[].tsprshade sprite[player_using_VR_tank].shade
  settspr[].tsprpal sprite[player_using_VR_tank].pal
  settspr[].tsprxrepeat 64
  settspr[].tspryrepeat 64
  }
  
}

ifmultiplayer set TSPRITE_PLAYER screenpeek
else set TSPRITE_PLAYER PLAYER_IDENTITY

ife TSPRITE_PICNUM 11772 // TIME PORTAL
{
getactorvar[TSPRITE_PLAYER].P_CHAR TSPRITE_TEMP3
ife TSPRITE_TEMP3 0 settspr[].tsprpicnum 11772
else settspr[].tsprpicnum 3625
}

ife TSPRITE_PICNUM 12261 // SPIRITS
{
getactorvar[TSPRITE_PLAYER].P_CHAR TSPRITE_TEMP3
ife TSPRITE_TEMP3 5 settspr[].tsprpicnum 12261
else settspr[].tsprpicnum 3625
}

ife TSPRITE_PICNUM 12267 // SPIRITS
{
getactorvar[TSPRITE_PLAYER].P_CHAR TSPRITE_TEMP3
ife TSPRITE_TEMP3 5 settspr[].tsprpicnum 12267
else settspr[].tsprpicnum 3625
}

ife TSPRITE_PICNUM 21 // PISTOL
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405 // If it's the weapon icon above the player's head
	{
	getactorvar[TSPRITE_TEMP2].WEAPON1_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else // otherwise if it's the pickup sprite
	{
	getactorvar[TSPRITE_PLAYER].WEAPON1_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	set TSPRITE_TEMP2 1200
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 28 // SHOTGUN
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON2_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	getactorvar[TSPRITE_PLAYER].WEAPON2_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	set TSPRITE_TEMP2 3200
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 22 // CHAINGUN
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON3_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	getactorvar[TSPRITE_PLAYER].WEAPON3_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	
	set TSPRITE_TEMP2 3200
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 23 // RPG
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON4_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	getactorvar[TSPRITE_PLAYER].WEAPON4_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	 
	set TSPRITE_TEMP2 3200
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 26 // PIPEBOMB
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP
ife TSPRITE_TEMP 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON5_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 15 // change it's X value
	settspr[].tspryrepeat 15 // change it's Y value
	}
}

ife TSPRITE_PICNUM 3689 // PIPEBOMB
{
	getactorvar[TSPRITE_PLAYER].WEAPON5_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	ife TSPRITE_TEMP3 5215 set TSPRITE_TEMP4 20 // James nade
	ife TSPRITE_TEMP3 26 set TSPRITE_TEMP4 10 // Zaxtor bomb
	ife TSPRITE_TEMP3 5045 set TSPRITE_TEMP4 32 // Merlijn bomb
	ife TSPRITE_TEMP3 5986 set TSPRITE_TEMP4 32 // Highwire nade
	ife TSPRITE_TEMP3 6332 set TSPRITE_TEMP4 48 // Sang TNT
	ife TSPRITE_TEMP3 6846 set TSPRITE_TEMP4 64 // Rusty TNT
	ife TSPRITE_TEMP3 6487 set TSPRITE_TEMP4 32 // Geoffrey Disc
	ife TSPRITE_TEMP3 7075 set TSPRITE_TEMP4 40 // Mikko nade
	ife TSPRITE_TEMP3 6331 set TSPRITE_TEMP4 50 // Cultist TNT
	ife TSPRITE_TEMP3 12963 set TSPRITE_TEMP4 40 // Jane clusterbomb
	ife TSPRITE_TEMP3 16530 set TSPRITE_TEMP4 45 // Micky grenade
	settspr[].tsprxrepeat TSPRITE_TEMP4 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP4 // If it's not the sprite's shadow, change it's Y value
}

ife TSPRITE_PICNUM 25 // SHRINKER
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON6_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	getactorvar[TSPRITE_PLAYER].WEAPON6_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	
	set TSPRITE_TEMP2 3200
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 32 // EXPANDER
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON6_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
}

ife TSPRITE_PICNUM 29 // DEVISTATOR
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON7_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	getactorvar[TSPRITE_PLAYER].WEAPON7_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	set TSPRITE_TEMP2 3200
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 27 // TRIPBOMB
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON8_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	getactorvar[TSPRITE_PLAYER].WEAPON8_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	set TSPRITE_TEMP2 1600
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 24 // FREEZER
{
gettspr[].tsprowner TSPRITE_TEMP2
geta[TSPRITE_TEMP2].picnum TSPRITE_TEMP4
ife TSPRITE_TEMP4 1405
	{
	getactorvar[TSPRITE_TEMP2].WEAPON9_TILE TSPRITE_TEMP3
	settspr[].tsprpicnum TSPRITE_TEMP3
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	getactorvar[TSPRITE_PLAYER].WEAPON9_TILE TSPRITE_TEMP3
	gettspr[].tsprpal TSPRITE_TEMP
	settspr[].tsprpicnum TSPRITE_TEMP3
	set TSPRITE_TEMP2 3200
	div TSPRITE_TEMP2 tilesizx[TSPRITE_TEMP3]
    clamp TSPRITE_TEMP2 16 32
	settspr[].tsprxrepeat TSPRITE_TEMP2 // change it's X value
	ifn TSPRITE_TEMP 4 settspr[].tspryrepeat TSPRITE_TEMP2 // If it's not the sprite's shadow, change it's Y value
	}
}

ife TSPRITE_PICNUM 40 // PISTOL AMMO
{
getactorvar[TSPRITE_PLAYER].W1_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 49 // SHOTGUN AMMO
{
getactorvar[TSPRITE_PLAYER].W2_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 41 // MACHINEGUN AMMO
{
getactorvar[TSPRITE_PLAYER].W3_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 44 // RPG AMMO
{
getactorvar[TSPRITE_PLAYER].W4_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 47 // PIPEBOMB BOX
{
getactorvar[TSPRITE_PLAYER].W5_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
ife TSPRITE_TEMP3 20959 // Snowfall's bombs
	{
	settspr[].tsprxrepeat 20 // change it's X value
	settspr[].tspryrepeat 20 // change it's Y value
	}
	else
	{
	settspr[].tsprxrepeat 32 // change it's X value
	settspr[].tspryrepeat 32 // change it's Y value
	}
}

ife TSPRITE_PICNUM 46 // SHRINKER AMMO
{
getactorvar[TSPRITE_PLAYER].W6_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
ife TSPRITE_TEMP3 46 break // if shrinker crystal, glow as normal
settspr[].tsprshade sector[].floorshade
}

ife TSPRITE_PICNUM 45 // EXPANDER AMMO
{
getactorvar[TSPRITE_PLAYER].W11_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 42 // DEVISTATOR AMMO
{
getactorvar[TSPRITE_PLAYER].W7_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 37 // FREEZER AMMO
{
getactorvar[TSPRITE_PLAYER].W9_AMMO_TILE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 55 // STEROIDS
{
getactorvar[TSPRITE_PLAYER].CSTEROIDS TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 61 // BOOTS
{
getactorvar[TSPRITE_PLAYER].CBOOTS TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 53 // Medikit
{
getactorvar[TSPRITE_PLAYER].CMEDIKIT TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 1348 // Holoduke
{
getactorvar[TSPRITE_PLAYER].CHOLODUKE TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 57 // Jetpack
{
getactorvar[TSPRITE_PLAYER].CJETPACK TSPRITE_TEMP3
ife CHAR 4 set TSPRITE_TEMP3 6370
ife CHAR 9 set TSPRITE_TEMP3 6370
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 59 // Night vision
{
getactorvar[TSPRITE_PLAYER].DISP_NVG TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 56 // Scuba
{
getactorvar[TSPRITE_PLAYER].CSCUBA TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
}

ife TSPRITE_PICNUM 54 // ARMOUR
{
getactorvar[TSPRITE_PLAYER].C_ARMOUR TSPRITE_TEMP3
ifn CHAR -1 ife CHEST_LOADOUT[CHAR] 4 settspr[].tsprpicnum 117
else settspr[].tsprpicnum TSPRITE_TEMP3
ife TSPRITE_TEMP3 5229 // James
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 28
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 28
	}
ife TSPRITE_TEMP3 6638 // Sang
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 25
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 25
	}
ife TSPRITE_TEMP3 6868 // Rusty
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 22
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 22
	}
ife TSPRITE_TEMP3 6637 // Geoffrey
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 30
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 30
	}
ife TSPRITE_TEMP3 7084 // Mikko
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 24
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 24
	}
ife TSPRITE_TEMP3 16638 // Micky
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 25
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 25
	}
ife TSPRITE_TEMP3 20989 // Snowfall
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 22
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 22
	}
}

ife TSPRITE_PICNUM 5236 // HEAVY ARMOUR
{
getactorvar[TSPRITE_PLAYER].C_HEAVY_ARMOUR TSPRITE_TEMP3
settspr[].tsprpicnum TSPRITE_TEMP3
ife TSPRITE_TEMP3 4959
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 36
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 36
	}
ife TSPRITE_TEMP3 5410
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 45
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 45
	}
ife TSPRITE_TEMP3 6867 // Rusty
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 24
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 24
	}
ife TSPRITE_TEMP3 6636 // Geoffrey
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 35
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 35
	}
ife TSPRITE_TEMP3 7089
	{
	gettspr[].tsprpal TSPRITE_TEMP2
	settspr[].tsprxrepeat 50
	ifn TSPRITE_TEMP2 4 settspr[].tspryrepeat 50
	}
}

ifactor WOODSCRAP state SHELL_ROT
ifactor SWOODSCRAP state SHELL_ROT_BACK
ifactor 3761 state SHELL_ROT
ifactor EXSHELL state SHELL_ROT
ifactor FL_SHELL state SHELL_ROT
ifactor MAGN_SHELL state SHELL_ROT
ifactor RIFLESHELL state SHELL_ROT
ifactor 13772 state SHELL_ROT
ifactor 13780 state SHELL_ROT

	switch TSPRITE_PICNUM
		case SWOODSCRAP
		case WOODSCRAP
		case ICE_DEBRIS
		case ROCKDEB1
		case ROCKDEB3
		case ROCKDEB4
		case SROCKDEB4
		case SLIMEPROJ
		case CLUSTER_BOMB
		case CLUSTER_BOMB2
			settspr[].tsprpal sector[].floorpal
		break
	endswitch

endevent

onevent EVENT_ENTERLEVEL
set mission_scare 0
set LOADING_SCREEN_HINT 0
set RADIO_CONTACT YES
set speaker 0
set skybox_sect -1
set skybox_scale 64
set skybox_id 0
set skybox 0
set skybox_tile -1
set CUSENDLEVEL 0
set SP_FADE 0
set SP_FADEA 0
set SP_FADEF 0
set SP_R 0
set SP_B 0
set SP_G 0
set cameraend 0
set CC_MUSIC 0
set DISP_MAINMENU 0
set jib_quote_track 0
set HOLO_ACCESS 0
set STOP_EFFECTS 0
set END_LEVEL 0
set AUTOAIM_STATUS -1
set HUB_MAP 0
set INVASION 0
set TREASURE_FOUND 0
set INVEN_REPLACE 0
set SHIP_INTEGRITY -1
set TEX_TEMP_X -1
set TEX_TEMP_Y -1
set TEX_TEMP_SX -1
set TEX_TEMP_SY -1
set WORLD_TRIGGER 0
set STORY_TRIGGER1 0
set STORY_TRIGGER2 0
set STORY_TRIGGER3 0
set HUGE_BOSS_HEALTH -1
set AMC_BUDGET_INCREASE 0
set CIVS_PANIC 0
set AMC_BASE 0
set MAIN_MENU_TRACK 0
set DAYNIGHT 0
set give_loadout 1
set cameratype 0
set pickup_quote_track 0
set camerasprite -1
set raining 0
set global_trigger 0
set destruct_trigger 0
set NUKE_ACTIVE 0
set MIDICHANGES -1
set MISSIONLINE1 0
set MISSIONLINE2 0
set MISSIONLINE3 0
set MISSIONLINE4 0
set MISSIONLINE5 0
set MISSIONLINE6 0
set cuts_txt -1
set countdown -1
set countdown_fail -1
set countdown_minutes 0
set countdown_seconds 0
set GENERATOR_ACTIVE 0
set SLO_MO_SHOWOFF 0
set FISSION_MAILED 0
set SCAN_MODULE 1
set REACTOR_VAR -1
set weather_type 0
set HELLGKEYS 0
set HELLGKEYSA 0
set TIMEZONE 0
set allies_present 0
set both_present 0
set CURBOSS -1
set screen_pal 0
set CONVO_STATE 0

	set TEMP8 0
	whilevarvarn TEMP8 NUMWALLS
	{
	// CHECK WALL BLEND
	ifand wall[TEMP8].cstat 16
		{
		ife wall[TEMP8].overpicnum 21292 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 18414 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 18432 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 3375 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 4346 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 7305 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 23446 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 23659 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 8169 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 8170 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 23799 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 10870 setwall[TEMP8].blend 255
		ife wall[TEMP8].overpicnum 663 
			{
			ifand wall[TEMP8].cstat 128 nullop else
				{
				getwall[TEMP8].cstat TEMP9
				xorvar TEMP9 128
				setwall[TEMP8].cstat TEMP9
				}
			setwall[TEMP8].blend 255
			}
		}
	add TEMP8 1
	}

endevent

onevent EVENT_INCURDAMAGE
set RETURN -1
endevent


defstate HITSPRITELOOKSTUFF
geta[].x x
geta[].y y
geta[].sectnum TEMP3
geta[].ang TEMP

sin my TEMP
cos mx TEMP
geta[].z z
    // getp[].pyoff TEMP

    add z player[].pyoff
    add z -9674

    set mz 100
    getp[].horiz TEMP
    sub mz TEMP
    getp[].horizoff TEMP
    sub mz TEMP

    shiftvarl mz 11

hitscan x y z TEMP3 mx my mz hitsect hitwall hitsprite hitx hity hitz 16777280
ifand GUNFIREMODE 32768
	{
	espawn 5064
	seta[RETURN].x hitx
	seta[RETURN].y hity
	seta[RETURN].z hitz
	dist DISTANCE THISACTOR RETURN 
	}
ends

onevent EVENT_CHEATGETHEAT
set RETURN 4800
set CHEATED 1
endevent

onevent EVENT_CHEATGETHOLODUKE
ife CHAR 0 set RETURN 900
ife CHAR 4 set RETURN 600
ife CHAR 6 set RETURN 300
ife CHAR 9 set RETURN 600
set CHEATED 1
endevent

onevent EVENT_CHEATGETSCUBA
ife CHAR 0 set RETURN 12800
set CHEATED 1
endevent

defstate KEEPMYPAL
  geta[].owner TEMP
  ifn TEMP -1 seta[].pal sprite[TEMP].pal // SET IT'S PALETTE TO IT'S OWNER'S PALETTE
ends

onevent EVENT_RESETPLAYER
ifmultiplayer nullop else
{
	setp[].sound_pitch 0
	set CHARSTART 0
	ife CHAR -1 set CHARSELECT 1
	set show_next_char 0
	set LOADOUT_COST 0
	set MISSIONUP 0
	set MISSIONLINE1 0
	set MISSIONLINE2 0
	set MISSIONLINE3 0
	set MISSIONLINE4 0
	set MISSIONLINE5 0
	set MISSIONLINE6 0
	set cuts_txt -1
	set cs_textl 1
	set PCINTER 0
	set MOUSEUP 0
	set player_spooked 0
	set vr_glitched 0
	set countdown -1
	set WEP3_BLOODY 0
	set countdown_type 0
	set CHOKE 0
	set SHOTGUN_STRUGGLE -1
	set PHANTASM_STICK -1
	set FCHOKE 0
	set JUST_INIT 0
}
set mission_scare 0
set CUS_WACK 0
set LOADING_SCREEN_HINT 0
set jib_quote_track 0
set HIDE_CROSSHAIR 0
set CUSENDLEVEL 0
set AUTOAIM_STATUS -1
set IN_DREAM 0
set INJURED 0
set GUN_CHARGE 0
set CHEATED 0
set SWORD_BLOCK 0
set NOISE_SAID 0
set DEATH_CAM -1
set GOT_PASSWORD 0
set PLAYERONTHEBIKE 0
set MELEE_LOCKED_ON -1
set CONTROL_VR -1
set voice_comm_menu 0
set FAKE_SHRUNK 0
set fire_mode_menu 0
set PLAYER_PROTECTED 0
set player_in_vehicle 0
set player_using_hovercraft -1
set player_using_fighter -1
set player_using_hovertank -1
set player_using_VR_tank -1
set player_using_mech -1
set player_using_horse -1
set MSHIELDUP 1
set SHIELDUP 0
set MERLIJNSHIELD 100
set MSHIELDTYPE 0
set MEDIKIT_USING 0
set caught_in_web 0
set caught_in_net 0
set on_tripwire 0
set ingas 0
set inspace 0
set using_minigun -1
set using_50cal -1
set SCOPE 0
set SPACE_SUIT 0
set SWORD_RAMP 0
set INVINC 0
set WEP0_BLOODY 0
set CHECKBOX -1
set SELSLOT 0
set ALLYSLOT1 -1
set ALLYSLOT2 -1
set ALLYSLOT3 -1
set ALLYSLOT4 -1
set MUSIC_LEVEL 0
set MUSIC_CHECK 0
set MUSIC_PLAY 0
endevent

onevent EVENT_RESETWEAPONS
	set GUNSAKIMBO 0
	set GUNFIREMODE 0
	set GUNFIREMODE_2 0
	set AMMO_TYPE 0
	set GUNMAG 0
	set PISTOLMAG 0
	set SHOTGUNMAG 0
	set SHOTGUNBOXMAG 0
	set MGUNMAG 0
	set RIFLEMAG 0
	set AUTOSHOTMAG 0
	set SLUGSHOTMAG 0
	set ROCKETMAG 0
	set ALTMAG 0
	// set temp_weapon 0
	set silver_ammo 0
	set silver_bolts 0
	set explosive_shells 0
	set flechete_shells 0
	set tesla_ammo 0
	set micro_torpedo 0
	set magnum_shells 0
	set dragon_shells 0
	set atomic_bomb 0
	set heat_seek_card 0
	set SCOPE 0
	set DUP_missile_ammo 0
	set fortymm_grenades 0
	set fortymm_shells 0 
	set fortymm_MIA_shells 0
	set fortymm_plasma 0
	set fortymm_caseless 0 
	set fortymm_slug 0
	set fortymm_electro 0 
	set fortymm_cryo 0
	set TEMP 0
	whilevarn TEMP 16
		{
		setarray AMMO_TYPES[TEMP] 0
		add TEMP 1
		}
	// setp[].ammo_amount 0 0
endevent

onevent EVENT_RESETINVENTORY
ifmultiplayer nullop else
{
	set ACCESSKEY2 0
	set PLUGKEY 0
	set RUNEKEYS 0
	set SWIPECARDS 0
	set SCARABKEYS 0
	set ABYSS_KEYS 0
	set SW_KEYS 0
	set OLDKEYS 0
	set COGS 0
	set GOT_EXPLOSIVE 0
	set GENERIC_KEYS 0
	set TOOLBOX 0
}
set AIR_FILTER 0
set FIRE_SUIT 0
set JUGGERN_SUIT 0
set GAS_MASK 0
set GOT_FLIPPER 0
set JUMP_BOOTS 0
set P_SPIRIT_ARMOUR 0
set P_FIRE_ARMOUR 0
endevent

action SONICRPG 17
action MISSILERPG 84
action GLRPG 93
action TRIRPG 419
action DARKRPG 758
action CYBERRPG 8315

defstate CHANGEACCURACY
	geta[].zvel TEMP
	ifrnd 128 add TEMP TEMP2 else sub TEMP TEMP2
	seta[].zvel TEMP
	geta[].ang TEMP
	ifrnd 128 sub TEMP TEMP3 else add TEMP TEMP3
	seta[].ang TEMP
ends

defstate littlerandtraj // code by Eddy Zykov/Balls of Steel Team
 randvar TEMP 20 
 geta[].ang TEMP2 
 geta[].zvel TEMP3
 sub TEMP 10
 add TEMP2 TEMP
 randvar TEMP 500
 sub TEMP 250
 add TEMP3 TEMP
 seta[].ang TEMP2 
 seta[].zvel TEMP3
 break 
ends

useractor notenemy 3179 enda
useractor notenemy 3180 enda

defstate WOODCHUNKSPAWN
shoot SWOODSCRAP
ifg TEMP 10 shoot SWOODSCRAP
ifg TEMP 20 shoot SWOODSCRAP
ifg TEMP 30 shoot SWOODSCRAP
ifg TEMP 40 shoot SWOODSCRAP
ifg TEMP 50 shoot SWOODSCRAP
ends

defstate ROCKCHUNKSPAWN
shoot SROCKDEB4
ifg TEMP 10 shoot SROCKDEB4
ifg TEMP 20 shoot SROCKDEB4
ifg TEMP 30 shoot SROCKDEB4
ifg TEMP 40 shoot SROCKDEB4
ifg TEMP 50 shoot SROCKDEB4
ends

defstate BULLETHITSOUNDS
ifcount 1
{
geta[].extra TEMP6
ife STEPSOUNDFX 0 { set playsound HITNORMAL spawn GUNSMOKE } else
ife STEPSOUNDFX 1 { set playsound HITWOOD spawn GUNSMOKE state WOODCHUNKSPAWN } else
ife STEPSOUNDFX 2 
{ 
ifrnd 96 set playsound HITMETAL2 else ifrnd 96 set playsound HITMETAL3 else set playsound HITMETAL4 
spawn GUNSMOKE shoot SPARK shoot SPARK 
ifrnd 64 spawn 9284 else ifrnd 64 spawn 9285 else ifrnd 64 spawn 9286 else spawn 9287
} 
else
ife STEPSOUNDFX 3 { set playsound HITMETAL spawn GUNSMOKE shoot SPARK shoot SPARK 
ifrnd 64 spawn 9284 else ifrnd 64 spawn 9285 else ifrnd 64 spawn 9286 else spawn 9287 } else
ife STEPSOUNDFX 4 { set playsound HITDIRT spawn DUSTSMOKE } else
ife STEPSOUNDFX 5 { set playsound HITNORMAL spawn GUNSMOKE } else
ife STEPSOUNDFX 8 { set playsound HITDIRT spawn GUNSMOKE } else
ife STEPSOUNDFX 9 set playsound HITWATER else
ife STEPSOUNDFX 10 { set playsound HITDIRT ife FLOORTEX 8067 { espawn DUSTSMOKE seta[RETURN].pal 8 } else spawn DUSTSMOKE } else
ife STEPSOUNDFX 11 { set playsound HITSTONE state ROCKCHUNKSPAWN spawn GUNSMOKE } else
ife STEPSOUNDFX 12 set playsound HITMUD else
ife STEPSOUNDFX 14 { set playsound HITMETAL set playsound HITWATER spawn GUNSMOKE } else
ife STEPSOUNDFX 15 { set playsound HITSTONE set playsound HITWATER spawn GUNSMOKE } else
ife STEPSOUNDFX 16 set playsound HITWATER else
ife STEPSOUNDFX 17 { set playsound HITCHAINL spawn GUNSMOKE shoot SPARK shoot SPARK 
ifrnd 64 spawn 9284 else ifrnd 64 spawn 9285 else ifrnd 64 spawn 9286 else spawn 9287 } else
ife STEPSOUNDFX 18 { set playsound HITGLASS spawn GUNSMOKE } else
ife STEPSOUNDFX 19 { set playsound HITCARDB spawn GUNSMOKE } else
ife STEPSOUNDFX 20 { set playsound HITMUD spawn GUNSMOKE } else
ife STEPSOUNDFX 21 { set playsound HITMUD spawn BLOOD ifrnd 64 guts JIBS6 1 } else
ife STEPSOUNDFX 22 { set playsound HITDIRT spawn DUSTSMOKE } else
ife STEPSOUNDFX 23 { set playsound HITWOOD spawn GUNSMOKE state WOODCHUNKSPAWN } else
ife STEPSOUNDFX 24 { set playsound HITMETAL spawn GUNSMOKE shoot SPARK shoot SPARK 
ifrnd 64 spawn 9284 else ifrnd 64 spawn 9285 else ifrnd 64 spawn 9286 else spawn 9287 } else
ife STEPSOUNDFX 26 { set playsound HITGLASS spawn GUNSMOKE eshoot ICE_DEBRIS setthisprojectile[RETURN].xrepeat 2 setthisprojectile[RETURN].yrepeat 2 } else
ife STEPSOUNDFX 27 { set playsound HITSTONE state ROCKCHUNKSPAWN spawn GUNSMOKE } else
ife STEPSOUNDFX 28 { set playsound HITDIRT spawn DUSTSMOKE } else
ife STEPSOUNDFX 30 { set playsound HITSTONE spawn GUNSMOKE } else
ife STEPSOUNDFX 32 { set playsound HITMUD spritepal 8 espawn BLOOD seta[RETURN].pal 8 ifrnd 64 guts JIBS6 1 } 
// randomizes pitch depending on bullet strength
randvar TEMP4 256 
geta[].extra TEMP5 
mulvar TEMP5 5
sub TEMP4 TEMP5 
ife playsound 0 set playsound HITNORMAL
soundvar playsound
setactorsoundpitch THISACTOR playsound TEMP4
killit
}
ends

// Controls melee hit sounds
defstate MELEE_HIT_SOUNDS
		ife STEPSOUNDFX 1 { ifrnd 128 set playsound MELEE_HIT_WOOD1 else set playsound MELEE_HIT_WOOD2 shoot SWOODSCRAP shoot SWOODSCRAP } 
		else ife STEPSOUNDFX 23 { ifrnd 128 set playsound MELEE_HIT_WOOD1 else set playsound MELEE_HIT_WOOD2 shoot SWOODSCRAP shoot SWOODSCRAP } 
		else ife STEPSOUNDFX 4 { ifrnd 128 set playsound MELEE_HIT_DIRT1 else set playsound MELEE_HIT_DIRT2 spawn DUSTSMOKE }
		else ife STEPSOUNDFX 6 { set playsound MELEE_HIT_CARPET1 } 
		else ife STEPSOUNDFX 8 { set playsound MELEE_HIT_SNOW1 espawn DUSTSMOKE seta[RETURN].pal 27 }
		else ife STEPSOUNDFX 9 { sound WATER_SPLASH spawn WATERSPLASH2 }
		else ife STEPSOUNDFX 10 { ifrnd 128 set playsound MELEE_HIT_DIRT1 else set playsound MELEE_HIT_DIRT2 spawn DUSTSMOKE }
		else ife STEPSOUNDFX 11 { set playsound MELEE_HIT_STONE1 shoot SPARK shoot SPARK } 
		else ife STEPSOUNDFX 19 { set playsound MELEE_HIT_CARPET1 shoot SPARK shoot SPARK } 
		else ife STEPSOUNDFX 20 { ifrnd 128 set playsound MELEE_HIT_DIRT1 else set playsound MELEE_HIT_DIRT2 spawn DUSTSMOKE }
		else ife STEPSOUNDFX 21 { ifrnd 128 set playsound MELEE_HIT_DIRT1 else set playsound MELEE_HIT_DIRT2 spawn DUSTSMOKE }
		else ife STEPSOUNDFX 32 { ifrnd 128 set playsound MELEE_HIT_DIRT1 else set playsound MELEE_HIT_DIRT2 spawn DUSTSMOKE }
		else ife STEPSOUNDFX 28 { set playsound MELEE_HIT_SNOW1 spawn DUSTSMOKE } 
		else ife STEPSOUNDFX 32 { ifrnd 128 set playsound MELEE_HIT_DIRT1 else set playsound MELEE_HIT_DIRT2 espawn DUSTSMOKE seta[RETURN].pal 8 }
		else 
			{ 
			spawn 8433
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			ifrnd 96 set playsound METSWIPE else
			ifrnd 96 set playsound METSWIPE2 else
			set playsound METSWIPE3
			}
		// This code randomizes the pitch of the sound a bit based on it's damage
		randvar TEMP4 128 
		ifrnd 128 sub TEMP4 128
		geta[].extra TEMP5 
		mulvar TEMP5 2
		sub TEMP4 TEMP5 
		soundvar playsound
		setactorsoundpitch THISACTOR playsound TEMP4
ends

defstate PROJ_HIT_SOUNDS
	set TEMP3 TEMP
	ifl TEMP3 -16384
	 ifg TEMP3 -32768 // hitting a wall?
		{
		add TEMP3 32768 // add 32768 to get the wall's number
		getwall[TEMP3].picnum FLOORTEX
		state CHECKSTEPS
		state MELEE_HIT_SOUNDS
		}
		else
	ifl TEMP3 32768
	 ifg TEMP3 16384 // hitting a floor/ceiling?
		{
		sub TEMP3 16384
		state getfloordist
		ifl z 32 gets[TEMP3].floorpicnum FLOORTEX
		else gets[TEMP3].ceilingpicnum FLOORTEX
		state CHECKSTEPS
		state MELEE_HIT_SOUNDS
		}
ends
	

onevent EVENT_KILLIT

// geta[].picnum SPRITE_PICNUM
switch sprite[].picnum
	case TRIPBOMB
		ifspawnedby APLAYER
		 ife CHAR 1
			{
			globalsound ZAX_BOMB_EXPL
			}
	case SEENINE
		ifspritepal 3
			{
			stopsound PIPEBOMB_EXPLODE
			globalsound DISTANT_EXPLOSION
			screensound DISTANT_EXPLOSION
			}
		ifspritepal 5 stopsound PIPEBOMB_EXPLODE
		ifspritepal 9
			{
			stopsound PIPEBOMB_EXPLODE
			globalsound MISSILE_LAUNCH
			screensound MISSILE_LAUNCH
			}
		
		set RETURN 0
		break
	case WATERDRIP
		ifspritepal 10
			{
			espawn 2379
			seta[RETURN].pal 10
			// seta[RETURN].cstat sprite[].cstat
			seta[RETURN].shade sprite[].shade 
			spawn 2284
			soundonce BLOOD_DRIP
			}
		else
		ifspritepal 2
			{
			espawn 2379
			seta[RETURN].pal 10
			// seta[RETURN].cstat sprite[].cstat
			seta[RETURN].shade sprite[].shade 
			spawn 2284
			soundonce BLOOD_DRIP
			}
		else
		{
		espawn 2379
		seta[RETURN].pal sprite[].pal
		// seta[RETURN].cstat sprite[].cstat
		seta[RETURN].shade sprite[].shade 
		}
		set RETURN 0
		break
	case 1031
	case 1032
	case 1033
		espawn 3714
		seta[RETURN].z sector[].floorz
		seta[RETURN].pal sprite[].pal
		set RETURN 0
	break
	case 198
	case 14094
		sound GLASS_BREAK3
		lotsofglass 25 
		set RETURN 0
	break
	case JIBS1
	case JIBS2
	case JIBS3
	case JIBS4
	case JIBS5
	case LIZMANHEAD1 
	case LIZMANARM1
	case LIZMANLEG1
	case HEADJIB1
	case ARMJIB1
	case LEGJIB1
	case HUMAN_TORSO
		state random_wall_jibs
		set RETURN 0
	break
	case 13383 
	case 13404
	case 4961
	case 12053
	case 19802
	case 16076 
	case 14604
	case 14605
	case 4960
	case 4959
	case 6874
	case 6875
	case 4963
	case 12203
	case 12204
		// melee hit sounds
	geta[].htmovflag TEMP3
	ifl TEMP3 -16384
	 ifg TEMP3 -32768 // hitting a wall?
		{
		add TEMP3 32768 // add 32768 to get the wall's number
		getwall[TEMP3].picnum FLOORTEX
		state CHECKSTEPS
		state MELEE_HIT_SOUNDS
		}
		else
	ifl TEMP3 32768
	 ifg TEMP3 16384 // hitting a floor/ceiling?
		{
		sub TEMP3 16384
		state getfloordist
		ifl z 32 gets[TEMP3].floorpicnum FLOORTEX
		else gets[TEMP3].ceilingpicnum FLOORTEX
		state CHECKSTEPS
		state MELEE_HIT_SOUNDS
		}
		else
		ifn TEMP3 0
		{ 
		spawn 8433
		shoot SPARK
		shoot SPARK
		ifrnd 96 sound METSWIPE else
		ifrnd 96 sound METSWIPE2 else
		sound METSWIPE3
		}
	set RETURN 0
break
case JIBS6
	spawn 2284
	state random_wall_jibs
	set RETURN 0
break
case CRACK1
case CRACK2
case CRACK3
case CRACK4
	set destruct_trigger HITAGSAVED
	operateactivators HITAGSAVED 0 
	operaterespawns HITAGSAVED 
	operatemasterswitches HITAGSAVED
	set RETURN 0
break
case GREENSLIME
	geta[].htowner TEMP4
	ife sprite[TEMP4].picnum 1405
		{
		getactorvar[TEMP4].P_CREDITS TEMP6
		add TEMP6 1
		setactorvar[TEMP4].P_CREDITS TEMP6
		}
	set RETURN 0
break
case 18067 // Bolt
case 18072 // golden bolt 
	geta[].htmovflag TEMP
	
	state PROJ_HIT_SOUNDS
	
	add TEMP 16384
	ifl TEMP 16384 ifg TEMP -1
	{
		ifactor 18067 espawn 18069 // spawn dagger
		ifactor 18072 espawn 18074 // spawn golden dagger
		setactorvar[RETURN].myowner TEMP
		setactorvar[RETURN].TEMP2 sprite[TEMP].htang
		geta[TEMP].z TEMP5
		sub TEMP5 sprite[].z
		setactorvar[RETURN].TEMP5 TEMP5
		seta[RETURN].shade sector[].floorshade
	}
	set RETURN 0
break
case 5011 // Bolt
	geta[].htmovflag TEMP
	state PROJ_HIT_SOUNDS
	
	add TEMP 16384
	ifl TEMP 16384 ifg TEMP -1
	{
	ifrnd 128
		{
		eshoot 5011
		seta[RETURN].ang sprite[].ang
		getthisprojectile[RETURN].EXTRA TEMP3
		divvar TEMP3 2
		setthisprojectile[RETURN].EXTRA TEMP3
		getthisprojectile[RETURN].VEL TEMP3
		divvar TEMP3 2
		setthisprojectile[RETURN].VEL TEMP3
		}
	else
		{
		espawn 12283 // spawn bolt
		setactorvar[RETURN].myowner TEMP
		setactorvar[RETURN].TEMP2 sprite[TEMP].htang
		geta[TEMP].z TEMP5
		sub TEMP5 sprite[].z
		setactorvar[RETURN].TEMP5 TEMP5
		seta[RETURN].shade sector[].floorshade
		}
	}
	set RETURN 0
break
case 5010 // Arrow
case 18096 // Compound arrow
case 12232 // silver bolt
	geta[].htmovflag TEMP
	state PROJ_HIT_SOUNDS
	
	add TEMP 16384
	ifl TEMP 16384 ifg TEMP -1
	{
		ifactor 5010 espawn 12284 // spawn arrow
		ifactor 18096 espawn 18097
		ifactor 12232 espawn 12282 // spawn silver bolt
		setactorvar[RETURN].myowner TEMP
		setactorvar[RETURN].TEMP2 sprite[TEMP].htang
		geta[TEMP].z TEMP5
		sub TEMP5 sprite[].z
		setactorvar[RETURN].TEMP5 TEMP5
		seta[RETURN].shade sector[].floorshade
	}
	set RETURN 0
break
case IN_MINE_DART
	espawn 6814
	seta[RETURN].pal 2
	seta[RETURN].owner sprite[].owner
	set RETURN 0
break
case MINE_DART
	espawn 6814
	seta[RETURN].owner sprite[].owner
	set RETURN 0
break
case M_TRAP_THROW
	espawn M_TRAP_IDLE
	seta[RETURN].owner sprite[].owner
	set RETURN 0
break
case MC_TRAP_THROW
	espawn MC_TRAP_IDLE
	seta[RETURN].owner sprite[].owner
	set RETURN 0
break
case R_TRAP_THROW
	espawn R_TRAP_IDLE
	seta[RETURN].owner sprite[].owner
	set RETURN 0
break
case PROXBUNDLE
	ifand GUNFIREMODE 32 espawn PROXONFLOOR_2
	else espawn PROXONFLOOR
	seta[RETURN].owner sprite[].owner
	set RETURN 0
break
case PRIEST_BLAST
	shoot SPARK
	shoot SPARK
	shoot SPARK
	shoot SPARK
	set RETURN 0
break
case 6826
case 22631
	geta[].htmovflag TEMP
	state PROJ_HIT_SOUNDS
	shoot SPARK
	shoot SPARK
	shoot SPARK
	shoot SPARK
	set RETURN 0
break
case 6816
	geta[].htmovflag TEMP
	state PROJ_HIT_SOUNDS
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	set RETURN 0
break
case BRUISERFIREBALL
case HADESBLASTH
	shoot SPARK
	shoot SPARK
	shoot SPARK
	shoot SPARK
	ifactorsound THISACTOR FBALL_FLY stopactorsound THISACTOR FBALL_FLY
	set RETURN 0
break
case 22610
case SPELL2
case 20834
case REDM_BLAST
	shoot SPARK2
	shoot SPARK2
	shoot SPARK2
	shoot SPARK
	ifactorsound THISACTOR LBALL_FLY stopactorsound THISACTOR LBALL_FLY
	set RETURN 0
break
case 12782
	ifactorsound THISACTOR PROJ_FLY stopactorsound THISACTOR PROJ_FLY
	set RETURN 0
break
case 6085
case 5375
case 5968
case 2704
case 10475
case 2606
case GOLD_SPELL2
case 19807
	shoot SPARK
	shoot SPARK
	shoot SPARK
	shoot SPARK
	set RETURN 0
	break
case TORPEDO
case MISSILE
	ifspawnedby APLAYER
		{
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		spawn BIG_SMOKE2
		spawn BIG_SMOKE2
		spawn BIG_SMOKE2
		spawn 8433
		}
	set RETURN 0
break
case RPG
	ifspawnedby APLAYER
		{
		ife CHAR 1
		 ife CURWEAP 7
		    {
			}
			else
				{
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
				}
		ife temp_weapon 16
		 ife CURWEAP 0
			{
			spawn BIG_SMOKE2
			spawn BIG_SMOKE2
			spawn 8433
			quake 13
			}
		ife CHAR 10
		 ife CURWEAP 7
			{
			spawn BIG_SMOKE2
			spawn BIG_SMOKE2
			spawn 8433
			quake 13
			}
		ife CHAR 12
		 ife CURWEAP 7
			{
			spawn BIG_SMOKE2
			spawn BIG_SMOKE2
			spawn 8433
			quake 13
			}
		}
	set RETURN 0
break
case DOMELITE
	espawn 3179
	seta[RETURN].xrepeat sprite[].xrepeat
	seta[RETURN].yrepeat sprite[].yrepeat
	seta[RETURN].cstat sprite[].cstat
	seta[RETURN].pal sprite[].pal
	set RETURN 0
break
case HANGLIGHT
	sound VENT_BUST
	espawn 3180
	seta[RETURN].xrepeat sprite[].xrepeat
	seta[RETURN].yrepeat sprite[].yrepeat
	seta[RETURN].cstat sprite[].cstat
	set RETURN 0
break
case POT1
case POT2
	spawn BROWNSTAIN sound VENT_BUST set RETURN 0
break
case CAMERALIGHT
case MOVIECAMERA
	sound VENT_BUST set RETURN 0
break
endswitch
	
endevent

onevent EVENT_PREGAME
	switch sprite[].picnum
		case 2284
			cstat 32
			break
		case EXPLOSION2
			cstator 2
			seta[].blend 255
			break
		case 1404
			ifand ZVELSAVED 1 seta[].z ZPOS_SAVED
			break
	endswitch
endevent

onevent EVENT_EGS

  ifactor WTANK
    state wtankload
  ifactor WTANKGUN
    cstat 32768
  ifactor EXPLOSIONMAKER
  {
    geta[].z SET
    gets[].ceilingz ANGLE
    seta[].z ANGLE
    cstat 32768
  }

switch sprite[].picnum
case 18067 // Bolt
case 18072 // golden bolt 
case 5011 // Bolt
case 5010 // Arrow
case 18096 // Compound arrow
case 12232 // silver bolt
case 19029
case 18157
case 10828
case 10039
case COPTER_ROTOR
case COPTER_ROTOR2
case 16764
case 22923
case 23746
case 5381
case 13592
case 18427
case 18133
case SHOOTME
case SHOOTME2
case SHOOTME3
case LILITH
case 9750
 geta[].owner myowner
 break
case BLUELASERSHOT
setprojectile[].userdata 80
  break
case TRENTON_SOLARI
	ifspawnedby TRENTON_SOLARI ifspritepal 0 spritepal 10
	break
case 17079
  set SPEC_ACT 1
  break
case 12GSHELLF
 geta[].owner myowner
 seta[].pal sprite[myowner].pal
 break
case 2284
 cstat 34
 sizeat 10 10
 break
case 9284
case 9285
case 9286
case 9287
  iffloordistl 4 espawn 9288
  ifceilingdistl 4 espawn 9288
 break
case 16113
case 16114 
case 16115 
case 16116 
case 16117 
case 16118 
case 16119 
case 16120 
case 16121 
 seta[].shade -127
 cstat 32768 // make initially invisible
 break
case ROTATEGUN
case WTANK
case WTANKDEAD
case 40MM_SH_FLOOR
 state KEEPMYPAL
 break
case PROJECTILE_FLARE
	cstat 32768
break
case 18271
 state KEEPMYPAL
 geta[].owner myowner
 geta[myowner].lotag TEMP2
 add TEMP2 1
 setactorvar[].LOTAGSAVED TEMP2
 break
case 13952
case SHOTSPARK1
 geta[].owner myowner
 break
case BLOODSPLAT1
case BLOODSPLAT2
case BLOODSPLAT3
case BLOODSPLAT4
	ifspawnedby SORCERER spritepal 1
	ifspawnedby DARKAVATAR spritepal 1
	ifspawnedby CYBERCULTIST spritepal 4
	ifspawnedby ANUBIS_MUMMY spritepal 5
	ifspawnedby COBRA spritepal 8
	ifspawnedby NEWBEAST spritepal 8
	ifspawnedby LIL_SCORP spritepal 8
	break
case SORCERER
case 9771
case DARKAVATAR
case LOST
		state KEEPMYPAL
		espawn 13950 // spawning circle
		seta[RETURN].ang sprite[].ang
		break
case MISTERH
    geta[].owner myowner
	state KEEPMYPAL
	flash 
	palfrom 20 64 64 64 
	globalsound LIGHTNING_SLAP
	soundonce LIGHTNING_SLAP
	seta[].ang sprite[myowner].ang
	spawn 8433
	spawn PENTAGRAM
	spawn BURNING2
break
case 3665
	sizeto 128 128
	geta[].owner myowner
	seta[].cstat sprite[myowner].cstat
	seta[].pal sprite[myowner].pal
break
case FIRE
case FIRE2
	sizeat 64 64
	state KEEPMYPAL
break
case FLAMEKEY 
case SPIDERKEY 
case DAGGERKEY 
case MOONKEY 
case SKULLKEY 
case EYEKEY 
case GENERICKEY
case NORMAL_KEY1
case NORMAL_KEY2
case NORMAL_KEY3
case NORMAL_KEY4
case NORMAL_KEY5
    soundonce KEY_DROP
break
case 1404
	ifspawnedby RESPAWN 
		{
		geta[].owner myowner
		ife sprite[myowner].pal 3 set EXTRASAVED -1
		else
			{
			getactorvar[myowner].EXTRASAVED EXTRASAVED
			getactorvar[myowner].xvel HITAGSAVED
			}
		}
break
case FL_GRENADE
	seta[].pal 17
break
case MI_24_HIND
case KA_50_BLACK_SHARK
case BLACK_HAWK
case EDFSOLDIER_ACTIVE
case 10510
case HPOWERSUIT
case TERMINATOR
case TERMINATORSTAYPUT
case TERMINATORCRAWLING
case TERMTORSO
case TERMHEAD
	state KEEPMYPAL
break
case AMCSOLDIER_ACTIVE
	state KEEPMYPAL
break
case LAVABALL
	randvar TEMP 2048
	seta[].ang TEMP
	randvar TEMP -8192
	seta[].zvel TEMP
	set TEMP 0
	seta[].shade -127
break
case 9946
case 12800
	geta[].owner TEMP4
break
case 3737 // Magazine spawning stuff .etc
case 3720
case 3756
case 7103
case 6781
case 7111 // Drum mag
case 14641 // Bizon mag
case 12190 // Beta mag
	geta[].z TEMP
	sub TEMP 6192
	seta[].z TEMP
break
case 6204
	geta[].z TEMP
	sub TEMP 6136
	seta[].z TEMP
	break
case 6200
	geta[].owner myowner
	break
case MINISHRINKERSPRITE
case BARRETTRIFLESPRITE
case SMGSPRITE
case BLOODSTAFFSPRITE
case LIZMANGUNSPRITE
case PIGCOPGUNSPRITE
case SKULLDUSTERSPRITE
case FLESHSQUIRTERSPRITE
case STYGIANGUNSPRITE
case SAWNOFFSPRITE
case TOMMYGUNSPRITE
case RIOTGUNSPRITE
case CROSSBOWSPRITE
case MIAGUNSPRITE
case LASERGUNSPRITE
case TMISSILELSPRITE
case CHAINSAWSPRITE
case FLAMETHROWERSPRITE
case SWORDSPRITE
case MOPSPRITE
case BLOODY_MOPSPRITE
case FNFALSPRITE
case MP40SPRITE
case JPLASMASPRITE
case LIZMANFGUNSPRITE
case M16SPRITE
case AK114SPRITE
case RIOTGUN_MINIGUN_SPRITE
case NAILGUN_SPRITE
case RIOTGUN_GRENADEL_SPRITE
case DARTGUN_SPRITE
case M60_SPRITE
case ZMISSILELSPRITE
case GOROHEADSPRITE
case M960_SPRITE
case ZCHAINGUN_SPRITE
case RAILGUN_SPRITE
case PROTO_SHRINKER_SPRITE
case 16087
case 17980
case 20101
	ifspawnedby APLAYER { cstat 0 action ZERO }
	break
case 6078 // Russian grenade
    geta[].owner myowner
    ifspawnedby APLAYER set grenade_counter 0 else
	getactorvar[myowner].grenade_counter grenade_counter
	break
case PROXBUNDLE
case DYNAMITEBUNDLE
case DYNAMITESTICK
case 3622
case DISCBOMB
case DISCBOMB2
case GRENADE
case H_GRENADE
case J_GRENADE
case MC_GRENADE
case SF_GRENADE
case HOLYHANDG
    ifspawnedby APLAYER
		{
		geta[].owner myowner
		geta[].xvel TEMP
		getactorvar[myowner].bomb_throw_power TEMP2
		add TEMP TEMP2
		seta[].xvel TEMP
		geta[].zvel TEMP
		set TEMP3 TEMP2
		mulvar TEMP3 4
		sub TEMP TEMP3
		seta[].zvel TEMP
		}
	break
case EXPLOSION2
	seta[].blend 255
	cstat 130
	ifg ALARM_DETECT 0 add ALARM_COUNTER 70
			ifspawnedby RPG
		 ife CHAR 1
		  ife CURWEAP 7 nullop else
	spawn 8433
	ifinwater  { spawn 18920 seta[].xrepeat 1 seta[].yrepeat 1 }
	ifspawnedby SEENINE nullop
	else ifspawnedby OOZFILTER nullop
	else ifspawnedby 9361 nullop
	else ifspawnedby 9359 nullop
	else ifspawnedby GORO_EXPLODING_FLAME nullop
	else
	{
	ifonwater spawn 18138
	else
		{
		ifspawnedby RPG
		 ife CHAR 1
		  ife CURWEAP 7 nullop else
			{
			spawn BIG_SMOKE2
			spawn BIG_SMOKE2
			spawn BIG_SMOKE2
			}
		}
	}
	ifspawnedby 5968
		{
		flash
		ifpdistl 16000 quake 13
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		debris SCRAP2 3
		}
	ifspawnedby 6085
		{
		flash
		ifpdistl 8000 quake 13
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		}
	ifspawnedby SF_GRENADE
		{
		flash
		ifpdistl 8000 quake 13
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		shoot SPARK2
		}
	ifspawnedby J_GRENADE
		{
		flash
		ifpdistl 8000 quake 13
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		}
	ifspawnedby H_GRENADE
		{
		flash
		ifpdistl 8000 quake 13
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		}
	ifspawnedby GRENADE
		{
		flash
		ifpdistl 8000 quake 13
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		}
	ifspawnedby HOLYHANDG
		{
		flash
		ifpdistl 8000 quake 13
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		shoot SPARK
		}
	break
case 14509
	randvar TEMP2 64
	randvar TEMP3 32
	state CHANGEACCURACY
	break
case 9359
case 9361
case 9115
	randvar TEMP2 128
	randvar TEMP3 16
	state CHANGEACCURACY
	break
case GASBURST
case 19807
	seta[].blend 255
	seta[].shade -127
	randvar TEMP2 128
	randvar TEMP3 16
	state CHANGEACCURACY
	break
case 22631
	seta[].shade -127
	break
case 6816
case 6826
	randvar TEMP2 64
	randvar TEMP3 8
	state CHANGEACCURACY
	break
case 5374
	seta[].blend 255
	seta[].shade -127
	randvar TEMP2 64
	randvar TEMP3 8
	state CHANGEACCURACY
	break
case 6857
case 6627
case 6198
	randvar TEMP2 64
	randvar TEMP3 8
	state CHANGEACCURACY
	seta[].shade -127
	seta[].blend 255
	break
case BONE_SHARD
	randvar TEMP2 256
	randvar TEMP3 64
	state CHANGEACCURACY
	break
case 7423
	geta[].owner TEMP
	seta[].xrepeat sprite[TEMP].xrepeat
	seta[].yrepeat sprite[TEMP].yrepeat
break
case HADESBLAST
case HADESBLASTH
	geta[].z TEMP
	add TEMP 2192
	seta[].z TEMP
	seta[].blend 255
break
case RUBYBLAST
	spawn PROJECTILE_FLARE
	randvar TEMP2 32
	randvar TEMP3 16
	state CHANGEACCURACY
	seta[].blend 255
	seta[].shade -127
break
case 21612
case AMCSHIP
case AMCSHIP2
case 8924
case 8931
case 9388
case CAR_MOVE
case 15329
	updatesectorz sprite[].x sprite[].y sprite[].z TEMP8
	ifn TEMP8 -1 changespritesect THISACTOR TEMP8 else sizeat 0 0
	geta[].owner TEMP
	ife sprite[TEMP].pal 3 set LOTAGSAVED 2 // FLY UP
	ife sprite[TEMP].pal 5 set LOTAGSAVED 1
	ife sprite[TEMP].pal 9 set LOTAGSAVED 3
	ife sprite[TEMP].pal 10 set LOTAGSAVED 4
	ife sprite[TEMP].pal 11 set LOTAGSAVED 5
	ife sprite[TEMP].pal 12 set LOTAGSAVED 6
	ife sprite[TEMP].pal 13 { spawn EXPLOSION2 shoot SPARK shoot SPARK spawn 8433 soundonce MISSILE_EXPLODE set LOTAGSAVED 7 }
	ife sprite[TEMP].pal 14 { globalsound CY_FLYBY set LOTAGSAVED 9 }
	ife sprite[TEMP].pal 15 set LOTAGSAVED 7
	ife sprite[TEMP].pal 16 set LOTAGSAVED 10
	getactorvar[TEMP].EXTRASAVED TEMP3
	ife TEMP3 1 
		{
		ife sprite[].picnum AMCSHIP2 screensound AMCSHIP2_FLYBY
		else screensound AMCSHIP_FLYBY
		}
break
case GROUNDEXPLOSION
     flash
break
case GOLD_SPELL1
case SPELL1
case SPELL2
case 22610
case GOLD_SPELL2
case SPELL8
case SPELL9
case SPELL7
case BRUISERFIREBALL
case BRUISERFEXPLOSION
case RUBYBLAST_EX
case 7159
case 7163
case REDM_BLAST
case BLOOD_BLAST
case ENERGY_EXPLOSION
case NUCLEAR_EXPLOSION
case MPLASMA
case MDF_PLASMA
case 5372
case PRIEST_BLAST
case MINE_DART
case IN_MINE_DART
case 9376
case MICRO_MISSILE
case HOMING_MISSILE
case MISSILE
case GORO_FLAME
case 7526
case 12712
case 12717
case 22442
case PETRIFYRAY
case 5394
case PLASMAPROJ
case 24489
case 24490
	seta[].blend 255
	seta[].shade -127
break
case FRAMEEFFECT1
	state KEEPMYPAL
	seta[].blend 255
	seta[].shade -127
break
case SPARK
case SPARK2
	seta[].cstat 514
	seta[].blend 255
	randvar TEMP 2048
	seta[].ang TEMP
	randvar TEMP -4096
	seta[].zvel TEMP
	set TEMP 0
	seta[].yvel 0
	seta[].shade -127
break
case HEAT_SINK
	geta[].z TEMP
	add TEMP 1120
	seta[].z TEMP
	seta[].shade -127
break
case SWOODSCRAP
case WOODSCRAP
case ICE_DEBRIS
case ROCKDEB1
case ROCKDEB3
case ROCKDEB4
case SROCKDEB4
case SLIMEPROJ
case CLUSTER_BOMB
case CLUSTER_BOMB2
	randvar TEMP 2048
	seta[].ang TEMP
	randvar TEMP -4096
	seta[].zvel TEMP
	seta[].yvel 0
	setthisprojectile[].pal sector[].floorpal
case ROCKDEB2
	randvar TEMP 2048
	seta[].ang TEMP
	randvar TEMP 4096
	ifrnd 128 mulvar TEMP -1
	seta[].zvel TEMP
	seta[].yvel 0
break
case WATERDRIP
	ifspritepal 0
		{
		ifspawnedby 3555 spritepal 10
		ifspawnedby 3327 spritepal 10
		ifspawnedby 20084 spritepal 10
		ifspawnedby 20085 spritepal 10
		ifspawnedby 20087 spritepal 10
		ifspawnedby 20088 spritepal 10
		ifspawnedby 2284 spritepal 10
		}
break
case 13772
case RIFLESHELL
case SRIFLESHELL
case SHELL_LINK
	state animate_sprite_event
	move FORWARD
	randvar TEMP 512 
	seta[].zvel TEMP
	geta[].ang TEMP
	sub TEMP -412
	randvar TEMP2 128
	add TEMP TEMP2
	seta[].ang TEMP
	geta[].owner TEMP8
		set TEMP3 sprite[TEMP8].x
		add TEMP3 256
		geta[TEMP8].ang TEMP4
		ifactor SRIFLESHELL add TEMP4 160 else
		ifactor RIFLESHELL add TEMP4 160 else 
		ifactor SHELL_LINK add TEMP4 160 else 
		ifspawnedby APLAYER
			{
			ife CURWEAP 1
				{
				ife CHAR 0 add TEMP4 140 else
				ife CHAR 5 add TEMP4 140 else
				ife CHAR 7 add TEMP4 140 else 
				ife CHAR 6 add TEMP4 140 
				else add TEMP4 128
				}
			else ife CURWEAP 3
				{
				ife CHAR 5 add TEMP4 140
				else add TEMP4 128
				}
			else add TEMP4 128
			}
		else add TEMP4 128
		rotatepoint sprite[TEMP8].x sprite[TEMP8].y TEMP3 sprite[TEMP8].y TEMP4 TEMP5 TEMP6
		seta[].x TEMP5 
		seta[].y TEMP6
		geta[TEMP8].z TEMP
		sub TEMP 8096
		ifspawnedby APLAYER
			{
			getp[].horiz TEMP2
			sub TEMP2 100
			mulvar TEMP2 16
			sub TEMP TEMP2
			}
		seta[].z TEMP
break
case 13780
	move FORWARD
	state animate_sprite_event
	randvar TEMP 512 
	seta[].zvel TEMP
	geta[].ang TEMP
	sub TEMP 512
	randvar TEMP2 -128
	add TEMP TEMP2
	seta[].ang TEMP
	geta[].owner TEMP8
		set TEMP3 sprite[TEMP8].x
		add TEMP3 256
		geta[TEMP8].ang TEMP4
		add TEMP4 -128
		rotatepoint sprite[TEMP8].x sprite[TEMP8].y TEMP3 sprite[TEMP8].y TEMP4 TEMP5 TEMP6
		seta[].x TEMP5 
		seta[].y TEMP6
		geta[TEMP8].z TEMP
		sub TEMP 8096
		ifspawnedby APLAYER
			{
			getp[].horiz TEMP2
			sub TEMP2 100
			mulvar TEMP2 14
			sub TEMP TEMP2
			}
		seta[].z TEMP
break
case 40MM_SHELL
	move FORWARD
	geta[].owner TEMP8
		set TEMP3 sprite[TEMP8].x
		add TEMP3 256
		geta[TEMP8].ang TEMP4
		add TEMP4 140
		rotatepoint sprite[TEMP8].x sprite[TEMP8].y TEMP3 sprite[TEMP8].y TEMP4 TEMP5 TEMP6
		seta[].x TEMP5 
		seta[].y TEMP6
		geta[TEMP8].z TEMP
		sub TEMP 8096
		ifspawnedby APLAYER
			{
			getp[].horiz TEMP2
			sub TEMP2 100
			mulvar TEMP2 14
			sub TEMP TEMP2
			}
		seta[].z TEMP
break
case 3761
case EXSHELL
case FL_SHELL
case MAGN_SHELL
	state animate_sprite_event
	move FORWARD
	geta[].ang TEMP
	sub TEMP -412
	randvar TEMP2 128
	add TEMP TEMP2
	seta[].ang TEMP
	geta[].owner TEMP8
		set TEMP3 sprite[TEMP8].x
		add TEMP3 256
		geta[TEMP8].ang TEMP4
		ifspawnedby APLAYER
		 ife CURWEAP 0
		  ife temp_weapon 7 
		   add TEMP4 200 else
		add TEMP4 140
		rotatepoint sprite[TEMP8].x sprite[TEMP8].y TEMP3 sprite[TEMP8].y TEMP4 TEMP5 TEMP6
		seta[].x TEMP5 
		seta[].y TEMP6
		geta[TEMP8].z TEMP
		sub TEMP 8096
		ifspawnedby APLAYER
			{
			getp[].horiz TEMP2
			sub TEMP2 100
			mulvar TEMP2 14
			sub TEMP TEMP2
			}
		seta[].z TEMP
break
case NJIB
case NJIB2
case NJIB3
case NJIB4
case OCTA_TENT
case 11426
case 11431
case 4714
	randvar TEMP 2048
	seta[].ang TEMP
	randvar TEMP -4000 
	seta[].zvel TEMP
break
case PISTOLMAGAZINE
case PISTOLMAGAZINE2
case SMGMAGAZINE
case SMG_MAG2
case 3790
	geta[].z TEMP
	add TEMP 1120
	seta[].z TEMP
break
case RIFLEMAGAZINE
case DRUMMAGAZINE
case SHOTGUNBOXMAGAZINE
case BETA_MAG
	geta[].z TEMP
	add TEMP 2020
	seta[].z TEMP
break
case WATERSPLASH2
  ifinwater
   { 
   ife sector[].ceilingpicnum FLOORPLASMA seta[].pal 2 else
   ife sector[].ceilingpicnum 5795 seta[].pal 11 else
   ife sector[].ceilingpicnum PURPLELAVA { seta[].pal 18 spawn LAVABUBBLE } else
   ife sector[].ceilingpicnum 773 seta[].pal 13
   ife sector[].ceilingpicnum 7387 seta[].pal 14
   ife sector[].ceilingpicnum 7396 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].ceilingpicnum 10030 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].ceilingpicnum 10033 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].ceilingpicnum 10047 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].ceilingpicnum 17052 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].ceilingpicnum 10526 { spawn LAVASPLASH cactor 3833 }
    } 
    else
    {
   ife sector[].floorpicnum FLOORPLASMA { espawn LAVASPLASH seta[RETURN].pal 2 sound LAVA_HIT cactor 3833 } else
   ife sector[].floorpicnum PURPLELAVA seta[].pal 18 else
   ife sector[].floorpicnum 773 seta[].pal 13 else
   ife sector[].floorpicnum 7396 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].floorpicnum 10030 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].floorpicnum 10033 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].floorpicnum 10047 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].floorpicnum 17052 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
   ife sector[].floorpicnum 10526 { spawn LAVASPLASH sound LAVA_HIT cactor 3833 } else
     {
	ife sector[].floorpicnum 5795 seta[].pal 11
	ife sector[].floorpicnum 7387 seta[].pal 14
   	espawn 8435
	seta[RETURN].z sector[].floorz
	seta[RETURN].pal sprite[].pal
	 }
   }
   break
 case BULLETHOLE 
 case TRIPBOMB
	seta[].mdflags 16
  break
 case FIRELASER
  geta[].owner myowner
  seta[].mdflags 16
  seta[].blend 255
  ifspawnedby LIZTROOP
  ife sprite[myowner].pal 10
  {
    seta[].pal 24
    addstrength FIRELASER_WEAPON_STRENGTH
    addstrength FIRELASER_WEAPON_STRENGTH
  }
  ife sprite[myowner].pal 20
  {
    seta[].pal 24
    addstrength FIRELASER_WEAPON_STRENGTH
    addstrength FIRELASER_WEAPON_STRENGTH
  }
   break
 case HEAVYHBOMB
  seta[].mdflags 16
	ifspawnedby APLAYER
	{
	geta[].owner myowner
	getactorvar[myowner].P_CHAR TEMP
	ife TEMP 0 { set SHOOTGRENADE myowner cactor 3833 }
	ife TEMP 2 { set SHOOTHOLYG myowner cactor 3833 }
	ife TEMP 3 { set SHOOTGRENADE myowner cactor 3833 }
	ife TEMP 4 { set SHOOTDYNAMITE myowner cactor 3833 }
	ife TEMP 5 { set SHOOTDYNAMITE myowner cactor 3833 }
	ife TEMP 6 { set SHOOTDISCBOMB myowner cactor 3833 }
	ife TEMP 7 { set SHOOTGRENADE myowner cactor 3833 }
	ife TEMP 9 { set SHOOTDYNAMITE myowner cactor 3833 }
	ife TEMP 10 { set SHOOTGRENADE myowner cactor 3833 }
	ife TEMP 11 { set SHOOTHOLYG myowner cactor 3833 }
	ife TEMP 12 { set SHOOTCLUSTER myowner cactor 3833 }
	ife TEMP 13 { set SHOOTGRENADE myowner cactor 3833 }
	ife TEMP 14 { set SHOOTGRENADE myowner cactor 3833 }
	}
	break
 case RPG
   ifspawnedby APLAYER
   {
   ife CHAR 1 
		{ 
		ife CURWEAP 7
		 ife SPECIALIST_EQUIPMENT[52] 2
		  {
		  sizeat 7 7
		  }
		  else
		  {
		action SONICRPG 
		addstrength 40 
		ife CURWEAP 7 sizeat 7 7 else sizeat 14 14
			}
		} 
		else
   ife CHAR 3 { action MISSILERPG addstrength 20 sizeat 10 10 randvar TEMP2 256 randvar TEMP3 8 state CHANGEACCURACY } else
   ife CHAR 5 { action TRIRPG addstrength 20 }
   }
   ifspawnedby CYBERDEMON { action CYBERRPG addstrength 60 }
   ifspawnedby SPIDERDEMON action CYBERRPG 
   ifspawnedby ROTATEGUN { action TRIRPG addstrength -40 }
   ifspawnedby BOSS3 
	{ 
	geta[].owner TEMP 
	geta[TEMP].pal TEMP2 
	ifn TEMP2 0 
		{
		addstrength -100
		geta[].z TEMP
		add TEMP 3000  
		seta[].z TEMP
		} 
	}
    ifspawnedby COMMANDER
	{
	geta[].owner TEMP 
	geta[TEMP].pal TEMP2 
	ife TEMP2 20 
		{
		soundonce SONICC
		action SONICRPG
		} 
	else
		{
		action DARKRPG
		}
	}
	ifspawnedby SECTOREFFECTOR
	{
	sound BOS1_ATTACK2
	action DARKRPG
	}
	break
 case EGG
  state KEEPMYPAL
  seta[].xrepeat 40
  seta[].yrepeat 40
   break
 case DRONE
 case PIGCOP
 case PIGCOPSTAYPUT
 case PIGCOPDIVE
 case ZPIGCOP
 case ZPIGCOP_STAYPUT
 case PIG_SF
 case PIG_SF_STAYPUT
 case COMMANDER
 case COMMANDERSTAYPUT
 case LIZMAN
 case LIZMANSTAYPUT
 case LIZMANSPITTING
 case LIZMANJUMP
 case OCTABRAIN
 case OCTABRAINSTAYPUT
 case HEADJIB1
 case ARMJIB1
 case ACCESSCARD
 case ACCESSCARD2
 case LEGJIB1
  case LIZMANHEAD1
  case LIZMANHEAD3
  case 2214 // head on floor
  case LIZMANARM1
  case LIZMANLEG1
  case SATYR_HEAD
  case SATYR_HEAD_FLOOR
  case MJ12_HEAD
  case MJ12_HEAD_FLOOR
  case SHAMBLER
   state KEEPMYPAL
  break
 case LIZTROOP
 case LIZTROOPRUNNING
 case LIZTROOPSTAYPUT
 case LIZTROOPJETPACK
 case LIZTROOPDUCKING
 case LIZTROOPSHOOT
  geta[].owner TEMP
  ifn TEMP -1
  {
    ife sprite[TEMP].pal 0 seta[].pal 11 else
    seta[].pal sprite[TEMP].pal  
  }
  break
 case NEWBEAST
 case NEWBEASTSTAYPUT
 case NEWBEASTJUMP
 case NEWBEASTHANG
 case NEWBEASTHANGDEAD
  geta[].owner TEMP
  ifn TEMP -1
  {
    ife sprite[TEMP].pal 0 seta[].pal 15 else
    seta[].pal sprite[TEMP].pal  
  }
  break
 case CULTIST
 case CULTISTSTAYPUT
 case CULTISTJUMP
  geta[].owner TEMP
  ifn TEMP -1
  {
	seta[].xrepeat 28
	seta[].yrepeat 28
    ife sprite[TEMP].pal 0 seta[].pal 15 else
    seta[].pal sprite[TEMP].pal  
  }
  break
  case TRIAD
  case TRIADSTAYPUT
  case TRIADJUMP
	state KEEPMYPAL
	seta[].xrepeat 28
	seta[].yrepeat 28
  break
  case ZSCIEN
  case ZCHAING
  case ZSOLDIER
  case ZSOLDIER2  
  case Z_GRENADEL
   state KEEPMYPAL
  break
  case NINJA
  case NINJASTAYPUT
  case NINJAJUMP
  case RIPPER
  case GUARDIAN
  case GUARDIANSTAYPUT
  case MAMANO
	  state KEEPMYPAL
	  geta[].owner TEMP
	  ifn TEMP -1
	  {
		ifn sprite[TEMP].pal 3 
			{
			globalsound TELEPORT_IN
			spawn 18623
			}
	  }
  break  
   case LESANG
	  state KEEPMYPAL
	  geta[].owner TEMP
	  ifn TEMP -1
	  {
		globalsound SIREN_TELEP
		spawn 18623
	  }
  break  
  case PE_TROOP
  case PE_TROOP_STAYPUT
  case PE_ELDER
  case PE_ELDER_STAYPUT
	  state KEEPMYPAL
	  geta[].owner TEMP
	  ifn TEMP -1
	  {
		ifn sprite[TEMP].pal 3 
			{
			soundonce BLOOD_EXPLOSION
			spawn 18935
			ifrnd 128 spawn 10644 else spawn 10643
			}
	  }
  break
  case ANUBIS
  case ANUBIS_STAYPUT
  case ANUBIS_MUMMY
  case ANUBIS_MUMMY_STAYPUT 
  case SIREN
  case ALUDRAN
  case ALUDRAN_STAYPUT  
  case SCORPIONESS
  case SCORPIONESS_STAYPUT
  case COBRA 
  case COBRA_STAYPUT 
    state KEEPMYPAL
    globalsound LESANG_AID
	espawn SKULLEXPLOSION
	seta[RETURN].pal 1
	break
  case SATYR
  case SATYRSTAYPUT
  case SHADE
  case SHADESTAYPUT
  case INFERNAL
  case INFERNAL_STAYPUT
  case FLESHWIZARD
  case FLESHWIZARDSTAYPUT
  case BRUISER
  case BRUISERSTAYPUT
  case CYBERDEMON
  case SPIDERDEMON
  case MAEPHISTO
  case CYBERTOUR
  case CYBERTOURSTAYPUT
  state KEEPMYPAL
  geta[].owner TEMP
  ifn TEMP -1
  {
    ife sprite[TEMP].pal 0 globalsound DEMON_TELEPORT
	ifactor BRUISER ife sprite[TEMP].pal 3 globalsound DEMON_TELEPORT
  }
  break
  case HADESPHERE
  case HADESPHERESTAYPUT
  state KEEPMYPAL
  geta[].owner TEMP
  ifn TEMP -1
  {
    spawn PENTAGRAM
    ife sprite[TEMP].pal 0 globalsound DEMON_TELEPORT
  }
  break
  case ZOMBIE
  state KEEPMYPAL
  break
  case JIBS2
  case JIBS3
  case JIBS4
  case JIBS5
    ifspawnedby SORCERER spritepal 1
	ifspawnedby DARKAVATAR spritepal 1
	ifspawnedby ANUBIS_MUMMY spritepal 5
	ifspawnedby COBRA spritepal 8
	ifspawnedby NEWBEAST spritepal 8
	ifspawnedby 4705 spritepal 27
	ifspawnedby PE_SENTRY sizeat 0 0
	break
  case JIBS6
	geta[].owner TEMP
	ifn TEMP -1 { getactorvar[TEMP].FIRE_DAMAGE TEMP2 ifg TEMP2 0 sizeat 0 0 }
    ifspawnedby SORCERER spritepal 1
	ifspawnedby 9771 spritepal 1
	ifspawnedby DARKAVATAR spritepal 1
	ifspawnedby ANUBIS_MUMMY spritepal 5
	ifspawnedby COBRA spritepal 8
	ifspawnedby NEWBEAST spritepal 8
	ifspawnedby 4705 spritepal 27
	ifspawnedby PE_SENTRY sizeat 0 0
	break
endswitch

ifactor TRANSPORTERSTAR
{
ifspawnedby RESPAWN 
	{ 
	geta[].owner TEMP4
	switch sprite[TEMP4].hitag
	case SATYR
	case SATYRSTAYPUT
	case FLESHWIZARD
	case FLESHWIZARDSTAYPUT
	case SHADE
	case SHADESTAYPUT
    case INFERNAL
    case INFERNAL_STAYPUT
	case BRUISER
	case BRUISERSTAYPUT
	case CYBERTOUR
	case CYBERTOURSTAYPUT
	case MAEPHISTO
	case 7492 // Shade dummy
		spawn BURNING2
		espawn PENTAGRAM
		seta[RETURN].ang sprite[].ang
		break
	case 8576
	case CULTIST
	case CULTISTSTAYPUT
	case WATERBUBBLE
	case 7677
	case VLADMIR
	case RIPPERJUMP
	case RIPPER
	case MAMANOJUMP
	case MAMANO
	case BEYONDBRAIN
		seta[].xrepeat 1
		seta[].yrepeat 1
		break
	default
		break
	endswitch
	}
}

endevent


action RN_TRAP_STICK 3

defstate STICKTOMONSTER
    ifn TEMP -1 
     { 
     cstat 0
     seta[].x sprite[TEMP].x
     seta[].y sprite[TEMP].y
     geta[TEMP].z TEMP5
     add TEMP5 -5120
     seta[].z TEMP5
	 ifaction 0
		 {
		 ifactor HEARTLEECHFLOAT action ZERO
		 else ifactor R_TRAP_IDLE { sound RUSTY_TRAP action RN_TRAP_STICK  }
		 else { action ZERO sound RUSTY_TRAP }
		 }
     }
ends

defstate FINDMONSTERS
   findnearactor3d SHOOTME 512 TEMP state STICKTOMONSTER
   findnearactor3d SHOOTME3 512 TEMP state STICKTOMONSTER
ends

action DYNAPICK2 6306

move SLOW 50

eventloadactor RESPAWN
ifg sprite[].extra 0 geta[].extra EXTRASAVED
enda

eventloadactor MUSICANDSFX
ifg sprite[].extra 0 geta[].extra EXTRASAVED
ife sprite[].hitag -32768 sets[].hitag 32767
ifg sprite[].hitag 32767 sets[].hitag 32767
enda

spritenopal SECTOREFFECTOR

eventloadactor SECTOREFFECTOR
// geta[].lotag LOTAGSAVED
geta[].hitag HITAGSAVED
geta[].xvel XVELSAVED
geta[].yvel YVELSAVED
geta[].zvel ZVELSAVED
geta[].cstat CSTATSAVED
seta[].zvel 0
ifg sprite[].extra 0 geta[].extra EXTRASAVED
geta[].pal PALSAVED
geta[].z initz

ife sprite[].lotag 80
{
ifn EXTRASAVED -1 set skybox_tile EXTRASAVED
set cloud_centre THISACTOR
	set TEMP7 0
	whilevarvarn TEMP7 numsectors
	{
	// CHECK FLOORS

		gets[TEMP7].floorpicnum TEMP2
		ife TEMP2 178
		{
		ife NO_SKYBOX YES ifn EXTRASAVED -1 sets[TEMP7].floorpicnum EXTRASAVED else
		 sets[TEMP7].floorpicnum 179
		}
	// CHECK CEILINGS

		gets[TEMP7].ceilingpicnum TEMP2
		ife TEMP2 178
		{
		ife NO_SKYBOX YES ifn EXTRASAVED -1 sets[TEMP7].ceilingpicnum EXTRASAVED else
		 sets[TEMP7].ceilingpicnum 179
		}
	  add TEMP7 1
	}
	set TEMP8 0
	whilevarvarn TEMP8 NUMWALLS
	{
	// CHECK WALLS
		ife wall[TEMP8].picnum 178
		{
		ife NO_SKYBOX YES ifn EXTRASAVED -1 setwall[TEMP8].picnum EXTRASAVED else
		 setwall[TEMP8].picnum 179
		}
		ife wall[TEMP8].overpicnum 178
		{
		ife NO_SKYBOX YES ifn EXTRASAVED -1 setwall[TEMP8].overpicnum EXTRASAVED else
		 setwall[TEMP8].overpicnum 179
		}
	add TEMP8 1
	}
}

enda

eventloadactor GPSPEED
geta[].lotag LOTAGSAVED
geta[].hitag HITAGSAVED
geta[].xvel XVELSAVED
ifg sprite[].extra 0 geta[].extra EXTRASAVED
enda

defstate SEHUBSTATE

ife WAIT YES // wait for the player to leave the sector before re-activating
break

// don't change maps if this map just loaded
// this avoids problem caused by scroll lock being placed in a map changing sector
ifl player[].player_par 4
break

// don't change maps if the player is at the edge of the sector
// this avoids problem of the player going back and forth between maps with slight movement
getp[].posx xoff
getp[].posy yoff
add xoff 128
add yoff 128
updatesector xoff yoff TEMP
ifvarvarn player[].cursectnum TEMP break
sub xoff 256
updatesector xoff yoff TEMP
ifvarvarn player[].cursectnum TEMP break
sub yoff 256
updatesector xoff yoff TEMP
ifvarvarn player[].cursectnum TEMP break
add xoff 256
updatesector xoff yoff TEMP
ifvarvarn player[].cursectnum TEMP break

ife sprite[].shade 10
{
	set xoff 0
	set yoff 0
	set zoff 0
}
else
{
	geta[].x TEMP
	getp[].posx xoff
	sub xoff TEMP
	geta[].y TEMP
	getp[].posy yoff
	sub yoff TEMP
	geta[].z TEMP
	getp[].posz zoff
	add zoff 8192
	sub zoff TEMP
	ife EXTRASAVED 1 { set xoff 0 set yoff 0 set zoff 0 }
}


set pdestination HITAGSAVED
geta[].pal temp
set playerwait 2

		ife loading 0 set loading 30

		setarray Player_equip[43] temp_weapon // Temp weapon
		getp[].ammo_amount 0 TEMP
		setarray Player_equip[1] TEMP
		getp[].gotweapon 1 TEMP // Pistol
		setarray Player_equip[2] TEMP
		getp[].ammo_amount 1 TEMP
		setarray Player_equip[3] TEMP
		getp[].gotweapon 2 TEMP // Shotgun
		setarray Player_equip[4] TEMP
		getp[].ammo_amount 2 TEMP
		setarray Player_equip[5] TEMP
		getp[].gotweapon 3 TEMP // Shotgun
		setarray Player_equip[6] TEMP
		getp[].ammo_amount 3 TEMP // Chaingun
		setarray Player_equip[7] TEMP
		getp[].gotweapon 4 TEMP // RPG
		setarray Player_equip[8] TEMP
		getp[].ammo_amount 4 TEMP
		setarray Player_equip[9] TEMP
		getp[].ammo_amount 5 TEMP // Pipebomb
		setarray Player_equip[10] TEMP
		getp[].gotweapon 6 TEMP // Shrinker
		setarray Player_equip[11] TEMP
		getp[].ammo_amount 6 TEMP
		setarray Player_equip[12] TEMP
		getp[].gotweapon 7 TEMP // Devistator
		setarray Player_equip[13] TEMP
		getp[].ammo_amount 7 TEMP
		setarray Player_equip[14] TEMP
		getp[].ammo_amount 8 TEMP // Tripbomb
		setarray Player_equip[15] TEMP
		getp[].gotweapon 9 TEMP // Freezer
		setarray Player_equip[16] TEMP
		getp[].ammo_amount 9 TEMP
		setarray Player_equip[17] TEMP
		getp[].gotweapon 11 TEMP // Expander
		setarray Player_equip[18] TEMP
		getp[].ammo_amount 11 TEMP
		setarray Player_equip[19] TEMP
		setarray Player_equip[20] PHEALTH
		setarray Player_equip[21] PMAXHEALTH
		setarray Player_equip[22] PARMOUR
		setarray Player_equip[23] P_SPIRIT_ARMOUR
		
		ife CHAR 0 setarray Player_equip[24] JAMES_UPGRADE
		ife CHAR 1 setarray Player_equip[24] ZAXTOR_UPGRADE
		ife CHAR 2 setarray Player_equip[24] MERLIJN_UPGRADE
		ife CHAR 3 setarray Player_equip[24] HIGHWIRE_UPGRADE
		ife CHAR 4 setarray Player_equip[24] SANG_UPGRADE
		ife CHAR 5 setarray Player_equip[24] RUSTY_UPGRADE
		ife CHAR 6 setarray Player_equip[24] GEOFFREY_UPGRADE
		ife CHAR 7 setarray Player_equip[24] MIKKO_UPGRADE
		ife CHAR 13 setarray Player_equip[24] MICKY_UPGRADE
		ife CHAR 14 setarray Player_equip[24] SNOWFALL_UPGRADE
		
		setarray Player_equip[25] GUNFIREMODE
		setarray Player_equip[26] GUNSAKIMBO
		setarray Player_equip[27] GOT_EXPLOSIVE
		setarray Player_equip[28] AIR_FILTER
		setarray Player_equip[29] PISTOLMAG
		setarray Player_equip[30] MGUNMAG
		setarray Player_equip[31] RUNEKEYS
		setarray Player_equip[32] ACCESSKEY2
		setarray Player_equip[33] PLUGKEY
		setarray Player_equip[34] HELLGKEYS
		setarray Player_equip[35] OLDKEYS
		getp[].boot_amount TEMP
		setarray Player_equip[36] TEMP
		getp[].heat_amount TEMP
		setarray Player_equip[37] TEMP
		getp[].holoduke_amount TEMP
		setarray Player_equip[38] TEMP
		getp[].jetpack_amount TEMP
		setarray Player_equip[39] TEMP
		getp[].scuba_amount TEMP
		setarray Player_equip[40] TEMP
		getp[].firstaid_amount TEMP
		setarray Player_equip[41] TEMP
		getp[].steroids_amount TEMP
		setarray Player_equip[42] TEMP
		getp[].got_access TEMP
		setarray Player_equip[44] TEMP
		setarray Player_equip[45] GENERIC_KEYS
		setarray Player_equip[46] silver_ammo
		setarray Player_equip[47] explosive_shells
		setarray Player_equip[48] FIRE_SUIT
		setarray Player_equip[49] GAS_MASK
		setarray Player_equip[50] tesla_ammo
		setarray Player_equip[51] SCARABKEYS
		setarray Player_equip[52] COGS
		setarray Player_equip[53] P_FIRE_ARMOUR
		setarray Player_equip[54] TOOLBOX
		setarray Player_equip[55] flechete_shells
		setarray Player_equip[56] silver_bolts
		setarray Player_equip[57] NORMAL_KEYS
		setarray Player_equip[58] micro_torpedo
		setarray Player_equip[59] magnum_shells
		setarray Player_equip[60] heat_seek_card
		setarray Player_equip[61] atomic_bomb
		setarray Player_equip[62] DUP_missile_ammo
		setarray Player_equip[63] SW_KEYS
		setarray Player_equip[64] fortymm_grenades
		setarray Player_equip[65] fortymm_shells
		setarray Player_equip[66] fortymm_MIA_shells
		setarray Player_equip[67] fortymm_plasma
		setarray Player_equip[68] fortymm_caseless
		setarray Player_equip[69] fortymm_electro
		setarray Player_equip[70] fortymm_slug
		setarray Player_equip[71] fortymm_cryo
		setarray Player_equip[72] ROPE
		setarray Player_equip[73] EGYPT_KEYS
		setarray Player_equip[74] EGYPT_ARTIFACTS
		setarray Player_equip[75] dragon_shells
		setarray Player_equip[76] GOT_KNIFE
		setarray Player_equip[77] RIOTSHIELD
		setarray Player_equip[80] AMMO_TYPES[0]
		setarray Player_equip[81] AMMO_TYPES[1]
		setarray Player_equip[82] AMMO_TYPES[2]
		setarray Player_equip[83] AMMO_TYPES[3]
		setarray Player_equip[84] AMMO_TYPES[4]
		setarray Player_equip[85] AMMO_TYPES[5]
		setarray Player_equip[86] AMMO_TYPES[6]
		setarray Player_equip[87] AMMO_TYPES[7]
		setarray Player_equip[88] AMMO_TYPES[8]
		setarray Player_equip[89] AMMO_TYPES[9]
		setarray Player_equip[90] AMMO_TYPES[10]
		setarray Player_equip[91] AMMO_TYPES[11]
		setarray Player_equip[92] AMMO_TYPES[12]
		setarray Player_equip[93] AMMO_TYPES[13]
		setarray Player_equip[94] AMMO_TYPES[14]
		setarray Player_equip[95] AMMO_TYPES[15]
		setarray Player_equip[97] SWIPECARDS
		setarray Player_equip[98] GOT_FIREWALL
		setarray Player_equip[99] GOT_FLIPPER
		
		setarray Player_equip[100] TEMP_WEAPON_MAG

		setarray Player_equip[102] SHOTGUNMAG
		setarray Player_equip[103] SHOTGUNBOXMAG

		setarray Player_equip[105] ROCKETMAG
		setarray Player_equip[106] AUTOSHOTMAG
		setarray Player_equip[107] SLUGSHOTMAG
		setarray Player_equip[108] RIFLEMAG
		setarray Player_equip[109] MACHINE_MAG
		setarray Player_equip[110] ANBMAG
		setarray Player_equip[111] ALTMAG
		setarray Player_equip[119] player[].curr_weapon
		setarray Player_equip[121] player[].actors_killed
		
		setarray secret_count[LEVEL] player[].secret_rooms
		
state save_arrays
set LOADING_SCREEN_HINT 0
savemapstate
ifl loading 20 startlevel VOLUME temp

ends

eventloadactor DOMELITE 
ife sprite[].extra 0
	{
	espawn 18427  
	ifand sprite[].cstat 8 nullop else
		{
		geta[].sectnum TEMP3
		seta[RETURN].z sector[TEMP3].ceilingz
		}
	geta[].pal TEMP4
	ife TEMP4 0 seta[RETURN].pal 2
	else seta[RETURN].pal TEMP4
	setactorvar[RETURN].myowner THISACTOR
	}
enda

gamevar AIRLEFT 0 1

onevent EVENT_GAME

ifactor EGG ife NO_FACEHUGGERS YES killit
ifactor GREENSLIME ife NO_FACEHUGGERS YES killit

ife weather_type 2
	{
	geta[].zvel TEMP
	ifg TEMP 0 divvar TEMP 2
	seta[].zvel TEMP
	}
else
ife weather_type 3 // no gravity
{
	switch sprite[].picnum
		case FIRELASER
			break
		default
			geta[].zvel TEMP
			ifg TEMP 0 divvar TEMP 20
			seta[].zvel TEMP
			break
	endswitch
}
else
ifand sector[].ceilingstat 16384 // low gravity
{
	switch sprite[].picnum
		case FIRELASER
			break
		default
			geta[].zvel TEMP
			ifg TEMP 0 divvar TEMP 2
			seta[].zvel TEMP
			break
	endswitch
}

ifactor 17638
{
ifn HITAGSAVED 0
	{
	sleeptime 0
	checkactivatormotion HITAGSAVED
	ife RETURN 1 { action ACAR soundonce FIFTY_T_BEEP stopsound AUTOTURRET_SCAN }
	}
}
ife sprite[].statnum 1
	{
	ifg END_LEVEL 0 ifg sprite[].extra 0 sleeptime 32767
	/* floor reflection code, left in but not working because I am bad into math
	ifactor 4733 break
	gets[].extra TEMP2
		ife TEMP2 128
			{
			ife sprite[].cstat 32768 nullop else
				{
				ifn TEMP9 5
					{
					espawn 4733
					seta[RETURN].owner THISACTOR
					setactorvar[RETURN].myowner THISACTOR
					set TEMP9 5
					}
				}
			}
		*/
		ifand sprite[].cstat 8
		ifg sprite[].extra 0
		{
		ifactor GREENSLIME nullop else
		ifactor ROTATEGUN nullop else
		ifactor 10595 nullop else
		ifactor SHARK nullop else
		ifactor BLOOD nullop else
			{
			gets[].ceilingz TEMP
			add TEMP 11000
			seta[].z TEMP
			}
		}
		ifand sprite[].hitag seekplayer
		 ifand sprite[].htflags 32
			{
			state enemyfindtarget
			ife target -1 state enemyfindtarget2
			ife target -1 
				{
				ifcansee
					{
					dist xydist THISACTOR PLAYER_IDENTITY
					getp[].posx mx
					getp[].posy my
					sub mx sprite[].x
					sub my sprite[].y
					getangle ANGVAR mx my
					ifnotmoving
						{
						randvar TEMP4 2048
						seta[].ang TEMP4
						}
					else
					seta[].ang ANGVAR
					set target PLAYER_IDENTITY
					}
					else
					{
					geta[].htlastvx mx
					geta[].htlastvy my
					sub mx sprite[].x
					sub my sprite[].y
					getangle ANGVAR mx my
					ifnotmoving
						{
						randvar TEMP4 2048
						seta[].ang TEMP4
						}
					else
					seta[].ang ANGVAR
					}
				}
			}

		ifand sprite[].hitag seektarget2
			{
			ifrnd 16 state enemyfindtarget
			ife target -1 ifrnd 16 state enemyfindtarget3
			ife target -1 
				{
				ifcansee
					{
					dist xydist THISACTOR PLAYER_IDENTITY
					getp[].posx mx
					getp[].posy my
					sub mx sprite[].x
					sub my sprite[].y
					getangle ANGVAR mx my
					ifnotmoving
						{
						randvar TEMP4 2048
						seta[].ang TEMP4
						}
					else
					seta[].ang ANGVAR
					set target PLAYER_IDENTITY
					}
					else
					{
					geta[].htlastvx mx
					geta[].htlastvy my
					sub mx sprite[].x
					sub my sprite[].y
					getangle ANGVAR mx my
					ifnotmoving
						{
						randvar TEMP4 2048
						seta[].ang TEMP4
						}
					else
					seta[].ang ANGVAR
					}
				}
			}
		ifand sprite[].hitag shoottarget2
			{
			state enemyfindtarget
			ife target -1 state enemyfindtarget3
			ife target -1 
				{
				 ifcansee
					{
					dist xydist THISACTOR PLAYER_IDENTITY
					
					geta[PLAYER_IDENTITY].x MX
					geta[PLAYER_IDENTITY].y MY
					geta[].x x
					geta[].y y
					sub MX x
					sub MY y
					getangle ANGVAR MX MY
					seta[].ang ANGVAR
					
					set target PLAYER_IDENTITY
					}
				}
			}
		}

ifvarvare MELEE_LOCKED_ON THISACTOR
	{
	ifl UPPER_CUT 20
		{
		seta[].xvel 0
		}
	}

ife RANDOM_ENEMY YES
 ife VOLUME 0
  ife LEVEL 7
{

ifactor LIZTROOP
{
	ifai 0
		{
		ifrnd 48 cactor CULTIST else
		ifrnd 48 cactor ZSCIEN else
		ifrnd 48 cactor SHADE else
		ifrnd 48 cactor TRIAD else
		ifrnd 48 cactor ZSOLDIER else
		ifrnd 48 cactor ZSOLDIER2 else
		ifrnd 48 cactor PE_TROOP
		}
}

ifactor PIGCOP
{
	ifai 0
		{
		ifspritepal 13 cactor PIG_SF else
		ifrnd 48 { cactor CULTIST spritepal 10 } else
		ifrnd 48 cactor MERC else
		ifrnd 48 cactor INFERNAL else
		ifrnd 48 cactor SATYR else
		ifrnd 48 cactor PIGCOP_RIOTSHIELD else
		ifrnd 48 { cactor GUARDIAN spritepal 11 } 
		}
}

ifactor PIGCOPSTAYPUT
{
	ifai 0
		{
		ifrnd 48 nullop else
		ifrnd 48 { cactor CULTISTSTAYPUT spritepal 10 } else
		ifrnd 48 cactor MERCSTAYPUT else
		ifrnd 48 cactor MERC2STAYPUT else
		{ cactor TRIADSTAYPUT spritepal 16 }
		}
}


ifactor PIGCOPDIVE
{
	ifai 0
		{
		ifrnd 48 nullop else
		ifrnd 48 { cactor CULTIST spritepal 10 } else
		ifrnd 48 cactor MERC else
		ifrnd 48 cactor MERC2 else
		ifrnd 48 cactor FASCIST else
		ifrnd 48 cactor SATYR else
		 { cactor GUARDIAN spritepal 11 } 
		}
}

ifactor LIZMAN
{
	ifai 0
		{
		ifrnd 48 cactor ZCHAING else
		ifrnd 48 cactor MERC2 else
		ifrnd 48 cactor FASCIST else
		ifrnd 48 cactor NINJA else
		ifrnd 48 cactor MJ12_TROOP else
		ifrnd 32 { cactor GUARDIAN spritepal 11 } else
		ifrnd 32 { cactor TRIAD spritepal 49 } else
		ifrnd 32 { cactor CULTIST spritepal 49 } else
		ifrnd 32 { cactor FASCIST spritepal 24 } else
		ifrnd 32 { cactor ZCHAING spritepal 24 } else
		ifrnd 32 { cactor ZSOLDIER spritepal 24 } else
		ifrnd 32 { cactor ZSOLDIER2 spritepal 24 }
		}
}

ifactor OCTABRAIN
{
	ifai 0
		{
		ifrnd 64 nullop else
		ifrnd 32 cactor SORCERER else
		ifrnd 32 cactor HADESPHERE
		}
}

ifactor COMMANDER
{
	ifai 0
		{
		ifrnd 96 nullop else
		ifrnd 32 cactor CYBERTOUR else
		ifrnd 32 cactor BRUISER else
		ifrnd 32 { cactor PITFIEND strength 350 } else
		ifrnd 32 cactor LPOWERSUIT
		}
}

ifactor NEWBEAST
{
	ifai 0
		{
		ifrnd 96 nullop else
		ifrnd 64 cactor RIPPER else
		ifrnd 64 cactor BERSERKER else
		ifrnd 64 cactor OGRE else
		ifrnd 16 cactor MAMANO
		}
}

ifactor BOSS1
{
	ifai 0
	{
	ifspritepal 0
		{
		ifrnd 96 nullop else
		ifrnd 32 { cactor HPOWERSUIT } else
		ifrnd 32 { cactor DARKAVATAR } else
		ifrnd 16 { cactor CYBERDEMON } else
		ifrnd 32 { cactor MISTERH }
		}
		else
		{
		ifrnd 96 nullop else
		ifrnd 48 cactor MAEPHISTO else
		ifrnd 48 cactor PE_SENTRY
		}
	}
}

ifactor BOSS2
{
	ifai 0
	ifspritepal 0
		{
		ifrnd 96 nullop else
		ifrnd 32 { cactor HPOWERSUIT } else
		ifrnd 32 { cactor DARKAVATAR } else
		ifrnd 16 { cactor CYBERDEMON } else
		ifrnd 32 { cactor MISTERH }
		}
}

ifactor BOSS3
{
	ifai 0
	ifspritepal 0
		{
		ifrnd 96 nullop else
		ifrnd 32 { cactor HPOWERSUIT } else
		ifrnd 32 { cactor DARKAVATAR } else
		ifrnd 16 { cactor CYBERDEMON } else
		ifrnd 32 { cactor MISTERH }
		}
}

ifactor BOSS4
{
	ifai 0
	ifspritepal 0
		{
		ifrnd 96 nullop else
		ifrnd 32 { cactor HPOWERSUIT } else
		ifrnd 32 { cactor DARKAVATAR } else
		ifrnd 16 { cactor CYBERDEMON } else
		ifrnd 32 { cactor MISTERH }
		}
}

}

ifactor TRANSPORTERSTAR
{
ifspawnedby RESPAWN 
	{ 
	geta[].owner TEMP 
	geta[TEMP].hitag TEMP2 
	switch TEMP2
	case SATYR
	case SATYRSTAYPUT
	case SHADE
	case SHADESTAYPUT
	case FLESHWIZARD
	case FLESHWIZARDSTAYPUT
	case BRUISER
	case BRUISERSTAYPUT
	case HADESPHERE
	case HADESPHERESTAYPUT
	case 8576
	case CULTIST
	case CULTISTSTAYPUT
	case AMCSHIP
	case AMCSHIP2
	case 15329
	case 8924
	case 8931
	case WATERBUBBLE
	case FIRE
	case FIRE2
	case BURNING
	case BURNING2
	case VLADMIR
	case ZOMBIE
	case 10510
	case 12267
	case 3665
		seta[].xrepeat 1
		seta[].yrepeat 1
		break
	default
		break
	endswitch
	}
}

ifactor CAMERA1
{
ifn sprite[].hitag 0 ifg sprite[].xrepeat 8 ifg sprite[].yrepeat 8 soundonce CAMERA_MOVE
ifg TEMP5 0
	{
	sub TEMP5 1
	ife PCAMERA 0 set PCAMERA 1
	ife EXTRASAVED 1
		{ 

		getinput[].horz TEMP
		ifg TEMP 0
		{
		getuserdef[].mouseflip TEMP2
		
		geta[].shade TEMP4
		ifl TEMP4 120
			{
			ife TEMP2 0 sub TEMP4 TEMP else
			add TEMP4 TEMP
			ifg TEMP4 120 set TEMP4 120
			seta[].shade TEMP4
			set TEMP9 1
			}
		}
		else
		ifl TEMP 0
		{
		getuserdef[].mouseflip TEMP2
		
		geta[].shade TEMP4
		ifg TEMP4 -120
			{
			ife TEMP2 0 sub TEMP4 TEMP else
			add TEMP4 TEMP
			ifl TEMP4 -120 set TEMP4 -120
			seta[].shade TEMP4
			set TEMP9 1
			}
		}
		else set TEMP9 0


		getinput[].avel TEMP
		geta[].ang TEMP4
		getinput[TEMP6].extbits TEMP7
		getinput[TEMP6].bits TEMP8
		ifn TEMP 0
			{
			add TEMP4 TEMP
			seta[].ang TEMP4
			set TEMP9 1
			}
		else set TEMP9 0

			ifand TEMP7 16 
				{
				set TEMP9 1
				geta[].ang TEMP4
				sub TEMP4 16
				seta[].ang TEMP4
				}
			else
			ifand TEMP7 32 
				{
				set TEMP9 1
				geta[].ang TEMP4
				add TEMP4 16
				seta[].ang TEMP4
				}
			else
			ifand TEMP8 8192 
				{
				geta[].shade TEMP4
				ifl TEMP4 114
					{
					set TEMP9 1
					add TEMP4 4
					seta[].shade TEMP4
					}
				}
			else
			ifand TEMP8 16384 
				{
				geta[].shade TEMP4
				ifg TEMP4 -118
					{
					set TEMP9 1
					sub TEMP4 4
					seta[].shade TEMP4
					}
				}
			else
			ifand TEMP8 8 
				{
				geta[].shade TEMP4
				ifl TEMP4 114
					{
					set TEMP9 1
					add TEMP4 4
					seta[].shade TEMP4
					}
				}
			else
			ifand TEMP8 16 
				{
				geta[].shade TEMP4
				ifg TEMP4 -118
					{
					set TEMP9 1
					sub TEMP4 4
					seta[].shade TEMP4
					}
				}
			else set TEMP9 0
			}	
	ife TEMP9 0 stopactorsound THISACTOR CAMERA_MOVE
	else ife TEMP9 1 soundonce CAMERA_MOVE
			
	}
}

ifactor APLAYER
{

getp[].newowner CAMID
ifn CAMID -1
	{
	setactorvar[CAMID].TEMP5 3
	geta[].yvel TEMP9
	setactorvar[CAMID].TEMP6 TEMP9
	}
ife PCAMERA 1 { ifmultiplayer nullop else spawn 1404 set PCAMERA 2 }
ife PCAMERA 2
	{
	ife CAMID -1 set PCAMERA 0
	}
	
ifn pdestination -1
{
	setp[].look_ang 0
	sub playerwait 1
	ifl playerwait 1
	{
		loadmapstate
		set TEMP 0
		whilevarn TEMP 16384
		{
			ife sprite[TEMP].statnum 4
			{
				changespritestat TEMP 1
				seta[TEMP].picnum SMALLSMOKE
				seta[TEMP].cstat 32768
			}
			ife sprite[TEMP].picnum SMALLSMOKE
			seta[TEMP].cstat 32768
			add TEMP 1
		}
		set TEMP 0
		whilevarn TEMP 16384
		{
			ife sprite[TEMP].picnum SECTOREFFECTOR
			{
				ifg sprite[TEMP].lotag 68 ifl sprite[TEMP].lotag 71
				ifn sprite[TEMP].statnum 1024
				{
					ifvarvare sprite[TEMP].hitag pdestination
					ifn sprite[TEMP].shade 10
					{
						ifg END_LEVEL 0 set END_LEVEL 0
						setactorvar[TEMP].WAIT YES
						getp[].i PLAYER_IDENTITY
						geta[TEMP].x TEMP2
						add TEMP2 xoff
						setp[].posx TEMP2
						seta[PLAYER_IDENTITY].x TEMP2
						geta[TEMP].y TEMP2
						add TEMP2 yoff
						setp[].posy TEMP2
						seta[PLAYER_IDENTITY].y TEMP2
						geta[TEMP].z TEMP2
						add TEMP2 zoff
						seta[PLAYER_IDENTITY].z TEMP2
						sub TEMP2 8192
						setp[].posz TEMP2
						setp[].cursectnum sprite[TEMP].sectnum
						changespritesect PLAYER_IDENTITY sprite[TEMP].sectnum
						setp[].knuckle_incs 0
						setp[].kickback_pic 0
						setp[].ang sprite[TEMP].ang
						
						
						
		set temp_weapon Player_equip[43]
		setp[].ammo_amount 0 Player_equip[1]
		setp[].gotweapon 1 Player_equip[2]
		setp[].ammo_amount 1 Player_equip[3]
		setp[].gotweapon 2 Player_equip[4]
		setp[].ammo_amount 2 Player_equip[5]
		setp[].gotweapon 3 Player_equip[6] 
		setp[].ammo_amount 3 Player_equip[7] 
		setp[].gotweapon 4 Player_equip[8] // RPG
		setp[].ammo_amount 4 Player_equip[9]
		setp[].ammo_amount 5 Player_equip[10] // Pipebomb
		ifg Player_equip[10] 0 setp[].gotweapon 5 1
		setp[].gotweapon 6 Player_equip[11] // Shrinker
		setp[].ammo_amount 6 Player_equip[12]
		setp[].gotweapon 7 Player_equip[13] // Devistator
		setp[].ammo_amount 7 Player_equip[14]
		setp[].ammo_amount 8 Player_equip[15] // Tripbomb
		setp[].gotweapon 9 Player_equip[16] // Freezer
		setp[].ammo_amount 9 Player_equip[17]
		setp[].gotweapon 11 Player_equip[18] // Expander
		setp[].ammo_amount 11 Player_equip[19]
		
		getp[].i PLAYER_IDENTITY
		ife Player_equip[20] 0 setarray Player_equip[20] 200
		seta[PLAYER_IDENTITY].extra Player_equip[20]
		ife Player_equip[21] 0 setarray Player_equip[21] 200
		setp[].max_player_health Player_equip[21]
		
		setp[].shield_amount Player_equip[22]
		set P_SPIRIT_ARMOUR Player_equip[23] 
		set P_FIRE_ARMOUR Player_equip[53]
		
		ife CHAR 0 set JAMES_UPGRADE Player_equip[24] 
		ife CHAR 1 set ZAXTOR_UPGRADE Player_equip[24]
		ife CHAR 2 set MERLIJN_UPGRADE Player_equip[24]
		ife CHAR 3 set HIGHWIRE_UPGRADE Player_equip[24]
		ife CHAR 4 set SANG_UPGRADE Player_equip[24]
		ife CHAR 5 set RUSTY_UPGRADE Player_equip[24]
		ife CHAR 6 set GEOFFREY_UPGRADE Player_equip[24]
		ife CHAR 7 set MIKKO_UPGRADE Player_equip[24]
		
		set GUNFIREMODE Player_equip[25]
		set GUNSAKIMBO Player_equip[26]
		set GOT_EXPLOSIVE Player_equip[27]
		set AIR_FILTER Player_equip[28] 
		set PISTOLMAG Player_equip[29]
		set MGUNMAG Player_equip[30]
		set RUNEKEYS Player_equip[31]
		set ACCESSKEY2 Player_equip[32]
		set PLUGKEY Player_equip[33]
		set HELLGKEYS Player_equip[34]
		set OLDKEYS Player_equip[35]
		set GENERIC_KEYS Player_equip[45]
		setp[].got_access Player_equip[44]
		setp[].boot_amount Player_equip[36]
		setp[].heat_amount Player_equip[37]
		setp[].holoduke_amount Player_equip[38]
		setp[].jetpack_amount Player_equip[39]
		setp[].scuba_amount Player_equip[40]
		setp[].firstaid_amount Player_equip[41]
		setp[].steroids_amount Player_equip[42]
		set silver_ammo Player_equip[46]
		set explosive_shells Player_equip[47]
		set FIRE_SUIT Player_equip[48]
		set GAS_MASK Player_equip[49]
		set tesla_ammo Player_equip[50]
		set SCARABKEYS Player_equip[51]
		set COGS Player_equip[52]
		set TOOLBOX Player_equip[54]
		set flechete_shells Player_equip[55]
		set silver_bolts Player_equip[56]
		set NORMAL_KEYS Player_equip[57] 
		set micro_torpedo Player_equip[58]
		set magnum_shells Player_equip[59]
		set heat_seek_card Player_equip[60]
		set atomic_bomb Player_equip[61]
		set DUP_missile_ammo Player_equip[62]
		set SW_KEYS Player_equip[63]
		set fortymm_grenades Player_equip[64]
		set fortymm_shells Player_equip[65]
		set fortymm_MIA_shells Player_equip[66]
		set fortymm_plasma Player_equip[67]
		set fortymm_caseless Player_equip[68]
		set fortymm_electro Player_equip[69]
		set fortymm_slug Player_equip[70]
		set fortymm_cryo Player_equip[71]
		set ROPE Player_equip[72]
		set EGYPT_KEYS Player_equip[73] 
		set EGYPT_ARTIFACTS Player_equip[74]
		set dragon_shells Player_equip[75]
		set GOT_KNIFE Player_equip[76]
		set RIOTSHIELD Player_equip[77]
		set SWIPECARDS Player_equip[97]
		set GOT_FIREWALL Player_equip[98]
		set GOT_FLIPPER Player_equip[99]
		
		setarray AMMO_TYPES[0] Player_equip[80]
		setarray AMMO_TYPES[1] Player_equip[81]
		setarray AMMO_TYPES[2] Player_equip[82]
		setarray AMMO_TYPES[3] Player_equip[83]
		setarray AMMO_TYPES[4] Player_equip[84]
		setarray AMMO_TYPES[5] Player_equip[85]
		setarray AMMO_TYPES[6] Player_equip[86]
		setarray AMMO_TYPES[7] Player_equip[87]
		setarray AMMO_TYPES[8] Player_equip[88]
		setarray AMMO_TYPES[9] Player_equip[89]
		setarray AMMO_TYPES[10] Player_equip[90]
		setarray AMMO_TYPES[11] Player_equip[91]
		setarray AMMO_TYPES[12] Player_equip[92]
		setarray AMMO_TYPES[13] Player_equip[93]
		setarray AMMO_TYPES[14] Player_equip[94]
		setarray AMMO_TYPES[15] Player_equip[95]
		
		
		
		set TEMP_WEAPON_MAG Player_equip[100]
		
		set SHOTGUNMAG Player_equip[102]
		set SHOTGUNBOXMAG Player_equip[103]
		
		set ROCKETMAG Player_equip[105]
		set AUTOSHOTMAG Player_equip[106]
		set SLUGSHOTMAG Player_equip[107]
		set RIFLEMAG Player_equip[108]
		set MACHINE_MAG Player_equip[109]
		set ANBMAG Player_equip[110]
		set ALTMAG Player_equip[111]
		
		setp[].curr_weapon Player_equip[119]
		setp[].secret_rooms secret_count[LEVEL]
		getp[].actors_killed TEMP2
		add TEMP2 Player_equip[121]
		setp[].actors_killed TEMP2
		set TEMP 16383
					}
				}
			}
			add TEMP 1
		}
		set pdestination -1
	}
	
}
	
}


ifactor MUSICANDSFX
{
ifn camerasprite -1 sleeptime 0
ifg sprite[].hitag 32767 seta[].hitag 32767
ife sprite[].lotag 74
 ife sprite[].hitag 0
  seta[].hitag 716
  
ifg EXTRASAVED 0
ifpdistl 16192
	{
	ifspritepal 0 gets[].floorzgoal TEMP6 	
	else ifspritepal 2 gets[].ceilingzgoal TEMP6
	ife TEMP6 0 { ifactorsound THISACTOR EXTRASAVED nullop 
	else ifactorsound THISACTOR sprite[].lotag nullop else soundvar EXTRASAVED }
	else ife TEMP6 -1 ifactorsound THISACTOR sprite[].hitag stopactorsound THISACTOR EXTRASAVED
	}

ifspritepal 8
	{
	geta[].x TEMP
	geta[].y TEMP2
	
	sub TEMP skybox_x
	sub TEMP2 skybox_y
	
	ifl TEMP 2048
	ifg TEMP -2048
	ifl TEMP2 2048
	ifg TEMP2 -2048
		{
		ife TEMP3 0
			{
			globalsoundvar sprite[].lotag
			set TEMP3 1
			}
		}
	else ife TEMP3 1
		{
		stopsoundvar sprite[].lotag
		set TEMP3 0
		}
	}

}

ifactor TOUCHPLATE
{
ifspritepal 11
	{
	checkactivatormotion sprite[].lotag
	 ife RETURN 1
		{
		killit
		}
	}
}

ifactor ACTIVATOR
{
ifspritepal 10
	{
	checkactivatormotion sprite[].lotag
		ife RETURN 1
			{
			set FORCEFIELD_TURNOFF sprite[].lotag
			}			
	}
}

ifactor SECTOREFFECTOR
{

ife sprite[].lotag 90
{
ife CONTROL_VR -1
	{
	ifvarvarn screen_pal HITAGSAVED
	set screen_pal HITAGSAVED
	}
}

ife sprite[].lotag 666 // Credits to Dan Gaskil for this code
{
	headspritesect spriteid sprite[].sectnum
	whilevarn spriteid -1
	{
		set TEMP 0
		ife sprite[spriteid].picnum APLAYER
		{
			getuserdef[].god TEMP2
			ife TEMP2 NO
			{
				geta[spriteid].yvel TEMP2
				ife player[TEMP2].dead_flag 0 set TEMP 1
			}
		}
		else set TEMP 1

		ife TEMP 1
		{
			ifvarvarg sprite[spriteid].z initz
			{
			seta[spriteid].htextra 140
			seta[spriteid].htpicnum RADIUSEXPLOSION
			seta[spriteid].htowner spriteid
			seta[spriteid].xrepeat 0
			seta[spriteid].yrepeat 0
			}
		}
		nextspritesect spriteid spriteid
	}
}

ife sprite[].lotag 667 // Credits to Dan Gaskil for this code
{
	headspritesect spriteid sprite[].sectnum
	whilevarn spriteid -1
	{
		set TEMP 0
		ife sprite[spriteid].picnum APLAYER
		{
			geta[spriteid].z mz
				ifvarvarg mz initz
				{
				addphealth -140
				seta[spriteid].htextra 140
				seta[spriteid].htowner spriteid
				}
		}
		else set TEMP 1
		ife TEMP 1
		{
			geta[spriteid].z mz
			ifvarvarg mz initz
			{
			geta[spriteid].statnum TEMP3
			ife TEMP3 1
				{
				ifspritepal 2
					{
					getactorvar[spriteid].MONSTER_FLAGS TEMP4 // check to see if its a lava monster
					ifand TEMP4 16 nullop else
						{
						seta[spriteid].htextra 9999
						seta[spriteid].htowner spriteid
						}
					}
					else
					{
					getactorvar[spriteid].MONSTER_FLAGS TEMP4 // check to see if its a flying monster
					ifand TEMP4 1 ifg sprite[spriteid].extra 0 nullop else
					ifg sprite[spriteid].extra 0
						{
						seta[spriteid].htextra 9999
						seta[spriteid].htowner spriteid
						}
					}
				}
			}
		}
		nextspritesect spriteid spriteid
	}
}

ife sprite[].lotag 668 // Credits to Dan Gaskil for this code; kills everything except specific actors (clouds .etc)
{
	headspritesect spriteid sprite[].sectnum
	whilevarn spriteid -1
	{
		set TEMP 0
		ife sprite[spriteid].picnum APLAYER
		{
			geta[spriteid].z mz
				ifvarvarg mz initz
				{
				seta[spriteid].htowner spriteid
				set DEATH_CAM HITAGSAVED
				}
		}
		else set TEMP 1
		ife TEMP 1
		{
			geta[spriteid].z mz
			ifvarvarg mz initz
			{
			geta[spriteid].statnum TEMP3
			getactorvar[spriteid].SPEC_ACT TEMP4
			ife TEMP3 1
			 ife TEMP4 0
				{
					seta[spriteid].htextra 140
					seta[spriteid].htpicnum RADIUSEXPLOSION
					seta[spriteid].htowner spriteid
					seta[spriteid].xrepeat 0
					seta[spriteid].yrepeat 0
				}
			}
		}
		nextspritesect spriteid spriteid
	}
}

ife sprite[].lotag 669 // Credits to Dan Gaskil for this code; kills and deletes everything in sector when hitag is activated
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	headspritesect spriteid sprite[].sectnum
	whilevarn spriteid -1
	{
		set TEMP 0
		ife sprite[spriteid].picnum APLAYER
		{
			getuserdef[].god TEMP2
			ife TEMP2 NO
			{
				geta[spriteid].yvel TEMP2
				ife player[TEMP2].dead_flag 0 set TEMP 1
			}
		}
		else set TEMP 1
		ife TEMP 1
			{
				seta[spriteid].htextra 9999
				seta[spriteid].htpicnum RADIUSEXPLOSION
				seta[spriteid].htowner spriteid
				seta[spriteid].xrepeat 0
				seta[spriteid].yrepeat 0
			}
		nextspritesect spriteid spriteid
		}
	}
}

ife sprite[].lotag 670 // Credits to Dan Gaskil for this code, kills everything in sector when hitag is activated
{
checkactivatormotion HITAGSAVED
ife RETURN 1
	{
	headspritesect spriteid sprite[].sectnum
	whilevarn spriteid -1
	{
		set TEMP 0
		ife sprite[spriteid].picnum APLAYER
		{
			getuserdef[].god TEMP2
			ife TEMP2 NO
			{
				geta[spriteid].yvel TEMP2
				ife player[TEMP2].dead_flag 0 set TEMP 1
			}
		}
		else set TEMP 1
		ife TEMP 1
			{
			 ifg sprite[spriteid].extra 0
				{
				seta[spriteid].htextra 9999
				seta[spriteid].htpicnum SHOTSPARK1
				seta[spriteid].htowner THISACTOR
				}
			}
		nextspritesect spriteid spriteid
		}
	}
}

ife sprite[].lotag 671 // Credits to Dan Gaskil for this code - will kill player if not in vehicle or non-flying enemies
{
	headspritesect spriteid sprite[].sectnum
	whilevarn spriteid -1
	{
		set TEMP 0
		ife sprite[spriteid].picnum APLAYER
		 ife player_in_vehicle 0
		{	
			geta[spriteid].z mz
				ifvarvarg mz initz
				{
				addphealth -140
				seta[spriteid].htextra 140
				seta[spriteid].htowner spriteid
				}
		}
		else set TEMP 1
		ife TEMP 1
		{
			geta[spriteid].z mz
			ifvarvarg mz initz
			{
			geta[spriteid].statnum TEMP3
			ife TEMP3 1
				{
				getactorvar[spriteid].MONSTER_FLAGS TEMP4
				ifand TEMP4 1 nullop else
					{
					seta[spriteid].htextra 140
					seta[spriteid].htowner spriteid
					}
				}
			}
		}
		nextspritesect spriteid spriteid
	}
}

ife sprite[].lotag 98
{
ifn XVELSAVED -1
	{
	checkactivatormotion XVELSAVED
		ife RETURN 1
			{
			set TEMP8 1
			seta[].lotag 0
			// seta[].statnum 1024
			}
	}
}

ife sprite[].lotag 0
{
ifspritepal 2
	{
	ife TEMP8 0
		{
		checkactivatormotion XVELSAVED
			ife RETURN 1
				set TEMP8 1
		}
	ife TEMP8 1
		{
		gets[].extra TEMP7
		ifl TEMP7 1024
			{
			add TEMP7 16
			sets[].extra TEMP7
			}
		}
	}
ifspritepal 3
	{
	ife TEMP8 0
		{
		checkactivatormotion XVELSAVED
			ife RETURN 1
				set TEMP8 1
		}
	ife TEMP8 1
		{
		gets[].extra TEMP7
		ifl TEMP7 2048
			{
			soundonce TURBINE_ON
			add TEMP7 16
			sets[].extra TEMP7
			}
		else soundonce TURBINE_ACT
		}
	}
ifspritepal 8
	{
	ife TEMP8 0
		{
		soundonce TURBINE_ACT
		checkactivatormotion XVELSAVED
			ife RETURN 1
				set TEMP8 1
		}
	ife TEMP8 1
		{
		gets[].extra TEMP7
		ifg TEMP7 1
			{
			sub TEMP7 8
			sets[].extra TEMP7
			}
		ifl TEMP7 1 
			{ 
			set TEMP7 1
			stopsound TURBINE_ACT
			seta[].lotag 99
			}
		}
	}
ifspritepal 6
	{
	sets[].extra YVELSAVED
	}
ifg EXTRASAVED 0
	{
	checkactivatormotion EXTRASAVED
		ife RETURN 1
			{
			seta[].lotag 99
			// seta[].statnum 1024
			}
	}
}

ife sprite[].lotag 1
{
ifg EXTRASAVED 0
	{
	checkactivatormotion EXTRASAVED
		ife RETURN 1
			{
			seta[].lotag 99
			// seta[].statnum 1024
			}
	}
}

ife sprite[].lotag 25
{
ifg EXTRASAVED 0
	{
	ifvarvare sector[].floorz sector[].ceilingz 
		{
		soundvar EXTRASAVED
		ifspritepal 3 spawn BIG_SMOKE2
		ifpdistl 4096 quake 13
		}
	}
}



ife sprite[].lotag 29
{
ifspritepal 3
	{
	gets[].ceilingstat TEMP2
	ifand TEMP2 2 nullop else { xorvar TEMP2 2 sets[].ceilingstat TEMP2 }
	gets[].floorslope TEMP
	sets[].ceilingslope TEMP
	}
}

ife sprite[].lotag 42
{

ifaction 0
{
ife EXTRASAVED -1 set EXTRASAVED 8
ife EXTRASAVED 0 set EXTRASAVED 8
geta[].x x
geta[].y y
geta[].sectnum TEMP
geta[].ang TEMP3

sin my TEMP3
cos mx TEMP3
geta[].z z

hitscan x y z TEMP mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280
action ZERO
}

ifn hitwall -1
	{

		getwall[hitwall].x TEMP
		getwall[hitwall].y TEMP2

		set TEMP3 sprite[].x
		add TEMP3 EXTRASAVED

		add TEMP4 HITAGSAVED
		ifg TEMP4 2048 set TEMP4 0
		ifl TEMP4 -2048 set TEMP4 0
		
		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
		
		dragpoint hitwall TEMP5 TEMP6
		
	}

}

ife sprite[].lotag 75
{
	checkactivatormotion HITAGSAVED
		ife RETURN 1
		{
		set skybox 1
		killit
		}
}


ife sprite[].lotag 77 // de-activated skybox, to swap with another one
{
	checkactivatormotion YVELSAVED
	ife RETURN 1
		{
		set skybox 2
		seta[].lotag 80
				
		ife PALSAVED 2 nullop else
			{
			geta[].x skybox_x
			geta[].y skybox_y
			}
		geta[].z skybox_z
		updatesectorz skybox_x skybox_y skybox_z skybox_sect
		}
	ifn ZVELSAVED 0 // use this tag to turn the skybox off permanantly
	{
	checkactivatormotion ZVELSAVED
	ife RETURN 1
		{
		seta[].lotag 76
		}
	}
}


ife sprite[].lotag 78 // de-activated skybox, turns off skybox initially
{
set skybox 0
	checkactivatormotion YVELSAVED
	ife RETURN 1
		{
		seta[].lotag 80
				
		ife PALSAVED 2 nullop else
		{
		geta[].x skybox_x
		geta[].y skybox_y
		}
		geta[].z skybox_z
		updatesectorz skybox_x skybox_y skybox_z skybox_sect
		
		}
	ifn ZVELSAVED 0 // use this tag to turn the skybox off permanantly
	{
	checkactivatormotion ZVELSAVED
	ife RETURN 1
		{
		seta[].lotag 76
		}
	}
}

ife sprite[].lotag 79
{
	checkactivatormotion HITAGSAVED
		ife RETURN 1
		{
		ifg skybox 0 set skybox 0 else
		ife skybox 0 
			{
			ifspritepal 0 set skybox 1
			else ifspritepal 1 set skybox 2
			}
		}
}

ife sprite[].lotag 80 // skybox
{
sleeptime 0
ifn XVELSAVED 0 // turn off skybox with XVEL (turn on again with YVEL)
	{
	checkactivatormotion XVELSAVED
	ife RETURN 1
		{
		ife PALSAVED 3
			{
			seta[].lotag 77
			}
		else
			{
			set skybox 0
			seta[].lotag 78
			}
		}
	}

ife PALSAVED 0 set skybox 1 else
ife PALSAVED 1 // skybox that moves with player
	{
	ife HITAGSAVED 0 set skybox_scale 64 else
	set skybox_scale HITAGSAVED
	set skybox 2
	}
	else
ife PALSAVED 2 // rotating skybox
	{
		geta[].x TEMP
		geta[].y TEMP2
		
		set TEMP3 TEMP
		add TEMP3 HITAGSAVED

		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP9 skybox_x skybox_y
		
		ifg TEMP9 2048 sub TEMP9 2048
		seta[].ang TEMP9
		
		getp[].ang TEMP6
		add TEMP6 TEMP9

		set skybox_angle TEMP6
		add TEMP9 2
	set skybox 3
	}
else
ife PALSAVED 3 // skybox that moves with player
	{
	ife HITAGSAVED 0 set skybox_scale 64 else
	set skybox_scale HITAGSAVED
	set skybox 2
	}
	else
ife PALSAVED 8
	{
	ife HITAGSAVED 0 set skybox_scale 64 else
	set skybox_scale HITAGSAVED
	set skybox 2
	geta[].z TEMP
	add TEMP 128
	seta[].z TEMP
	}

	
ife PALSAVED 2 nullop else
{
geta[].x skybox_x
geta[].y skybox_y
}
geta[].z skybox_z
updatesectorz skybox_x skybox_y skybox_z skybox_sect

ife NO_SKYBOX YES ifn EXTRASAVED -1 set skybox 0 // if skyboxes are off and a backup pic is set, turn the skybox off

}

ife sprite[].lotag 81
{
gets[skybox_sect].floorshade skybox_shade
mulvar skybox_shade 3
sets[].visibility skybox_shade
}

ife sprite[].lotag 82 // Anchor
{
set skybox_id THISACTOR
}

ife sprite[].lotag 84 // Shiny wall
{

ifaction 0
	{
	geta[].x x
	geta[].y y
	geta[].sectnum TEMP
	geta[].ang TEMP3

	sin my TEMP3
	cos mx TEMP3
	geta[].z z

	hitscan x y z TEMP mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280
	action ZERO
	}

ifn hitwall -1
{

	getwall[hitwall].xpanning TEMP2
	sub TEMP2 HITAGSAVED
	
	getwall[hitwall].ypanning TEMP2
	sub TEMP2 HITAGSAVED
	
	getp[].i target
	dist xydist THISACTOR target
	shiftvarr xydist 6
	ifl xydist 8 set xydist 8
	add xydist 32
	ifg xydist 128 set xydist 128
	set TEMP 128
	sub TEMP xydist
	ifg TEMP 120 set TEMP 120
	// setwall[hitwall].xrepeat TEMP
	// divvar TEMP 4
	// setwall[hitwall].yrepeat TEMP
	
	getp[].ang TEMP2
	geta[].ang TEMP3
	sub TEMP2 TEMP3
	divvar TEMP2 2
	setwall[hitwall].xpanning TEMP2
	// setwall[hitwall].ypanning TEMP2
	
}

}

ife sprite[].lotag 69
{
	ifvarvare player[].cursectnum sprite[].sectnum state SEHUBSTATE
	else set WAIT NO
}

ife sprite[].lotag 6
	{
	ife TEMP8 2 // if train was at top speed this means it's slowing down to stop
	 ifl sprite[].xvel 250 // if it's slowing down
	  ifg sprite[].xvel 5 // if it hasn't stopped though
	 {
	 ifspritepal 0 soundonce SUBTRAIN_STOP
	 else ifspritepal 8 soundonce CARS_STOP
	 else ifspritepal 11 soundonce PALACE_DOOR2
	 }
	 else
	ifg sprite[].xvel 5
		{	
			ifspritepal 3
				{
				ife TEMP8 0 { globalsound TRAIN_WHISTLE set TEMP8 1 }
				ifactorsound THISACTOR TRAIN_AMB nullop else sound TRAIN_AMB
				}
			else ifspritepal 9 soundonce BOAT_RUN
			else ifspritepal 7 soundonce BIG_DRILL_IDLE
			else ifspritepal 8
				{
				ife TEMP8 0 { soundonce CARS_START set TEMP8 1 }
				ifactorsound THISACTOR VEH_RUN2 nullop else sound VEH_RUN2
				ifg sprite[].xvel 250 set TEMP8 2 // if at top speed, set var
				}
			else ifspritepal 2 soundonce BUBBLE_AMBIENCE
			else ifspritepal 0 
				{
				ife TEMP8 0 { soundonce SUBTRAIN_START set TEMP8 1 }
				ifactorsound THISACTOR SUBWAY_S nullop else sound SUBWAY_S
				ifg sprite[].xvel 250 set TEMP8 2 // if at top speed, set var
				}
		}
	else 
		{
		ifspritepal 9 soundonce BOAT_IDLE
		else ifspritepal 3
			{
			ife TEMP8 1 { ifactorsound THISACTOR TRAIN_AMB stopactorsound THISACTOR TRAIN_AMB globalsound TRAIN_WHISTLE set TEMP8 0 }	
			}
		else ifspritepal 0 ife TEMP8 2 { ifactorsound THISACTOR SUBWAY_S stopactorsound THISACTOR SUBWAY_S set TEMP8 0 }
		}
	}
	
ife sprite[].lotag 14
	{
	ifg sprite[].xvel 5
		{	
			ifspritepal 3 { ifactorsound THISACTOR TRAIN_AMB nullop else sound TRAIN_AMB }
			else ifspritepal 9 soundonce BOAT_RUN
			else ifspritepal 7 soundonce BIG_DRILL_IDLE
			else ifspritepal 2 soundonce BUBBLE_AMBIENCE
			else ifspritepal 0 { ifactorsound THISACTOR SUBWAY_S nullop else sound SUBWAY_S }
		}
	else 
		{
		ifspritepal 9 soundonce BOAT_IDLE
		else ifspritepal 3 { ifactorsound THISACTOR TRAIN_AMB stopactorsound THISACTOR TRAIN_AMB }
		else ifspritepal 0 { ifactorsound THISACTOR SUBWAY_S stopactorsound THISACTOR SUBWAY_S }
		}
	}
	
ife sprite[].lotag 30
	{
	ife TEMP8 2 // if train was at top speed this means it's slowing down to stop
	 ifl sprite[].xvel 250 // if it's slowing down
	  ifg sprite[].xvel 5 // if it hasn't stopped though
	 {
	 ifspritepal 0 soundonce SUBTRAIN_STOP
	 else ifspritepal 8 soundonce CARS_STOP
	 else ifspritepal 11 soundonce PALACE_DOOR2
	 }
	 else
	ifg sprite[].xvel 5
		{	
			ifspritepal 3
				{
				ife TEMP8 0 { globalsound TRAIN_WHISTLE set TEMP8 1 }
				ifactorsound THISACTOR TRAIN_AMB nullop else sound TRAIN_AMB
				}
			else ifspritepal 9 soundonce BOAT_RUN
			else ifspritepal 7 soundonce BIG_DRILL_IDLE
			else ifspritepal 8
				{
				ife TEMP8 0 { soundonce CARS_START set TEMP8 1 }
				ifactorsound THISACTOR VEH_RUN2 nullop else sound VEH_RUN2
				ifg sprite[].xvel 250 set TEMP8 2 // if at top speed, set var
				}
			else ifspritepal 2 soundonce BUBBLE_AMBIENCE
			else ifspritepal 11 
				{
				ife TEMP8 0 { soundonce PALACE_DOOR1 set TEMP8 1 }
				ifg sprite[].xvel 250 set TEMP8 2 // if at top speed, set var
				}
			else ifspritepal 0 
				{
				ife TEMP8 0 { soundonce SUBTRAIN_START set TEMP8 1 }
				ifactorsound THISACTOR SUBWAY_S nullop else sound SUBWAY_S
				ifg sprite[].xvel 250 set TEMP8 2 // if at top speed, set var
				}
		}
	else 
		{
		ifspritepal 9 soundonce BOAT_IDLE
		else ifspritepal 3
			{
			ife TEMP8 1 { ifactorsound THISACTOR TRAIN_AMB stopactorsound THISACTOR TRAIN_AMB globalsound TRAIN_WHISTLE set TEMP8 0 }	
			}
		else ifspritepal 0 ife TEMP8 2 { ifactorsound THISACTOR SUBWAY_S stopactorsound THISACTOR SUBWAY_S set TEMP8 0 }
		}
	}


	ife sprite[].lotag 31
		{
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
				ife EXTRASAVED 1 { ife TEMP2 0 quote 400 set TEMP2 1 }
				ife EXTRASAVED 2 { ife TEMP2 0 quote 401 set TEMP2 1 }
				ife EXTRASAVED 3 { ife TEMP2 0 quote 403 set TEMP2 1 }
				ife XVELSAVED 1
					{
					sets[].floorslope 0
					gets[].floorstat TEMP3
					ifand TEMP3 2 { xorvar TEMP3 2 sets[].floorstat TEMP3 }
					}
			}
		}

	ife sprite[].lotag 32
		{
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
				ife EXTRASAVED 1 { ife TEMP2 0 quote 402 set TEMP2 1 }
				ife EXTRASAVED 2 { ife TEMP2 0 quote 401 set TEMP2 1 }
			}
		}
		
	ife sprite[].lotag 46
		{
			ifvarvare player[].cursectnum sprite[].sectnum
			{
			ifp ponground
				{
				ifspritepal 0 soundonce WIND_FLY
				set TEMP3 HITAGSAVED
				mulvar TEMP3 -1
				setp[].poszv TEMP3
				}
			}

		}
		
	ife sprite[].lotag 47 
		{
			ifvarvare player[].cursectnum sprite[].sectnum
			{
			ifp ponground
				{
				ifspritepal 0 soundonce WIND_FLY
				geta[].ang TEMP
				set knockbackang TEMP
				set TEMP3 HITAGSAVED
				mulvar TEMP3 -1
				set knockbackheight TEMP3
				set knockback2 1
				}
			}

		}


	ife sprite[].lotag 71 
		{
		ife TEMP2 0 
			{ 
			gets[].floorpicnum TEMP7 
			gets[].floorshade TEMP8
			geta[].z TEMP3
			gets[].floorz TEMP4
			sets[].floorz TEMP3
			set TEMP2 1 
			}

		getp[].cursectnum TEMP5
		geta[].sectnum TEMP6
			ifvarvare TEMP5 TEMP6
			{
			ifp ponground
				{
				gets[].floorz TEMP5
				ifvarvare TEMP4 TEMP5 nullop
				 else 
					{ 
					add TEMP5 250 
					sets[].floorz TEMP5 
					ifvarvarg TEMP5 TEMP4
						{
						sets[].floorz TEMP4
						sets[].floorpicnum HITAGSAVED
						geta[].ang TEMP6
						ife TEMP6 512 sets[].lotag 1
						geta[].pal TEMP6
						ifn TEMP6 0 sets[].floorpal TEMP6
						geta[].shade TEMP6
						sets[].floorshade TEMP6
						}
					}
				}
			}
			else
			{
			geta[].extra TEMP5
			ifn TEMP5 1
			{
			gets[].floorz TEMP5
			ifvarvarg TEMP5 TEMP3
				{
				sub TEMP5 64
				sets[].floorz TEMP5
				}
			gets[].floorpicnum TEMP5
			ifvarvarn TEMP5 TEMP7
				{
				sets[].floorshade TEMP8
				sets[].floorpicnum TEMP7
				geta[].ang TEMP6
				ife TEMP6 512 sets[].lotag 0
				} 
			}
			}

		}

ife sprite[].lotag 51 
		{
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
				ife ZVELSAVED 1
					{
					globalsound SLAB_FALL
					quake 13
					// shoot ROCKDEB1
					spawn BIG_SMOKE2 spawn BIG_SMOKE2
					set ZVELSAVED 0
					}
				ifn EXTRASAVED -1 sets[].floorpicnum EXTRASAVED
				geta[].ang TEMP6
				ife TEMP6 512 sets[].lotag 0
				ife TEMP6 1024 sets[].lotag 1
				geta[].pal TEMP6
				ifn TEMP6 0 sets[].floorpal TEMP6
				geta[].shade TEMP6
				sets[].floorshade TEMP6
				geta[].xvel TEMP6
				ife XVELSAVED 1
					{
					gets[].floorstat TEMP7
					orvar TEMP7 8
					sets[].floorstat TEMP7
					}
				ife XVELSAVED 2
					{
					sets[].lotag 1
					sets[].floorstat 3584
					geta[].cstat TEMP4
					ifand TEMP4 514 sets[].floorstat 3968
					else sets[].floorstat 3840
					}
				ife XVELSAVED 3
					{
					gets[].floorstat TEMP7
					ifand TEMP7 1 xorvar TEMP7 1
					sets[].floorstat TEMP7
					}
				ifand CSTATSAVED 2
					{
					gets[].floorstat TEMP7
					orvar TEMP7 64
					sets[].floorstat TEMP7					
					}
				ifand CSTATSAVED 4
					{
					sets[].floorxpanning sprite[].xrepeat
					sets[].floorypanning sprite[].yrepeat	
					}
				ifand CSTATSAVED 8
					{
					gets[].floorstat TEMP7
					ifand TEMP7 2 xorvar TEMP7 2
					sets[].floorstat TEMP7
					sets[].floorslope 0
					}
				ife YVELSAVED 1 sets[].visibility 244
			}

		}
		
ife sprite[].lotag 58
		{
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
				geta[].extra TEMP5
				sets[].ceilingpicnum TEMP5
				geta[].ang TEMP6
				ife TEMP6 512 sets[].lotag 0
				ife TEMP6 1024 sets[].lotag 1
				geta[].pal TEMP6
				ifn TEMP6 0 sets[].ceilingpal TEMP6
				geta[].shade TEMP6
				sets[].ceilingshade TEMP6
				geta[].xvel TEMP6
				ife TEMP6 1
					{
					gets[].ceilingstat TEMP7
					orvar TEMP7 8
					sets[].ceilingstat TEMP7
					}
				ife TEMP6 2
					{
					sets[].lotag 2
					sets[].ceilingstat 3968
					geta[].cstat TEMP4
					ifand TEMP4 514 sets[].ceilingstat 3968
					else sets[].ceilingstat 3840
					}
				ife TEMP6 3
					{
					gets[].ceilingstat TEMP7
					orvar TEMP7 1
					sets[].ceilingstat TEMP7
					}
				ife YVELSAVED 1 sets[].visibility 244
			}

		}

ife sprite[].lotag 52 
		{
		ife TEMP2 0 
			{ 
			gets[].floorpicnum TEMP7 
			gets[].floorshade TEMP8
			geta[].z TEMP3
			set TEMP2 1 
			}

			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
				ife sprite[].z sector[].floorz
				{
				sets[].floorpicnum EXTRASAVED
				geta[].ang TEMP6
				ife TEMP6 512 sets[].lotag 0 
				else ife TEMP6 1024 sets[].lotag 1
				geta[].pal TEMP6
				ifn TEMP6 0 sets[].floorpal TEMP6
				ifn YVELSAVED 0
					{
					gets[].floorslope TEMP7
					ifvarvare YVELSAVED TEMP7 sets[].floorslope 0
					else sets[].floorslope YVELSAVED
					}
				ife XVELSAVED 1
					{
					gets[].floorstat TEMP7
					orvar TEMP7 8
					sets[].floorstat TEMP7
					}
				ife XVELSAVED 2
					{
					gets[].floorstat TEMP7
					orvar TEMP7 1
					sets[].floorstat TEMP7
					}
				ife XVELSAVED 3
					{
					sets[].floorstat 1664
					}
				geta[].shade TEMP6
				sets[].floorshade TEMP6
				sets[].visibility ZVELSAVED
				}
			}

		}


ife sprite[].lotag 53 
		{
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
			ife TEMP2 0
				{
				ifn sector[].lotag 2 sets[].lotag 2 else
					{
					ife sprite[].ang 512 nullop else
					sets[].lotag 0
					}
				set TEMP2 1
				}
			}
			else ife RETURN 0 set TEMP2 0
		}
		
ife sprite[].lotag 54
	{
		checkactivatormotion HITAGSAVED
		ife RETURN 1
		{
			geta[].x x
			geta[].y y
			geta[].sectnum TEMP
			geta[].ang TEMP3

			sin my TEMP3
			cos mx TEMP3
			geta[].z z

			hitscan x y z TEMP mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280

			ifn hitwall -1
			{
			ife ZVELSAVED 1 
				{
				getwall[hitwall].cstat TEMP4
				ifand TEMP4 1 xorvar TEMP4 1
				setwall[hitwall].cstat TEMP4
				}
			ife EXTRASAVED 0
				{
				geta[].pal TEMP2
				ifn TEMP2 0 setwall[hitwall].pal TEMP2
				geta[].shade TEMP3
				ifn TEMP3 0 setwall[hitwall].shade TEMP3
				}
			else
			ifn EXTRASAVED -1
				{
				setwall[hitwall].picnum EXTRASAVED
				geta[].pal TEMP2
				setwall[hitwall].pal TEMP2
				geta[].shade TEMP3
				setwall[hitwall].shade TEMP3
				}

			ifn YVELSAVED 0
				{
				getwall[hitwall].cstat TEMP4
				ifand TEMP4 16 nullop else { xorvar TEMP4 16 setwall[hitwall].cstat TEMP4 }
				setwall[hitwall].overpicnum YVELSAVED
				geta[].pal TEMP2
				ifn TEMP2 0 setwall[hitwall].pal TEMP2
				geta[].shade TEMP3
				ifn TEMP3 0 setwall[hitwall].shade TEMP3
				}				
			}
		}
	}
	
ife sprite[].lotag 55 
		{
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			{
				geta[].extra TEMP5
				ifn TEMP5 -1 sets[].ceilingpicnum TEMP5
				geta[].pal TEMP6
				ifn TEMP6 0 sets[].ceilingpal TEMP6
				geta[].shade TEMP6
				ifn TEMP6 0 sets[].ceilingshade TEMP6
				geta[].xvel XVELSAVED
				ife XVELSAVED 3
				{
				gets[].ceilingstat TEMP7
				orvar TEMP7 1
				sets[].ceilingstat TEMP7
				}
				
			}

		}
		
ife sprite[].lotag 56 
		{
			checkactivatormotion HITAGSAVED
			ife RETURN 1
			ifn sprite[].sectnum -1
			 ifn sprite[].sectnum 4096
			{
			sets[].lotag EXTRASAVED
			}

		}
		
ife sprite[].lotag 57 // change texture if z exceeds floor or whatever
	{
	ife TEMP2 0 
				{ 
				gets[].floorpicnum TEMP7 
				gets[].floorshade TEMP8
				geta[].z TEMP3
				set TEMP2 1 
				}

				checkactivatormotion HITAGSAVED
				ife RETURN 1
				{
					ifg sector[].floorz sprite[].z 
					{
					sets[].floorpicnum EXTRASAVED
					geta[].ang TEMP6
					ife TEMP6 512 sets[].lotag 0 
					else ife TEMP6 1024 sets[].lotag 1
					geta[].pal TEMP6
					ifn TEMP6 0 sets[].floorpal TEMP6
					ifn YVELSAVED 0
						{
						gets[].floorslope TEMP7
						ifvarvare YVELSAVED TEMP7 sets[].floorslope 0
						else sets[].floorslope YVELSAVED
						}
					ife XVELSAVED 1
						{
						gets[].floorstat TEMP7
						orvar TEMP7 8
						sets[].floorstat TEMP7
						}
					ife XVELSAVED 2
						{
						gets[].floorstat TEMP7
						orvar TEMP7 1
						sets[].floorstat TEMP7
						}
					geta[].shade TEMP6
					sets[].floorshade TEMP6
					sets[].visibility ZVELSAVED
					}
				}
	}
	
ife sprite[].lotag 60 // sector attribute copier
	{
	checkactivatormotion EXTRASAVED
	ife RETURN 1
		{
		headspritestat spriteid 3
		whilevarn spriteid -1
			{
			ife sprite[spriteid].picnum 1
			 ife sprite[spriteid].lotag 61
			  ife sprite[spriteid].hitag sprite[].hitag
					{
					geta[spriteid].sectnum TEMP
					sets[].visibility sector[TEMP].visibility
					sets[].hitag sector[TEMP].hitag
					sets[].lotag sector[TEMP].lotag
					sets[].floorpal sector[TEMP].floorpal
					sets[].floorpicnum sector[TEMP].floorpicnum
					sets[].floorshade sector[TEMP].floorshade
					sets[].floorslope sector[TEMP].floorslope
					sets[].floorstat sector[TEMP].floorstat
					sets[].floorxpanning sector[TEMP].floorxpanning
					sets[].floorypanning sector[TEMP].floorypanning
					sets[].floorz sector[TEMP].floorz
					
					sets[].ceilingpal sector[TEMP].ceilingpal
					sets[].ceilingpicnum sector[TEMP].ceilingpicnum
					sets[].ceilingshade sector[TEMP].ceilingshade
					sets[].ceilingslope sector[TEMP].ceilingslope
					sets[].ceilingstat sector[TEMP].ceilingstat
					sets[].ceilingxpanning sector[TEMP].ceilingxpanning
					sets[].ceilingypanning sector[TEMP].ceilingypanning
					sets[].ceilingz sector[TEMP].ceilingz
					set spriteid -1
					}
				ifn spriteid -1 nextspritestat spriteid spriteid
			}
		}
	}

}

ifactor BULLETHOLE
	{
	ifaction 0
		{
		geta[].owner TEMP
		geta[TEMP].extra TEMP2
		divvar TEMP2 4
		ifl TEMP2 4 set TEMP2 4 // sets a minimum size
		ifg TEMP2 16 set TEMP2 16 // sets a maximum size
		seta[].xrepeat TEMP2
		seta[].yrepeat TEMP2
		cstator 192
		ifrnd 128 cstator 8
		action ZERO		
		}
	}

// EVENT_GAME SWITCH STATEMENT

switch sprite[].picnum
case GASBURST
	ifspawnedby APLAYER ifpdistl 1024 cstat 32768 else cstat 130
	break
case 22442
	ifpdistl 2048 cstat 32768
	else cstat 2
	break
case MICRO_MISSILE
	ifspawnedby PITFIEND
		{
		setactor[].extra 20
		setthisprojectile[].extra 20
		}
	ifspawnedby CYBERALIEN
		{
		setactor[].extra 20
		setthisprojectile[].extra 20
		}
	ifspawnedby CYBERTOUR
		{
		setactor[].extra 20
		setthisprojectile[].extra 20
		}
	ifspawnedby HPOWERSUIT
		{
		setactor[].extra 20
		setthisprojectile[].extra 20
		}	
break
case 14644 // Cycloid plasma
	spawn PROJECTILE_FLARE
	ifspawnedby APLAYER
	 ifn player_in_vehicle 0
		{
		setactor[].extra 800
		setthisprojectile[].extra 800
		}
break
case RUBYBLAST
	ifspawnedby PE_ELDER
		{
		setactor[].extra 30
		setthisprojectile[].extra 30
		}	
break
case 12782
	action ANUBIS_AXE_FRAMES
	ifactorsound THISACTOR PROJ_FLY nullop else sound PROJ_FLY
break
case SPELL2
case REDM_BLAST
case BLOOD_BLAST
	ifactorsound THISACTOR LBALL_FLY nullop else sound LBALL_FLY
break
case 1404
	ifand ZVELSAVED 1 seta[].z ZPOS_SAVED
break
case COFFEEMUG
case JOLLYMEAL
case 4546
case 4547
case 4548
	ife EXTRASAVED 1 
		{
		seta[].z ZPOS_SAVED
		}
break
case OOZ2
	ifcount 512
	killit
break
case RESPAWN
	geta[].extra EXTRASAVED
	geta[].yvel YVELSAVED
	ifn YVELSAVED 0
		{
		getuserdef[].player_skill SKILL_LEVEL
		ifvarvarg YVELSAVED SKILL_LEVEL killit
		}
	break
case FORCERIPPLE
sizeat 8 8
break
case SPARK
case SPARK2
	seta[].cstat 514
	seta[].blend 255
break
case SWOODSCRAP
case WOODSCRAP
case ICE_DEBRIS
case ROCKDEB1
case ROCKDEB3
case ROCKDEB4
case SROCKDEB4
case SLIMEPROJ
case CLUSTER_BOMB
case CLUSTER_BOMB2
	seta[].mdflags 16
break
case FIRSTGUNSPRITE
case SHOTGUNSPRITE
case CHAINGUNSPRITE
case RPGSPRITE
// case HEAVYHBOMB
case SHRINKERSPRITE
case TRIPBOMBSPRITE
case DEVISTATORSPRITE
case FREEZESPRITE
case AMMO
case SHOTGUNAMMO
case BATTERYAMMO
case RPGAMMO
case HBOMBAMMO
case CRYSTALAMMO
case GROWAMMO
case DEVISTATORAMMO
case FREEZEAMMO
case SHIELD
case FIRSTAID
case STEROIDS
case AIRTANK
case HEATSENSOR
case JETPACK
case BOOTS
case HOLODUKE
changespritestat THISACTOR 1
break
case 2930 // Letters for Rusty's shades
case 2931
case 2932
case 2933
case 2934
case 2935
case 2936
case 2937
case 2938
case 2939
case 2940
case 2941
case 2942
case 2943
case 2944
case 2945
case 2946
case 2947
case 2948
case 2949
case 2950
case 2951
case 2952
case 2953
case 2954
case 2955
case 2956
case 2957
case 2958
case 2959
case 2960
case 2961
case 2962
case 2963
case 2964
case 2965
geta[].yvel TEMP
ife TEMP 1
	{
	ife CHAR 5
	 {
	 getp[].heat_on TEMP2
	 ife TEMP2 1
		{
		cstat 16
		}
	 else cstat 32768
	 }
	 else cstat 32768
	}
break
case JIBS1
case JIBS2
case JIBS3
case JIBS4
case JIBS5
case JIBS6
case LIZMANHEAD1 
case LIZMANARM1
case LIZMANLEG1
case HEADJIB1
case ARMJIB1
case LEGJIB1
case HUMAN_TORSO
ife TIMEZONE 8 { spawn 6142 spawn 6142 spawn 6142 killit }
state getceildist
ifl z 0 
 ifn TEMP4 -1
	{
	ifn sector[].ceilingslope 0 killit
	ifinwater killit
	espawn 2284
	seta[RETURN].pal sprite[].pal
	setactorvar[RETURN].TEMP4 1
	killit
	}
iffloordistl 8
	{
	ifactor JIBS6 sound BLOOD_SPURT else { ifrnd 128 sound GIB_LAND2 else sound GIB_LAND1 }
	changespritestat THISACTOR 1
	state rf
	ifmultiplayer nullop else 
		{
		espawn 2284
		seta[RETURN].pal sprite[].pal
		}
	ifactor JIBS1 seta[].picnum 2249
	ifactor JIBS2 seta[].picnum 2254
	ifactor JIBS3 seta[].picnum 2259
	ifactor JIBS4 seta[].picnum 2264
	ifactor JIBS5 seta[].picnum 2269
	ifactor JIBS6 seta[].picnum 2284
	ifactor LIZMANHEAD1 seta[].picnum 2214
	ifactor LIZMANARM1 seta[].picnum 2215
	ifactor LIZMANLEG1 seta[].picnum 2216
	ifactor HEADJIB1 seta[].picnum 1769
	ifactor ARMJIB1 seta[].picnum 1773
	ifactor LEGJIB1 seta[].picnum 1777
	ifactor HUMAN_TORSO seta[].picnum 1519
	ifactor HUMAN_ARM seta[].picnum 1534
	}
break
case BRUISERFIREBALL
	ifactorsound THISACTOR FBALL_FLY nullop else sound FBALL_FLY
	spawn PROJECTILE_FLARE
break
case 7163
case 7159
case SPELL4
case SPELL5
case SPELL14
case SHRINKSPARK
case 9376
case PRIEST_BLAST
case LAVABALL
case HEAT_SINK
case 9115
case 12712
	spawn PROJECTILE_FLARE
break
case HOMING_MISSILE

	ifspawnedby SCORPIONESS
		{
		setactor[].extra 25
		setthisprojectile[].extra 25
		}
	ifspawnedby CYBERALIEN
		{
		setactor[].extra 25
		setthisprojectile[].extra 25
		}
	ifspawnedby CYBERTOUR
		{
		setactor[].extra 25
		setthisprojectile[].extra 25
		}

			ifspawnedby APLAYER
				{
				add INTERNALCOUNT 1
				ifg INTERNALCOUNT 10
					{
					state botfindtarget
					ifn target -1
						{
							ifn player_in_vehicle 1 ifcansee set PLAYER_VOICEOVER 22
							soundonce HEAT_SEEK
							geta[target].x mx
							geta[target].y my
							geta[].x x
							geta[].y y
							sub mx x
							sub my y
							getangle ANGVAR mx my
							seta[].ang ANGVAR 
							ldist TEMP THISACTOR target
							geta[].z TEMP2
							sub TEMP2 8192 // Offset the Z. Assumes the center of the actor is the same as the player
							geta[target].z TEMP3
							sub TEMP3 8592 // Offset the Z. assumes the center of the actor is the same as the player
							sub TEMP3 TEMP2
							shiftvarl TEMP3 8
							ifn TEMP 0 divvarvar TEMP3 TEMP
							seta[].zvel TEMP3
						}
					set INTERNALCOUNT 0
					}
				}
			else
				{
				ifpdistg 2048 
				 ife TEMP8 0
					{
					ifrnd 8 soundonce HEAT_SEEK
					getp[].posx mx
					getp[].posy my
					geta[].x x
					geta[].y y
					sub mx x
					sub my y
					getangle ANGVAR mx my
					seta[].ang ANGVAR
					getp[].posz TEMP2
					geta[].z TEMP
					ifvarvarl TEMP TEMP2 { add TEMP 40 seta[].z TEMP }
					ifvarvarg TEMP TEMP2 { sub TEMP 40 seta[].z TEMP }
					}
					else
					set TEMP8 1
				}
break
case 6221
case HADESBLASTH
case 12717
		spawn PROJECTILE_FLARE
		ifactorsound THISACTOR FBALL_FLY nullop else sound FBALL_FLY
		ifpdistl 4096 set TEMP3 1
		ifactor 6221
			{
			seta[].blend 255
			seta[].shade -127
			}
		ifn TEMP3 1
			{
			getp[].posx mx
			getp[].posy my
			geta[].x x
			geta[].y y
			sub mx x
			sub my y
			getangle ANGVAR mx my
			seta[].ang ANGVAR
			getp[].posz TEMP2
			geta[].z TEMP
			ifvarvarl TEMP TEMP2 { add TEMP 40 seta[].z TEMP }
			ifvarvarg TEMP TEMP2 { sub TEMP 40 seta[].z TEMP }
			}
break
case SPACEDOORSWITCH
	ife CHARSELECT 0
	ife EXTRASAVED 1
		{
		ifn CHAR 2 killit
		}
break
case 7047
case 7052
case 22828
case 15175
	cstat 130
	seta[].blend 255
	spawn PROJECTILE_FLARE
	seta[].shade -127
	shoot SPARK
break
case 3622
	soundonce DYNAMITEFUSE
	shoot SPARK2
break
case DYNAMITESTICK
	soundonce DYNAMITEFUSE
	shoot SPARK
break
case RAINSPRITE
	sleeptime 0
break
case BOTTLE4
ifpdistl 812
ifp palive
   ifp pfacing
    ifhitspace
     ifl INEBRIATION 800
	{
	quote 134
	sound DRINKSOME
  	palfrom 16 0 32
	ife CHAR 3 addphealth 5 else addphealth 2
      ife CHAR 0 add INEBRIATION 100
	ife CHAR 1 add INEBRIATION 150
      ife CHAR 2 add INEBRIATION 50
      ife CHAR 3 add INEBRIATION 25
      ife CHAR 4 add INEBRIATION 200
	ife CHAR 5 add INEBRIATION 150
      ife CHAR 6 add INEBRIATION 150
	ife CHAR 7 add INEBRIATION 100
	ife CHAR 9 add INEBRIATION 25
	ife CHAR 10 add INEBRIATION 25
	ife CHAR 11 add INEBRIATION 50
	ife CHAR 12 add INEBRIATION 100
	ife CHAR 13 add INEBRIATION 300
	ife CHAR 14 add INEBRIATION 10
	killit
	}
  break
 case BOTTLE3
 case BOTTLE13
case BOTTLE14
case BOTTLE15
case BOTTLE16
case BOTTLE17
case BOTTLE18 
ifpdistl 812
ifp palive
   ifp pfacing
    ifhitspace
     ifl INEBRIATION 600
	{
	quote 134
	sound DRINKSOME
  	palfrom 16 0 32
	addphealth 2
      ife CHAR 0 add INEBRIATION 100
	ife CHAR 1 add INEBRIATION 150
      ife CHAR 2 add INEBRIATION 50
      ife CHAR 3 add INEBRIATION 100
      ife CHAR 4 add INEBRIATION 200
	ife CHAR 5 add INEBRIATION 150
      ife CHAR 6 add INEBRIATION 150
	ife CHAR 7 add INEBRIATION 100
	ife CHAR 9 add INEBRIATION 25
	ife CHAR 10 add INEBRIATION 25
	ife CHAR 11 add INEBRIATION 50
	ife CHAR 12 add INEBRIATION 100
	ife CHAR 13 add INEBRIATION 300
	ife CHAR 14 add INEBRIATION 10
	killit
	}
  break
 case 22610
 case 22536
 case 6204
   state littlerandtraj
  break
 case RPG
    ifspawnedby APLAYER
	{
	ife CHAR 1
	ife CURWEAP 7
	 ife SPECIALIST_EQUIPMENT[52] 2
	 {
	 spawn 3296
	state littlerandtraj
	 }
	ife CHAR 13
	ife CURWEAP 4
	ifn tracker -1
		{
		iffloordistl 8 set tracker -1
		add INTERNALCOUNT 1
		ifl INTERNALCOUNT 150
			{
			set mx p_hitx
			set my p_hity
			geta[].x x
			geta[].y y
			sub mx x
			sub my y
			getangle ANGVAR mx my
			seta[].ang ANGVAR 		

			ifn tracker -1 
				{
				soundonce RED_COMPBEEP
				ldist TEMP THISACTOR tracker
				geta[].z TEMP2
				sub TEMP2 8192 // Offset the Z. Assumes the center of the actor is the same as the player
				geta[tracker].z TEMP3
				sub TEMP3 8592 // Offset the Z. assumes the center of the actor is the same as the player
				sub TEMP3 TEMP2
				shiftvarl TEMP3 8
				ifn TEMP 0 divvarvar TEMP3 TEMP
				seta[].zvel TEMP3
				}
			}
		}
	ife CURWEAP 0
	 ife temp_weapon 16
		{
		spawn GUNSMOKE
		}
	}
    ifspawnedby BOSS3
	{
	geta[].owner TEMP
	geta[TEMP].pal TEMP2
	 ifn TEMP2 0 { sizeat 20 20 }
	}
    ifspawnedby BOSS5
	{
	sizeat 20 20
	}
     ifspawnedby COMMANDER
	{
	geta[].owner TEMP
	geta[TEMP].pal TEMP2
	 ife TEMP2 20 { sizeat 14 14 }
	}
	gets[].floorpal TEMP
	seta[].pal TEMP
  break
 case BLOODPOOL
  	gets[].floorpal TEMP
	ife TEMP 1 seta[].pal TEMP
	ifspawnedby PE_SENTRY killit
	break
 case DYNAMITEBUNDLE
 geta[].owner myowner
 ifspawnedby APLAYER
 {
ife CURWEAP 10
 ife KICKBACKPIC 3
			{
			ifpdistl 4096 quake 13
			spawn EXPLOSION2
			globalsound PIPEBOMB_EXPLODE
			hitradius PIPEBOMBRADIUS 80 90 100 HANDBOMB_WEAPON_STRENGTH
			killit
			}
}
   break
 case MC_GRENADE
 geta[].owner myowner
 ifspawnedby APLAYER
 {
ife CURWEAP 10
 ife KICKBACKPIC 3
			{
			ifpdistl 4096 quake 13
			spawn EXPLOSION2
			globalsound PIPEBOMB_EXPLODE
			hitradius PIPEBOMBRADIUS 80 90 100 HANDBOMB_WEAPON_STRENGTH
			killit
			}
}
   break
 case DYNAMITEONFLOOR
 geta[].owner myowner
	 ifspawnedby APLAYER
	 {
ife CURWEAP 10
	 ife KICKBACKPIC 3
				{
				ifpdistl 4096 quake 13
				spawn EXPLOSION2
				globalsound PIPEBOMB_EXPLODE
				hitradius PIPEBOMBRADIUS 80 90 100 HANDBOMB_WEAPON_STRENGTH
				killit
				}
	}
 else
	  ifspawnedby DYNAMITEBUNDLE
	  {
	 geta[myowner].owner TEMP3
	 getactorvar[TEMP3].CURWEAP TEMP
	 getactorvar[TEMP3].KICKBACKPIC TEMP2
ife TEMP 10
	 ife TEMP2 3
				{
				spawn EXPLOSION2
				globalsound PIPEBOMB_EXPLODE
				hitradius PIPEBOMBRADIUS 80 90 100 HANDBOMB_WEAPON_STRENGTH
				killit
				}
	  }
   break
case MC_GRENADE_ONFLOOR
 geta[].owner myowner
	 ifspawnedby APLAYER
	 {
ife CURWEAP 10
	 ife KICKBACKPIC 3
				{
				ifpdistl 4096 quake 13
				spawn EXPLOSION2
				globalsound PIPEBOMB_EXPLODE
				hitradius PIPEBOMBRADIUS 80 90 100 HANDBOMB_WEAPON_STRENGTH
				killit
				}
	}
 else
	  ifspawnedby MC_GRENADE
	  {
	 geta[myowner].owner TEMP3
	 getactorvar[TEMP3].CURWEAP TEMP
	 getactorvar[TEMP3].KICKBACKPIC TEMP2
ife TEMP 10
	 ife TEMP2 3
				{
				spawn EXPLOSION2
				globalsound PIPEBOMB_EXPLODE
				hitradius PIPEBOMBRADIUS 80 90 100 HANDBOMB_WEAPON_STRENGTH
				killit
				}
	  }
   break
case HEAVYHBOMB
  ifspawnedby APLAYER
  {
  getactorvar[myowner].P_CHAR TEMP
  state FINDMONSTERS
  }
  else seta[].picnum 3689
  break
endswitch

endevent


action EXPBARRELFRAME     0   2   1   1   15
actor EXPLODINGBARREL 26
  fall
  ifaction EXPBARRELFRAME
  {
    ifactioncount 2
    {
      hitradius 1024 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      spawn EXPLOSION2
      debris SCRAP2 2
      sound PIPEBOMB_EXPLODE
      killit
    }
    break
  }
  ifsquished
  {
    debris SCRAP1 5
    killit
    break
  }
  ifhitweapon
    action EXPBARRELFRAME
enda

action BURNING_FLAME  0   12   1   1   2
move BURNING_VELS 

defstate burningstate

  sleeptime 300
  seta[].blend 255
  cstator 2


  ifspawnedby BURNING
  {
    ifgapzl 16
      break
  }
  else
    ifspawnedby BURNING2
  {
    ifgapzl 16
      break
  }

  ifpdistg 10240
    break

  ifcount 128
  {
    ifspawnedby TIRE
    {
      ifactioncount 512
        killit
      ifrnd 16
        sizeto 64 48
    }
    else
    {
      sizeto 8 8
      sizeto 8 8
      ifcount 192
        killit
    }
  }
  else
  {
    ifmove 0
      move BURNING_VELS

    sizeto 52 52

    ifp palive
      ifpdistl 844
        ifrnd 32
          ifcansee
    {
       ife CHAR 0 sound J_HOTHOT
       ife CHAR 1 sound Z_LONGTERM_PAIN
      set FIRE_DAMAGE 1
      palfrom 24 16
    }
  }

ends

actor BURNING WEAK BURNING_FLAME
  state burningstate
enda

actor BURNING2 WEAK BURNING_FLAME
  state burningstate
enda

action TOILETWATERFRAMES 0 4 1 1 1
actor TOILETWATER 0 TOILETWATERFRAMES
  ifpdistl 8192
  {
  ifspritepal 3 nullop else
    soundonce WATER_GURGLE
    ifspawnedby TOILET
      sizeto 34 34
    else
    {
      ifspawnedby WATERFOUNTAINBROKE
        sizeto 6 15
      else
        ifspawnedby TOILETWATER
          nullop
      else
        sizeto 24 32
    }

    ifp palive
      ifpdistl RETRIEVEDISTANCE
        ifp pfacing
          ifactioncount 32
            ifphealthl 30
              ifhitspace
                ifcansee
    {
      addphealth 1
	ifg INEBRIATION 0 { sub INEBRIATION 10 }
      globalsound DUKE_DRINKING
      resetactioncount
    }
  }
enda

action WOODENHORSEFRAME  0   1   4
action WOODENFALLFRAME  122  1   5

actor HORSEONSIDE WEAKEST
  cactor WOODENHORSE
  action WOODENFALLFRAME
enda
actor WOODENHORSE WEAK WOODENHORSEFRAME
  fall
  ifhitweapon
  {
    ifdead
    {
      debris SCRAP1 4
      debris SCRAP2 3
      killit
    }
    else
      action WOODENFALLFRAME
  }
enda

defstate steamcode
  ifpdistl 6144
    soundonce STEAM_HISSING

  ifcount 20
    {
      resetcount
      ifp palive
        ifpdistl 1024
      {
        addphealth -1
        palfrom 16 16
      }
    }
  else
  {
    ifspawnedby STEAM
      nullop
    else
      ifspawnedby CEILINGSTEAM
        nullop
	else
    sizeto 24 24
  }
ends

action STEAMFRAMES    0     5     1     1     1
actor STEAM 0 STEAMFRAMES
  state steamcode
enda

actor CEILINGSTEAM 0 STEAMFRAMES
  state steamcode
enda

actor WATERBUBBLEMAKER 0 0 0
  ifpdistl 3084
    ifrnd 24
      spawn WATERBUBBLE
enda

action BUBBLE
action CRACKEDBUBBLE  1
move BUBMOVE       -10 -36
move BUBMOVEFAST     -10 -52

actor WATERBUBBLE 0 BUBBLE BUBMOVE 
seta[].blend 255
  ifaction CRACKEDBUBBLE
  {
    ifinwater
      ifrnd 192
        killit
    ifactioncount 7
      killit
  }
  else
  {
  cstator 2
    ifcount 4
    {
      ifrnd 192
        move BUBMOVE getv geth randomangle
      else
        move BUBMOVEFAST getv geth randomangle
      resetcount

      ifrnd 84
        sizeat 8 10
      else
        ifrnd 84
          sizeat 10 8
      else
        sizeat 9 9
    }

    ifonwater
    {
      iffloordistl 8
        action CRACKEDBUBBLE
    }
    else
      ifactioncount 40
        action CRACKEDBUBBLE
  }
enda

action LAVAFRAMES 0 5 1 1 10
useractor notenemy LAVASPLASH

ifaction 0
{
sizeat 32 32
spriteflags 4
seta[].shade -16
spawn SMALLSMOKE
action LAVAFRAMES
}

ifaction LAVAFRAMES
ifactioncount 5
killit

enda

move SMOKEVEL 8 -16
move SMOKEVELD 8 16
move ENGINE_SMOKE 64 -64
move SMOKESHOOTOUT -192

action DUSTFRAMES 0 6 1 1 10
useractor notenemy DUSTSMOKE 0 DUSTFRAMES
sizeat 20 20

move SMOKEVEL geth getv
  ifactioncount 6
    killit
enda

move ML_UP 32 32
move NSSLOW 32 0

action GUNFRAMES 0 16 1 1 8
action NUKEFRAMES 1 0 1 1 90

useractor notenemy GUNSMOKE

ifaction 0
{
seta[].blend 168
ifspawnedby 16004 { sizeat 16 16 cstat 514 ifpdistl 1024 killit }
else ifspawnedby APLAYER { sizeat 4 4 cstat 514 } 
else ifspawnedby THEEBIKE { sizeat 4 4 cstat 130 }
else 
ifspawnedby 7677 
{
sizeto 226 226
ifaction 0 action NUKEFRAMES
cstat 514
}
else { sizeat 16 16 sizeto 128 128 cstat 514 }

ifrnd 128 cstator 4
ifrnd 128 cstator 8
action GUNFRAMES
}

ifspawnedby RPG
{
sizeto 64 64 cstat 642
move ML_UP getv spin randomangle
}

ifspawnedby THEEBIKE
{
sizeto 16 16
move ML_UP getv geth
}

ifaction NUKEFRAMES
{
move NSSLOW geth
ifcount 512 killit
}
else
	{
	ifceilingdistl 6
	move SMOKEVELD geth getv
	else
	move SMOKEVEL geth getv
	}

ifaction GUNFRAMES
  ifactioncount 16
    killit

  ifpdistl 1596
    ifspawnedby 5375
      killit
	  
  ifpdistl 1596
    ifspawnedby 5968
      killit

enda

action BLOODEXFRAMES 0 4 1 1 10
useractor notenemy BLOOD_EX 0 
sizeat 32 32
cstat 128

ifaction 0
{
ifrnd 128 cstator 4
action BLOODEXFRAMES
}

  ifactioncount 4
    killit

  ifpdistl 1596
    ifspawnedby 5375
      killit

enda

move WATERVEL 32 16

action WATERFRAMES -1 6 1 1 20
useractor notenemy WFRAMES 0 WATERFRAMES
fall
sizeto 20 20
cstat 514
move WATERVEL geth getv
  ifactioncount 6
    killit

state getfloordist
ifl z 1
	{
	gets[].lotag TEMP
	ife TEMP 1 { espawn WATERSPLASH2 geta[].pal TEMP2 seta[RETURN].pal TEMP2 killit }
	}

enda



useractor notenemy 6517 // Heavy railgun trail
ifcount 26 killit else
ifcount 13 sizeto 1 1 
else sizeto 20 20

ifaction 0
{
seta[].blend 255
cstat 146
	 findnearactor3d SHOOTME 768 TEMP9 ifn TEMP9 -1
		{
		getactorvar[TEMP9].myowner TEMP8
		ifl sprite[TEMP8].htextra 250 seta[TEMP8].htextra 250
		}
	 findnearactor3d SHOOTME3 768 TEMP4 ifn TEMP4 -1
		{
		getactorvar[TEMP4].myowner TEMP8
		ifl sprite[TEMP8].htextra 250 seta[TEMP8].htextra 250
		}
	action ZERO
}

enda

useractor notenemy 14420
ifcount 26 killit else
ifcount 13 sizeto 1 1 
else sizeto 16 16

ifaction 0
{
cstat 144
hitradius 1024 100 60 50 40
action ZERO
}

enda


useractor notenemy 6522 // Railgun trail
ifcount 26 killit else
ifcount 13 sizeto 1 1 
else sizeto 16 16

ifaction 0
{
cstat 144
	 findnearactor3d SHOOTME 768 TEMP9 ifn TEMP9 -1
		{
		getactorvar[TEMP9].myowner TEMP8
		ifl sprite[TEMP8].htextra 150 seta[TEMP8].htextra 150
		}
	 findnearactor3d SHOOTME3 768 TEMP5 ifn TEMP5 -1
		{
		getactorvar[TEMP5].myowner TEMP8
		ifl sprite[TEMP8].htextra 150 seta[TEMP8].htextra 150
		}
	action ZERO
}

ifl TEMP4 254 add TEMP4 8
set alpha TEMP4
state SPRITE_FADE

enda

spritenoshade 6575
spritenopal 6575

useractor notenemy 6575 // Meltabeam
spritepal 0
seta[].shade -127
ifcount 3 killit
else sizeat 18 18

ifaction 0
{
seta[].blend 255
cstat 146
	 findnearactor3d SHOOTME 768 TEMP9 ifn TEMP9 -1
		{
		getactorvar[TEMP9].myowner TEMP8
		seta[TEMP8].htextra 15
		getactorvar[TEMP8].ENERGY_DAMAGE TEMP7
		add TEMP7 5
		setactorvar[TEMP8].ENERGY_DAMAGE TEMP7
		}
	 findnearactor3d SHOOTME3 768 TEMP4 ifn TEMP4 -1
		{
		getactorvar[TEMP4].myowner TEMP8
		seta[TEMP8].htextra 15
		getactorvar[TEMP8].ENERGY_DAMAGE TEMP7
		add TEMP7 5
		setactorvar[TEMP8].ENERGY_DAMAGE TEMP7
		}
	action ZERO
}

enda

defstate LASER_CODE
ifaction 0
{
state NOEVENTNOCLIPPING
cstat 130
seta[].blend 255
seta[].shade -127
action ZERO
}
ifmultiplayer nullop else ifl framerate 15 killit
sizeto 4 4
geta[].shade TEMP
add TEMP 8
ifg TEMP 30 killit
seta[].shade TEMP
ends

spritenoshade 9401
useractor notenemy 9401 // green laser trail
state LASER_CODE
enda

spritenoshade 12902
useractor notenemy 12902 // blue laser trail
state LASER_CODE
enda

spritenoshade 6633
useractor notenemy 6633 // red laser trail
state LASER_CODE
enda

useractor notenemy 13216 // ally bullet trail
cstat 128
ifmultiplayer nullop else ifl framerate 15 killit
ifcount 26 killit else
ifcount 13 sizeto 1 1 
else sizeto 8 8
enda

action SMOKEFRAMES 0 4 1 1 10
actor SMALLSMOKE 0 SMOKEFRAMES
cstator 514
  ifmove 0
  {
  seta[].blend 48
    ifspawnedby RECON
      move SMOKESHOOTOUT geth
    else
      ifspawnedby SECTOREFFECTOR
        move ENGINE_SMOKE geth getv
    else
      move SMOKEVEL geth getv faceplayer
	ifspawnedby 2698 cstat 514
	ifspawnedby 2704 cstat 514
    ifspawnedby RPG
      cstat 514
    ifspawnedby 2704
      cstat 130
    ifspawnedby SPELL4
      spritepal 514
	ifspawnedby 14644 { sizeat 24 24 cstat 514 spritepal 8 }
	ifspawnedby MICRO_MISSILE { sizeat 24 24 cstat 514 }
	ifspawnedby HOMING_MISSILE { sizeat 24 24 cstat 514 }
	ifspawnedby 7047 { sizeat 32 32 cstat 514 spritepal 19 }
	ifspawnedby 7052 { sizeat 32 32 cstat 514 spritepal 19 }
	ifspawnedby LAVABALL { sizeat 32 32 cstat 514 spritepal 2 }
	ifspawnedby 14970 { sizeat 32 32 cstat 514 }
	ifspawnedby 3761 { sizeat 2 2 cstat 514 }
	ifspawnedby HEAT_SINK { sizeat 2 2 cstat 514 }
	ifspawnedby 40MM_SHELL { sizeat 2 2 cstat 514 }
	ifspawnedby EXSHELL { sizeat 2 2 cstat 514 }
	ifspawnedby FL_SHELL { sizeat 2 2 cstat 514 }
	ifspawnedby MAGN_SHELL { sizeat 3 3 cstat 514 }
	ifspawnedby SHOTSPARK1 killit
	ifspawnedby COMMANDER
        { 
	move SMOKEVEL2 geth 
	cstat 514 
	}
	ifspawnedby PE_SENTRY
        { 
	move SMOKEVEL2 geth 
	cstat 514 
	}
	
    ifspawnedby KNEE 
	ifactioncount 0
	{
	ifl UPPER_CUT 20 { soundonce UPPER_PUNCH stopsound KICK_HIT } else
	ife SPIN_KICK 20
	ife TWIRL_KICK 20
	ife ROUNDHOUSE_KICK 27
	ife SLIDE_KICK 27
	ife FLYING_KICK 27
	ife DROP_KICK 27
		{
	 	ifp pboosted sound SPUNCHHIT else
		ife CHAR 2 { ife CURWEAP 0 sound PUNCHHIT } else
		sound PUNCHHIT
		}
		else ifp pboosted sound SPUNCHHIT else sound PUNCHHIT
	}
	ifspawnedby 14604 spawn 8433
	ifspawnedby 14605 spawn 8433
    ifspawnedby 4963 spawn 8433
	ifspawnedby 12204 spawn 8433
    ifspawnedby 14970
		{
		ifactioncount 0
			{
			spawn 8433
			shoot SPARK
			shoot SPARK
			shoot SPARK
			shoot SPARK
			}
		}
	ifspawnedby 10247
		{
		spawn 8433 shoot SPARK ifactioncount 0 sound CHAINSAW_HIT
		}
    ifspawnedby 12053 
		{
		spawn 8433
		ifactioncount 0 sound HIT_SWORD
		}
    ifspawnedby 12054 
		{
		ifactioncount 0 sound MOP_HIT
		}
    ifspawnedby 19027 // Beamsabre
		{
		spawn 8433
		shoot SPARK shoot SPARK
		ifactioncount 0 sound BEAMSABRE_HIT
		}
    ifspawnedby 6874
		{
		spawn 8433
		shoot SPARK shoot SPARK
		ifpdistl 256 killit
		}
    ifspawnedby 6875
		{
		spawn 8433
		ifpdistl 256 killit
		}
  }
  ifpdistl 1596
   ifspawnedby MICRO_MISSILE
      killit
  ifpdistl 1596
   ifspawnedby HOMING_MISSILE
      killit
  ifpdistl 1596
    ifspawnedby MISSILE
      killit
  ifpdistl 1596
    ifspawnedby 2698
      killit
  ifpdistl 1596
    ifspawnedby 2704
      killit
  ifpdistl 1596
    ifspawnedby RPG
      killit
  ifpdistl 1596
    ifspawnedby SPELL4
      killit
  ifpdistl 1596
    ifspawnedby 7047
      killit
  ifpdistl 1596
    ifspawnedby 7052
      killit
  ifpdistl 512
    ifspawnedby 4963
      killit
  ifpdistl 512
    ifspawnedby 14604
      killit
  ifpdistl 512
    ifspawnedby 14605
      killit
  ifactioncount 4
    killit

enda

action BARREL_DENTING  2 2 1 1 6
action BARREL_DENTED   1
action BARREL_DENTED2  2

move SPAWNED_BLOOD

actor NUKEBARRELDENTED WEAK
  cactor NUKEBARREL
  action BARREL_DENTED
enda

actor NUKEBARRELLEAKED WEAK
  cactor NUKEBARREL
  action BARREL_DENTED2
enda


actor NUKEBARREL MEDIUMSTRENGTH
  ifsquished
  {
    debris SCRAP1 32
    spawn BLOODPOOL
    state random_ooz
    killit
  }
  fall
  ifaction BARREL_DENTING
  {
    ifactioncount 2
    {
      debris SCRAP1 10
      ifrnd 2 spawn BLOODPOOL
      killit
    }
  }
  else
    ifhitweapon
  {
    ifdead
    {
      sound VENT_BUST

      ifrnd 128
        spawn BLOODPOOL
      action BARREL_DENTING
    }
    else
    {
      ifaction 0
        action BARREL_DENTED
      else
        ifaction BARREL_DENTED
      {
        action BARREL_DENTED2
        spawn BLOODPOOL
      }
      else
        ifaction BARREL_DENTED2
          action BARREL_DENTING
    }
  }
enda

action SHRINKERFRAMES 0 4 1 1 10
actor SHRINKEREXPLOSION 0 SHRINKERFRAMES
  ifactioncount 4
    killit
	
cstator 514
seta[].blend 255

ifspawnedby SPELL2 spritepal 1
ifspawnedby 22610 spritepal 1
ifspawnedby GOLD_SPELL2 spritepal 7
ifspawnedby 9376 spritepal 27
ifspawnedby 19807 { cstat 130 sizeat 8 8 spritepal 7 }
ifspawnedby 6198 { cstat 130 sizeat 8 8 spritepal 1 }
ifspawnedby 6627 { cstat 130 sizeat 14 14 spritepal 8 }

enda

action UNDERW_EXP_FRAMES 0 14 1 1 4

useractor notenemy 18920

ifaction 0
{
seta[].blend 255
sizeat 96 96
cstat 130
action UNDERW_EXP_FRAMES
spawn WATERBUBBLE spawn WATERBUBBLE spawn WATERBUBBLE spawn WATERBUBBLE
}

ifactioncount 14 killit

enda

action EXPLOSION_FRAMES 0 21 1 1 0

actor EXPLOSION2 1 

ifspawnedby 9359 { spritepal 2 sizeat 32 32 }
ifspawnedby 9361 { spritepal 2 sizeat 24 24 }
ifspawnedby 5460 sizeat 64 64

ifspawnedby 14644 spritepal 8

ifspawnedby MI_24_HIND sizeat 128 128
ifspawnedby KA_50_BLACK_SHARK sizeat 128 128
ifspawnedby BLACK_HAWK sizeat 128 128
ifspawnedby AMCSHIP sizeat 128 128
ifspawnedby AMCSHIP2 sizeat 128 128

ifspawnedby HOVERCRAFT sizeat 48 48

ifspawnedby SPELL4 spritepal 2

ifspawnedby 3622 spritepal 2

ifinwater { spawn WATERBUBBLE spawn 18920 killit }

ifspawnedby GORO_EXPLODING_FLAME
	{
	sizeat 24 24
	spritepal 2
	ifpdistl 1536 killit
	ifactioncount 1
		{
		hitradius 1024 20 40 60 80
		sound GORO_EXPLOSION
		}
	}

ifspawnedby WTANKPROJ ife TEMP 0 { hitradius 2500 200 300 400 800 sizeat 128 128 set TEMP 1 }

ifaction 0
{
iffloordistl 8 ifg sprite[].yrepeat 16 { espawn EXPLOSION2BOT seta[RETURN].pal sprite[].pal }
ifceilingdistl 8 ifg sprite[].yrepeat 16 { espawn EXPLOSION2BOT seta[RETURN].pal sprite[].pal }
seta[].blend 255
cstat 130
action EXPLOSION_FRAMES
	ifspawnedby SEENINE
	{
	geta[].owner TEMP
	geta[TEMP].pal TEMP2
	ife TEMP2 3
		{
		espawn 2520
		setactorvar[RETURN].TEMP DISTANT_EXPLOSION
		}
		else
	ife TEMP2 9
		{
		quake 13
		palfrom 30 30 30 30
		soundonce MISSILE_LAUNCH
		}
		else
		{
		espawn 2520
		setactorvar[RETURN].TEMP RPG_EXPLODE
		}
	}
}

ifspawnedby C4_PLACE_HERE sizeto 64 64

ifspawnedby CLUSTER_PROJ
ife TEMP3 0
	{
	shoot CLUSTER_BOMB
	shoot CLUSTER_BOMB
	shoot CLUSTER_BOMB
	shoot CLUSTER_BOMB
	shoot CLUSTER_BOMB
	shoot CLUSTER_BOMB
	set TEMP3 1
	}
	
ifspawnedby 12969
ifactioncount 0
	{
	shoot CLUSTER_BOMB2
	shoot CLUSTER_BOMB2
	shoot CLUSTER_BOMB2
	shoot CLUSTER_BOMB2
	shoot CLUSTER_BOMB2
	shoot CLUSTER_BOMB2
	}
	
ifspawnedby 6814 sizeat 16 16

ifspawnedby 5968
{
sizeto 64 64
}

ifspawnedby FUELPOD 
{ 
spawn GROUNDEXPLOSION
hitradius 2048 50 100 125 150 
globalsound LASERTRIP_EXPLODE 
killit
}

ifspawnedby SATELLITE 
ifactioncount 1 
{ 
hitradius 2048 50 100 125 150 
globalsound LASERTRIP_EXPLODE 
}

ifspawnedby SOLARPANNEL 
ifactioncount 1 
{ 
hitradius 2048 50 100 125 150 
globalsound LASERTRIP_EXPLODE 
}

ifspawnedby ANTENNA 
ifactioncount 1 
{ 
hitradius 2048 50 100 125 150 
globalsound LASERTRIP_EXPLODE 
}

  ifactioncount 21
    killit

enda

action EXPLOSION_FRAMES2 0 20 1 1 0

spritenoshade BIG_EXPLOSION

useractor notenemy BIG_EXPLOSION 1  // Big explosion

ifaction 0
{
ifspawnedby MICRO_MISSILE flash
quake 30
seta[].shade -127
cstat 130
seta[].blend 255



ifspawnedby 16004 
	{ 
	sizeat 60 60 
	shoot SPARK shoot SPARK shoot SPARK
	shoot LAVABALL shoot LAVABALL shoot LAVABALL
	spritepal 2
	quake 26 
	}
else
ifspawnedby 21602
	{ 
	sizeat 90 90 
	shoot SPARK shoot SPARK shoot SPARK
	shoot LAVABALL shoot LAVABALL shoot LAVABALL
	spritepal 2
	quake 26 
	}
else
ifspawnedby WTANKPROJ { sizeat 90 90 flash }
else
ifspawnedby 18271 sizeat 128 128 else
sizeat 64 64
action EXPLOSION_FRAMES2
}

	geta[].shade TEMP
	add TEMP 8
	seta[].shade TEMP

  ifactioncount 20
    killit

enda

spritenoshade MISSILE_EXPLOSION

action MISSILE_EX_FRAMES 0 16 1 1 0

useractor notenemy MISSILE_EXPLOSION 1 0
ifaction 0 { ifonwater spawn 18138 ifinwater { spawn 18920 killit } seta[].blend 255 quake 13 action MISSILE_EX_FRAMES cstat 130 ifrnd 128 cstator 4 }
sizeat 32 32


seta[].shade -127

  ifactioncount 16
    killit


enda

spritenoshade GROUNDEXPLOSION

action GROUNDEX_FRAMES 0 9 1 1 6

useractor notenemy GROUNDEXPLOSION 1 GROUNDEX_FRAMES
fall
cstat 2
seta[].blend 255
ifspawnedby CLUSTER_BOMB sizeat 32 32 else
sizeat 64 64

seta[].shade -127


  ifactioncount 9
    killit


enda

action NUKE_FLASH_FRAMES 0 12 1 1 8

spritenoshade 15954
useractor notenemy 15954 1 0
ifaction 0
	{
	geta[].htflags TEMP2
	orvar TEMP2 2048
	seta[].htflags TEMP2
	sizeat 80 80
	cstat 130
	seta[].blend 255
	action NUKE_FLASH_FRAMES
	seta[].shade -127
	}
	
ifactioncount 12 killit
	
enda

action MAGIC_SPAWN_FRAMES 0 22 1 1 0

spritenoshade 18623
spritenopal 18623

spriteflags 18623 16

useractor notenemy 18623 1 0
ifaction 0
{
		ifspawnedby LESANG
			{
			sizeat 64 64
			spritepal 1
			}
			else
			ifspawnedby 10287
			{
			sizeat 64 64
			spritepal 2
			}
			else
		sizeat 32 32
		seta[].blend 255 
		cstat 2
		seta[].shade -127
		ifspawnedby HOVERCRAFT move FLYSLOW geth randomangle
		action MAGIC_SPAWN_FRAMES
}
ifaction MAGIC_SPAWN_FRAMES
{
ifactioncount 22 killit
}

enda

action SPLASH_FRAMES 0 15 1 1 0
action SPLASH_FRAMES2 0 15 1 1 4

useractor notenemy 18138 1 0 // Big wave
ifaction 0
{
		ifspawnedby RESPAWN 
		{ 
		quake 13 sound WAVECRASH 
		sizeat 128 128 sizeto 200 200	
		seta[].blend 255
		cstat 130
		action SPLASH_FRAMES2 
		}
		else 
		ifspawnedby EXPLOSION2 
		{ 
		sizeat 128 128 sizeto 200 200	
		seta[].blend 255
		cstat 130
		action SPLASH_FRAMES2 
		}
		else 
		{
		sizeat 64 64
		sizeto 128 128
		seta[].blend 180
		cstat 514
		action SPLASH_FRAMES
		}
		seta[].shade -127
}
ifaction SPLASH_FRAMES
{
ifactioncount 15 killit
}
ifaction SPLASH_FRAMES2
{
ifactioncount 15 killit
}

enda

action NUCLEAR_EX_FRAMES 0 48 1 1 6

move NUKE_SHROOM 100 -140

useractor notenemy NUCLEAR_EXPLOSION 1 0
ifaction 0 
	{ 
	ifspawnedby ATOM_BOMB sound GEIGER_2
	geta[].htflags TEMP2
	xorvar TEMP2 2048
	seta[].htflags TEMP2
	ifspawnedby NUCLEAR_EXPLOSION 
		{
		set NUKE_ACTIVE 1
		move NUKE_SHROOM geth getv
		seta[].blend 255 
		cstat 2
		spritepal 2  
		sizeat 100 100
		action NUCLEAR_EX_FRAMES 
		}
	else
		{
		spawn 15954
		palfrom 64 64 64 64 
		setgamepalette 5 
		quake 250 
		action NUCLEAR_EX_FRAMES 
		seta[].blend 255 
		spritepal 2 
		cstat 2 
		ifrnd 128 cstator 4 
		state spawn_nuke_smokering
		state getceildist
		ifg z 400
			{
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 0
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 256
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 512
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 768
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 1024
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 1280
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 1536
			espawn NUCLEAR_EXPLOSION
			seta[RETURN].ang 1792
			}
		}
	}
ifspawnedby NUCLEAR_EXPLOSION sizeto 150 150
else sizeat 140 240

seta[].shade -127
ifspawnedby 18271 nullop else flash

ifspawnedby 18271
 ifcount 2
	{
		geta[].x TEMP
		geta[].y TEMP2
		set TEMP3 TEMP
		add TEMP3 2048
		randvar TEMP4 2048
		rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
		espawn BIG_SMOKE2
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		set TEMP6 0
		resetcount
	}
	
ifmove NUKE_SHROOM move NUKE_SHROOM geth getv

ifactioncount 40
 ife INTERNALCOUNT 0
	{
	ifspawnedby NUCLEAR_EXPLOSION nullop else
		{
		geta[].z TEMP4
		sub TEMP4 65536
		espawn 18551 seta[RETURN].pal 3
		espawn 18551 seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 256 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 384 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 512 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 640 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 768 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 896 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1024 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1152 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1280 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1408 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1536 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1664 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1792 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		espawn 18551 geta[RETURN].ang TEMP add TEMP 1920 seta[RETURN].ang TEMP seta[RETURN].z TEMP4
		}
	set INTERNALCOUNT 1
	}

ife INTERNALCOUNT 1
	{
	geta[].shade TEMP3
	add TEMP3 2
	seta[].shade TEMP3
	}

  ifactioncount 48
    {
	set NUKE_ACTIVE 0
	palfrom 20 20 0 0
	setgamepalette 0
    killit
	}

enda

useractor notenemy 18551
ifaction 0
	{
	geta[].htflags TEMP2
	orvar TEMP2 2048
	seta[].htflags TEMP2
	seta[].blend 255
	cstat 2
	ifspritepal 3 sizeat 160 240 else { sizeat 240 240 move TROOPWALKVELS geth }
	action ZERO
	}
	
ifaction ZERO
	{
	ifcount 256 
		{
		seta[].htflags 4
		set TEMP2 1
		}
	}
	
ife TEMP2 1
	{
	geta[].shade TEMP3
	add TEMP3 1
	ifg TEMP3 30 killit
	seta[].shade TEMP3
	}
	
enda

spritenoshade 12722

action AN_MAGIC_EX 0 4 1 1  6
useractor notenemy 12722
seta[].blend 255

ifaction 0
{
cstat 130
sizeat 32 32
shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2
seta[].shade -127
action AN_MAGIC_EX
}

  ifactioncount 4
    killit

enda

action SKULLE_FRAMES 0 7 1 1  6
useractor notenemy SKULLEXPLOSION 1 SKULLE_FRAMES
seta[].blend 255
ifspawnedby SPELL8
{
sizeat 32 32
cstat 130
}
else
ifspawnedby 6200
{
sizeat 20 20
spritepal 0
cstat 130
}
else
ifspawnedby 6221
{
sizeat 40 40
spritepal 30
cstat 130
}
else
ifspawnedby STYGIAN_ROCK
{
spritepal 2
sizeat 48 48
cstat 130
ifactioncount 0	{ flash shoot ROCKDEB2 }
}
else
ifspawnedby HEARTLEECHFLOAT
{
spritepal 2
sizeat 32 32
cstat 2
}
else
{
sizeat 64 64
cstat 2
}

  ifactioncount 7
    killit

enda

// BLOOD EXPLOSION 2

action BLOODE_FRAMES 0 9 1 1 0
useractor notenemy 18935 1 BLOODE_FRAMES

cstat 2
seta[].blend 255
sizeat 40 40

  ifactioncount 9
    killit

enda

action RUBYEX_FRAMES 0 6 1 1 6
useractor notenemy RUBYBLAST_EX

ifaction 0
	{
	cstat 130
	ifpdistl 2048 nullop else
		{
		spawn 8433
		shoot SPARK shoot SPARK
		}
	sizeat 32 32
	sizeto 48 48
	action RUBYEX_FRAMES
	}

  ifactioncount 6
    killit

enda

action ENERGYEXPLOSION_FRAMES 0 5 1 1 10

useractor notenemy ENERGY_EXPLOSION 1 ENERGYEXPLOSION_FRAMES

ifspawnedby HEAVY_RAILGUN
	{
	shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	espawn 8433 seta[RETURN].pal 2
	cstat 128
	sizeat 25 25
	spritepal 21 
	ifactioncount 1 flash
	}
	
ifspawnedby HADESPHERE
	{ 
	shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	seta[].blend 255
	cstat 130
	sizeat 40 40 
	spritepal 2 
	}
	
ifspawnedby SF_GRENADE 
	{ 
	shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2 shoot SPARK2
	espawn 8433 seta[RETURN].pal 1
	seta[].blend 255
	cstat 130
	sizeat 40 40 
	spritepal 1
	ifactioncount 1 { flash quake 13 }
	}

ifspawnedby REDM_BLAST 
	{ 
	shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	espawn 8433 seta[RETURN].pal 2
	seta[].blend 255
	cstat 130
	sizeat 40 40 
	spritepal 2 
	ifactioncount 1 { flash quake 13 }
	}
	
ifspawnedby BLOOD_BLAST 
	{ 
	shoot SPARK shoot SPARK
	espawn 8433 seta[RETURN].pal 2
	seta[].blend 255
	cstat 130
	sizeat 40 40 
	spritepal 2 
	ifactioncount 1 { flash quake 13 }
	}
	
	
ifspawnedby MC_TRAP_IDLE
	{ 
	ife TEMP 0 { espawn 8433 seta[RETURN].pal 1 set TEMP 1 }
	cstat 130
	seta[].blend 255
	sizeat 20 20 
	spritepal 1
	}

	
ifspawnedby 7159 
	{ 
	ife TEMP 0 { espawn 8433 seta[RETURN].pal 1 set TEMP 1 }
	cstat 130
	seta[].blend 255
	sizeat 20 20 
	spritepal 1
	}


ifactioncount 5 killit

enda

action BLOODTRAIL_FRAMES 0 5 1 1  6
useractor notenemy BLOODTRAIL 1 0
ifmultiplayer killit
ifspawnedby 4714 spritepal 8
ifaction 0 { sizeat 24 24 state rf cstator 128 action BLOODTRAIL_FRAMES }

  ifactioncount 6
    killit

enda

action GORO_FLAME_EXPLOSION_FRAMES 0 5 1 1 6

spritenoshade GORO_FLAME_EX

useractor notenemy GORO_FLAME_EX 1 0
ifaction 0
	{
	sizeat 16 16
	cstat 128
	seta[].shade -127
	action GORO_FLAME_EXPLOSION_FRAMES
	}
	
ifaction GORO_FLAME_EXPLOSION_FRAMES
 ifactioncount 5 killit
	
enda


spritenoshade 15184

useractor notenemy 15184 1 0
ifaction 0
	{
	sizeat 16 16
	cstat 128
	seta[].shade -127
	action GORO_FLAME_EXPLOSION_FRAMES
	}
	
ifaction GORO_FLAME_EXPLOSION_FRAMES
 ifactioncount 5 killit
	
enda

action SHADEFEXPLOSION_FRAMES 0 6 1 1  6

useractor notenemy SHADEFEXPLOSION 1 SHADEFEXPLOSION_FRAMES
seta[].blend 255
ifspawnedby 7159 { sizeat 16 16 cstat 646 spritepal 1 ifpdistl 1024 killit } else
ifspawnedby 7163 { sizeat 16 16 cstat 646 spritepal 2 ifpdistl 1024 killit } else
ifspawnedby 19029 { sizeat 8 8 cstat 646 spritepal 27 ifpdistl 1024 killit } else
ifspawnedby SHOTSPARK1 { spritepal 1 sizeto 16 16 cstat 130 } else
ifspawnedby 7526 { sizeat 26 26 cstat 130 } else
ifspawnedby BRUISERFIREBALL { spritepal 19 sizeat 26 26 cstat 646 ifpdistl 1024 killit } else
ifspawnedby STYGIAN_ROCK { spritepal 2 sizeat 32 32 cstat 130 ifpdistl 1024 killit } else
{ sizeto 32 32 cstat 130 } 


  ifactioncount 7
    killit

enda

action HADESFEXPLOSION_FRAMES 0 6 1 1  6
useractor notenemy HADESFEXPLOSION 1 HADESFEXPLOSION_FRAMES
seta[].blend 255
sizeat 32 32 cstat 130


  ifactioncount 6
    killit

enda

action BRUISERFEXPL_FRAMES 0 12 1 1  6
useractor notenemy BRUISERFEXPLOSION 

ifaction 0
	{
	seta[].blend 255 
	sizeat 40 40 
	cstat 130 
	shoot SPARK
	shoot SPARK
	shoot SPARK
	action BRUISERFEXPL_FRAMES
	}

  ifactioncount 12
    killit

enda

action PULSEE_FRAMES 0 4 1 1  6
useractor notenemy PULSEEXPLOSION 1 PULSEE_FRAMES

sizeat 32 32
seta[].blend 255
cstat 130

 ifactioncount 2 nullop else
ifactioncount 1 shoot SPARK

  ifactioncount 4
    killit
enda

action GASBURSTEX_FRAMES 0 6 1 1  6
useractor notenemy 6495 1 GASBURSTEX_FRAMES

sizeat 32 32

ifspawnedby MPLASMA spritepal 1
else ifspawnedby MDF_PLASMA spritepal 1
else ifspawnedby PLASMAPROJ spritepal 30
else spritepal 2

cstat 130
seta[].blend 255

  ifactioncount 6
	{
	spawn BIG_SMOKE
    killit
	}
enda

action CRYSTALE_FRAMES 0 5 1 1  6
useractor notenemy CRYSTALEXPLOSION 1 CRYSTALE_FRAMES

ifspawnedby SPELL1 sizeat 32 32
ifspawnedby SPELL7 { sizeat 32 32 spritepal 2 }
ifspawnedby SPELL9 sizeat 48 48
ifspawnedby GOLD_SPELL1 { sizeat 32 32 spritepal 23 }
ifspawnedby PRIEST_BLAST { sizeto 32 32 spritepal 23 }

seta[].blend 255
cstat 130

ife TEMP 0 ifinwater { spawn WATERBUBBLE set TEMP 1 }

  ifactioncount 5
    killit
enda

action EXPLOSION2_BOT -329 20 1 1 0

actor EXPLOSION2BOT 1 0

ifaction 0
{
move STOP randomangle
cstat 1058
sizeat 40 40
iffloordistl 32 seta[].z sector[].floorz
ifceilingdistl 32 seta[].z sector[].ceilingz
seta[].blend 255
action EXPLOSION2_BOT
}

  ifactioncount 20
    killit
enda

action FFLAME_FR 0 16 1 1 1
action FFLAME 0 1 1 1 1

actor FLOORFLAME 0 FFLAME_FR
  ifaction FFLAME_FR
  {
    ifpdistl 1024
      hitradius 1024 WEAKEST WEAKEST WEAKEST WEAKEST
    ifactioncount 16
      action FFLAME
  }
  ifaction FFLAME
    ifrnd 4
  {
    action FFLAME_FR
    sound FLAMETH_STOP
    resetactioncount
  }
enda


action RIP_F 0 8 1 1 1
actor FORCERIPPLE 0 RIP_F
sizeto 32 32
cstator 514
seta[].blend 255
  ifactioncount 8
    killit
enda

action TRANSFOWARD 0  6  1  1  2
action TRANSBACK   5  6  1 -1  2
actor TRANSPORTERSTAR 0 TRANSFOWARD
  ifaction TRANSFOWARD
  {
    ifactioncount 6
      action TRANSBACK
  }
  else
    ifactioncount 6
      killit
	  
	seta[].blend 255
	cstator 2
	  
	ifspawnedby RESPAWN killit

   ifspawnedby 5372
        {
        sizeto 128 128
        spritepal 1 
		seta[].blend 255
        cstat 130          
        }

   ifspawnedby DAYBLAST
	  {
	  geta[].owner TEMP
	  geta[TEMP].xrepeat TEMP2
	  seta[].xrepeat TEMP2
	  geta[TEMP].yrepeat TEMP2
	  seta[].yrepeat TEMP2
	  }

   ifspawnedby 5374
        {
        sizeto 128 128
        spritepal 1
		seta[].blend 255
        cstat 130          
        }

enda

spritenoshade TRANSPORTERBEAM

action BEAMFOWARD  0  4  1  1  9
actor TRANSPORTERBEAM 

ifaction 0
{
seta[].shade -127
seta[].blend 255
cstat 130
ifspawnedby 15626 sizeat 160 160
action BEAMFOWARD
}

ifspawnedby SECTOREFFECTOR // TELEPORT EFFECTS
	{
	geta[].owner TEMP4
	geta[TEMP4].shade TEMP5
	ifactioncount 0
		{
		ife TEMP3 0
			{
			ife TEMP5 22
				{
				sound TELEPORT_IN
				spawn 18623
				ifcansee palfrom 30 0 30 0
				cstat 32768
				}
			else
			ife TEMP5 23
				{
				globalsound SOMETHINGHITFORCE
				ifn ALLYSLOT1 -1 { setactorvar[ALLYSLOT1].FOLLOW_PLAYER 0 set ALLYSLOT1 -1 }
				ifn ALLYSLOT2 -1 { setactorvar[ALLYSLOT2].FOLLOW_PLAYER 0 set ALLYSLOT2 -1 }
				ifn ALLYSLOT3 -1 { setactorvar[ALLYSLOT3].FOLLOW_PLAYER 0 set ALLYSLOT3 -1 }
				ifn ALLYSLOT4 -1 { setactorvar[ALLYSLOT4].FOLLOW_PLAYER 0 set ALLYSLOT4 -1 }
				palfrom 30 0 30 0
				cstat 32768
				}
			else
			ife TEMP5 25
				{
				globalsound DEMON_TELEPORT
				ifcansee palfrom 30 30 0 0
				cstat 32768
				}
			else
			ife TEMP5 26
				{
				globalsound USE_TIMEPORTAL
				ifcansee palfrom 30 0 0 30
				spawn 8433
				cstat 32768
				}
			else
			ife TEMP5 27
				{
				globalsound VR_GLITCH
				ifcansee palfrom 64 64 64 64
				spawn 8433
				cstat 32768
				}
			else
			globalsound SOMETHINGHITFORCE
			set TEMP3 1
			}
		}
	}

ifspawnedby 9375 
	{
	ife player[].heat_on 1 palfrom 10 0 0 0 else
	ifpdistl 20480 palfrom 63 0 0 0 else palfrom 20 0 0 0 
	}

ifspritepal 27 
	{ 
	ife player[].heat_on 1 palfrom 10 63 63 63 else
	ifpdistl 20480 palfrom 63 63 63 63 else palfrom 20 63 63 63 }
	

  sizeto 32 64
  sizeto 32 64
  sizeto 32 64
  ifactioncount 4
    killit
enda

action FIRE_FRAMES   -1 14 1 1 4
action FIRE_FRAMES2   -1 16 1 1 4
move FIREVELS

defstate firestate

  ifaction 0
    ifrnd 16
    {
	seta[].blend 255
	ifactor FIRE2 action FIRE_FRAMES2
      else action FIRE_FRAMES
      cstat 2
	  
    }

  sleeptime 300         // Never let it fall to sleep

  ifspawnedby FIRE
  {
    ifgapzl 16
      break
  }
  else
    ifspawnedby FIRE2
  {
    ifgapzl 16
      break
  }

  ifinwater
    killit
	
  

	
ifspritepal 3 break
	

  ifp palive
	 ifcansee
  {
  ife FIRE_SUIT 1 nullop
  else
    ifrnd 32
   {
   ifspritepal 9
    ifpdistl 423
	  {
		   ifg P_FIRE_ARMOUR 0 { sound FIRE_ARM_PROT sub P_FIRE_ARMOUR 2 }
			else
			 {
				ife CHAR 0 sound J_HOTHOT
				 ife CHAR 1 sound Z_LONGTERM_PAIN
				getp[].i TEMP4
				getactorvar[TEMP4].FIRE_DAMAGE TEMP5
				add TEMP5 5
				setactorvar[TEMP4].FIRE_DAMAGE TEMP5
				palfrom 32 32
			 }
	   }
	else
     ifpdistl 846
	  {
		   ifg P_FIRE_ARMOUR 0 { sound FIRE_ARM_PROT sub P_FIRE_ARMOUR 2 }
			else
			 {
				ife CHAR 0 sound J_HOTHOT
				 ife CHAR 1 sound Z_LONGTERM_PAIN
				getp[].i TEMP4
				getactorvar[TEMP4].FIRE_DAMAGE TEMP5
				add TEMP5 5
				setactorvar[TEMP4].FIRE_DAMAGE TEMP5
				palfrom 32 32
			 }
	   }
	}
    
  }
  
  ifspritepal 3 break
  else
  ifactor FIRE
  {
    ifspawnedby FIRE
      break
  }
  else
    ifactor FIRE2
      ifspawnedby FIRE2
        break

  state getfloordist
  ifl z 128
  {
  ifl z 0 seta[].z sector[].floorz
    ifrnd 128
    {
      ifcount 84
        killit
                // This line(and the else below)
                // is not necessary, since actors
                // with zero x-size are automatically
                // deleted anyway!
      else
        ifcount 42
          sizeto 0 0
      else
        sizeto 32 32
    }
  }
  else
    killit

ends

useractor notenemy FIRE WEAK 0 FIREVELS state firestate enda
useractor notenemy FIRE2 WEAK 0 FIREVELS state firestate enda

actor FECES
  ifcount 24
  {
    ifpdistl RETRIEVEDISTANCE
    {
      ifrnd SWEARFREQUENCY
	    set PLAYER_VOICEOVER 46

      sound STEPNIT

      spawn BROWNSTAIN
      killit
    }
  }
  else
    sizeto 32 32
enda

action FEMSHRUNK
action FEMFROZEN1 1
action FEMGROW
action FEMFROZEN2
action FEMDANCE1 19 1 1 1 16
action FEMDANCE3 19 1 1 1 26
action FEMDANCE2 20 2 1 1 10

action FEMANIMATESLOW 0 2 1 1 100
action TOUGHGALANIM   0 5 1 1 25
action FEMANIMATE

defstate femcode

  ifactor NAKED1 nullop
  else
   ifactor NAKED2 nullop
  else
   ifactor NAKED3 nullop
  else
    ifactor FEM6 nullop
  else
    ifactor FEM6_A nullop
  else
    ifactor FEM6_B nullop
    else
    {
      fall
      ifactor BLOODYPOLE
        ifhitweapon
          ifdead
      {
        state standard_jibs
        killit
      }
    }

  ifaction FEMSHRUNK
  {
    ifcount SHRUNKDONECOUNT
    {
      action FEMANIMATE
      cstat 257
    }
    else
      ifcount SHRUNKCOUNT
	    {
		sound ACTOR_UNSHRINK
        sizeto 40 40
		}
    else
      state genericshrunkcode
  }
  else ifaction FEMGROW
  {
    ifcount 32
    {
      respawnhitag
      guts JIBS4 20
      guts JIBS6 20
      spritepal 6
      soundonce LADY_SCREAM
      ifactor NAKED1
        debris SCRAP3 4
      else
      ifactor NAKED2
        debris SCRAP3 4
      else
      ifactor NAKED3
        debris SCRAP3 4
      else
        ifactor PODFEM1
          debris SCRAP3 4
      else
        ifactor PODFEM2
          debris SCRAP3 4
      else
        ifactor PODFEM3
          debris SCRAP3 4
      state squish_sounds
      killit
    }
    else
      sizeto MAXXSTRETCH MAXYSTRETCH
  }

  else
    ifaction FEMDANCE1
  {
    ifactioncount 2
      action FEMDANCE2
  }
  else
    ifaction FEMDANCE2
  {
    ifactioncount 8
      action FEMDANCE3
  }
  else
    ifaction FEMDANCE3
  {
    ifactioncount 2
    action FEMANIMATE
  }
  else
    ifaction FEMFROZEN1
  {
    ifcount THAWTIME
    {
      action FEMANIMATE
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
	

	state NEWGUNEFFECTS

      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      lotsofglass 30
      sound GLASS_BREAKING
      respawnhitag
      ifrnd 84
        spawn BLOODPOOL
      killit
    }
    else
      ifp pfacing
        ifpdistl FROZENQUICKKICKDIST
          pkick
    break
  }
  else ifaction FEMFROZEN2
  {
    ifcount THAWTIME
    {
      ifactor TOUGHGAL
        action TOUGHGALANIM
      else
        ifactor FEM10
          action FEMANIMATESLOW
      else
        action FEMANIMATE

      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
          break
      }

      lotsofglass 30

      sound GLASS_BREAKING
      ifrnd 84
        spawn BLOODPOOL
      respawnhitag

      ifrnd 128
        { ife CHAR 0 sound JOHSHIT else
	    ife CHAR 2 sound MOHSHIT else
	    ife CHAR 3 sound ROHSHIT else
	    ife CHAR 5 sound RNOHSHIT else
	    ife CHAR 6 sound GOHSHIT else
	    ife CHAR 7 sound MSOHSHIT else
		ife CHAR 13 sound MC_OHSHIT }

      killit
    }
    else
      ifp pfacing
        ifpdistl FROZENQUICKKICKDIST
          pkick
    break
  }

  ifhitweapon
  {
  
  	geta[].htpicnum TEMP
			ife TEMP 9376 // If you hit them with the MIA Gun, 'teleport' them away to safety 
			{
				  state addbabeachievement
				  espawn TRANSPORTERBEAM
				  seta[RETURN].pal 17
				  killit
			}
	else
		  {
			state NEWGUNEFFECTS
			ifdead
			{
			  ifwasweapon GROWSPARK
			  {
				cstat 0
				move 0
				sound ACTOR_GROWING
				action FEMGROW
				break
			  }
			  else ifwasweapon FREEZEBLAST
			  {
				ifaction FEMSHRUNK
				  break

				ifactor NAKED1
				  action FEMFROZEN2
				else
				ifactor NAKED2
				  action FEMFROZEN2
				else		
				ifactor NAKED3
				  action FEMFROZEN2
				else				
				  ifactor FEM5
					action FEMFROZEN2
				else
				  ifactor FEM6
					action FEMFROZEN2
				else
				  ifactor FEM6_A
					action FEMFROZEN2
				else
				  ifactor FEM6_B
					action FEMFROZEN2
				else
				  ifactor FEM8
					action FEMFROZEN2
				else
				  ifactor FEM9
					action FEMFROZEN2
				else
				  ifactor FEM10
					action FEMFROZEN2
				else
				  ifactor TOUGHGAL
					action FEMFROZEN2
				else
				  ifactor PODFEM1
					action FEMFROZEN2
				else
				  ifactor PODFEM2
					action FEMFROZEN2
				else
				  ifactor PODFEM3
					action FEMFROZEN2
				else
				  action FEMFROZEN1

				move 0
				spritepal 1
				strength 0

				sound SOMETHINGFROZE

				break
			  }
			  else ifwasweapon 7159
			  {
				ifaction FEMSHRUNK
				  break

				ifactor NAKED1
				  action FEMFROZEN2
				else
				ifactor NAKED2
				  action FEMFROZEN2
				else		
				ifactor NAKED3
				  action FEMFROZEN2
				else				
				  ifactor FEM5
					action FEMFROZEN2
				else
				  ifactor FEM6
					action FEMFROZEN2
				else
				  ifactor FEM6_A
					action FEMFROZEN2
				else
				  ifactor FEM6_B
					action FEMFROZEN2
				else
				  ifactor FEM8
					action FEMFROZEN2
				else
				  ifactor FEM9
					action FEMFROZEN2
				else
				  ifactor FEM10
					action FEMFROZEN2
				else
				  ifactor TOUGHGAL
					action FEMFROZEN2
				else
				  ifactor PODFEM1
					action FEMFROZEN2
				else
				  ifactor PODFEM2
					action FEMFROZEN2
				else
				  ifactor PODFEM3
					action FEMFROZEN2
				else
				  action FEMFROZEN1

				move 0
				spritepal 1
				strength 0

				sound SOMETHINGFROZE

				break
			  }

			  ifrnd 128
				{ ife CHAR 0 sound JOHSHIT else
				ife CHAR 2 sound MOHSHIT else
				ife CHAR 3 sound ROHSHIT else
				ife CHAR 5 sound RNOHSHIT else
				ife CHAR 6 sound GOHSHIT else
				ife CHAR 7 sound MSOHSHIT }


			  respawnhitag
			  state standard_jibs
			  state random_wall_jibs
			  spawn BLOODPOOL

			  ifactor FEM1
				money 5
			  else
				ifactor FEM2
			  {
				money 7
				espawn BARBROKE seta[RETURN].xrepeat 32 seta[RETURN].yrepeat 32
				cstat 0
			  }
			  else
				ifactor FEM3
				  money 4
			  else
				ifactor FEM7
				  money 8

			  ifactor FEM5
			  {
				strength TOUGH
				cactor BLOODYPOLE
			  }
			  else ifactor FEM6
			  {
				cstat 0
				cactor FEM6PAD
			  }
			  else ifactor FEM6_A
			  {
				cstat 0
				cactor FEM6PAD
			  }
			  else ifactor FEM6_B
			  {
				cstat 0
				cactor FEM6PAD
			  }
			  else
				ifactor FEM8
			  {
				strength TOUGH
				cactor BLOODYPOLE
			  }
			  else
			  {
				spritepal 6
				soundonce LADY_SCREAM
				ifactor NAKED1
				  debris SCRAP3 18
				else
				ifactor NAKED2
				  debris SCRAP3 18
				else	
				ifactor NAKED3
				  debris SCRAP3 18
				else				
				  ifactor PODFEM1
					debris SCRAP3 18
				else
				  ifactor PODFEM2
					debris SCRAP3 18
				else
				  ifactor PODFEM3
					debris SCRAP3 18
				killit
			  }
			}
			else
			{
			  ifwasweapon SHRINKSPARK
			  {
				sound ACTOR_SHRINKING
				move 0
				action FEMSHRUNK
				cstat 0
				break
			  }
			  else
				ifwasweapon GROWSPARK
				  sound EXPANDERHIT
			  ifactor FEM8
				break

			  ifactor TOUGHGAL
				  state toughgalspeech
			  else state squish_sounds

			  guts JIBS6 1
			}
			}
  }
ends


useractor notenemy POLECHICKSAVED
fall
        ifhitweapon
      {
	  spritepal 8
	  state squish_sounds
        state standard_jibs
        killit
      }
enda

useractor notenemy TIEDCHICKSAVED
fall

        ifhitweapon
      {
	  state squish_sounds
	  spritepal 8
        state standard_jibs
        debris SCRAP3 6
        killit
      }
enda

useractor notenemy PODCHICKSAVED
fall

        ifhitweapon
      {
	  state squish_sounds
	  spritepal 8
        state standard_jibs
        debris SCRAP3 6
        killit
      }
enda

useractor notenemy CEILCHICKSAVED
        ifhitweapon
      {
	  state squish_sounds
	  spritepal 8
        state standard_jibs
        debris SCRAP3 6
        killit
      }
enda

defstate savethem
    ifp pfacing
      ifpdistl 1280
	  {
	  set player_use 0
        ifhitspace
           {
			  ifactor FEM5 
			{ state addbabeachievement cactor POLECHICKSAVED } else
			  ifactor FEM6  
			{ state addbabeachievement cactor TIEDCHICKSAVED } else
			  ifactor FEM6_A  
			{ state addbabeachievement cactor TIEDCHICKSAVED } else
			  ifactor FEM6_B  
			{ state addbabeachievement cactor TIEDCHICKSAVED } else
			  ifactor FEM8 
			{ state addbabeachievement cactor POLECHICKSAVED } else
			  ifactor PODFEM1 
			{ state addbabeachievement cactor PODCHICKSAVED } else
			  ifactor PODFEM2 
			{ state addbabeachievement cactor PODCHICKSAVED } else
			  ifactor PODFEM3 
			{ state addbabeachievement cactor PODCHICKSAVED } else
			  ifactor NAKED1 
			{ state addbabeachievement cactor CEILCHICKSAVED } else
			  ifactor NAKED2 
			{ state addbabeachievement cactor CEILCHICKSAVED } else
			  ifactor NAKED3 
			{ state addbabeachievement cactor CEILCHICKSAVED }
            }
		}
ends

defstate tipme
  ifp pfacing
    ifpdistl 1280
      ifhitspace
  {
	ifp pducking { spawn TRANSPORTERSTAR soundonce SAVE_PERSON killit }  else
	{
    tip
    ifrnd 128
      { 
	ife CHAR 0 soundonce JTIP1 else 
	ife CHAR 1 soundonce ZDANCE else 
	ife CHAR 3 soundonce RTIP1 else
	ife CHAR 4 soundonce STIP1 else
	ife CHAR 5 soundonce RNTIP1 else
	ife CHAR 6 soundonce GTIP1 else
	ife CHAR 10 soundonce BS_TIP1 else
	ife CHAR 14 soundonce SF_TIP1
}
    else
      { 
	ife CHAR 0 soundonce JTIP2 else 
	ife CHAR 1 soundonce ZSHAKE else 
	ife CHAR 3 soundonce RTIP2 else
	ife CHAR 4 soundonce STIP2 else
	ife CHAR 5 soundonce RNTIP2 else
	ife CHAR 6 soundonce GTIP2 else
	ife CHAR 10 soundonce BS_TIP2 else
	ife CHAR 14 soundonce SF_TIP2
}
    ifactor FEM1
      action FEMDANCE1
	}
  }
ends

state toughgaltalk
  ifp pfacing
    ifpdistl 1280
      ifhitspace
        state toughgalspeech
ends

actor FEM1 TOUGH FEMANIMATE
  sizeat 30 30
  state tipme
  state femcode
enda
actor FEM2 TOUGH FEMANIMATE
  sizeat 28 28
  state tipme
  state femcode
enda
actor FEM3 TOUGH FEMANIMATE
  sizeat 27 27
  state tipme
  state femcode
enda
actor FEM4 TOUGH FEMANIMATE
  sizeat 30 30
  state tipme
  state femcode
enda
actor FEM5 TOUGH FEMANIMATE
  state savethem
  state femcode
enda
actor FEM6 TOUGH FEMANIMATE
  state savethem
  state femcode
enda

useractor notenemy FEM6_A TOUGH FEMANIMATE
  state savethem
  state femcode
enda

useractor notenemy FEM6_B TOUGH FEMANIMATE
  state savethem
  state femcode
enda

actor FEM7 TOUGH FEMANIMATE
  sizeat 30 30
  state tipme
  state femcode
enda
actor FEM8 TOUGH FEMANIMATE
  state savethem
  state femcode
enda
actor FEM9 TOUGH FEMANIMATE
   sizeat 30 30
   state tipme
  state femcode
enda
actor FEM10 TOUGH FEMANIMATESLOW
  sizeat 32 32
  state tipme
  state femcode
enda

actor TOUGHGAL MANWOMANSTRENGTH TOUGHGALANIM
   sizeat 30 30
  state toughgaltalk
  state femcode
enda

useractor notenemy NAKED1 TOUGH
  state savethem
  state femcode
enda

useractor notenemy NAKED2 TOUGH
  state savethem
  state femcode
enda

useractor notenemy NAKED3 TOUGH
  state savethem
  state femcode
enda

useractor notenemy PODFEM3 TOUGH
  state savethem
  state femcode
enda

useractor notenemy PODFEM2 TOUGH
  state savethem
  state femcode
enda

useractor notenemy PODFEM1 TOUGH
  state savethem
  state femcode
enda


actor BLOODYPOLE TOUGH
  state femcode
enda
actor STATUEFLASH
  fall
  ifcount 32
    cactor STATUE
enda
actor STATUE
  fall
  ifp pfacing
    ifpdistl 1280
      ifhitspace
  {
    cactor STATUEFLASH
    move 0
  }
enda

actor MIKE
  ifp pfacing
    ifpdistl 1280
      ifhitspace
        mikesnd
enda

action BLOODFRAMES 0 4 1 1 15
actor BLOOD 0 BLOODFRAMES
  sizeto 72 72 sizeto 72 72 sizeto 72 72
  ifpdistg 3144 killit
  ifactioncount 4 killit
enda

actor KNEE KNEE_WEAPON_STRENGTH enda
actor SPIT SPIT_WEAPON_STRENGTH enda
actor CHAINGUN CHAINGUN_WEAPON_STRENGTH enda
actor SHOTGUN SHOTGUN_WEAPON_STRENGTH enda
actor FIRELASER FIRELASER_WEAPON_STRENGTH enda
actor HEAVYHBOMB HANDBOMB_WEAPON_STRENGTH enda
actor BOUNCEMINE BOUNCEMINE_WEAPON_STRENGTH enda
actor MORTER MORTER_WEAPON_STRENGTH enda
actor SHRINKSPARK SHRINKER_WEAPON_STRENGTH enda

actor GROWSPARK GROWSPARK_WEAPON_STRENGTH
  ifcount 18
    killit
  else
    ifcount 9
  {
    sizeto 0 0
    sizeto 0 0
    sizeto 0 0
    sizeto 0 0
  }
  else
  {
    sizeto 28 28
    sizeto 28 28
    sizeto 28 28
    sizeto 28 28
  }
enda

actor RPG RPG_WEAPON_STRENGTH enda
actor FREEZEBLAST FREEZETHROWER_WEAPON_STRENGTH enda
actor DEVISTATORBLAST FREEZETHROWER_WEAPON_STRENGTH enda
actor COOLEXPLOSION1 COOL_EXPLOSION_STRENGTH enda
actor TRIPBOMB TRIPBOMB_STRENGTH enda

defstate FLOOR_CEILING_BULLETHOLE


ife TEMP 0
	seta[].z sector[].floorz
else
ife TEMP 1
	seta[].z sector[].ceilingz

ifaction 0
	{
	ifactor 3068 
		{
		cstat 34
		seta[].blend 255
		}
	else
	cstat 32
	seta[].shade sector[].floorshade
	seta[].pal sector[].floorpal
	ifactor 3769
		{
		randvar TEMP 4
		ifl TEMP 2 set TEMP 2
		}
	else
		{
		randvar TEMP 6
		ifl TEMP 3 set TEMP 3
		}
	seta[].xrepeat TEMP
	seta[].yrepeat TEMP
	move 0 randomangle
	ifonwater killit else
		{
		insertspriteq
		action ZERO
		}
	}
ends

useractor notenemy 3754 // Floor/Ceiling Bullethole
state FLOOR_CEILING_BULLETHOLE
enda

useractor notenemy 3760 // Floor/Ceiling wood Bullethole
state FLOOR_CEILING_BULLETHOLE
enda

useractor notenemy 3769 // Floor/Ceiling concrete Bullethole
state FLOOR_CEILING_BULLETHOLE
enda

useractor notenemy 3068 // Floor/Ceiling glass Bullethole
state FLOOR_CEILING_BULLETHOLE
enda



// SHOTSPARK 
// Causally this stuff occurs after EVENT_POSTDAMAGESPRITE.

action WEAP2FRAMES 0  4  1  1  6
spritenoshade SHOTSPARK1
actor SHOTSPARK1 PISTOL_WEAPON_STRENGTH WEAP2FRAMES

ifspawnedby APLAYER ife CURWEAP 0 ife temp_weapon 8 { spawn BLOOD_EX killit }

ife INVASION 1
{
ifspawnedby APLAYER nullop else killit
}

ifcount 1
    nullop
else
{
    geta[].yvel BULLET_HIT_TYPE
    geta[].htg_t 8 hitsprite
    ifn hitsprite -1 
    { 
        seta[hitsprite].htpicnum BULLET_HIT_TYPE
        // ONLY NON-ENEMY/NON-ALLY STUFF GOES HERE FROM NOW ON. EVERYTHING ELSE GOES TO AMC_DMG_MODIFIERS
        switch sprite[hitsprite].picnum   
            case WATERTILE2
                sound HITWATER
                spawn WATERSPLASH2
                break
            
            case 5208 // Force Shield
                spawn SHADEFEXPLOSION
                break
                
            case 8088 // Target practice sprite
                getactorvar[EV_TARG_SPRITE].HITAGSAVED EV_TEMP
                ife EV_TEMP 2
                {
                    ifrnd 64 espawn 9284 else ifrnd 64 espawn 9285 else ifrnd 64 espawn 9286 else espawn 9287
                    seta[RETURN].pal 1
                    shoot SPARK2
                    shoot SPARK2
                    ifrnd 96 sound HITMETAL2 else ifrnd 96 sound HITMETAL3 else sound HITMETAL4 						
                }
                else
                {
                    spawn 8433
                    shoot SPARK
                    shoot SPARK
                    ifrnd 96 sound HITMETAL2 else ifrnd 96 sound HITMETAL3 else sound HITMETAL4 								
                }
                break
            
            case 19029 // ???
                shoot 19028
                ife PROTECTED_DING YES sound PROTECT_DING2
                ifspawnedby APLAYER ifrnd 32 set PLAYER_VOICEOVER 6 
                spawn SHADEFEXPLOSION
                break
            
            // metal impact
            case 160 // hydraulic pillar
            case 3481 // Metal wall (intact)
            case 3482 // Metal wall (broken)
            case 3877 // car
            case 4087 // oil barrel 1
            case 7260 // demonic grate
            case 7349 // metal railing 1
            case 9590 // metal bars 
            case 9630 // large bell (hexen)
            case 11608 // Metal gate
            case 12385 // metal railing 2
            case 13683 // broken down car
            case 16971 // oil barrel 2
            case 18294 // metal railing 3
            case 20192 // metal railing 4
            case 20384 // metal gate (front)
            case 20385 // metal gate (back)
            case 20417 // metal railing 5 (appears to be a duplicate of 20192)
            case 23577 // metal railing 6
                set TEMP3 0 
                ifrnd 64 spawn 9284 else ifrnd 64 spawn 9285 else ifrnd 64 spawn 9286 else spawn 9287
                shoot SPARK
                shoot SPARK // standard metal hit
                ifrnd 96 sound HITMETAL2 else ifrnd 96 sound HITMETAL3 else sound HITMETAL4 
                break
            
            // heavy metal impact
            case WTANKDEAD
            case WTANKGUN 
            case WTANKUP
            case WTANKUP2 
            case WTANKDW
            case WTANKDW2 
            case WTANKFR
            case WTANKLF 
            case WTANKLF2
            case WTANKFR2
            case WTANKFR3
            case WTANKBK
            case WTANKGUNFR
            case WTANKGUNUP
            case WTANKGUNUP2 
            case WTANKGUNFR2 
            case WTANKGUNAN 
            case WTANKGUNLF 
            case WTANKGUNBK
            case 2081 // pig tank chassis 1
            case 2082 // pig tank chassis 2
            case 2083 // pig tank chassis 3
            case 2084 // pig tank chassis 4
            case 9645 // black railing
            case 10701 // gothic lamp
            case 11593 // metal grate 1
            case 11594 // metal grate 2
            case 11595 // metal grate 3
            case 13044 // upscaled hydraulic pillar
            case 16343 // gong
            case 19181 // dormant mech

                ifrnd 64 espawn 9284 else ifrnd 64 espawn 9285 else ifrnd 64 espawn 9286 else espawn 9287
                seta[RETURN].pal 1
                shoot SPARK2
                shoot SPARK2
                ifrnd 96 sound HITMETAL2 else ifrnd 96 sound HITMETAL3 else sound HITMETAL4 
                break
            
            // chain link fence sprites
            case 913 
            case 962
            case 7168
            case 8600
            case 8601
            case 9136
            case 9138
            case 9724
            case 12396
            case 12401
            case 12492
            case 13206
            case 22429
            case 23773
                ifrnd 64 spawn 9284 else ifrnd 64 spawn 9285 else ifrnd 64 spawn 9286 else spawn 9287
                seta[RETURN].pal 0
                shoot SPARK
                shoot SPARK
                sound HITCHAINL
                break
            
            // wood sprites
            case 3889 // wood cart
            case 3906 // boards 1
            case 5842 // bridge
            case 8015 // wood railing 1
            case 8016 // wood railing 2
            case 8172 // boards 2
            case 10578 // pile of boards
            case 10646 // wood fence 1
            case 11541 // wood fence 2
            case 12429 // boards 3
                sound HITWOOD 
                shoot SWOODSCRAP
                break
            
            // glass sprites
            case 401 
            case 504 
            case 758 
            case 6880 // undefined/empty?
            case 14103 
            case 18282 
                sound HITGLASS
                lotsofglass 1
                break
            
        endswitch
    }
}

ifdead killit
ifactioncount 4 killit
else
{
    ifactioncount 3
    {
        ifinwater spawn WATERBUBBLE
    }
    else 
        ifcount 2 nullop
        else
        {
            ifonwater spawn WATERSPLASH2
            ifinwater spawn WATERBUBBLE
        }
}

ife BULLET_HIT_TYPE MELTA_BEAM { shoot SPARK break }
ife BULLET_HIT_TYPE GREENLASERSHOT
    ifcansee
    {
        sound LASER_IMPACT
        eshoot SPARK
        setthisprojectile[RETURN].pal 8
        eshoot SPARK
        setthisprojectile[RETURN].pal 8
    }
ife BULLET_HIT_TYPE REDLASERSHOT
    ifcansee
    {
        sound LASER_IMPACT
        eshoot SPARK
        setthisprojectile[RETURN].pal 2
        eshoot SPARK
        setthisprojectile[RETURN].pal 2
    }
    
ife BULLET_HIT_TYPE BLUELASERSHOT
    ifcansee
    {
        sound LASER_IMPACT
        eshoot SPARK
        setthisprojectile[RETURN].pal 1
        eshoot SPARK
        setthisprojectile[RETURN].pal 1
    }
    
ife BULLET_HIT_TYPE 20797
    ifcansee
    {
        sound LASER_IMPACT
        eshoot SPARK
        setthisprojectile[RETURN].pal 1
        eshoot SPARK
        setthisprojectile[RETURN].pal 1
    }
    
geta[].htg_t 6 hitwall
ifn hitwall -1
{
    getwall[hitwall].picnum FLOORTEX
    state CHECKSTEPS
    state BULLETHITSOUNDS
   
    ife STEPSOUNDFX 1 set MATERIAL_STRENGTH 100 // wood
    else ife STEPSOUNDFX 2 set MATERIAL_STRENGTH 50 // tin
    else ife STEPSOUNDFX 3 set MATERIAL_STRENGTH 30 // grate
    else ife STEPSOUNDFX 19 set MATERIAL_STRENGTH 150 // Cardboard
    else ife STEPSOUNDFX 22 set MATERIAL_STRENGTH 150 // Leaves
    else ife STEPSOUNDFX 23 set MATERIAL_STRENGTH 90 // Plank
    else set MATERIAL_STRENGTH 70
	
    ldist PENETRATE_STRENGTH myowner THISACTOR
    geta[].extra TEMP7
    ifl TEMP7 1 set TEMP7 1
    divvarvar PENETRATE_STRENGTH TEMP7
    geta[].yvel TEMP9
    ife TEMP9 BIGRIFLESHOT divvar PENETRATE_STRENGTH 4
    ife TEMP9 RIFLESHOT divvar PENETRATE_STRENGTH 3
    ife TEMP9 ARMOUR_PIERCING_SHOT divvar PENETRATE_STRENGTH 3
    ife TEMP9 F45_CALIBRE mulvar PENETRATE_STRENGTH 2
    ife TEMP9 HOLLOW_POINT_SHOT mulvar PENETRATE_STRENGTH 3
    ife TEMP9 GREENLASERSHOT mulvar PENETRATE_STRENGTH 4
			
    ifvarvarl PENETRATE_STRENGTH MATERIAL_STRENGTH
    {
        geta[].x TEMP
        geta[].y TEMP2
        
        set TEMP3 TEMP
        add TEMP3 200
        add TEMP3 PENETRATE_STRENGTH

        geta[].ang TEMP4
        rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
        
        geta[].z TEMP8
        geta[myowner].z TEMP3
        sub TEMP3 TEMP8

        updatesectorz TEMP5 TEMP6 TEMP8 TEMP7
        ifn TEMP7 -1
        {
            espawn 5131
            geta[].extra TEMP3
            seta[RETURN].extra TEMP3
            seta[RETURN].x TEMP5 
            seta[RETURN].y TEMP6
            seta[RETURN].z TEMP8
            seta[RETURN].ang TEMP4
        }
    }
   
    getwall[hitwall].overpicnum FLOORTEX
    state CHECKSTEPS
    state BULLETHITSOUNDS
    ife FLOORTEX 5834 
	{ 
        getwall[hitwall].cstat TEMP
        ifn TEMP 32768
		{
            sound GLASS_BREAKING 
            lotsofglass 40 
            setwall[hitwall].cstat 32768 
            getwall[hitwall].nextwall TEMP
            setwall[TEMP].cstat 32768
		}
	}
    break
}

state getfloordist
ifl z 0 
{
	gets[].floorpicnum FLOORTEX
	state CHECKSTEPS
	state BULLETHITSOUNDS

	gets[].floorstat TEMP
	ifand TEMP 1 nullop else 
	ifand TEMP 2 nullop else
	ifn STEPSOUNDFX 9 
	{ 
		ife STEPSOUNDFX 1 spawn 3760 else 
		ife STEPSOUNDFX 23 spawn 3760 else 
		ife STEPSOUNDFX 11 spawn 3769 else 
		ife STEPSOUNDFX 18 spawn 3068 else
		ife STEPSOUNDFX 26 spawn 3068 else
		spawn 3754 
	} 
	break
}

state getceildist
ifl z 4
{
	gets[].ceilingstat TEMP
	ifand TEMP 1 break else
	ifand TEMP 2 nullop else
	ifn STEPSOUNDFX 9 { espawn 3754 setactorvar[RETURN].TEMP 1 }
	gets[].ceilingpicnum FLOORTEX
	state CHECKSTEPS
	state BULLETHITSOUNDS
	break
}
enda

defstate standard_pjibs
  guts JIBS1 1
  guts JIBS3 2
  guts JIBS4 1
  guts JIBS5 1
  guts JIBS6 2
  guts HUMAN_TORSO 1
  // guts DUKELEG 2
  guts HUMAN_ARM 1
  ifrnd 16 money 1
ends

move DUKENOTMOVING 0

defstate handle_dead_dukes

ifactor 6424
{
  sizeat 22 22
 ifspritepal 0 spritepal 21
}
else
ifactor 6126
	{
  sizeat 30 30
 ifspritepal 0 spritepal 11
	}
	else
sizeat 22 22

  fall
  ifmove 0   // 1st time initializiation...
  {
    ifrnd 128
      cstat 4
    else
      cstat 0
    move DUKENOTMOVING
  }

  ifsquished
  {
    state squish_sounds
    state random_ooz
    killit
  }
  else
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state standard_jibs
      killit
    }
  }
ends

action PLYINGFRAMES 0

actor DUKELYINGDEAD 0 PLYINGFRAMES
  state handle_dead_dukes
enda

defstate spawnbackpack
	ife COOP 1 // If they're playing co-op
		{
	    espawn 176
		getp[].ammo_amount 1 TEMP
		setactorvar[RETURN].TEMP3 TEMP
		getp[].ammo_amount 2 TEMP
		setactorvar[RETURN].TEMP4 TEMP
		getp[].ammo_amount 3 TEMP
		setactorvar[RETURN].TEMP5 TEMP
		getp[].ammo_amount 4 TEMP
		setactorvar[RETURN].TEMP6 TEMP
		getp[].ammo_amount 5 TEMP
		setactorvar[RETURN].TEMP7 TEMP
		getp[].palookup TEMP
		seta[RETURN].pal TEMP
		}
ends

defstate rescam // change camera back, and spawn the ammo backpack
ifmultiplayer 
	{
	setp[].over_shoulder_on 0
	state spawnbackpack
	}
ends

useractor notenemy 5358 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 25730 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 6361 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 5610 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 6126 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 6424 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 6703 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 6455 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 6943 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 7782 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 9934 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 26400 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 12876 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 16424 0 PLYINGFRAMES
  state handle_dead_dukes
enda

useractor notenemy 20886 0 PLYINGFRAMES
  state handle_dead_dukes
enda


move PSTOPED
move PSHRINKING // used as a var only

onevent EVENT_CHANGEWEAPON
ife temp_weapon 40 stopsound ZRAILGUN_IDLE
ife temp_weapon 17 stopsound CHAINSAW_IDLE
ife CHAR 6 stopsound RAILGUN_AMB
ife CHAR 14 stopsound SF_LG_HUM
ifn BOW_PULLBACK 0 set BOW_PULLBACK 0
set GUN_RECOIL_COUNT 0
state STOP_WEAPON_CHANGE

ifg fire_mode_menu 0 set RETURN -1
ifn GL_COUNTDOWN 0 set RETURN -1

ifn RETURN -1 set WEAP_SHOW 130

set AMMO_TYPE AMMO_TYPES[CURWEAP]

ife HIDE_CROSSHAIR 1 set HIDE_CROSSHAIR 0

ife RUSTY_BAYONET 1 set RUSTY_BAYONET 0
ifand GUNFIREMODE 16384 { set HIDE_CROSSHAIR 0 xorvar GUNFIREMODE 16384 }
ifand GUNFIREMODE 131072 { set HIDE_CROSSHAIR 0 xorvar GUNFIREMODE 131072 }
ifand GUNFIREMODE 32768 xorvar GUNFIREMODE 32768

endevent


defstate TAKETOROOM
set TEMP2 PLAYER_SPAWNPOINT[CHAR]
ife TEMP2 0 nullop
else
	{
	geta[TEMP2].x CSPAWNPOSX
	geta[TEMP2].y CSPAWNPOSY
	geta[TEMP2].z CSPAWNPOSZ
	geta[TEMP2].ang CSPAWNANG
	updatesectorz CSPAWNPOSX CSPAWNPOSY CSPAWNPOSZ TEMP
	}
ifn TEMP -1
ifn TEMP2 0
	{
	changespritesect THISACTOR TEMP
	setp[].cursectnum TEMP
	setp[].posx CSPAWNPOSX
	setp[].posy CSPAWNPOSY 
	setp[].posz CSPAWNPOSZ
	setp[].ang CSPAWNANG
	ife VOLUME 0 set PLAYER_VOICEOVER 52
	}
palfrom 64 0 0 0
ends

defstate RUNSOUNDS
randvar FOOTSTEPCOUNT 3

ifg player[].footprintcount 0 { ifonwater nullop else ifinwater nullop else sound WET_FOOT }

ifonwater ifn STEPSOUNDFX 12 ifn STEPSOUNDFX 13 set STEPSOUNDFX 16

ifonwater nullop else
{
ifp pboosted
ife CHAR 1
	sound BIG_BOOT_STEP
	
ife FIRE_SUIT 1
	sound BIG_BOOT_STEP
	
ife SPACE_SUIT 1
	sound BIG_BOOT_STEP
	
}
	
ife CHAR 2
{
ifand BITS_PRESS P_SPRINTING
	{
	espawn 2520 state SPAWN_IN_PLAYER_FRONT 
	ife FOOTSTEPCOUNT 0 setactorvar[RETURN].TEMP H_ARMOUR_S1 else
	ife FOOTSTEPCOUNT 1 setactorvar[RETURN].TEMP H_ARMOUR_S2 else
	ife FOOTSTEPCOUNT 2 setactorvar[RETURN].TEMP H_ARMOUR_S1 else
	ife FOOTSTEPCOUNT 3 setactorvar[RETURN].TEMP H_ARMOUR_S2 
	}
	else
	ifp prunning
	{
	ife FOOTSTEPCOUNT 0 sound H_ARMOUR_M1 else
	ife FOOTSTEPCOUNT 1 sound H_ARMOUR_M2 else
	ife FOOTSTEPCOUNT 2 sound H_ARMOUR_M3 else
	ife FOOTSTEPCOUNT 3 sound H_ARMOUR_M4 
	}
}
	
ife STEPSOUNDFX 0
{
ife CHAR 20
	{
	ife FOOTSTEPCOUNT 0 set playsound HEELS_1 else
	ife FOOTSTEPCOUNT 1 set playsound HEELS_2 else
	ife FOOTSTEPCOUNT 2 set playsound HEELS_3 else
	ife FOOTSTEPCOUNT 3 set playsound HEELS_4 
	}
	else
	{
	ife FOOTSTEPCOUNT 0 set playsound STEP1 else
	ife FOOTSTEPCOUNT 1 set playsound STEP2 else
	ife FOOTSTEPCOUNT 2 set playsound STEP3 else
	ife FOOTSTEPCOUNT 3 set playsound STEP4 
	}
}
ife STEPSOUNDFX 1
{
ife FOOTSTEPCOUNT 0 set playsound WOOD1 else
ife FOOTSTEPCOUNT 1 set playsound WOOD2 else
ife FOOTSTEPCOUNT 2 set playsound WOOD3 else
ife FOOTSTEPCOUNT 3 set playsound WOOD4
}
ife STEPSOUNDFX 2
{
ife FOOTSTEPCOUNT 0 set playsound TIN1 else
ife FOOTSTEPCOUNT 1 set playsound TIN2 else
ife FOOTSTEPCOUNT 2 set playsound TIN3 else
ife FOOTSTEPCOUNT 3 set playsound TIN4 
}
ife STEPSOUNDFX 3
{
ife FOOTSTEPCOUNT 0 set playsound GRATES1 else
ife FOOTSTEPCOUNT 1 set playsound GRATE2 else
ife FOOTSTEPCOUNT 2 set playsound GRATE3 else
ife FOOTSTEPCOUNT 3 set playsound GRATE4  
}
ife STEPSOUNDFX 4
{
ife FOOTSTEPCOUNT 0 set playsound GRASS1 else
ife FOOTSTEPCOUNT 1 set playsound GRASS2 else
ife FOOTSTEPCOUNT 2 set playsound GRASS3 else
ife FOOTSTEPCOUNT 3 set playsound GRASS4 
}
ife STEPSOUNDFX 5
{
ife FOOTSTEPCOUNT 0 set playsound TILE1 else
ife FOOTSTEPCOUNT 1 set playsound TILE2 else
ife FOOTSTEPCOUNT 2 set playsound TILE3 else
ife FOOTSTEPCOUNT 3 set playsound TILE4  
}
ife STEPSOUNDFX 6
{
ife FOOTSTEPCOUNT 0 set playsound CARPET1 else
ife FOOTSTEPCOUNT 1 set playsound CARPET2 else
ife FOOTSTEPCOUNT 2 set playsound CARPET3 else
ife FOOTSTEPCOUNT 3 set playsound CARPET4  
}
ife STEPSOUNDFX 7 set playsound 4 // just a blank sound file
ife STEPSOUNDFX 8
{
ife snowprint 0 { spawn SNOWPRINT1 set snowprint 1 } else ife snowprint 1 { spawn SNOWPRINT2 set snowprint 0 } 
ife FOOTSTEPCOUNT 0 set playsound SNOW1 else
ife FOOTSTEPCOUNT 1 set playsound SNOW2 else
ife FOOTSTEPCOUNT 2 set playsound SNOW3 else
ife FOOTSTEPCOUNT 3 set playsound SNOW4 
}
ife STEPSOUNDFX 9
{
	ife sector[].floorpicnum 5795 seta[].pal 11
	ife sector[].floorpicnum 7387 seta[].pal 14
   	espawn 8435
	seta[RETURN].z sector[].floorz
	geta[].pal TEMP
	seta[RETURN].pal TEMP
ife FOOTSTEPCOUNT 0 set playsound SLOSH1 else
ife FOOTSTEPCOUNT 1 set playsound SLOSH2 else
ife FOOTSTEPCOUNT 2 set playsound SLOSH3 else
ife FOOTSTEPCOUNT 3 set playsound SLOSH4
}
ife STEPSOUNDFX 10
{
ife FOOTSTEPCOUNT 0 set playsound DIRT1 else
ife FOOTSTEPCOUNT 1 set playsound DIRT2 else
ife FOOTSTEPCOUNT 2 set playsound DIRT3 else
ife FOOTSTEPCOUNT 3 set playsound DIRT4  
}
ife STEPSOUNDFX 11
{
ife FOOTSTEPCOUNT 0 set playsound CRETE1 else
ife FOOTSTEPCOUNT 1 set playsound CRETE2 else
ife FOOTSTEPCOUNT 2 set playsound CRETE3 else
ife FOOTSTEPCOUNT 3 set playsound CRETE4
}
ife STEPSOUNDFX 12
{
ife FOOTSTEPCOUNT 0 set playsound MUD1 else
ife FOOTSTEPCOUNT 1 set playsound MUD2 else
ife FOOTSTEPCOUNT 2 set playsound MUD3 else
ife FOOTSTEPCOUNT 3 set playsound MUD4 
}
ife STEPSOUNDFX 13
{
ife FOOTSTEPCOUNT 0 set playsound LAVA_SPLASH else
ife FOOTSTEPCOUNT 1 set playsound LAVA_SPLASH else
ife FOOTSTEPCOUNT 2 set playsound LAVA_SPLASH else
ife FOOTSTEPCOUNT 3 set playsound LAVA_SPLASH 
}
ife STEPSOUNDFX 14
{
ife FOOTSTEPCOUNT 0 { set playsound TIN1 sound SLOSH1 } else
ife FOOTSTEPCOUNT 1 { set playsound TIN2 sound SLOSH2 } else
ife FOOTSTEPCOUNT 2 { set playsound TIN3 sound SLOSH3 } else
ife FOOTSTEPCOUNT 3 { set playsound TIN4 sound SLOSH4 } 
}
ife STEPSOUNDFX 15
{
ife FOOTSTEPCOUNT 0 { set playsound STEP1 sound SLOSH1 } else
ife FOOTSTEPCOUNT 1 { set playsound STEP2 sound SLOSH2 } else
ife FOOTSTEPCOUNT 2 { set playsound STEP3 sound SLOSH3 } else
ife FOOTSTEPCOUNT 3 { set playsound STEP4 sound SLOSH4 } 
}
ife STEPSOUNDFX 16
{
  gets[].floorpicnum TEMP
	ife TEMP 5795 seta[].pal 11
	ife TEMP 7387 seta[].pal 14
   	espawn 8435
	geta[RETURN].z TEMP3
	add TEMP3 -512
	seta[RETURN].z TEMP3
	geta[].pal TEMP
	seta[RETURN].pal TEMP
ife FOOTSTEPCOUNT 0 set playsound WADE1 else
ife FOOTSTEPCOUNT 1 set playsound WADE2 else
ife FOOTSTEPCOUNT 2 set playsound WADE3 else
ife FOOTSTEPCOUNT 3 set playsound WADE4  
}
ife STEPSOUNDFX 17
{
ife FOOTSTEPCOUNT 0 set playsound CHAINLINK1 else
ife FOOTSTEPCOUNT 1 set playsound CHAINLINK2 else
ife FOOTSTEPCOUNT 2 set playsound CHAINLINK3 else
ife FOOTSTEPCOUNT 3 set playsound CHAINLINK4 
}
ife STEPSOUNDFX 18
{
ife FOOTSTEPCOUNT 0 set playsound GLASS1 else
ife FOOTSTEPCOUNT 1 set playsound GLASS2S else
ife FOOTSTEPCOUNT 2 set playsound GLASS3S else
ife FOOTSTEPCOUNT 3 set playsound GLASS4 
}
ife STEPSOUNDFX 19
{
ife FOOTSTEPCOUNT 0 set playsound CARDBOARD1 else
ife FOOTSTEPCOUNT 1 set playsound CARDBOARD2 else
ife FOOTSTEPCOUNT 2 set playsound CARDBOARD3 else
ife FOOTSTEPCOUNT 3 set playsound CARDBOARD4 
}
ife STEPSOUNDFX 20
{
ife FOOTSTEPCOUNT 0 set playsound MUD1 else
ife FOOTSTEPCOUNT 1 set playsound MUD2 else
ife FOOTSTEPCOUNT 2 set playsound MUD3 else
ife FOOTSTEPCOUNT 3 set playsound MUD4 
}
ife STEPSOUNDFX 21
{
ife FOOTSTEPCOUNT 0 set playsound MUD1 else
ife FOOTSTEPCOUNT 1 set playsound MUD2 else
ife FOOTSTEPCOUNT 2 set playsound MUD3 else
ife FOOTSTEPCOUNT 3 set playsound MUD4 
}
ife STEPSOUNDFX 22
{
ife FOOTSTEPCOUNT 0 set playsound LEAF1 else
ife FOOTSTEPCOUNT 1 set playsound LEAF2 else
ife FOOTSTEPCOUNT 2 set playsound LEAF3 else
ife FOOTSTEPCOUNT 3 set playsound LEAF4 
}
ife STEPSOUNDFX 23
{
ife FOOTSTEPCOUNT 0 set playsound PLANK1 else
ife FOOTSTEPCOUNT 1 set playsound PLANK2 else
ife FOOTSTEPCOUNT 2 set playsound PLANK3 else
ife FOOTSTEPCOUNT 3 set playsound PLANK4
}
ife STEPSOUNDFX 24
{
ife FOOTSTEPCOUNT 0 set playsound DUCT1 else
ife FOOTSTEPCOUNT 1 set playsound DUCT2 else
ife FOOTSTEPCOUNT 2 set playsound DUCT3 else
ife FOOTSTEPCOUNT 3 set playsound DUCT4
}
ife STEPSOUNDFX 25 
{
ife FOOTSTEPCOUNT 0 set playsound FORCEF_STEP1 else
ife FOOTSTEPCOUNT 1 set playsound FORCEF_STEP2 else
ife FOOTSTEPCOUNT 2 set playsound FORCEF_STEP3 else
ife FOOTSTEPCOUNT 3 set playsound FORCEF_STEP4
}
ife STEPSOUNDFX 26
{
ife FOOTSTEPCOUNT 0 set playsound ICE_1 else
ife FOOTSTEPCOUNT 1 set playsound ICE_2 else
ife FOOTSTEPCOUNT 2 set playsound ICE_3 else
ife FOOTSTEPCOUNT 3 set playsound ICE_4
}
ife STEPSOUNDFX 27
{
ife FOOTSTEPCOUNT 0 set playsound GRAVEL_1 else
ife FOOTSTEPCOUNT 1 set playsound GRAVEL_2 else
ife FOOTSTEPCOUNT 2 set playsound GRAVEL_3 else
ife FOOTSTEPCOUNT 3 set playsound GRAVEL_4
}
ife STEPSOUNDFX 28
{
ife snowprint 0 { espawn SNOWPRINT1 seta[RETURN].pal 19 set snowprint 1 } else 
ife snowprint 1 { espawn SNOWPRINT2 seta[RETURN].pal 19 set snowprint 0 } 
ife FOOTSTEPCOUNT 0 set playsound SAND_1 else
ife FOOTSTEPCOUNT 1 set playsound SAND_2 else
ife FOOTSTEPCOUNT 2 set playsound SAND_3 else
ife FOOTSTEPCOUNT 3 set playsound SAND_4
}
ife STEPSOUNDFX 30
{
ife FOOTSTEPCOUNT 0 set playsound BONE1 else
ife FOOTSTEPCOUNT 1 set playsound BONE2 else
ife FOOTSTEPCOUNT 2 set playsound BONE1 else
ife FOOTSTEPCOUNT 3 set playsound BONE2
}
ife STEPSOUNDFX 31
{
ife FOOTSTEPCOUNT 0 set playsound COINS_1 else
ife FOOTSTEPCOUNT 1 set playsound COINS_2 else
ife FOOTSTEPCOUNT 2 set playsound COINS_1 else
ife FOOTSTEPCOUNT 3 set playsound COINS_2
}
ife STEPSOUNDFX 32
{
ife FOOTSTEPCOUNT 0 set playsound MUD1 else
ife FOOTSTEPCOUNT 1 set playsound MUD2 else
ife FOOTSTEPCOUNT 2 set playsound MUD3 else
ife FOOTSTEPCOUNT 3 set playsound MUD4 
}
ife JUGGERN_SUIT 1
{
ife FOOTSTEPCOUNT 0 set playsound SUIT_STEP1 else
ife FOOTSTEPCOUNT 1 set playsound SUIT_STEP2 else
ife FOOTSTEPCOUNT 2 set playsound SUIT_STEP3 else
ife FOOTSTEPCOUNT 3 set playsound SUIT_STEP4 
}
ifn playsound 0 
{
soundvar playsound
ife cuts_txt -1
	{
	ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR playsound 512
	else ife CHAR 1 setactorsoundpitch THISACTOR playsound -256
	else ife CHAR 2 setactorsoundpitch THISACTOR playsound -128
	else ife CHAR 3 setactorsoundpitch THISACTOR playsound 128
	else ife CHAR 4 
		{
		ifand CHAR_APP 2 nullop else
		setactorsoundpitch THISACTOR playsound 128
		}
	else ife CHAR 7 setactorsoundpitch THISACTOR playsound -128
	else ife CHAR 10 setactorsoundpitch THISACTOR playsound 256
	else ife CHAR 20 setactorsoundpitch THISACTOR playsound 256
	}
}
resetactioncount
ends

defstate SELECTEDCHAR
	readarrayfromfile ARTIFACTS_LOADOUT 4014
	readarrayfromfile SPECIALIST_EQUIPMENT 4016
	
	ife CHAR 0 { setp[].max_player_health 100 seta[].extra 100 }
	ife CHAR 1 { setp[].max_player_health 255 seta[].extra 255 }
	ife CHAR 2 { setp[].max_player_health 200 seta[].extra 200 setp[].ammo_amount 1 3 }
	ife CHAR 3 { setp[].max_player_health 100 seta[].extra 100 }
	ife CHAR 4 
		{ 
		ife PERSONEL_RESEARCH[10] 2 { setp[].max_player_health 100 seta[].extra 100 } 
        else ifand CHAR_APP 2 { setp[].max_player_health 100 seta[].extra 100 }
		else { setp[].max_player_health 75 seta[].extra 75 }
		state spawn_bat
		}
	ife CHAR 5 
		{ 
		ife PERSONEL_RESEARCH[6] 2 { setp[].max_player_health 140 seta[].extra 140 } // Adamantium
		else { setp[].max_player_health 120 seta[].extra 120 }
		}
	ife CHAR 6 
        { 
	    ife PERSONEL_RESEARCH[6] 2 { setp[].max_player_health 140 seta[].extra 140 }
        else { setp[].max_player_health 120 seta[].extra 120 }
        }
	ife CHAR 7 // MIKKO
		{ 
			ife PERSONEL_RESEARCH[6] 2 // Both
			 ife PERSONEL_RESEARCH[9] 2 
			 {
			  setp[].max_player_health 200
			  seta[].extra 200
			 }
			 else
			ife PERSONEL_RESEARCH[6] 2 // Cybertour sheathing
				{
				setp[].max_player_health 170 
				seta[].extra 170
				}
				else 
			ife PERSONEL_RESEARCH[9] 2 // MS Corp ceramic plating
				{
				setp[].max_player_health 180
				seta[].extra 180
				}
			 else 
			 {
			setp[].max_player_health 150 
			seta[].extra 150
			}
		}
	ife CHAR 9 { setp[].max_player_health 100 seta[].extra 100 }
	ife CHAR 10 { setp[].max_player_health 100 seta[].extra 100 }
	ife CHAR 11 { setp[].max_player_health 150 seta[].extra 150 }
	ife CHAR 12 { setp[].max_player_health 100 seta[].extra 100 }
	ife CHAR 13 { setp[].max_player_health 100 seta[].extra 100 }
	ife CHAR 14 
		{ 
		ife PERSONEL_RESEARCH[10] 2 { setp[].max_player_health 75 seta[].extra 75 } else
		{ setp[].max_player_health 50 seta[].extra 50 }
		}
	getp[].max_player_health PMAXHEALTH
	ife ARTIFACTS_LOADOUT[CHAR] 11
		{
		add PMAXHEALTH 20
		setp[].max_player_health PMAXHEALTH
		seta[].extra PMAXHEALTH
		}

	
	ifn CHAR 2 setp[].ammo_amount 1 48
	set CHARSELECT 0 
	ifmultiplayer
	{
	qgetsysstr 356 STR_PLAYERNAME
	ife CHAR 0 qstrcat 356 357
	ife CHAR 1 qstrcat 356 358
	ife CHAR 2 qstrcat 356 359
	ife CHAR 3 qstrcat 356 360
	ife CHAR 4 qstrcat 356 361
	ife CHAR 5 qstrcat 356 362
	ife CHAR 6 qstrcat 356 363
	ife CHAR 7 qstrcat 356 364
	ife CHAR 9 qstrcat 356 365
	ife CHAR 10 qstrcat 356 366
	ife CHAR 11 qstrcat 356 367
	ife CHAR 12 qstrcat 356 368
	ife CHAR 13 qstrcat 356 369
	ife CHAR 14 qstrcat 356 370
	userquote 356
	}
	palfrom 64 0 0 0
	globalsound CHOSEN
	
		ife CHAR 0
			{
			readgamevar JAMES_1911
			readgamevar JAMES_JACKH
			}	
ends

move PGROWINGPOP        // Used only as a variable

onevent EVENT_LOADGAME
inittimer 120
endevent

defstate CHECKSTEPSOUNDS
ife player[].spritebridge 1 // IF THE PLAYER IS ON A FLAT SPRITE
	{ 
	getp[].sbs TEMP2 // GET THE FLATSPRITE'S ID TAG
	set FLOORTEX sprite[TEMP2].picnum // SET THE VARIABLE FLOORTEX TO IT'S TEXTURE
	state CHECKSTEPS // AND CHECK THE STEP DEFINES
	} 
else
ifand sector[].floorstat 65536 set STEPSOUNDFX 9
else
state CHECKSTEPS
ends

defstate PLAYER_FROZECODE
    cstat 257
	spritepal 1
	setp[].weapon_pos 10

    fall
	set screen_pal 1
    palfrom 16 0 0 24

    ifmove 0
    {
      ifhitweapon
      {
        ifwasweapon FREEZEBLAST
          break
        lotsofglass 60
        ifrnd 84
          spawn BLOODPOOL

        sound GLASS_BREAKING
        spawn AMULET

        getlastpal

        move 1
        break
      }
    }
    else
    {
      cstat 32768
      quote 13
      ifhitspace
      {
        action 0
        resetplayer
      }
      break
    }

    ifactioncount THAWTIME
    {
      getlastpal
      strength 1
      move 0
      action 0
    }
    else
      ifactioncount FROZENDRIPTIME
    {
      ifrnd 32
      spawn WATERDRIP
    }

    ifp pfacing   // assumes another other player  (multiplayer)
      ifpdistl FROZENQUICKKICKDIST
       ifn COOP 1
        pkick

    break
ends

/* APlayer actor */

actor APLAYER MAXPLAYERHEALTH 0 0 0
getp[].i PLAYER_IDENTITY
gets[].floorpicnum FLOORTEX
getp[].curr_weapon CURWEAP
getp[].ammo_amount CURWEAP CUR_AMMO
getp[].shield_amount PARMOUR
geta[].extra PHEALTH
getp[].kickback_pic KICKBACKPIC
getp[].max_player_health PMAXHEALTH
setp[].weaponswitch 0
geta[].htextra HIT_DAMAGE
ife player[].toggle_key_flag 1 ife player_hitspace 0 set player_hitspace 1 else ife player[].toggle_key_flag 0 set player_hitspace 0
set P_CHAR CHAR

ifg IFF_COOLD 0 subvar IFF_COOLD 1
ifg FORTUNE_TIMER 0 sub FORTUNE_TIMER 1

ifg DS_LOCATION 0 sub DS_LOCATION 1

ifg voice_cooldown 0 sub voice_cooldown 1

ifg CUS_WACK 0
	{
	ifg CUS_WACK 8
		{
		getp[].horiz TEMP
		add TEMP 80
		ifg TEMP 298 set CUS_WACK 7
		setp[].horiz TEMP
		}
	else
		{
		getp[].horiz TEMP
		sub TEMP 20
		setp[].horiz TEMP		
		}
	sub CUS_WACK 1
	clamp CUS_WACK 0 30
	}

ifg saving 0
	{
	sub saving 1
	ife saving 28 savenn 9
	}
	
ifn ALLYSLOT2 -1
	{
	ife ALLYSLOT1 -1 
		{
		set ALLYSLOT1 ALLYSLOT2
		set ALLYSLOT2 -1
		}
	}
	
ifn ALLYSLOT3 -1
	{
	ife ALLYSLOT2 -1 
		{
		set ALLYSLOT2 ALLYSLOT3
		set ALLYSLOT3 -1
		}
	}
	
ifn ALLYSLOT4 -1
	{
	ife ALLYSLOT3 -1 
		{
		set ALLYSLOT3 ALLYSLOT4
		set ALLYSLOT4 -1
		}
	}

ifg cameraend 0 sub cameraend 1

ifhitspace setp[].crack_time 6

ifn gp_subt 0
{
ifg gp_subt 0 // countdown timer for subtitles
	{
	ifn cuts_txt -1 { set gp_subt 0 stopsoundvar playsound }
	else sub gp_subt 1 
	}
ifl gp_subt 0 set gp_subt 0
}
	
ife gp_subt 0 ifn subt_id 0 set subt_id 0 // resets subtitle id when timer is zero
ifg ally_subt 0 sub ally_subt 1 // countdown timer for ally subtitles

ifg SP_FADEF 0 sub SP_FADEF 4

ifg DISP_PULSE 0
	{
	sub DISP_PULSE 1
	ifl DISP_PULSE 2 set DISP_PULSE 16
	}

ifl GUN_RECOIL_COUNT 0 set GUN_RECOIL_COUNT 0

ife player[].player_par 1 
	{
	ife VOLUME 3
		{
		ife LEVEL 5 { set DS_PICNUM 21197 set DS_LOCATION 181 }
		ife LEVEL 6 { set DS_PICNUM 21196 set DS_LOCATION 181 }
		ife LEVEL 7 { set DS_PICNUM 21198 set DS_LOCATION 181 }
		ife LEVEL 8 { set DS_PICNUM 21200 set DS_LOCATION 181 }
		ife LEVEL 10 { set DS_PICNUM 21199 set DS_LOCATION 181 }
		ife LEVEL 11 { set DS_PICNUM 21201 set DS_LOCATION 181 }
		ife LEVEL 12 { set DS_PICNUM 21208 set DS_LOCATION 181 }
		ife LEVEL 15 { set DS_PICNUM 21206 set DS_LOCATION 181 }
		ife LEVEL 16 { set DS_PICNUM 21202 set DS_LOCATION 181 }
		ife LEVEL 17 { set DS_PICNUM 21205 set DS_LOCATION 181 }
		ife LEVEL 20 { set DS_PICNUM 21207 set DS_LOCATION 181 }
		ife LEVEL 25 { set DS_PICNUM 21203 set DS_LOCATION 181 }
		ife LEVEL 26 { set DS_PICNUM 21204 set DS_LOCATION 181 }
		}
	ifg loading 0 set loading 0 else
	palfrom 64 0 0 0
	}

ifg BUTTON_COUNTER 0 sub BUTTON_COUNTER 1

ifg CURSED 0 sub CURSED 1
	
ifg SHIELDUP 0 ife RIOTSHIELD 0 set SHIELDUP 0

ife AMC_BASE 1 
	{
	set SHIELDUP 0
	set MSHIELDUP 0
	set HIDE_CROSSHAIR 1 
	setp[].weapon_pos 10
	}

ifn player[].somethingonplayer -1
{

    ife HELMET_LOADOUT[CHAR] 1 // if wearing ballistic mask
    {
        setp[].somethingonplayer -1
        sound HITARMOUR2
    }
    else 
    {
        getp[].somethingonplayer TEMP
        ife sprite[TEMP].pal 3
        {
            addphealth -100
        }
    }	
	
}

ife JET_TOGGLE 1
	{
	ifand BITS_PRESS 1 nullop else
		{
		sound DUKE_JETPACK_OFF
		setp[].falling_counter 6
		setp[].poszv 0
		setp[].jetpack_on 0
		set JET_TOGGLE 0
		}
	}

ifg userdef[].screen_size 4 setuserdef[].screen_size 4

ife DYNAMIC_MUSIC YES
{
getuserdef[].musictoggle TEMP9
ife TEMP9 1
	{
	ife VOLUME 0
	 ife LEVEL 7
		{
		set TEMP6 PMAXHEALTH
		divvar TEMP6 4
		ife MUSIC_LEVEL 0 
			{
			ifsound ACTIONM_LVL1 set MUSIC_PLAY 1 else
			ifsound ACTIONM_LVL2 set MUSIC_PLAY 1 else
			ifsound ACTIONM_LVL3 set MUSIC_PLAY 2 else
			ifsound ACTIONM_BOSS set MUSIC_PLAY 2 else
				{
				ife MUSIC_PLAY 1 { soundonce ACTIONM_SMALLSTOP set MUSIC_PLAY 0 }
				else ife MUSIC_PLAY 2 { soundonce ACTIONM_BIGSTOP set MUSIC_PLAY 0 }
				soundonce ACTIONM_CALM
				ifvarvarl PHEALTH TEMP6 setactorsoundpitch THISACTOR ACTIONM_CALM -96
				}
			}
		else ife MUSIC_LEVEL 1 
			{ 
			stopsound ACTIONM_CALM 
			soundonce ACTIONM_LVL1 
			ifvarvarl PHEALTH TEMP6  setactorsoundpitch THISACTOR ACTIONM_LVL1 96
			}
		else ife MUSIC_LEVEL 2 
			{ 
			stopsound ACTIONM_CALM stopsound ACTIONM_LVL1 
			soundonce ACTIONM_LVL2 
			ifvarvarl PHEALTH TEMP6  setactorsoundpitch THISACTOR ACTIONM_LVL2 96
			}
		else ife MUSIC_LEVEL 3 
			{ 
			stopsound ACTIONM_CALM stopsound ACTIONM_LVL1 stopsound ACTIONM_LVL2 
			soundonce ACTIONM_LVL3 
			ifvarvarl PHEALTH TEMP6  setactorsoundpitch THISACTOR ACTIONM_LVL3 96
			}
		else ife MUSIC_LEVEL 4 
			{ 
			stopsound ACTIONM_CALM stopsound ACTIONM_LVL1 stopsound ACTIONM_LVL2 stopsound ACTIONM_LVL3 
			soundonce ACTIONM_BOSS 
			ifvarvarl PHEALTH TEMP6  setactorsoundpitch THISACTOR ACTIONM_BOSS 96
			}
		}
		
	ifl MUSIC_CHECK 160
		{
		add MUSIC_CHECK 1
		ifg MUSIC_CHECK 158 set MUSIC_LEVEL 0
		}
	}
}

ifn COMBAT_CHECK -1
{
ifn CC_MUSIC 0 soundoncevar CC_MUSIC
}

ifl ENEMIES_CLEARED 150
	{
	add ENEMIES_CLEARED 1
	}

ife weather_type 2 // low gravity
	{
	getp[].poszv TEMP8
	ifg TEMP8 0 divvar TEMP8 2
	setp[].poszv TEMP8
	}
else
ife weather_type 3 // zero gravity
	{
	setp[].autostep 4096
	getp[].poszv TEMP8
	setp[].falling_counter 0
	ifl TEMP8 -1000 set ZERO_G_ZVEL 1
	
	ife ZERO_G_ZVEL 1 // up
	  {
	  setp[].poszv -1200
	  ifand BITS_PRESS 2
	   ifcount 6
		{
		screensound SPACESUIT_THRUSTER
		set ZERO_G_ZVEL 0
		setp[].poszv 0
		resetcount
		}
	  }
	 else
	 ife ZERO_G_ZVEL 0 // 'stable'
	  {
	  setp[].poszv 0
	  ifand BITS_PRESS 2
	   ifcount 6
		{
		screensound SPACESUIT_THRUSTER
		set ZERO_G_ZVEL 3
		setp[].poszv 2400
		resetcount
		}
	   ifand BITS_PRESS 1
	    ifcount 6
		{
		screensound SPACESUIT_THRUSTER
		set ZERO_G_ZVEL 1
		setp[].poszv -1200
		resetcount
		}
	  }
	else
	 ife ZERO_G_ZVEL 3 // down
	  {
	  setp[].poszv 2400
	  ifand BITS_PRESS 1
	   ifcount 6
		{
		screensound SPACESUIT_THRUSTER
		set ZERO_G_ZVEL 0
		setp[].poszv -1200
		resetcount
		}
	  }
	else
	ifg TEMP8 0 { divvar TEMP8 20 setp[].poszv TEMP8 }
	}
else
ifand sector[].ceilingstat 16384 // low gravity
	{
	getp[].poszv TEMP8
	ifg TEMP8 0 divvar TEMP8 2
	setp[].poszv TEMP8
	}
	


ifg GUN_SPREAD 0
{ 
sub GUN_SPREAD 1
ifp pstanding sub GUN_SPREAD 1
ifg SKILL_LEVEL 2
	{
	set TEMP2 GUN_MAX_SPREAD
	ifg AGENT_FATIGUE[CHAR] 20000 add TEMP2 24
	else ifg AGENT_FATIGUE[CHAR] 10000 add TEMP2 12
	else ifg AGENT_FATIGUE[CHAR] 5000 add TEMP2 4
	ifvarvarg GUN_SPREAD TEMP2 set GUN_SPREAD TEMP2
	}
else
	ifvarvarg GUN_SPREAD GUN_MAX_SPREAD set GUN_SPREAD GUN_MAX_SPREAD
}
else ifl GUN_SPREAD 0 set GUN_SPREAD 0

ifn ENEMY_KILLED 0
{
ifrnd 16 set ENEMY_KILLED 0
}

ifn DEATH_CAM -1
	{
	operateactivators DEATH_CAM THISACTOR
	operatemasterswitches DEATH_CAM
	operaterespawns DEATH_CAM
	set DEATH_CAM -1
	}


getuserdef[].god TEMP2
ife TEMP2 1 set CHEATED 1

ifn FORCEFIELD_TURNOFF -1
{
			set TEMP3 0
				whilevarvarn TEMP3 NUMWALLS
					{
						getwall[TEMP3].lotag TEMP5
						ifvarvare TEMP5 FORCEFIELD_TURNOFF
							{
							setwall[TEMP3].overpicnum 0
							setwall[TEMP3].cstat 0
							}
					add TEMP3 1
					}
				set FORCEFIELD_TURNOFF -1
}

ifg HIT_DAMAGE 0                            // if the actor is set to take some damage from a weapon...
{
ife PLAYER_PROTECTED 1 seta[].htextra -1
geta[].htpicnum TEMP3
  geta[].htowner TEMP2      // gets the owner of the weapon into TEMP
  ifvarvare TEMP2 THISACTOR              // if the owner of the weapon IS this actor
	{
	switch TEMP3
	case REDM_BLAST
	case 7163 // fire materia
	case 7159 // ice materia
    seta[].htextra -1       // set the damage to 0
	break
	endswitch
	}
	ife TEMP3 14975 setactorvar[TEMP2].THROW_GRENADE 1
}

ifg flash_banged 0
	{
	soundonce FLASH_BANGED
	palfrom 64 64 64 64
	sub flash_banged 1
	}
ifl flash_banged 0 set flash_banged 0

ife userdef[].althud 0 set WEAP_SHOW 30
 
ifg mission_update 0 sub mission_update 1


ife GUN_HANDS 2 set HANDS_DRAW 2 else ife GUN_HANDS 1 set HANDS_DRAW 1

ifg GUN_HEAT[CURWEAP] 0
	{
	set TEMP9 GUN_HEAT[CURWEAP]
	sub TEMP9 1
	ifinwater sub TEMP9 1
	ife weather_type 1 sub TEMP9 1
	setarray GUN_HEAT[CURWEAP] TEMP9
	}
ifl GUN_HEAT[CURWEAP] 0 setarray GUN_HEAT[CURWEAP] 0

ife JUST_INIT 0
	{ 
	setvar DISP_MAINMENU 0
	setarray INVENTORY_SLOTS[1] 1
	setarray INVENTORY_SLOTS[2] 2
	setarray INVENTORY_SLOTS[3] 3
	setarray INVENTORY_SLOTS[4] 4
	setarray INVENTORY_SLOTS[5] 5
	setarray INVENTORY_SLOTS[6] 6
	setarray INVENTORY_SLOTS[7] 7
	set MISSIONPOS 320
	readarrayfromfile SKILL_MEDALS 4030
	readarrayfromfile SPECIALIST_CUSTOM 4045
	readarrayfromfile AGENT_FATIGUE 4060
	readarrayfromfile WEAPONS_RESEARCH 4000
	getp[].horiz PHORIZ
	getp[].ang PANG
	
	readarrayfromfile BEAT_EPISODES 4053
	ife BEAT_EPISODES[0] 0
		{
		readgamevar BEATEP1
		readgamevar BEATEP2
		readgamevar BEAT_EDF
		readgamevar BEAT_EXTRA
		setarray BEAT_EPISODES[1] BEATEP1
		setarray BEAT_EPISODES[2] BEATEP2

		setarray BEAT_EPISODES[6] BEAT_EDF
		setarray BEAT_EPISODES[7] BEAT_EXTRA
		setarray BEAT_EPISODES[0] 1
		writearraytofile BEAT_EPISODES 4053
		}
		

	
	ife VOLUME 0
	{
	readarrayfromfile BEAT_EPISODES 4053
	ife LEVEL 7 
		{
		set EP2_NEW_CHARACTERS 1 
		set EP3_NEW_CHARACTERS 1 
		}
	else
		{
		set EP2_NEW_CHARACTERS 0
		set EP3_NEW_CHARACTERS 0
		}
	ifand BEAT_EPISODES[2] 1024 set EP2_NEW_CHARACTERS 1 // If EP2 beaten, allow Mick selection
	ifand BEAT_EPISODES[3] 65536 set EP3_NEW_CHARACTERS 1 // If EP3 beaten, allow Snowfall selection
		readgamevar EP1_GOT_GOLD
		ifn EP1_GOT_GOLD 1
			{
			ifg SKILL_MEDALS[1] 2
			 ifg SKILL_MEDALS[2] 2
			  ifg SKILL_MEDALS[3] 2
			   ifg SKILL_MEDALS[4] 2
				ifg SKILL_MEDALS[5] 2
				 ifg SKILL_MEDALS[6] 2
				  ifg SKILL_MEDALS[7] 2
					{
					set EP1_GOT_GOLD 1
					savegamevar EP1_GOT_GOLD				
					}
			}
		readgamevar EP1_GOT_PLATINUM
		ifn EP1_GOT_PLATINUM 1
			{
			ifg SKILL_MEDALS[1] 3
			 ifg SKILL_MEDALS[2] 3
			  ifg SKILL_MEDALS[3] 3
			   ifg SKILL_MEDALS[4] 3
				ifg SKILL_MEDALS[5] 3
				 ifg SKILL_MEDALS[6] 3
				  ifg SKILL_MEDALS[7] 3
					{
					set EP1_GOT_PLATINUM 1
					savegamevar EP1_GOT_PLATINUM				
					}
			}
		}	
		
		
		
// 8 = City Under Siege
// 9 = Big Trouble in Little China
// 10 = Wharf
// 11 = Chisland
// 12 = Tower of Life
// 13 = Hidden Dojo
// 14 = Oilrig
// 20 = Repent
// 21 = Ghost Ship
// 22 = Ganymede FOB
// 23 = Stygian memorial
// 24 = Xuglop Train
// 25 = Far mountain reaches
// 26 = Space Station
// 27 = Mars Colony
// 28 = Corrupted Mine
// 29 = Jungle Base
// 30 = Shadow Realm
		
	ife VOLUME 1
	{
	set EP2_NEW_CHARACTERS 1
	ifand BEAT_EPISODES[3] 65536 set EP3_NEW_CHARACTERS 1 // If EP3 beaten, allow Snowfall selection
	else set EP3_NEW_CHARACTERS 0
		readgamevar EP2_GOT_GOLD
		ifn EP2_GOT_GOLD 1
			{
			ifg SKILL_MEDALS[8] 2
			 ifg SKILL_MEDALS[9] 2
			  ifg SKILL_MEDALS[10] 2
			   ifg SKILL_MEDALS[11] 2
				ifg SKILL_MEDALS[12] 2
				 ifg SKILL_MEDALS[21] 2
				  ifg SKILL_MEDALS[25] 2
				   ifg SKILL_MEDALS[26] 2
				    ifg SKILL_MEDALS[27] 2
					 ifg SKILL_MEDALS[30] 2
					{
					set EP2_GOT_GOLD 1
					savegamevar EP2_GOT_GOLD				
					}
			}
		readgamevar EP2_GOT_PLATINUM
		ifn EP2_GOT_PLATINUM 1
			{
			ifg SKILL_MEDALS[8] 3
			 ifg SKILL_MEDALS[9] 3
			  ifg SKILL_MEDALS[10] 3
			   ifg SKILL_MEDALS[11] 3
				ifg SKILL_MEDALS[12] 3
				 ifg SKILL_MEDALS[21] 3
				  ifg SKILL_MEDALS[25] 3
				   ifg SKILL_MEDALS[26] 3
				    ifg SKILL_MEDALS[27] 3
					 ifg SKILL_MEDALS[30] 3
					{
					set EP2_GOT_PLATINUM 1
					savegamevar EP2_GOT_PLATINUM				
					}
			}
		}

	ife VOLUME 2
	{
	set EP3_NEW_CHARACTERS 1
		readgamevar EP3_GOT_GOLD
		ifn EP3_GOT_GOLD 1
			{
			ifg SKILL_MEDALS[40] 2
			 ifg SKILL_MEDALS[43] 2
			  ifg SKILL_MEDALS[44] 2
			   ifg SKILL_MEDALS[45] 2
				ifg SKILL_MEDALS[50] 2
				 ifg SKILL_MEDALS[51] 2
				  ifg SKILL_MEDALS[53] 2
				    ifg SKILL_MEDALS[55] 2
					  ifg SKILL_MEDALS[57] 3					
					   ifg SKILL_MEDALS[58] 2
					{
					set EP3_GOT_GOLD 1
					savegamevar EP3_GOT_GOLD				
					}
			}
		readgamevar EP3_GOT_PLATINUM
		ifn EP3_GOT_PLATINUM 1
			{
			ifg SKILL_MEDALS[40] 3
			 ifg SKILL_MEDALS[43] 3
			  ifg SKILL_MEDALS[44] 3
			   ifg SKILL_MEDALS[45] 3
				ifg SKILL_MEDALS[50] 3
				 ifg SKILL_MEDALS[51] 3
				  ifg SKILL_MEDALS[53] 3
				    ifg SKILL_MEDALS[55] 3
					  ifg SKILL_MEDALS[57] 3
					   ifg SKILL_MEDALS[58] 3
					{
					set EP3_GOT_PLATINUM 1
					savegamevar EP3_GOT_PLATINUM				
					}
			}
		}			
		
	ifg VOLUME 0 set EP2_NEW_CHARACTERS 1
	ifg VOLUME 1 set EP3_NEW_CHARACTERS 1	
		
	resizearray TEMP_WEAPON_LOADOUT 32
	resizearray MELEE_WEAPON_LOADOUT 32
	resizearray SPECIALIST_EQUIPMENT 128
	resizearray SPECIALIST_LOADOUT 128
	espawn SHOOTME2
	setactorvar[RETURN].IS_PLAYER 1
	getuserdef[].player_skill SKILL_LEVEL
	resizearray PERSONEL_RESEARCH 63
	readarrayfromfile PERSONEL_RESEARCH 4002
	readarrayfromfile MYSTICAL_RESEARCH 4004
	readarrayfromfile MELEE_RESEARCH 4020
	ife LOADING_SCREEN_HINT 0 displayrandvar LOADING_SCREEN_HINT NUMBER_OF_HINTS 
	ife CHAR 4 state spawn_bat
	set JUST_INIT 1
	}
	
ife SPACE_SUIT 1
 ifn CHAR 12
  ifn CHAR 13
   ifn CHAR 14
	{
	ife CURWEAP 0 ifand WEAPON_SPECIAL[0] 64 nullop else
	setp[].weapon_pos -9
	ifg inspace 0
	 ife PLAYER_VOICEOVER 0
		{
		ife CHAR 0 soundonce JGASMASK 
		ife CHAR 1 soundonce ZGASMASK
		ife CHAR 4 soundonce SGASMASK		
		}	
	}
	
ifg inspace 0
	{
	setp[].sound_pitch -200 
	ife CHAR 14
		{
		ifg LIFE_SUPPORT 0 
			{
			soundonce LIFE_SUPPORT_ACT
			ife camerasprite -1 sub LIFE_SUPPORT 1
			}
		state SPACESUIT_BEEPS
		ife LIFE_SUPPORT 0 
		 ife camerasprite -1
			{
			palfrom 20 64 64 64
			wackplayer
			ifg PARMOUR 0 { getp[].shield_amount TEMP sub TEMP 1 setp[].shield_amount TEMP }
			else addphealth -1
			}
		}
	else
	ife CHAR 13
		{
		ifg LIFE_SUPPORT 0 
			{
			soundonce LIFE_SUPPORT_ACT
			ife camerasprite -1 sub LIFE_SUPPORT 2
			}
		state SPACESUIT_BEEPS
		ife LIFE_SUPPORT 0 
		 ife camerasprite -1
			{
			palfrom 20 64 64 64
			wackplayer
			ifg PARMOUR 0 { getp[].shield_amount TEMP sub TEMP 1 setp[].shield_amount TEMP }
			else addphealth -2
			}
		}
	else
	ife CHAR 12
		{
		ifg LIFE_SUPPORT 0 
			{
			soundonce LIFE_SUPPORT_ACT
			ife camerasprite -1 sub LIFE_SUPPORT 2
			}
		state SPACESUIT_BEEPS
		ife LIFE_SUPPORT 0 
		 ife camerasprite -1
			{
			palfrom 20 64 64 64
			wackplayer
			ifg PARMOUR 0 { getp[].shield_amount TEMP sub TEMP 1 setp[].shield_amount TEMP }
			else addphealth -2
			}
		}
	else
		{
		ife SPACE_SUIT 0
		 ife camerasprite -1
			{
			palfrom 20 64 64 64
			wackplayer
			addphealth -2
			}
		else
		ife SPACE_SUIT 1
			{
			ife PERSONEL_RESEARCH[27] 2 { ifg LIFE_SUPPORT 21600 set LIFE_SUPPORT 21600 }
			else ifg LIFE_SUPPORT 14400 set LIFE_SUPPORT 14400
			state SPACESUIT_BEEPS
			ifg LIFE_SUPPORT 0 
				{
				soundonce LIFE_SUPPORT_ACT
				ife camerasprite -1 sub LIFE_SUPPORT 2
				}
			ife LIFE_SUPPORT 0 
			 ife camerasprite -1
				{
				palfrom 20 64 64 64
				wackplayer
				addphealth -2
				}
			}
		}
	}
	
ifg ingas 0
	{
	ifn ingas 26 setp[].weapon_pos 10
	ifg GAS_MASK 0 { ife ENEMIES_CLEARED 150 sub ingas 1 }
	else sub ingas 1
	ife ingas 1 { setp[].sound_pitch 0 setgamepalette 0 }
	}
	
ifinwater nullop else
ifg PLAYER_VOICEOVER 0 state PLAYER_VOICES

ifg COUNTER 0 sub COUNTER 1
ifg COUNTER_2 0 sub COUNTER_2 1

	getuserdef[].idplayers TEMP
	ife TEMP 1
	{
	
	ifg ALARM_COUNTER 0 sub ALARM_COUNTER 1
	ifg ALARM_ACTIVE 0 sub ALARM_ACTIVE 1
	
	ifg ALARM_DETECT 0
		{
		sub ALARM_DETECT 1
		
		ife COUNTER_2 0
		ife ALARM_ACTIVE 0
			{
			ifg ALARM_COUNTER 30 soundonce ALARM_L2
			else ifg ALARM_COUNTER 0 soundonce ALARM_L1
			set COUNTER_2 26
			}
		}
	
	}

ifand player[].gm 8
{
	switch VOLUME
	case 0
	 ifn LEVEL 0
	 ifn LEVEL 1
	 ifn LEVEL 2
	 ifn LEVEL 6
	 ifn LEVEL 17
		state save_arrays
		state fatigue_system
		state budget_system
	break
	case 6
	 ifn LEVEL 0
	 ifn LEVEL 5
	 ifn LEVEL 10
	 ifn LEVEL 15
	 ifn LEVEL 20
	 ifn LEVEL 25
		state save_arrays
		state fatigue_system
		state budget_system
	break
	endswitch
} 


ife CURWEAP 0 
{	
set GUNMAG -1
ifg weaponcount 11 // ugly hack for hardcoded reduction of player speed for slot0 animation
	{
	getp[].posxv TEMP
		mulvar TEMP 15
		divvar TEMP 12
		setp[].posxv TEMP
		getp[].posyv TEMP
		mulvar TEMP 15
		divvar TEMP 12
		setp[].posyv TEMP
	}
ife temp_weapon 0
	{
	set GUN_ACCURACY 16
	ifn MELEE_LOCKED_ON -1
		{
		geta[MELEE_LOCKED_ON].extra TEMP
		ifl TEMP 1 set MELEE_LOCKED_ON -1
		else
			{
			geta[MELEE_LOCKED_ON].x mx
			geta[MELEE_LOCKED_ON].y my
			getp[].posx x
			getp[].posy y
			sub mx x
			sub my y
			getangle ANGVAR mx my
			ifg SPIN_KICK 13
			ifg ROUNDHOUSE_KICK 26
			setp[].ang ANGVAR
			dist TEMP THISACTOR MELEE_LOCKED_ON
			ifg TEMP 5000 set MELEE_LOCKED_ON -1
			}
		}
	}
}

ifmultiplayer
{
ife COOP 1
	{
	ife player[].reloading 1
	ife KICKBACKPIC 10
		{
			ifpdistl 8000
			{
			ife CHAR 0 soundonce J_RELOAD
			ife CHAR 1 soundonce Z_RELOAD
			ife CHAR 2 soundonce M_RELOAD
			ife CHAR 3 soundonce R_RELOAD
			ife CHAR 4 soundonce S_RELOAD
			ife CHAR 5 soundonce RN_RELOAD
			ife CHAR 6 soundonce G_RELOAD
			ife CHAR 7 soundonce MS_RELOAD
			qgetsysstr 356 STR_PLAYERNAME
			qstrcat 356 645
			userquote 356
			}
		}
	}
}


ifg P_CREDITS 0
{
add CREDITS P_CREDITS
set P_CREDITS 0
}

ifg HACKING_PROGRESS 0 
	{
	lockplayer 10
	setp[].movement_lock 33
	sub HACKING_PROGRESS 1
	}
	else
	ife HACKING_PROGRESS 0
	{
	setp[].movement_lock 0
	set HACKING_PROGRESS -1
	}
	
ifg SWORD_RAMP 2
{
    soundonce SWORD_RAMP_M
	sub SWORD_RAMP 1
	ife SWORD_RAMP 60 soundonce GO_SLOW
		
	ife CURWEAP 0
	{
	switch temp_weapon
		case 19 // katana
		case 20 // mop
		case 36 // SW sword
		case 37 // beam sabre
		 ifn player[].palette 5 setgamepalette 5
		 ifg HIT_DAMAGE -1 { seta[].htextra -1 set HIT_DAMAGE -1 }
		break
		default
		 ifn player[].palette 4 setgamepalette 4
		 palfrom 20 20 0 0
		 break
		endswitch
	}
	else
	{
	ifn player[].palette 4 setgamepalette 4
	palfrom 20 20 0 0
	}
}
else
ifg SWORD_RAMP 0
{
	stopsound SWORD_RAMP_M
	palfrom 40 40 40 40
	sub SWORD_RAMP 1
	setgamepalette 0
}

ifp palive // improved jumping code by Dan Gaskil
	{
	ifp pducking nullop else
	ifn player[].cursectnum -1
		{
			getp[].cursectnum mysector
			ifn sector[mysector].floorslope 0
			{
				getflorzofslope mysector player[].posx player[].posy z // temp is the return var
				// posz is normally 9748 higher (less z) than surface
				// the diff is reduced by about 512 for 1st tic of jump, then increases
				// after landing, the diff is reduced again for a few tics
				// when fully crouched, the diff is 4609
				getp[].posz TEMP
				add TEMP 9748
				sub TEMP z
				// we want to allow jumping when temp is slightly negative
				ifand BITS_PRESS 1
				ife player[].jumping_counter 0
				ifg TEMP -3804
				ife player[].jumping_toggle 0
				{
					setp[].jumping_counter 1
				}
			}
		}
	}


ife force_taunt 13 
{
ifinwater break
	ife CHAR 0
  	{
		ife CURWEAP 0
		 ife temp_weapon 19
		{
		randvar swear_random 160
		ifl swear_random 20 set playsound J_SWORD_TAUNT1 else
		ifl swear_random 40 set playsound J_SWORD_TAUNT2 else
		ifl swear_random 60 set playsound J_SWORD_TAUNT3 else
		ifl swear_random 80 set playsound J_SWORD_TAUNT4 else
		ifl swear_random 100 set playsound J_SWORD_TAUNT5 else
		ifl swear_random 120 set playsound J_SWORD_TAUNT6 else
		ifl swear_random 140 set playsound J_SDRAW_TAUNT1 else
		ifl swear_random 160 set playsound J_SDRAW_TAUNT2
		}
		else
		{
		randvar swear_random 160
		ifl swear_random 20 set playsound JFIREHOLE else
		ifl swear_random 40 set playsound JBLEACH else
		ifl swear_random 60 set playsound JGAS else
		ifl swear_random 80 set playsound JMASTER else
		ifl swear_random 100 set playsound JSUGAR else
		ifl swear_random 120 set playsound JWANTSOME else
		ifl swear_random 140 set playsound J_SMALLTIME else
		ifl swear_random 160 set playsound J_PEEK
		}
  	}
  else
  	ife CHAR 1
  	{
	randvar swear_random 280
	ifl swear_random 20 set playsound ZGUYSUCK else
	ifl swear_random 40 set playsound ZGOOD else
	ifl swear_random 60 set playsound ZGROSS else
	ifl swear_random 80 set playsound ZGOD else
	ifl swear_random 100 set playsound ZDEADS else
	ifl swear_random 120 set playsound ZLAUGHTER else
	ifl swear_random 140 set playsound ZCAKE else
	ifl swear_random 160 set playsound ZSOB else
	ifl swear_random 180 set playsound ZOUCH else
	ifl swear_random 200 set playsound ZSWEETJESUS else
	ifl swear_random 220 set playsound ZEATSHIT else
	ifl swear_random 240 set playsound ZNOMATCH else
	ifl swear_random 260 set playsound ZGOODFOSSA else
	set playsound ZROTINHELL
  	}
  else
  	ife CHAR 2
  	{
		ife CURWEAP 3 ifrnd 64 set playsound M_AXE1 else
		ife CURWEAP 3 ifrnd 64 set playsound M_AXE2 else
		ife CURWEAP 3 ifrnd 64 set playsound M_AXE3 else
		ife CURWEAP 5 ifrnd 64 set playsound M_HALLELUJA else
			{
			randvar swear_random 220
			ifl swear_random 20 set playsound MTAUNT1 else
			ifl swear_random 40 set playsound MTAUNT2 else
			ifl swear_random 60 set playsound MTAUNT3 else
			ifl swear_random 80 set playsound MTAUNT4 else
			ifl swear_random 100 set playsound MTAUNT5 else
			ifl swear_random 120 set playsound MTAUNT6 else
			ifl swear_random 140 set playsound MTAUNT7 else
			ifl swear_random 160 set playsound MTAUNT8 else
			ifl swear_random 180 set playsound MTAUNT9 else
			ifl swear_random 200 set playsound MTAUNT10 else
			set playsound MTAUNT11
			}
  	}
  else
  	ife CHAR 3
  	{
		randvar swear_random 140
		ifl swear_random 20 set playsound RTAUNT1 else
		ifl swear_random 40 set playsound RTAUNT2 else
		ifl swear_random 60 set playsound RTAUNT3 else
		ifl swear_random 80 set playsound RTAUNT4 else
		ifl swear_random 100 set playsound RTAUNT5 else
		ifl swear_random 120 set playsound RTAUNT6 else
		ifl swear_random 140 set playsound RTAUNT7
  	}
  else
  	ife CHAR 4
  	{
		ife CURWEAP 0
		 ife temp_weapon 19
		{
		randvar swear_random 140
		ifl swear_random 20 set playsound S_SWORD_TAUNT1 else
		ifl swear_random 40 set playsound S_SWORD_TAUNT2 else
		ifl swear_random 60 set playsound S_SWORD_TAUNT3 else
		ifl swear_random 80 set playsound S_SWORD_TAUNT4 else
		ifl swear_random 100 set playsound S_SWORD_TAUNT5 else
		ifl swear_random 120 set playsound S_SDRAW_TAUNT1 else
		ifl swear_random 140 set playsound S_SDRAW_TAUNT2
		}
	else
		{
		randvar swear_random 180
		ifl swear_random 20 set playsound STAUNT1 else
		ifl swear_random 40 set playsound STAUNT2 else
		ifl swear_random 60 set playsound STAUNT3 else
		ifl swear_random 80 set playsound STAUNT4 else
		ifl swear_random 100 set playsound STAUNT5 else
		ifl swear_random 120 set playsound STAUNT6 else
		ifl swear_random 140 set playsound STAUNT7 else
		ifl swear_random 160 set playsound STAUNT8 else
		set playsound STAUNT9
		}
  	}
  else
  	ife CHAR 5
  	{
	ife CURWEAP 0
	 ife temp_weapon 19
		{
		randvar swear_random 100
		ifl swear_random 20 set playsound RN_SWORD_TAUNT1 else
		ifl swear_random 40 set playsound RN_SWORD_TAUNT2 else
		ifl swear_random 60 set playsound RN_SWORD_TAUNT3 else
		ifl swear_random 80 set playsound RN_SWORD_TAUNT4 else
		ifl swear_random 100 set playsound RN_SWORD_TAUNT5
		}
	else
		{
		randvar swear_random 220
		ifl swear_random 20 set playsound RNTAUNT1 else
		ifl swear_random 40 set playsound RNTAUNT2 else
		ifl swear_random 60 set playsound RNTAUNT3 else
		ifl swear_random 80 set playsound RNTAUNT4 else
		ifl swear_random 100 set playsound RNTAUNT5 else
		ifl swear_random 120 set playsound RNTAUNT6 else
		ifl swear_random 140 set playsound RNTAUNT7 else
		ifl swear_random 160 set playsound RNTAUNT8 else
		ifl swear_random 180 set playsound RNTAUNT9 else
		ifl swear_random 200 set playsound RNTAUNT10 else
		set playsound RNTAUNT11
		}
  	}
  else
  	ife CHAR 6
  	{
		randvar swear_random 120
		ifl swear_random 20 set playsound GTAUNT1 else
		ifl swear_random 40 set playsound GTAUNT2 else
		ifl swear_random 60 set playsound GTAUNT3 else
		ifl swear_random 80 set playsound GTAUNT4 else
		ifl swear_random 100 set playsound GTAUNT5 else
		ifl swear_random 120 set playsound GTAUNT6
  	}
  else
  	ife CHAR 7
  	{
	randvar swear_random 120
	ifl swear_random 20 set playsound MSTAUNT1 else
	ifl swear_random 40 set playsound MSTAUNT2 else
	ifl swear_random 60 set playsound MSTAUNT3 else
	ifl swear_random 80 set playsound MSTAUNT4 else
	ifl swear_random 100 set playsound MSTAUNT5 else
	ifl swear_random 120 set playsound MSTAUNT6
  	}
  else
  	ife CHAR 9
  	{
	randvar TEMP 120
	ifl TEMP 20 set playsound CULTIST_TAUNT1 else
	ifl TEMP 40 set playsound CULTIST_TAUNT2 else
	ifl TEMP 60 set playsound CULTIST_TAUNT3 else
	ifl TEMP 80 set playsound CULTIST_TAUNT4 else
	ifl TEMP 100 set playsound CULTIST_TAUNT5 else
	ifl TEMP 120 set playsound CULTIST_TAUNT6
  	}
  else
   ife CHAR 12
  	{
	randvar swear_random 120
	ifl swear_random 20 set playsound JA_TAUNT_1 else
	ifl swear_random 40 set playsound JA_TAUNT_2 else
	ifl swear_random 60 set playsound JA_TAUNT_3 else
	ifl swear_random 80 set playsound JA_TAUNT_4 else
	ifl swear_random 100 set playsound JA_TAUNT_5 else
	set playsound JA_TAUNT_6
  	}
  else
  	ife CHAR 13
  	{
	randvar swear_random 120
	ifl swear_random 20 set playsound MC_TAUNT1 else
	ifl swear_random 40 set playsound MC_TAUNT2 else
	ifl swear_random 60 set playsound MC_TAUNT3 else
	ifl swear_random 80 set playsound MC_TAUNT4 else
	ifl swear_random 100 set playsound MC_TAUNT5 else
	ifl swear_random 120 set playsound MC_TAUNT6
  	}
else
	ife CHAR 14
	{
	randvar swear_random 160
	ifl swear_random 20 set playsound SF_TAUNT1 else
	ifl swear_random 40 set playsound SF_TAUNT2 else
	ifl swear_random 60 set playsound SF_TAUNT3 else
	ifl swear_random 80 set playsound SF_TAUNT4 else
	ifl swear_random 100 set playsound SF_TAUNT5 else
	ifl swear_random 120 set playsound SF_TAUNT6 else
	ifl swear_random 140 set playsound SF_TAUNT7 else
	set playsound SF_TAUNT8 
	}
  globalsoundvar playsound
  ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR playsound 512
  set swear_random 0
}

ifg force_taunt 0 sub force_taunt 1

ifg INTERNALCOUNT 0 sub INTERNALCOUNT 1
ifg INTERNALCOUNT_2 0 sub INTERNALCOUNT_2 1
ifg INTERNALCOUNT_3 0 sub INTERNALCOUNT_3 1


  seta[].mdflags 16
  
ifg drop_counter 0 sub drop_counter 1

ifn screen_pal 0
 ifvarvarn player[].palette screen_pal 
	{
	ifinwater nullop 
	else 
	ife player[].heat_on 0
		{
		ife screen_pal 1 setgamepalette 1
		else ife screen_pal 2 setgamepalette 2
		else ife screen_pal 3 setgamepalette 3
		else ife screen_pal 4 setgamepalette 4
		else ife screen_pal 5 setgamepalette 5
		else ife screen_pal 7 setgamepalette 7
		else ife screen_pal 8 setgamepalette 8
		else ife screen_pal 9 setgamepalette 9
		else ife screen_pal 11 setgamepalette 11
		else ife screen_pal 10 { setgamepalette 0 set screen_pal 0 }
		}
	}


state MEDIKIT_USE

ifg SLO_MO_SHOWOFF 0
	{
	getuserdef[].idplayers TEMP
	ife TEMP 1 sub SLO_MO_SHOWOFF 1
	ifl SLO_MO_SHOWOFF 5
		{
		setp[].sound_pitch 0
		set HUDON 0
		palfrom 32 64 64 64
		ifinwater setgamepalette 1 else
		setgamepalette 0
		inittimer 120
		state SLOMO_QUOTES
		ife SLO_MO_SHOWOFF 3 ife FISSION_MAILED 1 { addphealth -1000 resetplayer }
		}
	else
	ifl SLO_MO_SHOWOFF 10
		{
		setp[].sound_pitch -256
		inittimer 90
		}
	else
	ifl SLO_MO_SHOWOFF 20
		{
		setp[].sound_pitch -512
		inittimer 60
		}
	else
		{
		ife SLO_MO_SHOWOFF 25 screensound GO_SLOW
		ife FISSION_MAILED 1 setgamepalette 4 else
		setgamepalette 3
		setp[].sound_pitch -1024
		inittimer 30
		}
	}
	
ifl SHOTGUNMAG 0 set SHOTGUNMAG 0
ifl SHOTGUNBOXMAG 0 set SHOTGUNBOXMAG 0
ifl PISTOLMAG 0 set PISTOLMAG 0
ifl AUTOSHOTMAG 0 set AUTOSHOTMAG 0
ifl SLUGSHOTMAG 0 set SLUGSHOTMAG 0
ifl RIFLEMAG 0 set RIFLEMAG 0
ifvarvarg PISTOLMAG MAXPISTOLMAG set PISTOLMAG MAXPISTOLMAG
ifl MGUNMAG 0 set MGUNMAG 0
ifvarvarg MGUNMAG MAXMGUNMAG set MGUNMAG MAXMGUNMAG

ifn player_using_horse -1 
{
action BOAT_USE
ifl player[].horiz 0 setp[].horiz 0
setp[].over_shoulder_on 0
}

ifn player_using_hovercraft -1 
{
action BOAT_USE
geta[].htextra TEMP
ifg TEMP -1
	{
	geta[player_using_hovercraft].extra TEMP2
	sub TEMP2 TEMP
	seta[player_using_hovercraft].extra TEMP2
	seta[].htextra -1
	}
	
ifg hc_missile_fire 0 sub hc_missile_fire 1
	
	ifand BITS_PRESS 4
	{
	espawn 2520 
	state SPAWN_IN_PLAYER_FRONT 
	setactorvar[RETURN].TEMP AUTOTURRET_FIRE
	set TEMP3 player[].posx
	add TEMP3 1024
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	getp[].posz TEMP
	sub TEMP 3048
	seta[].z TEMP
	eshoot FIRELASER
	ife TEMP7 -1 action ZERO else
		{
		setsprite RETURN TEMP5 TEMP6 TEMP
		}
	}
	
	ifand BITS_PRESS 16384
	ifcount 13
	{
	sound WEAP_FIRE_MODE
	xorvar GUNFIREMODE 262144
	resetcount
	}
	
	ifand BITS_PRESS 64
	 ife hc_missile_fire 0
	{
	sound MISSILE_LAUNCH 
	set TEMP3 player[].posx
	add TEMP3 512
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	getp[].posz TEMP
	sub TEMP 2048
	seta[].z TEMP
	ifand GUNFIREMODE 262144 
		{
		eshoot MISSILE
		setthisprojectile[RETURN].hitradius 4500
		setthisprojectile[RETURN].workslike 98306
		setthisprojectile[RETURN].pal 14
		setthisprojectile[RETURN].vel 975
		setthisprojectile[RETURN].xrepeat 40
		setthisprojectile[RETURN].yrepeat 40
		setthisprojectile[RETURN].extra 275
		setthisprojectile[RETURN].extra_rand 275
		setthisprojectile[RETURN].isound EXPLOSION_BIG
		setthisprojectile[RETURN].spawns BIG_EXPLOSION
		}
	else
		{
		eshoot HOMING_MISSILE
		setthisprojectile[RETURN].extra 300
		}
	ife TEMP7 -1 action ZERO else
		{
		setsprite RETURN TEMP5 TEMP6 TEMP
		}
	set hc_missile_fire 64
	}
	
}

// HOVERTANK FIRING CODE
ifn player_using_hovertank -1 
{
	action HOVERTANK_USE
	setp[].weapon_pos 10
	setp[].movement_lock 15 

	//state PLAYER_VEHICLE_DAMAGE_MODIFIER
		
	setp[].jumping_toggle 0
	setp[].jumping_counter 0
	setp[].hard_landing 0
	setp[].jetpack_on 11

	ifg hc_missile_fire 0 sub hc_missile_fire 1
	ifg mech_maingun_fire 0 sub mech_maingun_fire 1
		
		ifand BITS_PRESS 4
		ife mech_maingun_fire 0
		{
			sound HOVERTANK_FIRE
			set GUN_RECOIL 15
			set TEMP3 player[].posx
			add TEMP3 2048
			rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
			updatesector TEMP5 TEMP6 TEMP7
			getp[].posz TEMP
			// Uncommenting this means projectiles fly above smaller enemy's heads, which is really annoying
			// sub TEMP 4096
			seta[].z TEMP
			eshoot 14644
			setthisprojectile[RETURN].hitradius 4096
			setthisprojectile[RETURN].extra 1600
			setthisprojectile[RETURN].velmult 8
			ife TEMP7 -1 action ZERO else
			{
				setsprite RETURN TEMP5 TEMP6 TEMP
			}
			set mech_maingun_fire 40
		}
			
		ifand BITS_PRESS 64
		 ife hc_missile_fire 0
		{
			sound HOVERTANK_MISSILE
			set TEMP3 player[].posx
			add TEMP3 2048
			rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
			updatesector TEMP5 TEMP6 TEMP7
			getp[].posz TEMP
			sub TEMP 2048
			seta[].z TEMP
			eshoot HOMING_MISSILE
			setthisprojectile[RETURN].hitradius 4096
			setthisprojectile[RETURN].extra 200
			setthisprojectile[RETURN].velmult 4
			ife TEMP7 -1 action ZERO else
			{
			setsprite RETURN TEMP5 TEMP6 TEMP
			}
			set hc_missile_fire 8
		}
}

ifn player_using_VR_tank -1 
{
action VR_TANK_USE
setp[].weapon_pos 10
setp[].movement_lock 15 
seta[].htextra -1

setp[].jumping_toggle 0
setp[].jumping_counter 0
setp[].hard_landing 0
setp[].jetpack_on 11

ifg hc_missile_fire 0 sub hc_missile_fire 1
ifg mech_maingun_fire 0 sub mech_maingun_fire 1
	
	ifand BITS_PRESS 4
	ife mech_maingun_fire 0
	{
	sound RETRO_DOORC
	set GUN_RECOIL 15
	set TEMP3 player[].posx
	add TEMP3 2048
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	getp[].posz TEMP
	sub TEMP 4096
	seta[].z TEMP
	eshoot 14644
	setthisprojectile[RETURN].hitradius 4096
	setthisprojectile[RETURN].isound RETRO_BOOM
	setthisprojectile[RETURN].velmult 2
	ife TEMP7 -1 action ZERO else
		{
		setsprite RETURN TEMP5 TEMP6 TEMP
		}
	set mech_maingun_fire 40
	}
	
	ifand BITS_PRESS 64
	 ife hc_missile_fire 0
	{
	sound RETRO_DOORC
	set TEMP3 player[].posx
	add TEMP3 2048
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	getp[].posz TEMP
	sub TEMP 2048
	seta[].z TEMP
	eshoot HOMING_MISSILE
	setthisprojectile[RETURN].hitradius 4096
	setthisprojectile[RETURN].extra 200
	setthisprojectile[RETURN].velmult 4
	ife TEMP7 -1 action ZERO else
	{
	setsprite RETURN TEMP5 TEMP6 TEMP
	}
	set hc_missile_fire 8
	}
	
}

ifn player_using_fighter -1 
{
action FIGHTER_USE
setp[].weapon_pos 10
setp[].movement_lock 15 
geta[].htextra TEMP
ifg TEMP -1
	{
	geta[player_using_fighter].extra TEMP2
	sub TEMP2 TEMP
	seta[player_using_fighter].extra TEMP2
	seta[].htextra -1
	}
	
setp[].jumping_toggle 0
setp[].jumping_counter 0
setp[].hard_landing 0
setp[].jetpack_on 11

ifg hc_missile_fire 0 sub hc_missile_fire 1
ifg mech_maingun_fire 0 sub mech_maingun_fire 1
	
	ifand BITS_PRESS 4
	ife mech_maingun_fire 0
	{
	sound CY_FIGHTER_FIRE
	
	set TEMP3 player[].posx
	add TEMP3 2048
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	getp[].posz TEMP
	sub TEMP 4096
	seta[].z TEMP
	eshoot MDF_PLASMA
	setthisprojectile[RETURN].velmult 8
	setthisprojectile[RETURN].pal 8
	ife TEMP7 -1 action ZERO else
		{
		setsprite RETURN TEMP5 TEMP6 TEMP
		}
	set mech_maingun_fire 2
	}
	
	ifand BITS_PRESS 64
	 ife hc_missile_fire 0
	{
	sound CY_FIGHTER_MISSILE
	set TEMP3 player[].posx
	add TEMP3 2048
	rotatepoint player[].posx player[].posy TEMP3 player[].posy player[].ang TEMP5 TEMP6
	updatesector TEMP5 TEMP6 TEMP7
	getp[].posz TEMP
	sub TEMP 2048
	seta[].z TEMP
	eshoot HOMING_MISSILE
	setthisprojectile[RETURN].hitradius 4096
	setthisprojectile[RETURN].extra 200
	setthisprojectile[RETURN].velmult 4
	ife TEMP7 -1 action ZERO else
		{
		setsprite RETURN TEMP5 TEMP6 TEMP
		}
	set hc_missile_fire 32
	}
	
}

    ifn ANGLE 0 // If player is in the tank?
    {
      cstat 32768
      // setp[].over_shoulder_on 0
      setp[].weapon_pos -9
	  setp[].pyoff 0
      geta[SET].z x
      add x -6144
      setp[].posz x
      setp[].oposz x
      getp[].pyoff x
      add x -14336
      setp[].pyoff x
      setp[].opyoff x
      geta[SET].x x
      setp[].posx x
      setp[].oposx x
      geta[SET].y y
      setp[].posy y
      setp[].oposy y
	  
	ifand BITS_PRESS 16384
	 ifcount 13
		{
		sound WEAP_FIRE_MODE
		xorvar GUNFIREMODE 262144
		resetcount
		}
		
	  set GUN_ACCURACY 24
	  
	  ifand BITS_PRESS 64
	  ife TANK_MACHINEGUN 0
	  {	  
	  set gunsmoke_angle 116
	  state spawn_gunsmoke
	  eshoot RIFLESHELL
	  geta[RETURN].z TEMP
	  sub TEMP 12000
	  seta[RETURN].z TEMP
	  flash
	  shoot ARMOUR_PIERCING_SHOT
	  shoot HOLLOW_POINT_SHOT
	  sound TANK_MGUN
	  set TANK_MACHINEGUN 4
	  }
	  ifg TANK_MACHINEGUN 0
		{
		ife TANK_MACHINEGUN 2 { getp[].horiz TEMP add TEMP 5 setp[].horiz TEMP }
		ife TANK_MACHINEGUN 1 { getp[].horiz TEMP sub TEMP 5 setp[].horiz TEMP }
		sub TANK_MACHINEGUN 1
		}
      ifhitspace
      {
        ife ANGLE 1
        {
		  set player_in_vehicle 0
		  soundonce TANK_STOP
		  stopsound TANK_ENGINE
		  stopsound TANK_TREAD
		  stopsound TANK_ROTATE
		  palfrom 63 0 0 0
          cstat 257
          getp[].posz x
          add x -14336
          setp[].posz x
          setp[].weapon_pos 0
          setactorvar[SET].ANGLE -3
          set ANGLE 0
        }
      }
      else
        set ANGLE 1
      seta[].htextra -1
    }

ifn player_using_mech -1 
{
ifg mech_hud_shake 0 sub mech_hud_shake 1
action PMECH_IDLE
ifg sprite[].htextra -1
	{
	geta[player_using_mech].extra TEMP2
	sub TEMP2 sprite[].htextra
	seta[player_using_mech].extra TEMP2
	seta[].htextra -1
	}
setp[].falling_counter 0
ifg hc_missile_fire 0 sub hc_missile_fire 1
ifg mech_maingun_fire 0 sub mech_maingun_fire 1
	
	ifand BITS_PRESS 4
	ife mech_maingun_fire 0
	ife hc_missile_fire 0
	{
	sound MELTAGUN_FIRE
	set GUN_RECOIL 8
	shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359 
	shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359 shoot 9359
	set mech_maingun_fire 27
	}
	
	ifand BITS_PRESS 2
	{
	set GUN_RECOIL 2
	espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP AUTOTURRET_FIRE
	shoot FIRELASER
	}
	
	ifand BITS_PRESS 64
	 ife hc_missile_fire 0
	  ife mech_maingun_fire 0
	{
	sound MISSILE_LAUNCH
	eshoot MISSILE

		set TEMP3 sprite[].x
		add TEMP3 256
		geta[].ang TEMP4
		add TEMP4 256
		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		geta[].z TEMP
		sub TEMP 14096
		seta[RETURN].z TEMP
	
	sound MISSILE_LAUNCH
	eshoot MISSILE
	
		set TEMP3 sprite[].x
		add TEMP3 256
		geta[].ang TEMP4
		sub TEMP4 256
		rotatepoint sprite[].x sprite[].y TEMP3 sprite[].y TEMP4 TEMP5 TEMP6
		seta[RETURN].x TEMP5 
		seta[RETURN].y TEMP6
		
		geta[].z TEMP
		sub TEMP 14096
		seta[RETURN].z TEMP
		
	set hc_missile_fire 32
	}
	
}

ife just_changed 1
	{
	ife FIRE_SUIT 1 action ES_STAND
	else ife SPACE_SUIT 1 ifn CHAR 12 ifn CHAR 13 ifn CHAR 14 action SS_STAND
	else ife CHAR 0 action JSTAND
	else ife CHAR 1 action ZSTAND
	else ife CHAR 2 action PSTAND
	else ife CHAR 3 action RSTAND
	else ife CHAR 4 action SSTAND
	else ife CHAR 5 action RNSTAND
	else ife CHAR 6 action GSTAND
	else ife CHAR 7 action MSTAND
	else ife CHAR 9 action PCSTAND
	else ife CHAR 10 action EAF_STAND
	else ife CHAR 11 action M2STAND
	else ife CHAR 12 action LSTAND
	else ife CHAR 13 action MC_STAND
	else ife CHAR 14 
		{
		ife TIMEZONE 6 action CIV_ASTAND else
		action SF_STAND
		}
	else ife CHAR 15 action MCNS_STAND
	else ife CHAR 20 action CSTAND
	set just_changed 0
	}
	
ifn DOCUMENT -1
 {
 lockplayer 13
 ifp pjumping set DOCUMENT -1
 
 ifn MAXPAGES 0
	{
	ifand EXTBITS_PRESS 4 // Left
	ifcount 13
		{
		ife PAGENUMBER 0 nullop else 
			{ sub DOCUMENT 1 sub PAGENUMBER 1 ifn PAGETURNSOUND 0 soundvar PAGETURNSOUND }
		resetcount
		}
	ifand EXTBITS_PRESS 8 // Right
	ifcount 13
		{
		ifvarvare PAGENUMBER MAXPAGES nullop else 
			{ add DOCUMENT 1 add PAGENUMBER 1 ifn PAGETURNSOUND 0 soundvar PAGETURNSOUND }
		resetcount
		}
	}
 
 }
 
	
ifp pstanding
 ifhitspace
	{
	set TEMP3 LEAN_COUNT
	mulvar TEMP3 16
	setp[].rotscrnang TEMP3
	setp[].movement_lock 12
	ifand EXTBITS_PRESS 16
		{
		ifl LEAN_COUNT 8 add LEAN_COUNT 1
		getp[].oang temp
        setp[].ang temp
		setp[].weapon_pos 10
		}
		else
	ifand EXTBITS_PRESS 32
		{
		ifg LEAN_COUNT -8 sub LEAN_COUNT 1
		getp[].oang temp
        setp[].ang temp
		setp[].weapon_pos 10
		}
	else
	ifl LEAN_COUNT 0 add LEAN_COUNT 1
	else ifg LEAN_COUNT 0 sub LEAN_COUNT 1
	}
else
ifn LEAN_COUNT 0 set LEAN_COUNT 0
	
	
// WILDLANDS

ifvarvarl SPRINTING PMAX_STAMINA 
	ifg SLIDE_KICK 25 
		{
		ifand BITS_PRESS P_SPRINTING nullop else
		add SPRINTING 1
		}



ife CURWEAP 5
{
switch CHAR
case 0
case 1
case 2
case 4
case 6
case 11
case 13
case 14
ife KICKBACKPIC 6
 ifl bomb_throw_power 256
	add bomb_throw_power 4
ife KICKBACKPIC 13 set bomb_throw_power 0
break
case 5
case 9
ife KICKBACKPIC 6
 ifl bomb_throw_power 256
	add bomb_throw_power 4
ife KICKBACKPIC 21 set bomb_throw_power 0
break
case 3
case 7
case 10
ife KICKBACKPIC 18
 ifl bomb_throw_power 256
    add bomb_throw_power 4
	ife KICKBACKPIC 24 set bomb_throw_power 0
break
default
set bomb_throw_power 0
break
endswitch
}
else
ife CURWEAP 8
{
 ife CHAR 0
	{
	ife KICKBACKPIC 3
		{
		 ifand BITS_PRESS 4 setp[].kickback_pic 2
		 ifl bomb_throw_power 256
			add bomb_throw_power 4
		}
	ife KICKBACKPIC 4 { ifg bomb_throw_power 96 soundonce JEXERT shoot PROXBUNDLE }
	ife KICKBACKPIC 13 set bomb_throw_power 0
	}
 ife CHAR 2
	{
	ife KICKBACKPIC 4 shoot M_TRAP_THROW
	ife KICKBACKPIC 13 set bomb_throw_power 0
	}
ife CHAR 4
	{
	ife KICKBACKPIC 4 spawn HEARTLEECHFLOAT
	}
 ife CHAR 5
	{
	ife KICKBACKPIC 4 shoot R_TRAP_THROW
	ife KICKBACKPIC 13 set bomb_throw_power 0
	}
 ife CHAR 6
	{
	ife KICKBACKPIC 3
		{
		 ifand BITS_PRESS 4 setp[].kickback_pic 2
		 ifl bomb_throw_power 256
			add bomb_throw_power 4
		}
	ife KICKBACKPIC 6 shoot DISCBOMB2
	ife KICKBACKPIC 13 set bomb_throw_power 0
	}
 ife CHAR 11
	{
	ife KICKBACKPIC 4 shoot M_TRAP_THROW
	ife KICKBACKPIC 13 set bomb_throw_power 0
	}
 ife CHAR 13
	{
	ife KICKBACKPIC 11 shoot MC_TRAP_THROW
	ife KICKBACKPIC 13 set bomb_throw_power 0
	}
}
else set bomb_throw_power 0

ife SKILL_LEVEL 5 // increase player damage if on Armageddon
	{
	ifmultiplayer nullop else
		{
		geta[].htextra TEMP
		ifg TEMP 0 { mulvar TEMP 2 seta[].htextra TEMP }
		}
	}
else
ife SKILL_LEVEL 1 // third player damage if on easy
	{
	ifmultiplayer nullop else
		{
		geta[].htextra TEMP
		ifg TEMP 0 { divvar TEMP 3 ifl TEMP 0 set TEMP -1 seta[].htextra TEMP }
		}
	}
	
ifl player_swap 26 add player_swap 1
ifl player_use 26 add player_use 1
ifl player_fire 26 add player_fire 1
ifl player_door 26 add player_door 1
ifl player_unlock 26 add player_unlock 1
ifl player_ship 26 add player_ship 1
ifl player_bipod 26 add player_bipod 1
ifl door_locked 26 add door_locked 1
ifl player_ninja 26 add player_ninja 1
	
ifg player_spooked 0
	{
soundonce SPOOKED

ife ARTIFACTS_LOADOUT[CHAR] 3 stopsound SPOOKED // If the player has Minerva's amulet on, don't mess with his vision
else
ife ARTIFACTS_LOADOUT[CHAR] 9 stopsound SPOOKED // If the player has the Spirit Shawl on, don't mess with his vision
else
ife CHAR 14 ifn player[].holoduke_on -1 stopsound SPOOKED // Snowfall's psionic shield is on
  else
ife HELMET_LOADOUT[CHAR] 4 ife player[].heat_on 1 stopsound SPOOKED // have ghost goggles on?
 else
 ifg SKILL_LEVEL 1 // if they're not playing on easy
	{
	ife CHAR 7 nullop else // Mikko is a cyborg and less vulnerable to mindattacks
	ife CHAR 4 nullop else // Sang is a warlock and less vulnerable to mindattacks
	ife CHAR 1 nullop else // Zaxtor is dimensionally shifted and less vulnerable to mindattacks
		{
		setp[].weapon_pos 10
		ifrnd 2 { addphealth -5 palfrom 20 20 wackplayer }
		ife CHAR 0 ifrnd 2 { addphealth -2 palfrom 20 40 wackplayer } // James' revelion blood is vulnerible to psychic attack
		}
	ife player_spooked 96
	{
	set TEMP 0
	whilevarvarn TEMP NUMWALLS
		{
		  getwall[TEMP].xpanning TEX_TEMP_X
		  setarray WALL_X[TEMP] TEX_TEMP_X
		  getwall[TEMP].ypanning TEX_TEMP_Y
		  setarray WALL_Y[TEMP] TEX_TEMP_Y
		  add TEMP 1
		}
	set TEMP3 0
	whilevarvarn TEMP3 NUMSECTORS
		{
		  gets[TEMP3].floorxpanning TEX_TEMP_SX
		  gets[TEMP3].ceilingxpanning TEX_TEMP_X
		  setarray FLOOR_X[TEMP3] TEX_TEMP_SX
		  setarray CEILING_X[TEMP3] TEX_TEMP_X

		  
		  gets[TEMP3].floorypanning TEX_TEMP_SY
		  gets[TEMP3].ceilingypanning TEX_TEMP_Y
		  setarray FLOOR_Y[TEMP3] TEX_TEMP_SY
		  setarray CEILING_Y[TEMP3] TEX_TEMP_Y

		  
		  add TEMP3 1
		}
	}
	else
	ifl player_spooked 96
	ifg player_spooked 2
	{
	set TEMP 0
	whilevarvarn TEMP NUMWALLS
		{
		  getwall[TEMP].xpanning TEMP2
		  randvar TEMP4 128
		  ifrnd 128 mulvar TEMP4 -1
		  add TEMP2 TEMP4
		  setwall[TEMP].xpanning TEMP2
		  
		  getwall[TEMP].ypanning TEMP2
		  randvar TEMP4 128
		  ifrnd 128 mulvar TEMP4 -1
		  add TEMP2 TEMP4
		  setwall[TEMP].ypanning TEMP2
		  
		  add TEMP 1
		}
	set TEMP3 0
	whilevarvarn TEMP3 NUMSECTORS
		{
		  gets[TEMP3].floorxpanning TEMP2
		  randvar TEMP4 128
		  ifrnd 128 mulvar TEMP4 -1
		  add TEMP2 TEMP4
		  sets[TEMP3].floorxpanning TEMP2
		  sets[TEMP3].ceilingxpanning TEMP2
		  
		  gets[TEMP3].floorypanning TEMP2
		  randvar TEMP4 128
		  ifrnd 128 mulvar TEMP4 -1
		  add TEMP2 TEMP4
		  sets[TEMP3].floorypanning TEMP2
		  sets[TEMP3].ceilingypanning TEMP2
		  
		  add TEMP3 1
		}
	}
	else
	ife player_spooked 2
	{
	set TEMP 0
	whilevarvarn TEMP NUMWALLS
		{
		  setwall[TEMP].xpanning WALL_X[TEMP]
		  setwall[TEMP].ypanning WALL_Y[TEMP]
		  add TEMP 1
		}
	set TEMP3 0
	whilevarvarn TEMP3 NUMSECTORS
		{
		  sets[TEMP3].floorxpanning FLOOR_X[TEMP3]
		  sets[TEMP3].ceilingxpanning CEILING_X[TEMP3]
		  sets[TEMP3].floorypanning FLOOR_Y[TEMP3]
		  sets[TEMP3].ceilingypanning CEILING_Y[TEMP3]
		  add TEMP3 1
		}	
	}
}	
	
	ifdead nullop else soundonce HEARTBEAT
	ife CHAR 0 soundonce JBREATHE
	ife CHAR 3 soundonce R_SCARED
	ife CHAR 4 soundonce SBREATHE
	set MISSIONSCREEN 0
	set mission_scare 1
	
	
	sub player_spooked 1
	ifl player_spooked 2 
		{ 
		stopsound SPOOKED 
		ifrnd 64 set PLAYER_VOICEOVER 31
		setgamepalette 0 
		
		ife IN_DREAM 1
			{
			palfrom 64 64 64 64
			operateactivators 947 THISACTOR 
			set IN_DREAM 0
			}
		else
		palfrom 32 0 0 0 
		}
	else setgamepalette 3
	}
	
ifg vr_glitched 0
	{
	setp[].weapon_pos 10
	ifrnd 2 wackplayer 

	ife vr_glitched 96
		{
	stopallsounds
	screensound VR_GLITCH
	set TEMP 0
	whilevarvarn TEMP NUMWALLS
			{
			  getwall[TEMP].xpanning TEMP2
			  setarray WALL_X[TEMP] TEMP2
			  getwall[TEMP].ypanning TEMP9
			  setarray WALL_Y[TEMP] TEMP9
			  setarray WALL_PICNUMA[TEMP] wall[TEMP].picnum
			  setarray MASK_PICNUMA[TEMP] wall[TEMP].overpicnum
			  add TEMP 1
			}
	set TEMP3 0
	whilevarvarn TEMP3 NUMSECTORS
			{
			  gets[TEMP3].floorxpanning TEMP2
			  gets[TEMP3].ceilingxpanning TEMP5
			  setarray FLOOR_X[TEMP3] TEMP2
			  setarray CEILING_X[TEMP3] TEMP5
			  setarray FLOOR_PICNUM[TEMP3] sector[TEMP3].floorpicnum
			  setarray CEILING_PICNUM[TEMP3] sector[TEMP3].ceilingpicnum
			  
			  gets[TEMP3].floorypanning TEMP2
			  gets[TEMP3].ceilingypanning TEMP5
			  setarray FLOOR_Y[TEMP3] TEMP2
			  setarray CEILING_Y[TEMP3] TEMP5

			  
			  add TEMP3 1
			}
		}
		else
		ifl vr_glitched 96
		ifg vr_glitched 2
		{
	set TEMP 0
	whilevarvarn TEMP NUMWALLS
			{
			  getwall[TEMP].xpanning TEMP2
			  randvar TEMP4 128
			  ifrnd 128 mulvar TEMP4 -1
			  add TEMP2 TEMP4
			  setwall[TEMP].xpanning TEMP2
			  
			  getwall[TEMP].ypanning TEMP9
			  randvar TEMP4 128
			  ifrnd 128 mulvar TEMP4 -1
			  add TEMP9 TEMP4
			  setwall[TEMP].ypanning TEMP9
			  setwall[TEMP].picnum 23658
			  setwall[TEMP].overpicnum 23658
			  add TEMP 1
			}
	set TEMP3 0
	whilevarvarn TEMP3 NUMSECTORS
			{
			  gets[TEMP3].floorxpanning TEMP2
			  randvar TEMP4 128
			  ifrnd 128 mulvar TEMP4 -1
			  add TEMP2 TEMP4
			  sets[TEMP3].floorxpanning TEMP2
			  sets[TEMP3].ceilingxpanning TEMP2
			  sets[TEMP3].floorpicnum 23658
			  sets[TEMP3].ceilingpicnum 23658
			  
			  gets[TEMP3].floorypanning TEMP2
			  randvar TEMP4 128
			  ifrnd 128 mulvar TEMP4 -1
			  add TEMP2 TEMP4
			  sets[TEMP3].floorypanning TEMP2
			  sets[TEMP3].ceilingypanning TEMP2
			  
			  add TEMP3 1
			}
		}
	else
	ife vr_glitched 2
		{
	set TEMP 0
	whilevarvarn TEMP NUMWALLS
			{
			  setwall[TEMP].xpanning WALL_X[TEMP]
			  setwall[TEMP].ypanning WALL_Y[TEMP]
			  setwall[TEMP].picnum WALL_PICNUMA[TEMP]
			  setwall[TEMP].overpicnum MASK_PICNUMA[TEMP]
			  add TEMP 1
			}
	set TEMP3 0
	whilevarvarn TEMP3 NUMSECTORS
			{
			  sets[TEMP3].floorxpanning FLOOR_X[TEMP3]
			  sets[TEMP3].ceilingxpanning CEILING_X[TEMP3]
			  sets[TEMP3].floorypanning FLOOR_Y[TEMP3]
			  sets[TEMP3].ceilingypanning CEILING_Y[TEMP3]
			  sets[TEMP3].floorpicnum FLOOR_PICNUM[TEMP3]
			  sets[TEMP3].ceilingpicnum CEILING_PICNUM[TEMP3]
			  add TEMP3 1
			}	
		}
	
	sub vr_glitched 1
	ifl vr_glitched 2 
		{ 
		stopsound SPOOKED 
		ifrnd 64 set PLAYER_VOICEOVER 31
		setgamepalette 0 
		
		palfrom 32 0 0 0 
		}
	else setgamepalette 2
}


ife GAS_MASK 2 
	{ 
	ife ingas 24 sound EQUIPMENT_OFF 
	ife CHAR 0 soundonce JGASMASK 
	ife CHAR 1 soundonce ZGASMASK
	ife CHAR 4 soundonce SGASMASK
	ife ingas 0 set GAS_MASK 1
	}

ifl GAS_MASK_PUTON 26 { setp[].weapon_pos 10 add GAS_MASK_PUTON 1 }

ifl water_screen 30 add water_screen 1

ife water_submerge 1 
	{ 
	ifinwater nullop else 
		{
		ifg DROWN_COUNT 0
			{
			ife CHAR 0 screensound J_BREATHE
			ife CHAR 1 screensound Z_GULP
			ife CHAR 5 screensound RN_BREATHE
			set DROWN_COUNT 0
			}
		globalsound SURFACE 
		set water_screen -30
		set water_submerge 0 
		} 
	} 

ifinwater
{
switch sector[].ceilingpicnum
case 7396
case 10526
	setp[].weapon_pos 10
	getp[].posxv TEMP6
	divvar TEMP6 4
	setp[].posxv TEMP6
	getp[].posyv TEMP6
	divvar TEMP6 4
	setp[].posyv TEMP6
	setgamepalette 5
	ifg FIRE_SUIT 0 nullop else addphealth -5
	soundonce BRUISER_FLAME
	break
endswitch

ife PERSONEL_RESEARCH[17] 2 // scuba research
{
ifand EGYPT_ARTIFACTS 2 nullop else
	{
	ifg player[].airleft 1
	 ifg player[].scuba_amount 0
		{
		setp[].scuba_on 0
		getp[].airleft AIRLEFT
		sub AIRLEFT 1
		setp[].airleft AIRLEFT
		setp[].scuba_on 0
		}
	}
}

	ife player[].scuba_on 1
			{
			ife CHAR 0 soundonce WEARSCUBAGEAR
			else ife CHAR 5 soundonce WEARSCUBAGEAR2
			else ife CHAR 7 soundonce WEARSCUBAGEAR2
			else soundonce WEARSCUBAGEAR3
			} 
			
state STOPSTEPSOUNDS

ife WEP3_BLOODY 1 set WEP3_BLOODY 0

ife water_submerge 0 { globalsound SUBMERGE set water_screen -30 set water_submerge 1 }
ife AIR_FILTER 1 setp[].scuba_amount 6400
ifp prunning
	{
	ifand BITS_PRESS P_SPRINTING soundonce PLAYER_SWIM
	ifand EXTBITS_PRESS 1
		{
		getp[].horiz TEMP
		sub TEMP 100 // 100 horiz equals straight ahead, so take away 100 and make 0 'straight ahead' for this
		mulvar TEMP -20
		setp[].poszv TEMP
		}
	}
}

ifg COMM_COUNTD 0 sub COMM_COUNTD 1
ifl COMM_COUNTD 0 add COMM_COUNTD 1

ifn WEAPSWAYX 0
ifl input[].avel 30
ifg input[].avel -30
	{
	ifg WEAPSWAYX 0 sub WEAPSWAYX 2
	ifl WEAPSWAYX 0 add WEAPSWAYX 2
	}

ifn WEAPSWAYY 0
ifl input[].horz 30
ifg input[].horz -30
	{
	ifg WEAPSWAYY 0 sub WEAPSWAYY 2
	ifl WEAPSWAYY 0 add WEAPSWAYY 2
	}

clamp WEAPSWAYY -20 20
clamp WEAPSWAYX -20 20

ifl input[].horz -30 ifl WEAPSWAYY 12 add WEAPSWAYY 4
ifg input[].horz 30 ifg WEAPSWAYY -12 sub WEAPSWAYY 4

ifn CONTROL_VR -1
	{
	ifg player[].footprintcount 0 setplayer[].footprintcount 0
	set SHIELDUP 0
	set MSHIELDUP 0
	set screen_pal 8
	ife MISSIONUP 1 set MISSIONUP 0
	setuserdef[].overhead_on 0
	setp[].kickback_pic 0
	setp[].weapon_pos 10
	seta[].htextra -1
	}

ifg caught_in_web 0
	{
	sub caught_in_web 1
	setp[].weapon_pos 10
	getp[].posxv TEMP
	divvar TEMP 4
	setp[].posxv TEMP
	getp[].posyv TEMP
	divvar TEMP 4
	setp[].posyv TEMP
	}

ifg caught_in_net 0
	{
	ife MISSIONUP 1 set MISSIONUP 0
	setuserdef[].overhead_on 0
	setp[].kickback_pic 0
	ife player_hitspace 1 
	{ ifp pboosted sub caught_in_net 10 else sub caught_in_net 5 wackplayer sound ROPE_CLIMB set player_hitspace 2 }
	setp[].weapon_pos 10
	getp[].posxv TEMP
	divvar TEMP 6
	setp[].posxv TEMP
	getp[].posyv TEMP
	divvar TEMP 6
	setp[].posyv TEMP
	}
	
ifg PHANTASM_STICK -1
	{
	ife MISSIONUP 1 set MISSIONUP 0
	palfrom 0 0 0 0
	set player_use -1
	setp[].horiz 100
	setuserdef[].overhead_on 0
	setp[].movement_lock 31
	setp[].kickback_pic 0
	setp[].weapon_pos 10
	soundonce PB_START
	
	ifcount 2 
		{ 
		// ballistic mask will make ball drill slower
		ife HELMET_LOADOUT[CHAR] 1 set TEMP 1 else 
		randvar TEMP 4
		sub PHANTASM_STRUGGLE TEMP 
		resetcount 
		}
	ife player_hitspace 1 
		{ 
		randvar TEMP 3
		add TEMP 6
		ifp pboosted add PHANTASM_STRUGGLE 16 else add PHANTASM_STRUGGLE TEMP 
		set player_hitspace 2 
		ifrnd 128 setp[].rotscrnang -16 else setp[].rotscrnang 16
		}
	
	ifrnd 4 
		{
		ife CHAR 0 soundonce JSTRUGGLE
		else ife CHAR 1 sound Z_LONGTERM_PAIN2 
		else ife CHAR 2 sound MHURT
		else ife CHAR 3 sound RHURT
		else ife CHAR 4 sound SHURT 
		else ife CHAR 5 sound RNHURT 
		else ife CHAR 9 sound CULTIST_PAIN3
		else ife CHAR 10 sound BS_PAIN1
		else ife CHAR 13 sound MC_HURT
		}
	ifg PHANTASM_STRUGGLE 50 
		{ 
		soundonce PB_STOP
		setp[].movement_lock 0
		setactorvar[PHANTASM_STICK].INTERNALCOUNT 52
		set PHANTASM_STICK -1
		set PHANTASM_STRUGGLE 0
		}
	else
	ifl PHANTASM_STRUGGLE -10
		{
		ife HELMET_LOADOUT[CHAR] 1 // ballistic mask protects from some damage
			{
			palfrom 20 64
			soundonce PB_KILL
			addphealth -1
			}
			else
			{
		    wackplayer
			palfrom 40 64
			soundonce PB_KILL
			addphealth -3
			}
		}
	else set player_use -1
	
	ifp pdead { set PHANTASM_STICK -1 set PHANTASM_STRUGGLE 0 setp[].movement_lock 0 }
	
	}
	
ifg SHOTGUN_STRUGGLE -1
	{
	palfrom 0 0 0 0
	ife MISSIONUP 1 set MISSIONUP 0
	setp[].horiz 100
	setuserdef[].overhead_on 0
	setp[].kickback_pic 0
	setp[].weapon_pos 10
	ifcount 2 
		{ 
		randvar TEMP 3
		sub SHOTGUN_STRUGGLE_NUM TEMP 
		resetcount 
		}
	ife player_hitspace 1 
		{ 
		randvar TEMP 3
		add TEMP 6
		ifp pboosted add SHOTGUN_STRUGGLE_NUM 16 else add SHOTGUN_STRUGGLE_NUM TEMP 
		set player_hitspace 2 
		ifrnd 128 setp[].rotscrnang -16 else setp[].rotscrnang 16
		}
	
	ifrnd 4 
		{
		ife CHAR 0 soundonce JSTRUGGLE
		else ife CHAR 1 sound Z_LONGTERM_PAIN2 
		else ife CHAR 2 sound MHURT
		else ife CHAR 3 sound RHURT
		else ife CHAR 4 sound SHURT 
		else ife CHAR 5 sound RNHURT 
		else ife CHAR 9 sound CULTIST_PAIN3
		else ife CHAR 13 sound MC_HURT
		}
	ifg SHOTGUN_STRUGGLE_NUM 75 
		{ 
		set player_use 26 set player_fire 0 
		ifand BITS_PRESS 4 
			{
			flash
			soundonce SAWNOFF_FIRE 
			wackplayer 
			set SHOTGUN_STRUGGLE 0
			shoot 3761
			shoot 3761
			set gunsmoke_angle 0
			state spawn_gunsmoke
			set SHOTGUN_STRUGGLE_NUM -100
			setp[].movement_lock 0
			}
		}
	else
	ifl SHOTGUN_STRUGGLE_NUM -25
		{
		ifrnd 128
			{
			flash
			soundonce SAWNOFF_FIRE
			palfrom 62 62 0 0
			wackplayer
			ife HELMET_LOADOUT[CHAR] 1 seta[].extra 1 else
			seta[].extra 0
			set SHOTGUN_STRUGGLE -1
			set SHOTGUN_STRUGGLE_NUM 0
			setp[].movement_lock 0
			}
		}
	else { set player_use -1 set player_fire 26 }
	
	ifp pdead set SHOTGUN_STRUGGLE -1
	
	}

ifg cameratype 1
	{
	ifg sprite[].htextra -1 seta[].htextra -1
	setp[].weapon_pos 10
	}
	
set HANDS_DRAW 2
	
ife on_tripwire 1
	{
	set SHIELDUP 0 set MSHIELDUP 0
	ife GUN_HANDS 2 setp[].weapon_pos 10 else ife GUN_HANDS 1 set HANDS_DRAW 1
	}

ifg fpress 0 sub fpress 1
ifg bpress 0 sub bpress 1
ifl onladder 0 add onladder 1

ifg onladder 0 state laddercode

state HITSPRITELOOKSTUFF
ifn hitwall -1
	{
	getwall[hitwall].shade TEMP
	getwall[hitwall].pal wall_pal
	ifl TEMP 0 set TEMP 0
	sub TEMP sprite[].shade
	ifvarvarg player_shade_diff TEMP sub player_shade_diff 1
	else ifvarvarl player_shade_diff TEMP add player_shade_diff 1
	// set player_shade_diff TEMP
	}

ifg CHOKE 0
{
set player_use -1
setuserdef[].overhead_on 0
palfrom 20 20
ifl player[].horiz 50 setp[].horiz 50
ife player_hitspace 1 { sub CHOKE 10 wackplayer set player_hitspace 2 }
soundonce CHOKING
state STOPSTEPSOUNDS
sub CHOKE 1

ifp pdead set CHOKE 0

}

ifn temp_weapon 0
ife CURWEAP 0
{
set WEAPON_TYPE 0
set GUNMAG -1
ife CUR_AMMO 0 ife KICKBACKPIC 0 
		{ 
		set temp_weapon 0 
		set GUN_VOLUME 0
		ifg SCOPE 0
			{
			set ZOOMAMOUNT 4
			set SCOPE 0
			}
		quote 515 
		soundonce ENDSEQVOL2SND1
		ifand GUNFIREMODE 16384 xorvar GUNFIREMODE 16384
		}
ife temp_weapon 1 // Is the player using the mini-shrinker?
	{
	set WEAPON0_TILE MINISHRINKERSPRITE
	set WEAPON_TYPE 8
	set GUNMAG -1
	set GUN_VOLUME 30
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_SIZE 1
	set GUN_HANDS 1
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 17
	set WEAPON0_HOLDDELAY 17
	set WEAPON0_FIREDELAY 7
	set WEAPON0_FIRESOUND SHRINKER_FIRE
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS SHRINKER
	set WEAPON0_FLAGS 38
	setarray WEAPON_SPECIAL[0] 0
	}
ife temp_weapon 2 // Is the player using the barrett rifle?
	{
	set WEAPON0_TILE BARRETTRIFLESPRITE
	set WEAPON_TYPE 1
	set GUNMAG -1
	set GUN_VOLUME 120
	set GUN_ACCURACY 2
	set GUN_MAX_SPREAD 64
	set GUN_SIZE 3
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 14
	set WEAPON0_HOLDDELAY 7
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND BARRETT_SHOT
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS BIGRIFLESHOT
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 0
	setarray WEAPON_SPECIAL[0] 0
	
	ife KICKBACKPIC 3 { ifp pducking add GUN_SPREAD 32 else add GUN_SPREAD 64 set gunsmoke_angle 64 state spawn_gunsmoke }
	ife KICKBACKPIC 4 { getp[].horiz TEMP add TEMP 5 setp[].horiz TEMP }
	ife KICKBACKPIC 5 { getp[].horiz TEMP add TEMP 5 setp[].horiz TEMP }
	ife KICKBACKPIC 6 { getp[].horiz TEMP sub TEMP 5 setp[].horiz TEMP }
	ife KICKBACKPIC 7 { getp[].horiz TEMP sub TEMP 5 setp[].horiz TEMP }
	ife CURWEAP 0
		{
		ifg SCOPE 0 state TURNOFF_NVG
		}
	
	}
ife temp_weapon 3 // Is the player using the dual mac10s?
	{
	set WEAPON0_TILE SMGSPRITE
	set WEAPON_TYPE 2
	set GUNMAG -1
	set GUN_VOLUME 20
	set GUN_ACCURACY 16
	set GUN_MAX_SPREAD 48
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 3
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS ZRIFLESHOT
	set WEAPON0_SHOTSPERBURST 2
	set WEAPON0_FLAGS 4
	setarray WEAPON_SPECIAL[0] 0
	
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP SMG_SHOT }
		ife KICKBACKPIC 1 set GUN_RECOIL 5
		ife KICKBACKPIC 2 { add GUN_SPREAD 4  shoot 13772 shoot 13780 set gunsmoke_angle 64 state spawn_gunsmoke set gunsmoke_angle -64 state spawn_gunsmoke }
	}
ife temp_weapon 4 // Is the player using the blood staff?
	{
	set WEAPON0_TILE BLOODSTAFFSPRITE
	set WEAPON_TYPE 8
	set GUNMAG -1
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_VOLUME 12
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 6
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 3
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS GASBURST
	set WEAPON0_FLAGS 6
	setarray WEAPON_SPECIAL[0] 0
	
	ife KICKBACKPIC 3 { espawn 2520 set GUN_RECOIL 5 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP UNMAKERF }
	ife KICKBACKPIC 4 ifand BITS_PRESS 4 ifg player[].ammo_amount 0 0 setp[].kickback_pic 2
	
	}
ife temp_weapon 5 // Is the player using the lizard man chaingun?
	{
	set WEAPON0_TILE LIZMANGUNSPRITE
	set WEAPON_TYPE 2
	set GUNMAG -1
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_VOLUME 16
	set GUN_ACCURACY 12
	set GUN_MAX_SPREAD 64
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 4
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND MINIGUN_START
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS CHAINGUN
	set WEAPON0_FLAGS 6
	setarray WEAPON_SPECIAL[0] 0
	
	ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP CAPT_ATTACK set GUN_RECOIL 5 add GUN_SPREAD 8  }
	ife KICKBACKPIC 3 { shoot RIFLESHELL set gunsmoke_angle 64 state spawn_gunsmoke }
	}
ife temp_weapon 6 // Is the player using the pigcop shotgun?
	{
	set WEAPON0_TILE PIGCOPGUNSPRITE
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 20
	set WEAPON0_HOLDDELAY 0
	set WEAPON0_FIREDELAY 2
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 7
	set WEAPON0_FLAGS 1024
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
		{
		
		set GUNMAG -1
		set GUN_SIZE 1
		set GUN_HANDS 2
		set GUN_VOLUME 70
		set GUN_ACCURACY 12
		set GUN_MAX_SPREAD 48
		set GUN_AMMO_TYPES 5
		ifand AMMO_TYPES[CURWEAP] 1
				{
				set WEAPON_TYPE 8
				set LAST_SHELL_FIRED 1
				set WEAPON0_SHOOTS 9361 
				set WEAPON0_FIRESOUND EXPL_SHELL_FIRE
				ife explosive_shells 0 ife KICKBACKPIC 0 { xorvar AMMO_TYPE 1 setarray AMMO_TYPES[CURWEAP] AMMO_TYPE }
				}
		else
		ifand AMMO_TYPES[CURWEAP] 4
				{
				set WEAPON_TYPE 9
				set LAST_SHELL_FIRED 4
				ife ARTIFACTS_LOADOUT[CHAR] 7 set WEAPON0_SHOOTS 6816 else
				set WEAPON0_SHOOTS 6826 
				set WEAPON0_FIRESOUND FLECH_SHELL_FIRE
				ife flechete_shells 0 ife KICKBACKPIC 0 { xorvar AMMO_TYPE 4 setarray AMMO_TYPES[CURWEAP] AMMO_TYPE }
				}
		else
		ifand AMMO_TYPES[CURWEAP] 64
				{
				set WEAPON_TYPE 0
				set LAST_SHELL_FIRED 64
				set WEAPON0_FIRESOUND MAGNUM_SHOTGUN
				set WEAPON0_SHOOTS RMAXREVOLVERSHOT
				ife magnum_shells 0 ife KICKBACKPIC 0 { xorvar AMMO_TYPE 64 setarray AMMO_TYPES[CURWEAP] AMMO_TYPE }
				}
		else
		ifand AMMO_TYPES[CURWEAP] 1024
				{
				set WEAPON_TYPE 8
				set LAST_SHELL_FIRED 1024
				set WEAPON0_FIRESOUND DRAGONS_BR_FIRE
				set WEAPON0_SHOOTS 22536
				ife dragon_shells 0 ife KICKBACKPIC 0 { xorvar AMMO_TYPE 1024 setarray AMMO_TYPES[CURWEAP] AMMO_TYPE }
				}
		else
				{
				set WEAPON_TYPE 2
				set LAST_SHELL_FIRED 0
				set WEAPON0_FIRESOUND PIG_ATTACK
				set WEAPON0_SHOOTS SHOTGUN
				}
		
		ife KICKBACKPIC 10 sound SHOTGUN_COCK2
		ife KICKBACKPIC 12 state SHOTGUN_SHELL
		
		ife KICKBACKPIC 3 
			{ 
			getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP
			}
		ife KICKBACKPIC 4 
			{ add GUN_SPREAD 48 getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP
		set gunsmoke_angle 64 state spawn_gunsmoke
			ifand AMMO_TYPES[CURWEAP] 64 { set gun_pushback_power -128 state gun_pushback }
			}
		ife KICKBACKPIC 5 
			{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
		ife KICKBACKPIC 6 
			{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
		}
	}
ife temp_weapon 7 // Is the player using the bone duster?
	{
	set WEAPON0_TILE SKULLDUSTERSPRITE
	set WEAPON_TYPE 9
	set GUNMAG -1
	set GUN_VOLUME 25
	set GUN_HANDS 2
	set GUN_ACCURACY 40
	add GUN_MAX_SPREAD 0
	set GUN_SIZE 0
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 5
	set WEAPON0_HOLDDELAY 0
	set WEAPON0_FIREDELAY 4
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 4
	set WEAPON0_SHOOTS BONE_SHARD
	set WEAPON0_FLAGS 1024
	setarray WEAPON_SPECIAL[0] 0
	
	ife KICKBACKPIC 2 { espawn 2520 set GUN_RECOIL 5 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP SKULL_DUSTER }
	}
ife temp_weapon 8 // Is the player using the flesh squirter?
	{
	set WEAPON0_TILE FLESHSQUIRTERSPRITE
	set WEAPON_TYPE 0
	set GUNMAG -1
	set GUN_VOLUME 70
	set GUN_ACCURACY 16
	set GUN_MAX_SPREAD 0
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 16
	set WEAPON0_HOLDDELAY 0
	set WEAPON0_FIREDELAY 7
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 10
	set WEAPON0_SHOOTS ZRIFLESHOTU
	set WEAPON0_FLAGS 1024
	setarray WEAPON_SPECIAL[0] 0
	
	ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP FLESH_SQUIRT }
	
	ife KICKBACKPIC 8 
		{ getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP }
	ife KICKBACKPIC 9 
		{ getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP }
	ife KICKBACKPIC 10 
		{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
	ife KICKBACKPIC 11
		{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
	}
ife temp_weapon 9 // Is the player using the stygian warcannon?
	{
	set WEAPON0_TILE STYGIANGUNSPRITE
	set WEAPON_TYPE 4
	set GUNMAG -1
	set GUN_VOLUME 80
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_SIZE 2
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 20
	set WEAPON0_HOLDDELAY 0
	set WEAPON0_FIREDELAY 14
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_FLAGS 1024
	setarray WEAPON_SPECIAL[0] 0
	
	ifand GUNFIREMODE 524288
		{
		set WEAPON0_SHOTSPERBURST 10
		set WEAPON0_SHOOTS 22536
		ife KICKBACKPIC 0 ifand GUNFIREMODE 524288 xorvar GUNFIREMODE 524288
		}
	else
		{
		set WEAPON0_SHOTSPERBURST 1
		set WEAPON0_SHOOTS STYGIAN_ROCK
		}
		
	ife KICKBACKPIC 1 sound STYGIAN_CHARGE
	ife KICKBACKPIC 12 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP STYGIAN_FIRE }
	ife KICKBACKPIC 13 { set gun_pushback_power -96 state gun_pushback }
	
	ife KICKBACKPIC 14 
		{ getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP }
	ife KICKBACKPIC 15 
		{ getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP }
	ife KICKBACKPIC 16 
		{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
	ife KICKBACKPIC 17
		{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
	
	}
ife temp_weapon 10 // Is the player using the sawn-offsawn-off shotgun?
	{
	set WEAPON0_TILE SAWNOFFSPRITE
	set GUNMAG TEMP_WEAPON_MAG
	set GUN_AMMO_TYPES 1
	set GUN_SIZE 1
	set GUN_HANDS 1
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_RELOAD 30
	set WEAPON0_TOTALTIME 7
	set WEAPON0_HOLDDELAY 0
	set WEAPON0_FIREDELAY 2
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_FIRESOUND 4
	set WEAPON0_FLAGS 1088
	setarray WEAPON_SPECIAL[0] 0

	
	ifvarvarg TEMP_WEAPON_MAG 2 set TEMP_WEAPON_MAG 0
	set MAX_TEMP_WEAPON_MAG 2
	
	ife TEMP_WEAPON_MAG 0
	 ife KICKBACKPIC 0
		{
		setp[].reloading 1
		setp[].kickback_pic 6
		}
	
		ifand AMMO_TYPES[CURWEAP] 1
			{
			set WEAPON_TYPE 8
			set WEAPON0_SHOOTS 9361 
			ife KICKBACKPIC 14 ife explosive_shells 0 { xorvar AMMO_TYPE 1 setarray AMMO_TYPES[CURWEAP] AMMO_TYPE }
			}
		else
		ifand AMMO_TYPES[CURWEAP] 4
			{
			set WEAPON_TYPE 9
			ife ARTIFACTS_LOADOUT[CHAR] 7 set WEAPON0_SHOOTS 6816 else
			set WEAPON0_SHOOTS 6826
			ife KICKBACKPIC 14 ife flechete_shells 0 { xorvar AMMO_TYPE 4 setarray AMMO_TYPES[CURWEAP] AMMO_TYPE }
			}
		else
		    {
			set WEAPON_TYPE 2
			set WEAPON0_SHOOTS SHOTGUN
			}
			
	ifand GUNFIREMODE 256 
		{
		set GUN_ACCURACY 48
		add GUN_MAX_SPREAD 48
		set WEAPON0_SHOTSPERBURST 2 
		ife KICKBACKPIC 3 
			{ add GUN_SPREAD 48 getp[].horiz TEMP add TEMP 20 setp[].horiz TEMP 
			ifand AMMO_TYPES[CURWEAP] 1 set gun_pushback_power -256 else set gun_pushback_power -96
			state gun_pushback
			}

		ife KICKBACKPIC 4 
			{ getp[].horiz TEMP add TEMP 20 setp[].horiz TEMP
		set gunsmoke_angle 64 state spawn_gunsmoke }
		ife KICKBACKPIC 5 
			{ getp[].horiz TEMP sub TEMP 20 setp[].horiz TEMP }
		ife KICKBACKPIC 6 
			{ getp[].horiz TEMP sub TEMP 20 setp[].horiz TEMP }
		
		}
		else 
		{
		set GUN_ACCURACY 24
		add GUN_MAX_SPREAD 24
		set WEAPON0_SHOTSPERBURST 1
		ife KICKBACKPIC 3 
			{ add GUN_SPREAD 24 getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP 
			ifand AMMO_TYPES[CURWEAP] 1 set gun_pushback_power -128 else set gun_pushback_power -48
			state gun_pushback
			}

		ife KICKBACKPIC 4 
			{ getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP
		set gunsmoke_angle 64 state spawn_gunsmoke }
		ife KICKBACKPIC 5 
			{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
		ife KICKBACKPIC 6 
			{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
		
		}
	
	ife KICKBACKPIC 2
		{
		ifand AMMO_TYPES[CURWEAP] 1
			{
			ifand GUNFIREMODE 256
				{
				set GUN_VOLUME 140
				sub TEMP_WEAPON_MAG 2
				espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP EXPL_SHELL_FIRE
				shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361
				shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361
				}
				else
				{
				set GUN_VOLUME 70
				sub TEMP_WEAPON_MAG 1
				espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP EXPL_SHELL_FIRE
				shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361 shoot 9361
				}
			}
			else
		ifand AMMO_TYPES[CURWEAP] 4
			{
			ifand GUNFIREMODE 256
				{
				set GUN_VOLUME 140
				sub TEMP_WEAPON_MAG 2
				espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP FLECH_SHELL_FIRE
				ife ARTIFACTS_LOADOUT[CHAR] 7 
					{
					shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816
					shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816
					}
					else
					{
					shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826
					shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826
					}
				}
				else
				{
				set GUN_VOLUME 70
				sub TEMP_WEAPON_MAG 1
				espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP FLECH_SHELL_FIRE
				ife ARTIFACTS_LOADOUT[CHAR] 7 
					{
					shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816 shoot 6816
					}
					else
					{
					shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826 shoot 6826
					}
				}
			}
			else
			{
			ifand GUNFIREMODE 256
				{
				set GUN_VOLUME 140
				sub TEMP_WEAPON_MAG 2
				espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP SAWNOFF_FIRE
				shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN
				shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN
				}
				else
				{
				set GUN_VOLUME 70
				sub TEMP_WEAPON_MAG 1
				espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP SAWNOFF_FIRE1
				shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN
				}
			}
		}
		
	ife KICKBACKPIC 12
		{
		ifand AMMO_TYPES[CURWEAP] 1
			{
			shoot EXSHELL
			ife TEMP_WEAPON_MAG 0 eshoot EXSHELL
			}
			else
		ifand AMMO_TYPES[CURWEAP] 4
			{
			shoot FL_SHELL
			ife TEMP_WEAPON_MAG 0 eshoot FL_SHELL
			}
			else
			{
			shoot 3761 
			ife TEMP_WEAPON_MAG 0 eshoot 3761 
			}
		ifand GUNFIREMODE 256 xorvar GUNFIREMODE 256 // If they fired a double shot reset to normal mode
		geta[RETURN].ang TEMP sub TEMP 1024 seta[RETURN].ang TEMP
		}
		
	ife KICKBACKPIC 16 
		{ 
		ifand AMMO_TYPES[CURWEAP] 1 
			{
			ifg explosive_shells 1 set TEMP_WEAPON_MAG 2 
			else set TEMP_WEAPON_MAG 1
			}
		else ifand AMMO_TYPES[CURWEAP] 4
			{
			ifg flechete_shells 1 set TEMP_WEAPON_MAG 2 
			else set TEMP_WEAPON_MAG 1
			}
		else
			{
			getp[].ammo_amount 0 TEMP
			ifg TEMP 1 set TEMP_WEAPON_MAG 2 
			else set TEMP_WEAPON_MAG 1
			}
		sound SAWNOFF_LOAD 
		}
	ife KICKBACKPIC 12 sound SAWNOFF_COCK
	}
ife temp_weapon 11 // Is the player using the Tommy Gun?
	{
	set WEAPON0_TILE TOMMYGUNSPRITE
	set GUNMAG -1
	set GUN_VOLUME 24
	set GUN_ACCURACY 16
	set GUN_MAX_SPREAD 64
	set GUN_SIZE 2
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 2
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 3
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	setarray WEAPON_SPECIAL[0] 0
	ifand AMMO_TYPES[CURWEAP] 2
		{
		set WEAPON_TYPE 7
		set WEAPON0_SHOOTS SILVERAMMOSHOT
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP TOMMYG_SFIRE }
		}
		else
		{
		set WEAPON_TYPE 2
		set WEAPON0_SHOOTS F45_CALIBRE
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP TOMMYG_FIRE }
		}
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 4
	
	ife KICKBACKPIC 2 { set GUN_RECOIL 9 add GUN_SPREAD 8 ifand AMMO_TYPES[CURWEAP] 2 shoot SRIFLESHELL else shoot 13772 set gunsmoke_angle 64 state spawn_gunsmoke }
 	
	}
ife temp_weapon 12 // Is the player using the Riotgun?
	{
	set WEAPON0_TILE RIOTGUNSPRITE
	set GUNMAG -1
	set GUN_ACCURACY 24
	set GUN_MAX_SPREAD 8
	set GUN_SIZE 1
	set GUN_HANDS 1 // gun has a strap so player could use it one-handed
	set GUN_AMMO_TYPES 8
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_FLAGS 1024
	setarray WEAPON_SPECIAL[0] 0
	
	ifand AMMO_TYPES[CURWEAP] 8 nullop else
		{
			ife KICKBACKPIC 3 
				{ add GUN_SPREAD 8 getp[].horiz TEMP add TEMP 20 setp[].horiz TEMP 
				set gun_pushback_power -96
				state gun_pushback
				}

			ife KICKBACKPIC 5 
			{ 
			set gunsmoke_angle 64 state spawn_gunsmoke 
			getp[].horiz TEMP sub TEMP 20 setp[].horiz TEMP 
			ifl CUR_AMMO 1
				{
				sound ENDSEQVOL2SND1 set temp_weapon 0 quote 515
				}
			}
		}

 
	ifand AMMO_TYPES[CURWEAP] 8 // Tesla ammo
		{
		set GUN_VOLUME 15
		set WEAPON_TYPE 8
		set WEAPON0_FIREDELAY 27
		set WEAPON0_TOTALTIME 50
		set WEAPON0_HOLDDELAY 55
		set WEAPON0_SHOOTS 6198
		set WEAPON0_SHOTSPERBURST 1
		set WEAPON0_FIRESOUND RIOTGUN_TESLAF
		ife KICKBACKPIC 3 sound MINIGUN_START
		ife KICKBACKPIC 47 sound MINIGUN_STOP
		ife KICKBACKPIC 6 sound TESLA_ARC
		ife KICKBACKPIC 27
			{
			set GUN_RECOIL 5
			set gunsmoke_angle 64 state spawn_gunsmoke 
			set gun_pushback_power -16 state gun_pushback
			}
		ife KICKBACKPIC 28 { ifand BITS_PRESS 4 setp[].kickback_pic 26 }
		}
	else
	ifand GUNFIREMODE 16 // 4 shots
		{
		set GUN_VOLUME 40
		set WEAPON_TYPE 2
		set WEAPON0_FIREDELAY 2
		set WEAPON0_TOTALTIME 46
		set WEAPON0_HOLDDELAY 50
		set WEAPON0_SHOTSPERBURST 7
		set WEAPON0_FIRESOUND RIOTGUN_FIRE
		set WEAPON0_SHOOTS SHOTGUN
		
		ife KICKBACKPIC 6 { sound SAWNOFF_LOAD shoot 3761  } 
		ife KICKBACKPIC 7 
		{ flash espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP RIOTGUN_FIRE shoot SHOTGUN shoot SHOTGUN shoot 
		SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN }
		ife KICKBACKPIC 8 state check_riotgun_ammo
		ife KICKBACKPIC 11 
			{ 
			add GUN_SPREAD 8
			getp[].horiz TEMP add TEMP 20 setp[].horiz TEMP 
			set gun_pushback_power -96
			state gun_pushback
			}
		ife KICKBACKPIC 12 
			{ 
			sound SAWNOFF_LOAD shoot 3761
			set gunsmoke_angle 64 state spawn_gunsmoke 
			getp[].horiz TEMP sub TEMP 20 setp[].horiz TEMP 
			}
		
		ife KICKBACKPIC 13 
		{ flash espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP RIOTGUN_FIRE shoot SHOTGUN shoot SHOTGUN shoot 
		SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN }
		ife KICKBACKPIC 14 state check_riotgun_ammo
		ife KICKBACKPIC 17 
			{ 
			add GUN_SPREAD 8
			getp[].horiz TEMP add TEMP 20 setp[].horiz TEMP 
			set gun_pushback_power -96
			state gun_pushback
			}
		ife KICKBACKPIC 18 
			{ 
			sound SAWNOFF_LOAD shoot 3761
			set gunsmoke_angle 64 state spawn_gunsmoke 
			getp[].horiz TEMP sub TEMP 20 setp[].horiz TEMP 
			}
		
		ife KICKBACKPIC 19 
		{ flash espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP RIOTGUN_FIRE shoot SHOTGUN shoot SHOTGUN shoot 
		SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN shoot SHOTGUN }
		ife KICKBACKPIC 20 state check_riotgun_ammo
		ife KICKBACKPIC 23 
			{ 
			add GUN_SPREAD 8
			getp[].horiz TEMP add TEMP 20 setp[].horiz TEMP 
			set gun_pushback_power -96
			state gun_pushback
			}
		ife KICKBACKPIC 24 
			{ 
			sound SAWNOFF_LOAD shoot 3761
			set gunsmoke_angle 64 state spawn_gunsmoke 
			getp[].horiz TEMP sub TEMP 20 setp[].horiz TEMP 
			}
			
		ife KICKBACKPIC 26 sound RIOTGUN_BOLT
		
		ife KICKBACKPIC 40 sound RIOTGUN_COCK
		
		}
	else // Standard mode
		{
		set GUN_VOLUME 45
		set WEAPON_TYPE 2
		set WEAPON0_FIREDELAY 2
		set WEAPON0_TOTALTIME 15
		set WEAPON0_HOLDDELAY 0
		set WEAPON0_SHOTSPERBURST 7
		set WEAPON0_SHOOTS SHOTGUN
		set WEAPON0_FIRESOUND 4
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP RIOTGUN_FIRE }
		ife KICKBACKPIC 12 { sound SAWNOFF_LOAD shoot 3761 }
		}
	}
ife temp_weapon 13 // Is the player using the crossbow?
	{
	set WEAPON0_TILE CROSSBOWSPRITE
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 24
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 1280
	set WEAPON0_FIRESOUND CROSSBOW
	setarray WEAPON_SPECIAL[0] 64
	
	ife CURWEAP 0
	{
	set GUNMAG -1
	set GUN_VOLUME 0
	set GUN_SIZE 1
	set GUN_HANDS 1
	set WEAPON_TYPE 5
	set GUN_ACCURACY 8
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 16
	
	ifand AMMO_TYPES[CURWEAP] 16 // silver bolts
			{
			ife silver_bolts 0
				{
				quote 279
				set AMMO_TYPE AMMO_TYPES[CURWEAP]
				xorvar AMMO_TYPE 16
				setarray AMMO_TYPES[CURWEAP] AMMO_TYPE
				setp[].weapon_pos 10
				}
			set WEAPON0_SHOOTS 12232
			}
		else
			{
			set WEAPON0_SHOOTS 5011
			}
	
	ife KICKBACKPIC 3 
		{ 
		getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP
		}
	ife KICKBACKPIC 4 
		{ getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP
		}
	ife KICKBACKPIC 5 
		{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
	ife KICKBACKPIC 6 
		{ getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
		
	ife KICKBACKPIC 10 sound CROSSBOW_DRAWBACK
		
	ifand BITS_PRESS 64
	 ifcount 13
		{
		sound SCOPE_ZOOM
		xorvar GUNFIREMODE 16384
		resetcount
		}
		
	}
	
	}
ife temp_weapon 14 // Is the player using the MIA gun?
	{
	set WEAPON0_TILE MIAGUNSPRITE
	set WEAPON_TYPE 6
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 17
	set WEAPON0_HOLDDELAY 17
	set WEAPON0_FIREDELAY 7
	set WEAPON0_FIRESOUND SHRINKER_FIRE
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS 9376
	set WEAPON0_FLAGS 38
	setarray WEAPON_SPECIAL[0] 64
	
	ife CURWEAP 0
		{
		set GUNMAG -1
		set GUN_VOLUME 10
		set GUN_SIZE 1
		set GUN_HANDS 2
		set GUN_ACCURACY 32
		set GUN_MAX_SPREAD 0
		set GUN_AMMO_TYPES 0
		}
	
	}
ife temp_weapon 15 // Is the player using the laser gun?
	{
	set WEAPON0_TILE LASERGUNSPRITE
	set WEAPON_TYPE 2
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 7
	set WEAPON0_HOLDDELAY 7
	set WEAPON0_FIREDELAY 3
	set WEAPON0_FIRESOUND LASERGUN_FIRE
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS GREENLASERSHOT
	set WEAPON0_FLAGS 4
	setarray WEAPON_SPECIAL[0] 64
	
	ife CURWEAP 0
		{
		set GUNMAG -1
		set GUN_VOLUME 10
		set GUN_SIZE 1
		set GUN_HANDS 1
		set GUN_ACCURACY 4
		set GUN_MAX_SPREAD 0
		set GUN_AMMO_TYPES 0
		}
	
	}
ife temp_weapon 16 // Is the player using the missile launcher?
	{
	set WEAPON0_TILE TMISSILELSPRITE

	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 16
	set WEAPON0_HOLDDELAY 16
	set WEAPON0_FIREDELAY 5
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS MISSILE
	set WEAPON0_FLAGS 4
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
		{
		set WEAPON_TYPE 4
		set GUNMAG -1
		set GUN_VOLUME 60
		set GUN_SIZE 2
		set GUN_HANDS 2
		set GUN_ACCURACY 32
		set GUN_MAX_SPREAD 0
		set GUN_AMMO_TYPES 0
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP MISSILE_LAUNCH } 
		}
	}
ife temp_weapon 17 // Is the player using the chainsaw?
	{
	set WEAPON0_TILE CHAINSAWSPRITE
	set GUNMAG -1
	set GUN_VOLUME 10
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 3
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS 10247
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 260
	setarray WEAPON_SPECIAL[0] 64
	
	ife CURWEAP 0
		{
		set WEAPON_TYPE 0
		ife player[].weapon_pos 0
			{
			ife KICKBACKPIC 0 soundonce CHAINSAW_IDLE
			else ifg KICKBACKPIC 0 soundonce CHAINSAW_FIRE
			}
		}
	
	}
ife temp_weapon 18 // Is the player using the flamethrower?
	{
	set WEAPON0_TILE FLAMETHROWERSPRITE
	set GUNMAG -1
	set GUN_VOLUME 16
	set GUN_SIZE 2
	set GUN_HANDS 2
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 3
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND FLAMETH_START
	set WEAPON0_SHOOTS -1
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 260
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
		{
		ifvarl player[].ammo_amount 0 2 { soundonce FLAMETH_STOP stopsound FLAMETH_FIRE }
		set WEAPON_TYPE 6
		ife KICKBACKPIC 0
			{
			ifactorsound THISACTOR FLAMETH_FIRE
				{
				stopsound FLAMETH_FIRE
				soundonce FLAMETH_STOP
				}
			}
		ife KICKBACKPIC 2 
			{
			ifand BITS_PRESS 4 
				{
				ifactorsound THISACTOR FLAMETH_START nullop else
				soundonce FLAMETH_FIRE
				}
			espawn 3296
			geta[].x TEMP
			geta[].y TEMP2
			set TEMP3 TEMP
			add TEMP3 256
			geta[].ang TEMP4
			add TEMP4 192
			randvar TEMP5 8
			ifrnd 128 add TEMP4 TEMP5 else sub TEMP4 TEMP5
			rotatepoint TEMP TEMP2 TEMP3 TEMP2 TEMP4 TEMP5 TEMP6
			seta[RETURN].x TEMP5 
			seta[RETURN].y TEMP6
			}
		}
	
	}
ife temp_weapon 19 // Is the player using the katana?
	{
	set WEAPON0_TILE SWORDSPRITE
	set GUNMAG -1
	set GUN_VOLUME 0
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 15
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 8
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS 12053
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 260
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
	{
	set WEAPON_TYPE 2
	ifand BITS_PRESS 64
	 ifp palive
	 ifg SPRINTING 0
		{
		setp[].kickback_pic 0
		set SWORD_BLOCK 19
		}
		else
		set SWORD_BLOCK 0
	
		ife KICKBACKPIC 0 
			{
			set SWORD_ANIM 0
			ife player[].weapon_pos 1 state CHAR_DRAW_SWORD
			}
		
		ife KICKBACKPIC 6 sound SWING
		
		ife KICKBACKPIC 8 ifg SWORD_RAMP 0 eshoot 12053 setthisprojectile[RETURN].userdata 72
		
		ife KICKBACKPIC 13
		{
		randvar SWORD_ANIM 2
		ifand BITS_PRESS 4 setp[].kickback_pic 5
		}
	}
	
	}
ife temp_weapon 20 // Is the player using the mop?
{
	set WEAPON0_TILE MOPSPRITE
	set GUNMAG -1
	set GUN_VOLUME 0
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 15
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 8
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS 12054
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 260
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
	{
	set WEAPON_TYPE 2
		ife KICKBACKPIC 0  set SWORD_ANIM 0
		
		ife KICKBACKPIC 6 sound SWING
		
		ife KICKBACKPIC 13
		{
		randvar SWORD_ANIM 2
		ifand BITS_PRESS 4 setp[].kickback_pic 5
		}
	}
	
}
ife temp_weapon 21 // Is the player using the FN FAL?
{
	set WEAPON0_TILE FNFALSPRITE
    set GUN_VOLUME 15
	set GUN_ACCURACY 8
	set GUN_MAX_SPREAD 48
	set GUN_SIZE 2
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 0
	set WEAPON0_FIREDELAY 2
	set WEAPON0_TOTALTIME 4
	set WEAPON0_HOLDDELAY 1
	set WEAPON0_FIRESOUND 4
	set WEAPON0_FLAGS 8276
	set WEAPON0_SPAWN 0
	set WEAPON0_SHOOTS RMAXREVOLVERSHOT
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_CLIP 0
	set WEAPON0_RELOADSOUND1 4
	set WEAPON0_RELOADSOUND2 4
	setarray WEAPON_SPECIAL[0] 0

	ife CURWEAP 0
		{
		set WEAPON_TYPE 0
		set GUNMAG TEMP_WEAPON_MAG
		// set MAX_TEMP_WEAPON_MAG 20
		
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP FNFAL_FIRE }
		
		ife KICKBACKPIC 3 { add GUN_SPREAD 16 set GUN_RECOIL 6 set gunsmoke_angle 32 state spawn_gunsmoke }
		
		ife KICKBACKPIC 26
			{
			set GUN_RECOIL_COUNT 0
			ifl TEMP_WEAPON_MAG 1 set MAX_TEMP_WEAPON_MAG 20
			else set MAX_TEMP_WEAPON_MAG 21
			}
			
		ifand GUNFIREMODE 16384 ifg KICKBACKPIC 6 { set HIDE_CROSSHAIR 0 xorvar GUNFIREMODE 16384 }
		
		ife KICKBACKPIC 10 { sound FNFAL_RELOAD ife TEMP_WEAPON_MAG 0 spawn 3756 }
		
		ife KICKBACKPIC 27
		{ ifvarvarl CUR_AMMO MAX_TEMP_WEAPON_MAG set TEMP_WEAPON_MAG CUR_AMMO else set TEMP_WEAPON_MAG MAX_TEMP_WEAPON_MAG }
		ife KICKBACKPIC 35 sound AUG_MOVEMENT
		ife KICKBACKPIC 46 sound BOLT_CATCH
		ife KICKBACKPIC 55 sound AUG_MOVEMENT
		
	  ifl TEMP_WEAPON_MAG 1
	   ife player[].weapon_pos 0
	    ife KICKBACKPIC 0
			{
		   	ifn CUR_AMMO 0
		   		{
				set WEAPON0_RELOAD 56
		   		setp[].reloading 1
		   		setp[].kickback_pic 6
				}
			}
		}
}
ife temp_weapon 22 // Is the player using the MP40?
{
	set WEAPON0_TILE MP40SPRITE
    set GUN_VOLUME 6
	set GUN_ACCURACY 8
	set GUN_MAX_SPREAD 24
	set GUN_AMMO_TYPES 0
	set GUN_SIZE 1
	set GUN_HANDS 1 // player could use it 1-handed
	set WEAPON0_FIREDELAY 2
	set WEAPON0_TOTALTIME 4
	set WEAPON0_HOLDDELAY 1
	set WEAPON0_FIRESOUND 4
	set WEAPON0_FLAGS 8276
	set WEAPON0_SPAWN 0
	set WEAPON0_RELOAD 34
	set WEAPON0_SHOOTS CHAINGUN
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_CLIP 0
	set WEAPON0_RELOADSOUND1 4
	set WEAPON0_RELOADSOUND2 4
	setarray WEAPON_SPECIAL[0] 0

	ife CURWEAP 0
		{
		set WEAPON_TYPE 2
		set GUNMAG TEMP_WEAPON_MAG
		set MAX_TEMP_WEAPON_MAG 32
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP VLAD_RIFLE set GUN_RECOIL 4 } 
		ife KICKBACKPIC 2 { set gunsmoke_angle 32 state spawn_gunsmoke }
		ife KICKBACKPIC 3 add GUN_SPREAD 8
		
		ife KICKBACKPIC 11 { sound MP40_MAGOUT ife TEMP_WEAPON_MAG 0 spawn 3737 }
		
		ife KICKBACKPIC 29 
			{
			sound MP40_MAGIN
			ifvarvarl CUR_AMMO MAX_TEMP_WEAPON_MAG set TEMP_WEAPON_MAG CUR_AMMO else set TEMP_WEAPON_MAG MAX_TEMP_WEAPON_MAG
			}
		
	  ifl TEMP_WEAPON_MAG 1
	   ife player[].weapon_pos 0
	    ife KICKBACKPIC 0
			{
		   	ifn CUR_AMMO 0
		   		{
		   		setp[].reloading 1
		   		setp[].kickback_pic 6
				}
			}
		}
}
ife temp_weapon 23 // is the player using the GDF plasmagun?
{
set WEAPON0_TILE JPLASMASPRITE
set GUN_VOLUME 3
set GUN_ACCURACY 32
set GUN_MAX_SPREAD 0
set GUN_SIZE 2
set GUN_HANDS 1
set GUN_AMMO_TYPES 0
set WEAPON0_SHOOTS 5372
set WEAPON0_FIREDELAY 2
set WEAPON0_TOTALTIME 4
set WEAPON0_HOLDDELAY 0 
set WEAPON0_FIRESOUND 4
set WEAPON0_INITIALSOUND 0
set WEAPON0_FLAGS 22
setarray WEAPON_SPECIAL[0] 64

	ife CURWEAP 0 
		{ 
		set WEAPON_TYPE 8
		set GUNMAG -1 
		ife camerasprite -1 soundonce PLASMAAMB 
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP PLASMAGUN } 
		}
	
}
ife temp_weapon 24 // Is the player using the lizard man firelasergun?
{
	set WEAPON0_TILE LIZMANFGUNSPRITE
	set GUN_VOLUME 15
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 0
	set GUNMAG -1
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 4
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND MINIGUN_START
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS FIRELASER
	set WEAPON0_FLAGS 6
	setarray WEAPON_SPECIAL[0] 0
	
	set WEAPON_TYPE 8
	
	ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP PRED_ATTACK } 
	
	ife KICKBACKPIC 1 set GUN_RECOIL 5
	ife KICKBACKPIC 2 { set gunsmoke_angle 64 state spawn_gunsmoke }
	
}
ife temp_weapon 25 // Is the player using the M4?
{
set WEAPON0_TILE M16SPRITE

	set WEAPON0_FIREDELAY 2
	set WEAPON0_TOTALTIME 3
	set WEAPON0_HOLDDELAY 1
	set WEAPON0_FIRESOUND 4
	set WEAPON0_FLAGS 4
	set WEAPON0_SPAWN 0
	set WEAPON0_SHOOTS ZRIFLESHOTU
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_CLIP 0
	set WEAPON0_RELOADSOUND1 4
	set WEAPON0_RELOADSOUND2 4

	ife CURWEAP 0
		{
		set WEAPON_TYPE 0
		ifg GL_COUNTDOWN 0 sub GL_COUNTDOWN 1
		set GUN_VOLUME 6
		set GUN_ACCURACY 8
		set GUN_MAX_SPREAD 32
		set GUN_SIZE 2
		set GUN_HANDS 2
		setarray WEAPON_SPECIAL[0] 2
		
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP M16_2_FIRE } 
			
		ifand GUNFIREMODE 32768 // If GL is selected
		set GUN_AMMO_TYPES 2048 // set ammo types to m203 compatible
		else
		set GUN_AMMO_TYPES 32 // set firing menu to switching to gl
		
		state check_cased_grenades_avail
		
		set GUNMAG TEMP_WEAPON_MAG
		set MAX_TEMP_WEAPON_MAG 40
		ife KICKBACKPIC 2 { set gunsmoke_angle 64 state spawn_gunsmoke }
		ife KICKBACKPIC 2 { set GUN_RECOIL 8 add GUN_SPREAD 8 }
		
		ife KICKBACKPIC 18 { sound M16OUT ife TEMP_WEAPON_MAG 0 spawn 3756 }
		
		
		ife GL_COUNTDOWN 45 { set gunsmoke_angle 32 state spawn_gunsmoke 
		getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP }
		ife GL_COUNTDOWN 44 { getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
		
					ife GL_COUNTDOWN 34 soundonce GL_OPEN
					ife GL_COUNTDOWN 30 state shoot_empty_40mmshell
					ife GL_COUNTDOWN 16 soundonce GL_INSERT
					ife GL_COUNTDOWN 8 soundonce GL_CLOSE
					
				ifg GL_COUNTDOWN 44
					{
					sub WEAPSWAYX 5
					sub WEAPSWAYY 5
					}
		
		ife KICKBACKPIC 30 
			{
			sound M16IN
			ifvarvarl CUR_AMMO MAX_TEMP_WEAPON_MAG set TEMP_WEAPON_MAG CUR_AMMO else set TEMP_WEAPON_MAG MAX_TEMP_WEAPON_MAG
			}
		ife KICKBACKPIC 46 state JMOVESOUND2
		ife KICKBACKPIC 52 soundonce BOLT_CATCH
		
	  ifl TEMP_WEAPON_MAG 1
	   ife player[].weapon_pos 0
	    ife KICKBACKPIC 0
			{
		   	ifn CUR_AMMO 0
		   		{
				set WEAPON0_RELOAD 61
		   		setp[].reloading 1
		   		setp[].kickback_pic 6
				}
			}
		}
}
ife temp_weapon 26 // Is the player using the AK104?
{
set WEAPON0_TILE AK114SPRITE

	setarray WEAPON_SPECIAL[0] 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_TOTALTIME 4
	set WEAPON0_HOLDDELAY 1
	set WEAPON0_FIRESOUND 4
	set WEAPON0_FLAGS 4
	set WEAPON0_SPAWN 0
	set WEAPON0_SHOOTS MSCORP_SHOT
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_CLIP 0
	set WEAPON0_RELOADSOUND1 4
	set WEAPON0_RELOADSOUND2 4
	


	ife CURWEAP 0
		{
		set WEAPON_TYPE 0
		set GUN_SIZE 2
		set GUN_HANDS 2
		ifg GL_COUNTDOWN 0 sub GL_COUNTDOWN 1
		set GUN_VOLUME 14
		
		ifand GUNFIREMODE 32768 // If GL is selected
		set GUN_AMMO_TYPES 4096 // set ammo types to gp25/30 compatible
		else
		set GUN_AMMO_TYPES 64 // set firing menu to switching to gl
		
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP AK104FIRE } 
		
		state check_caseless_grenades_avail
		
		ifand GUNFIREMODE 32768
		{
		ifand GUNFIREMODE 16384 xorvar GUNFIREMODE 32768
		}
		ifand GUNFIREMODE 16384 set GUN_ACCURACY 4
		else set GUN_ACCURACY 16
		
		set GUN_MAX_SPREAD 48
		
		set GUNMAG TEMP_WEAPON_MAG
		// set MAX_TEMP_WEAPON_MAG 30
		ife KICKBACKPIC 2 { ifand GUNFIREMODE 16384 set gunsmoke_angle 0 else set gunsmoke_angle 32 state spawn_gunsmoke }
		ife KICKBACKPIC 3
			{
			set GUN_RECOIL 8
			ifand GUNFIREMODE 16384 add GUN_SPREAD 8
			else add GUN_SPREAD 10
			}
			
		ife KICKBACKPIC 7 sound AUG_MOVEMENT
		
		ife KICKBACKPIC 10 { sound AK104_RELOAD ife TEMP_WEAPON_MAG 0 spawn 3756 }
		
		ife KICKBACKPIC 21 sound AUG_MOVEMENT
		
		ife KICKBACKPIC 26
			{
			ifl TEMP_WEAPON_MAG 1 set MAX_TEMP_WEAPON_MAG 30
			else set MAX_TEMP_WEAPON_MAG 31
			}
		
		ife KICKBACKPIC 27 
			{
			ifvarvarl CUR_AMMO MAX_TEMP_WEAPON_MAG set TEMP_WEAPON_MAG CUR_AMMO else set TEMP_WEAPON_MAG MAX_TEMP_WEAPON_MAG
			}
		ife KICKBACKPIC 44 sound AK104_BOLT
		ife KICKBACKPIC 55 sound AUG_MOVEMENT
		
		ifand GUNFIREMODE 16384 ifg KICKBACKPIC 6 { set HIDE_CROSSHAIR 0 xorvar GUNFIREMODE 16384 }
		
				ife GL_COUNTDOWN 45 { set gunsmoke_angle 32 state spawn_gunsmoke 
				getp[].horiz TEMP add TEMP 10 setp[].horiz TEMP }
				ife GL_COUNTDOWN 44 { getp[].horiz TEMP sub TEMP 10 setp[].horiz TEMP }
				
				ife GL_COUNTDOWN 35 sound AUG_MOVEMENT
				ife GL_COUNTDOWN 18 soundonce GL_RELOAD

							
						ifg GL_COUNTDOWN 44
							{
							sub WEAPSWAYX 5
							sub WEAPSWAYY 5
							}

		
	  ifl TEMP_WEAPON_MAG 1
	   ife player[].weapon_pos 0
	    ife KICKBACKPIC 0
			{
		   	ifn CUR_AMMO 0
		   		{
				set WEAPON0_RELOAD 58
		   		setp[].reloading 1
		   		setp[].kickback_pic 6
				}
			}
		}
}
ife temp_weapon 27 // Is the player using the Riotgun-minigun?
{
set WEAPON0_TILE RIOTGUN_MINIGUN_SPRITE
set GUN_VOLUME 20
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 12
	set GUN_SIZE 3
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 8
	set GUNMAG -1
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_FLAGS 1024
	setarray WEAPON_SPECIAL[0] 0
 
		ifand AMMO_TYPES[CURWEAP] 8 // Tesla ammo
		{
		set WEAPON_TYPE 8
		set WEAPON0_FIREDELAY 27
		set WEAPON0_TOTALTIME 50
		set WEAPON0_HOLDDELAY 55
		set WEAPON0_SHOOTS 6198
		set WEAPON0_SHOTSPERBURST 1
		set WEAPON0_FIRESOUND RIOTGUN_TESLAF
		ife KICKBACKPIC 6 sound TESLA_ARC
		ife KICKBACKPIC 27
			{
			set gunsmoke_angle 64 state spawn_gunsmoke 
			set gun_pushback_power -16 state gun_pushback
			}
		}
		else
		{
		set WEAPON_TYPE 0
		set WEAPON0_FIREDELAY 27
		set WEAPON0_TOTALTIME 50
		set WEAPON0_HOLDDELAY 55
		set WEAPON0_SHOOTS ZRIFLESHOTU
		set WEAPON0_SHOTSPERBURST 2
		set WEAPON0_FIRESOUND 4
		}
		
		ife CURWEAP 0
		{		
		ife KICKBACKPIC 3 sound MINIGUN2_START
		ife KICKBACKPIC 37 sound MINIGUN2_STOP
		ife KICKBACKPIC 27
			{
			espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP BOS1_ATTACK1
			set gunsmoke_angle 64 state spawn_gunsmoke 
			set gun_pushback_power -16 state gun_pushback
			set GUN_RECOIL 10
			ifand AMMO_TYPES[CURWEAP] 8 nullop else shoot RIFLESHELL
			}
		ife KICKBACKPIC 28 
			{ 
			add GUN_SPREAD 8
			ifand BITS_PRESS 4 setp[].kickback_pic 26
			ifand AMMO_TYPES[CURWEAP] 8 nullop else shoot RIFLESHELL
			}
		}
 
}
ife temp_weapon 28 // is the player using the nailgun?
{
set WEAPON0_TILE NAILGUN_SPRITE
ife ARTIFACTS_LOADOUT[CHAR] 7 set WEAPON0_SHOOTS 6816 else
set WEAPON0_SHOOTS 6826
set WEAPON0_FIREDELAY 2
set WEAPON0_TOTALTIME 4
set WEAPON0_HOLDDELAY 0 
set WEAPON0_FIRESOUND 4
set WEAPON0_INITIALSOUND 0
set WEAPON0_FLAGS 22
set WEAPON0_SHOTSPERBURST 1
setarray WEAPON_SPECIAL[0] 64

	ife CURWEAP 0 
		{
		set WEAPON_TYPE 9
		ife KICKBACKPIC 2 { espawn 2520 set GUN_RECOIL 10 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP NAILGUN2_FIRE } 
		set GUN_VOLUME 12
		set GUN_ACCURACY 32
		set GUN_MAX_SPREAD 0
		set GUN_SIZE 1
		set GUN_HANDS 2
		set GUN_AMMO_TYPES 0
		set GUNMAG -1 
		}
}
ife temp_weapon 29 // Is the player using the Riotgun-grenade launcher?
	{
	set WEAPON0_TILE RIOTGUN_GRENADEL_SPRITE
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_FLAGS 1024
		
		set WEAPON0_FIREDELAY 2
		set WEAPON0_TOTALTIME 10
		set WEAPON0_HOLDDELAY 0
		set WEAPON0_SHOTSPERBURST 1
		set WEAPON0_SHOOTS 5375
		set WEAPON0_FIRESOUND 4
		setarray WEAPON_SPECIAL[0] 0
			
		ife CURWEAP 0
		{
		set WEAPON_TYPE 4
		set GUNMAG -1
		set GUN_ACCURACY 32
		set GUN_MAX_SPREAD 0
		set GUN_SIZE 3
		set GUN_HANDS 2
		set GUN_AMMO_TYPES 0
			set GUN_VOLUME 45
			ife KICKBACKPIC 1 
				{ getp[].horiz TEMP add TEMP 20 setp[].horiz TEMP 
				set gun_pushback_power -96
				state gun_pushback
				}
				
			ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP RG_GL_FIRE } 

			ife KICKBACKPIC 3 
			{ 
			set gunsmoke_angle 64 state spawn_gunsmoke 
			getp[].horiz TEMP sub TEMP 20 setp[].horiz TEMP 
			ifl CUR_AMMO 1
				{
				sound ENDSEQVOL2SND1 set temp_weapon 0 quote 515
				}
			}
			ife KICKBACKPIC 5 sound RG_GL_COCK
		}

 
}
ife temp_weapon 30 // is the player using the dartgun?
{
set WEAPON0_TILE DARTGUN_SPRITE

set WEAPON0_FIREDELAY 2
set WEAPON0_TOTALTIME 10
set WEAPON0_HOLDDELAY 4 
	ifinwater
	{
	set WEAPON_TYPE 8
	set WEAPON0_SHOOTS 14510 
	set WEAPON0_FIRESOUND DARTGUN_FIRE_W
	}
else
	{
	set WEAPON_TYPE 8
	set WEAPON0_SHOOTS 14509
	set WEAPON0_FIRESOUND DARTGUN_FIRE
	}
set WEAPON0_INITIALSOUND 0
set WEAPON0_FLAGS 260
set WEAPON0_SHOTSPERBURST 1
setarray WEAPON_SPECIAL[0] 64

		set GUN_VOLUME 4
		ifinwater set GUN_ACCURACY 2
		else set GUN_ACCURACY 64
		set GUN_MAX_SPREAD 0
		set GUN_SIZE 1
		set GUN_HANDS 2
		set GUN_AMMO_TYPES 0
		
		ife KICKBACKPIC 3 set GUN_RECOIL 5
		ife KICKBACKPIC 5 sound ROTATEBARREL
		
		set GUNMAG -1 
		
		ifg GL_COUNTDOWN 0
			{
			sub GL_COUNTDOWN 1
			ife GL_COUNTDOWN 29
				{
				sub WEAPSWAYX 10
				sub WEAPSWAYY 10
				sound DARTGUN_FIRE_T
				flash
				shoot TORPEDO
				}
			ife GL_COUNTDOWN 20 ifg micro_torpedo 1 sound DARTGUN_TORP_L	
			}		
}
ife temp_weapon 31 // is the player using the M60?
{
set WEAPON0_TILE M60_SPRITE
set WEAPON0_SHOOTS RMAXREVOLVERSHOT
set WEAPON0_SHOTSPERBURST 1
set WEAPON0_HOLDDELAY 1 
set WEAPON0_FIRESOUND 4
set WEAPON0_INITIALSOUND 0
set WEAPON0_FLAGS 22
setarray WEAPON_SPECIAL[0] 0

set WEAPON0_FIREDELAY 2
set WEAPON0_TOTALTIME 3
set WEAPON0_RELOAD 70
set WEAPON0_FLAGS 4

	ife CURWEAP 0 
		{
		set GUN_VOLUME 25
		set WEAPON_TYPE 0
		set GUN_SIZE 2
		set GUN_HANDS 2
		set GUN_AMMO_TYPES 0
		set GUNMAG TEMP_WEAPON_MAG
		set MAX_TEMP_WEAPON_MAG 100
		ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP M60_FIRE } 
		ifand GUNFIREMODE 512 // using bipod?
			{
			set GUN_ACCURACY 8
			set GUN_MAX_SPREAD 8
			ife KICKBACKPIC 1 { add GUN_SPREAD 4 set GUN_RECOIL 7 }
			ife KICKBACKPIC 2 { set gunsmoke_angle 64 state spawn_gunsmoke }
			}
		else
			{
			set GUN_ACCURACY 12
			set GUN_MAX_SPREAD 32
			ife KICKBACKPIC 1 { add GUN_SPREAD 7 set GUN_RECOIL 15 }
			ife KICKBACKPIC 2 { set gunsmoke_angle 64 state spawn_gunsmoke }
			}
		ife KICKBACKPIC 18 sound M60_RELOAD1
		ife KICKBACKPIC 50 
			{
			sound M60_RELOAD2
			ifvarvarl CUR_AMMO MAX_TEMP_WEAPON_MAG set TEMP_WEAPON_MAG CUR_AMMO else set TEMP_WEAPON_MAG MAX_TEMP_WEAPON_MAG
			}
			
		ifg GUN_HEAT[CURWEAP] 40
			{
			ifg KICKBACKPIC 10 { set gunsmoke_z 9144 set gunsmoke_angle 64 } 
			else { set gunsmoke_z 9144 set gunsmoke_angle 64 } 
			state spawn_gunsmoke_z
			}
			
	  ifl TEMP_WEAPON_MAG 1
	   ife player[].weapon_pos 0
	    ife KICKBACKPIC 0
			{
		   	ifn CUR_AMMO 0
		   		{
		   		setp[].reloading 1
		   		setp[].kickback_pic 12
				}
			}
		ifand GUNFIREMODE 512
			{
			ifand BITS_PRESS 64
			ifcount 16
				{
				setp[].weapon_pos 10
				xorvar GUNFIREMODE 512
				soundonce PUT_ON_EQUIP
				resetcount
				}
			}
			else
			ifp pstanding
			{
			state checkwall
				ife WALL_CLOSE 1
					set player_bipod 0
			}
		}
}
ife temp_weapon 32 // Is the player using the Zilla missile launcher?
	{
	set WEAPON0_TILE ZMISSILELSPRITE
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 18
	set WEAPON0_HOLDDELAY 18
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND Z_MISSILE_FIRE
	set WEAPON0_SHOOTS 0
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 4
	setarray WEAPON_SPECIAL[0] 0

	ife CURWEAP 0
		{
		set GUNMAG -1
		set GUN_VOLUME 60
		set GUN_SIZE 2
		set GUN_HANDS 2
		set GUN_ACCURACY 32
		set GUN_MAX_SPREAD 0
		set GUN_AMMO_TYPES 512
		
		ifand GUNFIREMODE_2 2 set WEAPON0_FIRESOUND Z_MISSILE_FIRE
		else ifand GUNFIREMODE_2 4 set WEAPON0_FIRESOUND DUP_FIRE
		else set WEAPON0_FIRESOUND Z_MISSILE_FIRE
		
		ife KICKBACKPIC 2 
			{
			ife GEO_MEGA_SHOT[1] 1
			 ifand GUNFIREMODE_2 2
			  ifg atomic_bomb 0
				{
				globalsound Z_WARNING
				shoot ATOM_BOMB
				sub atomic_bomb 1
				setarray GEO_MEGA_SHOT[1] 0
				}
			else
			 ifand GUNFIREMODE_2 1
			  ifg heat_seek_card 0
				{
				ifand GUNFIREMODE_2 4
				 ifg DUP_missile_ammo 0
					{
					setprojectile[HOMING_MISSILE].userdata 32
					setprojectile[HOMING_MISSILE].pal 10
					eshoot HOMING_MISSILE // userdata has to be changed before firing
					setprojectile[HOMING_MISSILE].userdata 64
					setprojectile[HOMING_MISSILE].pal 21
					sound HEAT_SEEK
					setthisprojectile[RETURN].hitradius 4500
					setthisprojectile[RETURN].workslike 65538
					setthisprojectile[RETURN].vel 975
					setthisprojectile[RETURN].xrepeat 40
					setthisprojectile[RETURN].yrepeat 40
					setthisprojectile[RETURN].extra 275
					setthisprojectile[RETURN].extra_rand 275
					setthisprojectile[RETURN].userdata 32
					setthisprojectile[RETURN].isound EXPLOSION_BIG
					setthisprojectile[RETURN].spawns BIG_EXPLOSION
					sub DUP_missile_ammo 1
					}
					else
					{
					eshoot HOMING_MISSILE
					sound HEAT_SEEK
					setthisprojectile[RETURN].hitradius 2250
					setthisprojectile[RETURN].workslike 65538
					setthisprojectile[RETURN].vel 775
					setthisprojectile[RETURN].extra 75
					setthisprojectile[RETURN].extra_rand 75
					}
				sub heat_seek_card 1
				}
			else
				{
				ifand GUNFIREMODE_2 4
				 ifg DUP_missile_ammo 0
					{
					setprojectile[MICRO_MISSILE].userdata 32
					setprojectile[MICRO_MISSILE].pal 14
					eshoot MICRO_MISSILE  // userdata has to be changed before firing
					setprojectile[MICRO_MISSILE].userdata 64
					setprojectile[MICRO_MISSILE].pal 0
					setthisprojectile[RETURN].hitradius 4500
					setthisprojectile[RETURN].workslike 65538
					setthisprojectile[RETURN].pal 14
					setthisprojectile[RETURN].vel 975
					setthisprojectile[RETURN].xrepeat 40
					setthisprojectile[RETURN].yrepeat 40
					setthisprojectile[RETURN].extra 275
					setthisprojectile[RETURN].extra_rand 275
					setthisprojectile[RETURN].isound EXPLOSION_BIG
					setthisprojectile[RETURN].spawns BIG_EXPLOSION
					sub DUP_missile_ammo 1
					}
					else
					{
					eshoot MICRO_MISSILE
					setthisprojectile[RETURN].hitradius 2250
					setthisprojectile[RETURN].workslike 65538
					setthisprojectile[RETURN].vel 675
					setthisprojectile[RETURN].velmult 2
					setthisprojectile[RETURN].extra 75
					setthisprojectile[RETURN].extra_rand 75
					}
				}
			}
			
		set WEAPON_TYPE 4
		ifand GUNFIREMODE_2 1 // heat
			{
			ifg NUKE_COUNTDOWN 0 set NUKE_COUNTDOWN 0
			ife heat_seek_card 0 xorvar GUNFIREMODE_2 1 // take off heat mode if no heat card
			}
		ifand GUNFIREMODE_2 2 // nuke
			{
			set WEAPON_TYPE 10
			ifg atomic_bomb 1 set atomic_bomb 1 // fail safe to make sure they have a limit of 1
			ife atomic_bomb 0 ife KICKBACKPIC 0 xorvar GUNFIREMODE_2 2 // take off atomic mode if no atomic
			}
		ifand GUNFIREMODE_2 4 // DUP missiles
			{
			set WEAPON_TYPE 9
			ifand GUNFIREMODE_2 2 set WEAPON_TYPE 10 else ifg NUKE_COUNTDOWN 0 set NUKE_COUNTDOWN 0
			ifg DUP_missile_ammo 10 set DUP_missile_ammo 10 // fail safe to make sure they have a limit of 10
			ife DUP_missile_ammo 0 xorvar GUNFIREMODE_2 4 // take off DUP mod if no DUP missiles left
			}
			
		ifand GUNFIREMODE_2 2
		 ife KICKBACKPIC 0
		 {
		 ife GEO_MEGA_SHOT[1] 1 set GUN_ACCURACY 0
		  ife GEO_MEGA_SHOT[1] 0
			{
			set GUN_ACCURACY NUKE_COUNTDOWN
			ife NUKE_COUNTDOWN 0 set NUKE_COUNTDOWN 191
			ifg NUKE_COUNTDOWN 0 sub NUKE_COUNTDOWN 1 
			ife NUKE_COUNTDOWN 180 soundonce Z_STANDBY
			ife NUKE_COUNTDOWN 130 soundonce Z_COUNTD
			ife NUKE_COUNTDOWN 40 soundonce Z_SYSREADY
			ife NUKE_COUNTDOWN 5 state NUKE_TAUNTS
			ife NUKE_COUNTDOWN 1 { setarray GEO_MEGA_SHOT[1] 1 set NUKE_COUNTDOWN 0 }
			}
		  }
		ife KICKBACKPIC 2 { set gunsmoke_angle 64 state spawn_gunsmoke }
		ife KICKBACKPIC 3 { getp[].horiz TEMP add TEMP 5 setp[].horiz TEMP }
		ife KICKBACKPIC 4 { getp[].horiz TEMP add TEMP 5 setp[].horiz TEMP }
		ife KICKBACKPIC 5 { getp[].horiz TEMP add TEMP 5 setp[].horiz TEMP }
		ife KICKBACKPIC 6 { getp[].horiz TEMP sub TEMP 5 setp[].horiz TEMP }
		ife KICKBACKPIC 7 { getp[].horiz TEMP sub TEMP 5 setp[].horiz TEMP }
		ife KICKBACKPIC 8 { getp[].horiz TEMP sub TEMP 5 setp[].horiz TEMP }
		}
	}
ife temp_weapon 33 // is the player using the Guardian head?
{
set WEAPON0_TILE 16030
set WEAPON0_FIREDELAY 2
set WEAPON0_TOTALTIME 3
set WEAPON0_FIRESOUND 0
set WEAPON0_HOLDDELAY 0 
set WEAPON0_INITIALSOUND 0
set WEAPON0_FLAGS 70
setarray WEAPON_SPECIAL[0] 0

	ife CURWEAP 0 
		{
		set WEAPON_TYPE 8
		set GUN_VOLUME 3
		set GUN_ACCURACY 32
		set GUN_MAX_SPREAD 0
		set GUN_SIZE 1
		set GUN_HANDS 1
		set GUN_AMMO_TYPES 0
		set GUNMAG -1 
		
		ifl CUR_AMMO 10
			{
			ifand GUNFIREMODE_2 8 { xorvar GUNFIREMODE_2 8 sound BLOOD_SPURT }
			ifand GUNFIREMODE_2 4 { xorvar GUNFIREMODE_2 4 sound BLOOD_SPURT }
			}
		
		ifand GUNFIREMODE_2 8
			{
			set WEAPON0_SHOOTS GORO_EXPLODING_FLAME
			set WEAPON0_SHOTSPERBURST 1
			set WEAPON0_TOTALTIME 26
			ife KICKBACKPIC 2 
				{
				getp[].ammo_amount 0 TEMP sub TEMP 9 setp[].ammo_amount 0 TEMP
				sound GUARDIAN_FLAME				
				}
			ife KICKBACKPIC 3
				{
				setprojectile[GORO_EXPLODING_FLAME].offset -26
				eshoot GORO_EXPLODING_FLAME 		
				setprojectile[GORO_EXPLODING_FLAME].offset 64
				eshoot GORO_EXPLODING_FLAME 
				setprojectile[GORO_EXPLODING_FLAME].offset 224
				}
			}
		else
		ifand GUNFIREMODE_2 4
			{
			set WEAPON0_SHOOTS 0
			set WEAPON0_SHOTSPERBURST 0
			set WEAPON0_TOTALTIME 26
			ife KICKBACKPIC 2 
				{
				getp[].ammo_amount 0 TEMP sub TEMP 9 setp[].ammo_amount 0 TEMP
				spawn 17361
				espawn 17361 setactorvar[RETURN].TEMP4 205
				espawn 17361 setactorvar[RETURN].TEMP4 510
				espawn 17361 setactorvar[RETURN].TEMP4 715
				espawn 17361 setactorvar[RETURN].TEMP4 920
				espawn 17361 setactorvar[RETURN].TEMP4 1125
				espawn 17361 setactorvar[RETURN].TEMP4 1330
				espawn 17361 setactorvar[RETURN].TEMP4 1535
				espawn 17361 setactorvar[RETURN].TEMP4 1740
				espawn 17361 setactorvar[RETURN].TEMP4 1945
				sound GUARDIAN_FLAME
				}
			}
		else
			{
			ife CHAR 0 ifg VOLUME 1 
				{
				ifg KICKBACKPIC 0 setprojectile[GORO_FLAME].OFFSET -224
				else setprojectile[GORO_FLAME].OFFSET 224
				}
			set WEAPON0_SHOOTS GORO_FLAME
			set WEAPON0_SHOTSPERBURST 1
			set WEAPON0_TOTALTIME 3
			ife KICKBACKPIC 2 sound GUARDIAN_FLAME
			}
		}
}
ife temp_weapon 34 // Is the player using the Riotgun-minigun mark2?
{
set WEAPON0_TILE 16087
set GUN_VOLUME 20
	set GUN_ACCURACY 24
	set GUN_MAX_SPREAD 8
	set GUN_SIZE 2
	set GUN_HANDS 3
	set GUN_AMMO_TYPES 8
	set GUNMAG -1
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_FLAGS 1024
	setarray WEAPON_SPECIAL[0] 0
 	
		ifand AMMO_TYPES[CURWEAP] 8 // Tesla ammo
		{
		set WEAPON_TYPE 8
		set WEAPON0_FIREDELAY 27
		set WEAPON0_TOTALTIME 50
		set WEAPON0_HOLDDELAY 55
		set WEAPON0_SHOOTS 6198
		set WEAPON0_SHOTSPERBURST 1
		set WEAPON0_FIRESOUND RIOTGUN_TESLAF
		ife KICKBACKPIC 6 sound TESLA_ARC
		ife KICKBACKPIC 27
			{
			set gunsmoke_angle 64 state spawn_gunsmoke 
			set gun_pushback_power -8 state gun_pushback
			}
		}
		else
		{
		set WEAPON_TYPE 0
		set WEAPON0_FIREDELAY 27
		set WEAPON0_TOTALTIME 50
		set WEAPON0_HOLDDELAY 55
		set WEAPON0_SHOOTS ZRIFLESHOTU
		set WEAPON0_SHOTSPERBURST 2
		set WEAPON0_FIRESOUND 4
		}
		
		ife CURWEAP 0
		{
		ifn player[].weapon_pos 0 setp[].kickback_pic 0
		ifand GUNFIREMODE_2 16
			{
			ife KICKBACKPIC 0 setp[].kickback_pic 1
			ife KICKBACKPIC 25
				{
				ifand BITS_PRESS 4 setp[].kickback_pic 26
				else { soundonce MINIGUN_SPIN setp[].kickback_pic 30 }
				}
			ife KICKBACKPIC 31 setp[].kickback_pic 24
			}
			
		ife KICKBACKPIC 26
			{
			ifand BITS_PRESS 4 nullop else setp[].kickback_pic 30
			}
		
		ife KICKBACKPIC 3 sound MINIGUN2_START
		ife KICKBACKPIC 37 sound MINIGUN2_STOP
		ife KICKBACKPIC 27
			{
			espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP BOS1_ATTACK1
			set gunsmoke_angle 64 state spawn_gunsmoke 
			set gun_pushback_power -8 state gun_pushback
			set GUN_RECOIL 6
			ifand AMMO_TYPES[CURWEAP] 8 nullop else shoot RIFLESHELL
			}
		ife KICKBACKPIC 28 
			{ 
			add GUN_SPREAD 6
			ifand BITS_PRESS 4 setp[].kickback_pic 26
			ifand AMMO_TYPES[CURWEAP] 8 nullop else shoot RIFLESHELL
			}
		}
 
}
ife temp_weapon 35 // Is the player using the Calico m960?
{
set WEAPON0_TILE 16059

	set WEAPON0_FIREDELAY 2
	set WEAPON0_TOTALTIME 4
	set WEAPON0_HOLDDELAY 1
	set WEAPON0_FIRESOUND 4
	set WEAPON0_FLAGS 8276
	set WEAPON0_SPAWN 0
	set WEAPON0_RELOAD 39
	set WEAPON0_SHOOTS NINEMM_CALIBRE
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_CLIP 0
	set WEAPON0_RELOADSOUND1 4
	set WEAPON0_RELOADSOUND2 4
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
		{
		set WEAPON_TYPE 0
		set GUN_VOLUME 4
		set GUN_ACCURACY 12
		set GUN_MAX_SPREAD 32
		set GUN_SIZE 2
		set GUN_HANDS 2
		set GUN_AMMO_TYPES 0
		set GUNMAG TEMP_WEAPON_MAG
		set MAX_TEMP_WEAPON_MAG 50
		ife KICKBACKPIC 2 { set GUN_RECOIL 4 espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP M960_FIRE } 
		ife KICKBACKPIC 2 { set gunsmoke_angle 64 state spawn_gunsmoke }
		ife KICKBACKPIC 3 add GUN_SPREAD 6
		ife KICKBACKPIC 11 sound M960_RELOAD
		ife KICKBACKPIC 18 ife TEMP_WEAPON_MAG 0 spawn 3756 
		ife KICKBACKPIC 30 
			{
			ifvarvarl CUR_AMMO MAX_TEMP_WEAPON_MAG set TEMP_WEAPON_MAG CUR_AMMO else set TEMP_WEAPON_MAG MAX_TEMP_WEAPON_MAG
			}
	  ifl TEMP_WEAPON_MAG 1
	   ife player[].weapon_pos 0
	    ife KICKBACKPIC 0
			{
		   	ifn CUR_AMMO 0
		   		{
		   		setp[].reloading 1
		   		setp[].kickback_pic 6
				}
			}
		}
}
ife temp_weapon 36 // Is the player using the shadow warrior katana?
	{
	set WEAPON0_TILE SWORDSPRITE
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 15
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 8
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS 12053
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 260
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
	{
	set GUNMAG -1
	set WEAPON_TYPE 2
	set GUN_VOLUME 0
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	
	ifl SPRINTING PMAX_STAMINA add SPRINTING 1 // infinite sprint
	
	iffloordistl 16 ifl player[].falling_counter 60 setp[].falling_counter 0 // no fall damage
	
	ifand BITS_PRESS 64
	 ifp palive
	 ifg SPRINTING 0
		{
		setp[].kickback_pic 0
		set SWORD_BLOCK 36
		}
		else
		set SWORD_BLOCK 0
	
		ife KICKBACKPIC 0 
			{
			set SWORD_ANIM 0
			ife player[].weapon_pos 1 state CHAR_DRAW_SWORD
			}
		
		ife KICKBACKPIC 6 sound SWING
		
		ife KICKBACKPIC 8 { eshoot 12053 setthisprojectile[RETURN].userdata 72 }
		
		ife KICKBACKPIC 13
		{
		randvar SWORD_ANIM 2
		ifand BITS_PRESS 4 setp[].kickback_pic 5
		}
	}
}
ife temp_weapon 37 // Is the player using the beam sabre
	{
	set WEAPON0_TILE 20101

	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 15
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 8
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS 19027
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 260
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
	{
	set WEAPON_TYPE 1
	set GUNMAG -1
	set GUN_VOLUME 0
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	ifand BITS_PRESS 64
	 ifp palive
	 ifg SPRINTING 0
		{
		setp[].kickback_pic 0
		set SWORD_BLOCK 37
		}
		else
		set SWORD_BLOCK 0
	
		ife KICKBACKPIC 0 
			{
			set SWORD_ANIM 0
			ife player[].weapon_pos 1 state CHAR_DRAW_SWORD
			}
		
		ife KICKBACKPIC 6 sound BEAMSABRE_SWING
		
		ife KICKBACKPIC 13
		{
		randvar SWORD_ANIM 2
		ifand BITS_PRESS 4 setp[].kickback_pic 5
		}
	}
}
ife temp_weapon 38 // Is the player using the ripper heart
	{
	set WEAPON0_TILE 17980

	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 7
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOOTS -1
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_FLAGS 260
	setarray WEAPON_SPECIAL[0] 0

	set GUNMAG -1
	set WEAPON_TYPE 6
	set GUN_VOLUME 0
	set GUN_SIZE 1
	set GUN_HANDS 1
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	add TEMP6 1 ifg TEMP6 30 { sound DUKE_HARTBEAT set TEMP6 0 }
		
	ife KICKBACKPIC 1 sound BLOOD_SPURT
	ife KICKBACKPIC 2 sound FLESH_SQUIRT
	ife KICKBACKPIC 3 { spawn 18935 spawn 18066 }
	}
	
ife temp_weapon 39 // Is the player using the zombie soldier chaingun?
	{
	set WEAPON0_TILE ZCHAINGUN_SPRITE
	set WEAPON_TYPE 0
	set GUNMAG -1
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_VOLUME 16
	set GUN_ACCURACY 36
	set GUN_MAX_SPREAD 24
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 50
	set WEAPON0_HOLDDELAY 57
	set WEAPON0_FIREDELAY 27
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND MINIGUN_START
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS CHAINGUN
	set WEAPON0_FLAGS 6
	setarray WEAPON_SPECIAL[0] 0
	
	ife KICKBACKPIC 27 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP ZCHAING_FIRE }
	ife KICKBACKPIC 28 set GUN_RECOIL 10
		ife KICKBACKPIC 27 
		{ add GUN_SPREAD 6 shoot RIFLESHELL
		set gunsmoke_angle 64 state spawn_gunsmoke }
		
		ife player[].ammo_amount 0 0 stopsound ZCHAING_FIRE
		
		// auto-spin stuff
		ifn player[].weapon_pos 0 setp[].kickback_pic 0
		ifand GUNFIREMODE_2 16
			{
			ife KICKBACKPIC 0 setp[].kickback_pic 1
			ife KICKBACKPIC 25
				{
				ifand BITS_PRESS 4 setp[].kickback_pic 26
				else { soundonce MINIGUN_SPIN setactorsoundpitch THISACTOR MINIGUN_SPIN 256 setp[].kickback_pic 30 }
				}
			ife player[].ammo_amount 0 0 { setp[].kickback_pic 30 stopsound ZCHAING_FIRE sound MINIGUN_STOP xorvar GUNFIREMODE_2 16 }
			ife KICKBACKPIC 31 setp[].kickback_pic 24
			}
			
		
		ife KICKBACKPIC 3 sound MINIGUN_START
		ife KICKBACKPIC 29 { stopsound ZCHAING_FIRE sound MINIGUN_STOP }
		ife KICKBACKPIC 27
			{
			soundonce ZCHAING_FIRE
			set gunsmoke_angle 64 state spawn_gunsmoke 
			set gun_pushback_power -16 state gun_pushback
			getp[].horiz TEMP
			add TEMP 2
			setp[].horiz TEMP
			}
		ife KICKBACKPIC 28 
			{ 
			getp[].horiz TEMP
			sub TEMP 2
			setp[].horiz TEMP
			getp[].ammo_amount 0 TEMP2
			ifand BITS_PRESS 4 ifg TEMP2 0 setp[].kickback_pic 26 
			}

	}

ife temp_weapon 40 // Zilla inc Railgun?
	{
	set WEAPON0_TILE RAILGUN_SPRITE

	set WEAPON0_SHOOTS RAILGUN
	set WEAPON0_FIREDELAY 12
	set WEAPON0_TOTALTIME 16
	set WEAPON0_FIRESOUND ZRAILGUN_FIRE
	set WEAPON0_INITIALSOUND ZRAILGUN_CHARGE
	set WEAPON0_SHOTSPERBURST 0
	set WEAPON0_FLAGS 2
	set WEAPON0_SPAWNTIME -1
	set WEAPON0_SPAWN 0
	set WEAPON0_SOUND2TIME -1
	set WEAPON0_SOUND2SOUND 4
	set WEAPON0_RELOADSOUND1 4
	set WEAPON0_RELOADSOUND2 4
	setarray WEAPON_SPECIAL[0] 64

	set WEAPON_TYPE 1
	set GUNMAG -1
	set GUN_VOLUME 75
	set GUN_ACCURACY 2
	set GUN_MAX_SPREAD 0
	set GUN_SIZE 2
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 0
	ife CURWEAP 0 ife player[].weapon_pos 0 ifg CUR_AMMO 0 ife camerasprite -1 soundonce ZRAILGUN_IDLE
	else ifactorsound THISACTOR ZRAILGUN_IDLE stopsound ZRAILGUN_IDLE

	ife KICKBACKPIC 1 { sound ZRAILGUN_CHARGE getp[].horiz TEMP add TEMP 2 setp[].horiz TEMP }
	ife KICKBACKPIC 2 { getp[].horiz TEMP sub TEMP 2 setp[].horiz TEMP }
	ife KICKBACKPIC 3 { getp[].horiz TEMP add TEMP 4 setp[].horiz TEMP }
	ife KICKBACKPIC 4 { getp[].horiz TEMP sub TEMP 4 setp[].horiz TEMP }
	ife KICKBACKPIC 5 { getp[].horiz TEMP add TEMP 6 setp[].horiz TEMP }
	ife KICKBACKPIC 6 { getp[].horiz TEMP sub TEMP 6 setp[].horiz TEMP }
	ife KICKBACKPIC 7 { getp[].horiz TEMP add TEMP 8 setp[].horiz TEMP }
	ife KICKBACKPIC 8 { getp[].horiz TEMP sub TEMP 8 setp[].horiz TEMP }
	ife KICKBACKPIC 12 { set gun_pushback_power -96 state gun_pushback }
	ife KICKBACKPIC 13 { getp[].horiz TEMP add TEMP 8 setp[].horiz TEMP }
	ife KICKBACKPIC 14 { getp[].horiz TEMP sub TEMP 4 setp[].horiz TEMP }
	ife KICKBACKPIC 15 { getp[].horiz TEMP sub TEMP 4 setp[].horiz TEMP }
	}
}
ife temp_weapon 41 // Is the player using the AR-65?
{
	set WEAPON0_TILE AR65_SPRITE
    set GUN_VOLUME 6
	set GUN_ACCURACY 16
	
	set GUN_VOLUME 15
	set GUN_SIZE 2
	set GUN_HANDS 2
	set GUN_AMMO_TYPES 1024
	setarray WEAPON_SPECIAL[0] 192
	
	set WEAPON0_FIREDELAY 2
	set WEAPON0_TOTALTIME 4
	set WEAPON0_HOLDDELAY 1
	set WEAPON0_FIRESOUND 4
	set WEAPON0_FLAGS 8276
	set WEAPON0_SPAWN 0
	set WEAPON0_RELOAD 22
	set WEAPON0_SHOOTS ARMOUR_PIERCING_SHOT
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_CLIP 0
	set WEAPON0_RELOADSOUND1 4
	set WEAPON0_RELOADSOUND2 4

	ife CURWEAP 0
		{
		set WEAPON_TYPE 1
		set GUNMAG -1

	ife KICKBACKPIC 2 { espawn 2520 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP AR65_FIRE }
	
		ifg GUN_HEAT[CURWEAP] 150
			{
			setp[].reloading 1
			soundonce STEAM_HISSING
			soundonce AR73_OVERHEAT
			ifrnd 16 set PLAYER_VOICEOVER 42
			setp[].kickback_pic 5
			}
		ifg GUN_HEAT[CURWEAP] 50
			{
			ifg KICKBACKPIC 10 { set gunsmoke_z 9444 set gunsmoke_angle 98 } 
			else { set gunsmoke_z 9144 set gunsmoke_angle 64 } 
			state spawn_gunsmoke_z
			}

		ifg GUN_HEAT[CURWEAP] 75
			{
			soundonce AR73_BEEP
			set WEAPON0_FIREDELAY 2
			set WEAPON0_TOTALTIME 4
			}
			else
		ifg GUN_HEAT[CURWEAP] 25
			{
			set WEAPON0_FIREDELAY 2
			set WEAPON0_TOTALTIME 5
			}
			else
			{
			set WEAPON0_FIREDELAY 2
			set WEAPON0_TOTALTIME 6
			}
	

		ife KICKBACKPIC 2
			{ 
			set GUN_RECOIL 7
			set gunsmoke_angle 64 state spawn_gunsmoke 
			}	
			
		ife KICKBACKPIC 14 
			{ 
			set TEMP9 GUN_HEAT[CURWEAP]
			sub TEMP9 2
			setarray GUN_HEAT[CURWEAP] TEMP9
			ifl GUN_HEAT[CURWEAP] 20
				{
				stopsound STEAM_HISSING soundonce MDF_READY setarray GUN_HEAT[CURWEAP] 0
				}
			}
			ife KICKBACKPIC 15 
			{
			ifg GUN_HEAT[CURWEAP] 20 setp[].kickback_pic 14
			
			ifg HEAT_SINKS 0
			 ifg GUN_HEAT[CURWEAP] 100
			 ifand BITS_PRESS 128 { soundonce HEAT_SINK_EJECT shoot HEAT_SINK sub HEAT_SINKS 1 setarray GUN_HEAT[CURWEAP] 25 }
			}
			ife KICKBACKPIC 17 soundonce MDF_READY
		}
}
ife temp_weapon 42 // Is the player using the hell nailer?
	{
	set WEAPON0_TILE HELL_NAILER_SPRITE
	set WEAPON_TYPE 9
	set GUNMAG -1
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_VOLUME 12
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 9
	set WEAPON0_HOLDDELAY 3
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS 22631
	set WEAPON0_FLAGS 4
	setarray WEAPON_SPECIAL[0] 0
	
	ife CURWEAP 0
		{
		ife KICKBACKPIC 2 { espawn 2520 set GUN_RECOIL 5 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP HELL_NAIL_FIRE }
		 ife KICKBACKPIC 6 
			{ 
			setprojectile[22631].offset -264
			eshoot 22631 
			setprojectile[22631].offset 224
			espawn 2520 
			set GUN_RECOIL 5 state SPAWN_IN_PLAYER_FRONT setactorvar[RETURN].TEMP HELL_NAIL_FIRE }
		}
	
	}
ife temp_weapon 43 // Is the player using the proto-shrinker?
	{
	set WEAPON0_TILE PROTO_SHRINKER_SPRITE
	set WEAPON_TYPE 8
	set GUNMAG -1
	set GUN_VOLUME 30
	set GUN_ACCURACY 32
	set GUN_MAX_SPREAD 0
	set GUN_SIZE 1
	set GUN_HANDS 1
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 17
	set WEAPON0_HOLDDELAY 17
	set WEAPON0_FIREDELAY 7
	set WEAPON0_FIRESOUND SHRINKER_FIRE
	set WEAPON0_INITIALSOUND 4
	set WEAPON0_SHOTSPERBURST 1
	set WEAPON0_SHOOTS SHRINKER
	set WEAPON0_FLAGS 38
	setarray WEAPON_SPECIAL[0] 0
	
	ifvare CURWEAP 0
		{
		ifg near_crystal 0
			{
			setplayer[].ammo_amount 0 99
			sub near_crystal 1
			}
		else
		setplayer[].kickback_pic 0
		}
		
	}
ife temp_weapon 44 // Is the player using the juggernaut suit chaingun?
	{
	set WEAPON0_TILE 23958
	set WEAPON_TYPE 0
	set GUNMAG -1
	set GUN_SIZE 1
	set GUN_HANDS 2
	set GUN_VOLUME 16
	set GUN_ACCURACY 36
	set GUN_MAX_SPREAD 24
	set GUN_AMMO_TYPES 0
	set WEAPON0_WORKSLIKE 0
	set WEAPON0_TOTALTIME 3
	set WEAPON0_HOLDDELAY 2
	set WEAPON0_FIREDELAY 2
	set WEAPON0_FIRESOUND 4
	set WEAPON0_INITIALSOUND MINIGUN_SFIRE
	set WEAPON0_SHOTSPERBURST 4
	set WEAPON0_SHOOTS GOLDEN_SHOT_MED
	set WEAPON0_FLAGS 4
	setarray WEAPON_SPECIAL[0] 0
	
	ife JUGGERN_SUIT 0 
		{
		setplayer[].ammo_amount 0 0
		set temp_weapon 0
		}
	
	ife KICKBACKPIC 2 soundonce MINIGUN_FIRE
	ife KICKBACKPIC 1 set GUN_RECOIL 10
	ife KICKBACKPIC 0 
		{ 
		ifactorsound THISACTOR MINIGUN_FIRE
			{
			sound MINIGUN3_STOP
			stopsound MINIGUN_FIRE 
			}
		}
		ife KICKBACKPIC 2 
		{ add GUN_SPREAD 6 shoot RIFLESHELL
		set gunsmoke_angle 64 state spawn_gunsmoke }
	}
ifg temp_weapon 44 set temp_weapon 0 // REMEMBER TO UPDATE THIS EVERY TIME A TEMP WEAPON IS ADDED
ife temp_weapon 0
{
ifactorsound THISACTOR ZRAILGUN_IDLE stopsound ZRAILGUN_IDLE
set WEAPON0_TILE 3833
set GUN_HANDS 0
ife CURWEAP 0 set GUNMAG -1
set GUN_VOLUME 0
set GUN_SIZE 0
set GUN_AMMO_TYPES 0
setarray WEAPON_SPECIAL[0] 0
set WEAPON0_WORKSLIKE 0
set WEAPON0_SHOTSPERBURST 1
set WEAPON0_FLAGS 292
set WEAPON0_INITIALSOUND 4
}

ifg FCHOKESTOP 0 sub FCHOKESTOP 1

ifg FCHOKE 0
{
set player_use -1
palfrom 20 20
lockplayer 10
ifl player[].horiz 50 setp[].horiz 50
ifhitspace { wackplayer sub CHOKE 20 }
soundonce CHOKING
state STOPSTEPSOUNDS
ifg P_SPIRIT_ARMOUR 0 sub FCHOKE 4 else sub FCHOKE 1
ifp pdead set FCHOKE 0
}

ifg camera_bars -18 sub camera_bars 2
ife camera_bars -2 set HUDON 0

ife player[].player_par 1
{
	set raining rainstart
	set rainstart 0
}

ifg control_display 0 sub control_display 1

ife CONTROL_VR -1
ife player_in_vehicle 0 
state spawn_cold_breathe

ifg raining 0
{
  ife cs_textl 0
	 {
	ifand NOISE_SAID 16 nullop else
	ifoutside
	 ifrnd 1
		{
		set PLAYER_VOICEOVER 43
		xorvar NOISE_SAID 16
		}
	}

ife RAINREPLACE 1
	{
	ifoutside soundonce RAIN else soundonce RAININ
	}
}

ife RAINREPLACE 1 ife raining 0 set RAINREPLACE 0

ife TIMEZONE 1
{
ifoutside soundonce WAR_BACKGROUND else soundonce WAR_BACKGROUND_IN
}

ifn camerasprite -1 
	{
	set voice_comm_menu 0
	ife MISSIONUP 1 set MISSIONUP 0
	setuserdef[].overhead_on 0
	}

ife player[].knee_incs 2 set QUICKK 1

		 ifp ponground
		  ife player_in_vehicle 0 
		    ifn FIRE_SUIT 1
			ifn JUGGERN_SUIT 1
			ifn SPACE_SUIT 1
			ife INTERNALCOUNT_3 0
			ife SLIDE_KICK 27
			ife MISSIONUP 0
			ife SHOTGUN_STRUGGLE -1
			ife camerasprite -1
			ifp palive
			ifn CHAR 20
			{
			ifg SPRINTING 20
					{
					 ifand BITS_PRESS P_SPRINTING
					  {
					  ifand EXTBITS_PRESS 1 nullop else
					  ifand EXTBITS_PRESS 4 // strafes left
						{ 
						ifgapzl 16 break
						ifinwater break
						ifl ROLL_LEFT 13 break
							ife PERSONEL_RESEARCH[30] 2 sound MUSCLE_MOVE else
							ife CHAR 12 soundonce SERVO else 
							ife CHAR 2 soundonce H_ARMOUR_ROLL else
							soundonce JMOVE5
							getp[].ang TEMP3
							sub TEMP3 512
							set knockbackang TEMP3
							set knockbackheight 2048
							set knockback2 8
							setp[].quick_kick 0 
							set ROLL_LEFT 0
							set INTERNALCOUNT_3 26
							ife PERSONEL_RESEARCH[30] 2 sub SPRINTING 25 else
							sub SPRINTING 50
						} 
						else
					  ifand EXTBITS_PRESS 8 // strafes right
						{ 
						ifgapzl 16 break
						ifand EXTBITS_PRESS 1 break
						ifinwater break
						ifl ROLL_RIGHT 13 break
							ife PERSONEL_RESEARCH[30] 2 sound MUSCLE_MOVE else
							ife CHAR 12 soundonce SERVO else 
							ife CHAR 2 soundonce H_ARMOUR_ROLL else
							soundonce JMOVE5
							getp[].ang TEMP3
							sub TEMP3 -512
							set knockbackang TEMP3
							set knockbackheight 2048
							set knockback2 8
							setp[].quick_kick 0 
							set ROLL_RIGHT 0
							set INTERNALCOUNT_3 26
							ife PERSONEL_RESEARCH[30] 2 sub SPRINTING 25 else
							sub SPRINTING 50
						} 
					 else
					  ifand EXTBITS_PRESS 2 // moves backwards
							{ 
							ifgapzl 16 break
							ifinwater break
							ifl ROLL_BACKWARDS 26 break
							ife PERSONEL_RESEARCH[30] 2 sound MUSCLE_MOVE else
							ife CHAR 12 soundonce SERVO else 
							ife CHAR 2 soundonce H_ARMOUR_ROLL else
							soundonce JMOVE5
								getp[].ang TEMP3
								sub TEMP3 1024
								set knockbackang TEMP3
								set knockbackheight 2048
								set knockback2 8
								setp[].quick_kick 0 
								set ROLL_BACKWARDS 0
								set INTERNALCOUNT_3 26
								ife PERSONEL_RESEARCH[30] 2 sub SPRINTING 25 else
								sub SPRINTING 50
							} 
						}
					}
		
			}

ife player[].quick_kick 13
ife MISSIONUP 0
	{
	ifn camerasprite -1 break
	ifinwater set QUICKK 1 else
		{
		ifand BITS_PRESS 1 // If the player jumps
		 iffloordistl 14
				{ 
				setp[].jumping_counter 1441 
				setp[].quick_kick 0 
				ife CHAR 12 soundonce SERVO else soundonce JMOVE5
				set ROUNDHOUSE_KICK 0 
				} 
			else
		ifand BITS_PRESS 1 // If the player jumps
			ifand EXTBITS_PRESS 1 // If the player presses forward
			 ifg sprite[].xvel 60 // If the player's moving fast enough
				{
				setp[].quick_kick 0
				wackplayer
				ife player[].jumping_counter 721 setp[].jumping_counter 0
				ife CHAR 12 soundonce SERVO else soundonce JMOVE5
				ifand BITS_PRESS P_SPRINTING
				 ifg sprite[].xvel 100 set DROP_KICK 0 else
				set FLYING_KICK 0
				}
		else
		ifg sprite[].xvel 120 // player speed
		 ifand BITS_PRESS P_SPRINTING // if the player's sprinting
		  ifand EXTBITS_PRESS 1
		   ifg SPRINTING 20
		    ifp ponground
			{ 
			ifinwater break
			ifonwater break
			ifp pstanding nullop else
				{
							ife CHAR 12 soundonce SERVO else 
							ife CHAR 2 soundonce H_ARMOUR_ROLL else
							soundonce PSLIDE_KICK
				getp[].ang knockbackang
				set knockbackheight 4096                                  
				set knockback_slide 16
				setp[].quick_kick 0 
				set SLIDE_KICK 0
				}
			} 
		else
		ifand EXTBITS_PRESS 2
		 ifp pducking
		  ifp ponground
			{ 
			ifinwater break
							ife CHAR 12 soundonce SERVO else 
							ife CHAR 2 soundonce H_ARMOUR_ROLL else
							soundonce JMOVE5
			setp[].quick_kick 0 
			set TWIRL_KICK 0
			} 
		else
		ifand EXTBITS_PRESS 2
		  ifp ponground
			{ 
			ifinwater break
							ife CHAR 12 soundonce SERVO else 
							ife CHAR 2 soundonce H_ARMOUR_ROLL else
							soundonce JMOVE5
			setp[].quick_kick 0 
			set SPIN_KICK 0
			} 
		else
		ifp pjumping set QUICKK 0 else
		ife on_tripwire 1 set QUICKK 0 else
		ife TEMP2 1 set QUICKK 0 else
		ifn KICKBACKPIC 0 set QUICKK 0 else
		ifand GUNFIREMODE 16384 nullop else
		ifn SCOPE 0 nullop else
		ifl UPPER_CUT 20 set QUICKK 0 else
		ifp ponground ifg GOT_KNIFE 0 ife KICKBACKPIC 0 ifg SPRINTING 20 set KNIFE_ATTACK 0
		else set QUICKK 0
		}
	}
else
ife player[].quick_kick 8 // wall kick
	{
	ifinwater break
	iffloordistl 8 break
	espawn 3587
	seta[RETURN].x hitx
	seta[RETURN].y hity
	seta[RETURN].z hitz

	dist xydist THISACTOR RETURN

	ifg xydist 750 nullop else
			{
			sub SPRINTING 40
			set WALL_KICK 20
			ifl SPRINTING 0 break
			ifg player[].falling_counter 16 break
			getp[].ang TEMP5
			sub TEMP5 1024
			set knockbackang TEMP5
			ifand BITS_PRESS 1 setp[].ang TEMP5
			ife PERSONEL_RESEARCH[30] 2 { sound MUSCLE_MOVE set knockback 6 } else
			ifp pboosted set knockback 8 else set knockback 4
			}
	}
	
ifn SCOPE 0
	{
	
	// following code by Dan Gaskil
	getp[].ohoriz TEMP
	getp[].horiz TEMP2
	sub TEMP2 TEMP
	ifn cameraoffset 0
	{
		ifl TEMP2 0
		add cameraoffset TEMP2
		ifl cameraoffset 0 set cameraoffset 0
	}
	
	getp[].ohoriz TEMP
		getp[].horiz TEMP2
		sub TEMP2 TEMP
		ifn cameraoffset 0
		{
			ifl TEMP2 0
			add cameraoffset TEMP2
			ifl cameraoffset 0 set cameraoffset 0
		}
		ifn TEMP2 1 ifn TEMP2 -1
		{
			shiftvarr TEMP2 1
			add TEMP TEMP2
			setp[].horiz TEMP
		}
		
		getp[].oang TEMP
		getp[].ang TEMP2
		getincangle TEMP2 TEMP TEMP2
		ifn TEMP2 1 ifn TEMP2 -1
		{
			shiftvarr TEMP2 1
			add TEMP TEMP2
			setp[].ang TEMP
		}
	
	ifand BITS_PRESS P_SPRINTING // sprint key
	 ifg SPRINTING 0
		set HOLD_BREATHE 1
		else
		ife HOLD_BREATHE 1
		set HOLD_BREATHE 2
	}
	else
	ife SCOPE 0
	ife HOLD_BREATHE 1
	 set HOLD_BREATHE 2
	 
ife HOLD_BREATHE 1
	{
	inittimer 30
	soundonce HEARTBEAT
	setp[].sound_pitch -1024
	ife CHAR 3 sub SPRINTING 2 // Highwire is good at sniping
	else ife CHAR 5 sub SPRINTING 3 // So is Rusty
	else ife CHAR 7 sub SPRINTING 2 // So is Mikko
	else sub SPRINTING 4
	ifl SPRINTING 4
		{
		set SPRINTING -60
		wackplayer
		setp[].sound_pitch 0
		inittimer 120
		}
	}
else
ife HOLD_BREATHE 2
	{
	setp[].sound_pitch 0
	inittimer 120
	set HOLD_BREATHE 0
	}

ifn player[].falling_counter 0
ife player_in_vehicle 0
{
ifl player[].falling_counter 60
 ifg player[].falling_counter 7
	{
	ife CHAR 14 // Snowfall is a cat so he takes 1/2 fall damage
		{
		iffloordistl 24
			{
			getp[].falling_counter TEMP5 
			divvar TEMP5 2 
			setp[].falling_counter TEMP5
			}
		}
	ifand EGYPT_ARTIFACTS 1 nullop else
	 ife FIRE_SUIT 1 nullop else
		{
		iffloordistl 24
		 ife ROLL_FORWARDS 26
		  ife MELEE_RESEARCH[7] 2
			{
			set player_ninja 0
			 ifand BITS_PRESS 2
				{
				sub SPRINTING 80
				getp[].falling_counter TEMP5 divvar TEMP5 2 setp[].falling_counter TEMP5
								ife CHAR 12 soundonce SERVO else 
								ife CHAR 2 soundonce H_ARMOUR_ROLL else
								soundonce JMOVE5
				getp[].ang knockbackang
				set knockbackheight 2048
				set knockback2 8
				setp[].quick_kick 0 
				set ROLL_FORWARDS 0
				state landsounds
				set INTERNALCOUNT_3 26
				}
			}
		}
	}
ifg player[].falling_counter 62
	{
	soundonce WIND_FALL_RAPID
	ifg FALLING 0 sub FALLING 1 else add FALLING 1
	ife FALLING 1
		{
		getp[].horiz TEMP6
		add TEMP6 1
		setp[].horiz TEMP6
		set FALLING -5
		}
	else
	ife FALLING -1
		{
		getp[].horiz TEMP6
		sub TEMP6 1
		setp[].horiz TEMP6
		set FALLING 5
		}
	}
	else
	ifsound WIND_FALL_RAPID stopsound WIND_FALL_RAPID
}

ifg HEAL_COUNT 0 sub HEAL_COUNT 1


ifp pstanding
	{
	set TEMP2 PMAXHEALTH
	divvar TEMP2 10

	ifvarvarl PHEALTH TEMP2
		ife HEAL_COUNT 0
			{
			set HEAL_COUNT 26
			addphealth 1
			}
		ife CHAR 0
			{
			 ifphealthl 20
				 ife HEAL_COUNT 0
					{
					set HEAL_COUNT 26
					addphealth 1
					}
			}
	}

 // INVENTORY WHEEL
ife OLD_ITEM_SEL NO
{
	ifand BITS_PRESS 1048576 setp[].invdisptime 26
	ifand BITS_PRESS 134217728 setp[].invdisptime 26
	ifg player[].invdisptime 0
	{
	ife P_SWHEEL 1 // only do this if the player turned on the wheel
		{
		ifand BITS_PRESS 135266304 nullop else 
			{
			setp[].invdisptime 0
			set P_SWHEEL 0
			}
				
		getinput[].bits temp
		shiftvarr temp 8
		andvar temp 0xF
		switch temp
			case 11: // prev weapon
				getp[].inven_icon TEMP3
				sub TEMP3 1
				ifl TEMP3 0 set TEMP3 7
				ife TEMP3 7 ife player[].boot_amount 0 sub TEMP3 1
				ife TEMP3 6 ife player[].scuba_amount 0 sub TEMP3 1
				ife TEMP3 5 ife player[].heat_amount 0 sub TEMP3 1
				ife TEMP3 4 ife player[].jetpack_amount 0 sub TEMP3 1
				ife TEMP3 3 ife player[].holoduke_amount 0 sub TEMP3 1
				ife TEMP3 2 ife player[].steroids_amount 0 sub TEMP3 1
				ife TEMP3 1 ife player[].firstaid_amount 0 sub TEMP3 1															
				
				setp[].inven_icon TEMP3			
				break
			case 12: // next weapon
				getp[].inven_icon TEMP3
				add TEMP3 1
				ife TEMP3 1 ife player[].firstaid_amount 0 add TEMP3 1
				ife TEMP3 2 ife player[].steroids_amount 0 add TEMP3 1
				ife TEMP3 3 ife player[].holoduke_amount 0 add TEMP3 1
				ife TEMP3 4 ife player[].jetpack_amount 0 add TEMP3 1
				ife TEMP3 5 ife player[].heat_amount 0 add TEMP3 1
				ife TEMP3 6 ife player[].scuba_amount 0 add TEMP3 1
				ife TEMP3 7 ife player[].boot_amount 0 add TEMP3 1
				ifg TEMP3 7 set TEMP3 0
				setp[].inven_icon TEMP3
				break
		endswitch
		}

	}
}

ifg MOUSEUP 0
{
lockplayer 13
setp[].ang PANG
setp[].horiz PHORIZ
setp[].weapon_pos 10
getinput[].q16horz TEMP
// shiftvarr TEMP 16
getuserdef[].mouseflip TEMP2
ife TEMP2 1 sub Q16_MOUSEY TEMP else ife TEMP2 0 add Q16_MOUSEY TEMP
getinput[].q16avel TEMP
// shiftvarr TEMP 16
add Q16_MOUSEX TEMP

ifand GUNFIREMODE 16384 xorvar GUNFIREMODE 16384
ifg SCOPE 0 set SCOPE 0

set MOUSEX Q16_MOUSEX
set MOUSEY Q16_MOUSEY

clamp Q16_MOUSEX 0 20971520
clamp Q16_MOUSEY 0 13107200

shiftvarr MOUSEX 16
shiftvarr MOUSEY 16

clamp MOUSEX 0 320
clamp MOUSEY 0 200

ifand BITS_PRESS 64 set MOUSE_HINT_TIMER 0

	ifl MOUSE_HINT_TIMER 32
	{
	ifl MOUSE_HINT_TIMER 0 set MOUSE_HINT_TIMER 0
	add MOUSE_HINT_TIMER 1
	ife MOUSE_HINT_TIMER 1 set MOUSE_HINT -1
	}


}

ifn MISSIONUP 0
{
clamp MISSIONUP 0 320
getinput[].bits temp
shiftvarr temp 8
andvar temp 0xF
switch temp
    case 11: // prev weapon
	ifl INTERNALCOUNT 1
		{ 
		sound PDU_MOVE
		ife MISSIONSCREEN 5 { soundonce PU_CLOSE stopsound PU_SCAN }
		sub MISSIONSCREEN 1 
		ifl MISSIONSCREEN 0 
			{ ife SCAN_MODULE 1 { soundonce PU_OPEN set MISSIONSCREEN 5 } else set MISSIONSCREEN 4 }
		set INTERNALCOUNT 13
		} 
        break
    case 12: // next weapon
	ifl INTERNALCOUNT 1
		{ 
		sound PDU_MOVE
		add MISSIONSCREEN 1 
		ifg MISSIONSCREEN 5 { soundonce PU_CLOSE stopsound PU_SCAN set MISSIONSCREEN 0 }
		ifg MISSIONSCREEN 4 
			{
			ife SCAN_MODULE 0 set MISSIONSCREEN 0
			else ife SCAN_MODULE 1 { set MISSIONSCREEN 5 soundonce PU_OPEN }
			} 
		set INTERNALCOUNT 13
		}
        break
endswitch


// abort mission button
	ifg MOUSEX 30
	 ifl MOUSEX 74
	    ifg MOUSEY 165
		 ifl MOUSEY 175
			{
			ife AMC_BASE 0
			ifand BITS_PRESS 4
			 ifand BITS_PRESS 64
				{
				palfrom 64 64 64 64
				set MISSIONUP 0
				set MISSIONPOS 320
				set MISSIONSCREEN 0
				state save_arrays
				ifn base_level -1 ifn base_volume -1 startlevel base_volume base_level // takes them to the base level they were on
				else startlevel VOLUME 1
				}
			}

ifand EXTBITS_PRESS 1  // forward
	ifl INTERNALCOUNT 1
		{ 
		sound PDU_MOVE
		ife MISSIONSCREEN 5 { soundonce PU_CLOSE stopsound PU_SCAN }
		sub MISSIONSCREEN 1 
		ifl MISSIONSCREEN 0 
			{ ife SCAN_MODULE 1 { soundonce PU_OPEN set MISSIONSCREEN 5 } else set MISSIONSCREEN 4 }
		set INTERNALCOUNT 13
		}
ifand EXTBITS_PRESS 2  // backward
	ifl INTERNALCOUNT 1
		{ 
		sound PDU_MOVE
		add MISSIONSCREEN 1 
		ifg MISSIONSCREEN 5 { soundonce PU_CLOSE stopsound PU_SCAN set MISSIONSCREEN 0 }
		ifg MISSIONSCREEN 4 
			{
			ife SCAN_MODULE 0 set MISSIONSCREEN 0
			else ife SCAN_MODULE 1 { set MISSIONSCREEN 5 soundonce PU_OPEN }
			} 
		set INTERNALCOUNT 13
		} 
ife MISSIONUP 0 set MISSIONPOS 320
ife MISSIONUP 1
{
ifinwater set MISSIONUP 2
ifp pjumping set MISSIONUP 2
set HUDON 1
getp[].horiz PHORIZ
getp[].ang PANG
setp[].weapon_pos 10
setp[].movement_lock 31
 ifg MISSIONPOS 100
	sub MISSIONPOS 20
	
	ife MISSIONSCREEN 5 
	{
	set MOUSEUP 0
	ife MISSIONPOS 120 soundonce PU_OPEN
	else ife MISSIONPOS 100 soundonce PU_SCAN
	}
	else set MOUSEUP 1
	ife MISSIONPOS 300 sound PDU_OPEN
}
else
ife MISSIONUP 2
 {
 set MOUSEUP 0
 set HUDON 0
 ifn mission_scare 0 set mission_scare 0
  setp[].movement_lock 0
  	ife MISSIONPOS 120 ife MISSIONSCREEN 5 soundonce PU_CLOSE
	stopsound PU_SCAN
	ife MISSIONPOS 160 sound PDU_CLOSE
 ifl MISSIONPOS 320 add MISSIONPOS 20
 else ife MISSIONPOS 320 set MISSIONUP 0
 else ifg MISSIONPOS 320 set MISSIONPOS 320
 }
}

ifg OXYGEN_HIT 0
{
ifinwater nullop
else
	{
	add DROWN_COUNT 1
	ifg DROWN_COUNT 60 { palfrom 4 4 4 4 addphealth 20 sub OXYGEN_HIT 20 set DROWN_COUNT 0 }
	}
}

ifl player[].airleft 1
{ 
add DROWN_COUNT 1
ifg DROWN_COUNT 30 
	{ 
	ifp pdead nullop else
		{
		palfrom 16 0 0 64 
		wackplayer
		ife CHAR 0 soundonce J_DROWNING else
		ife CHAR 5 soundonce RN_DROWNING else
		soundonce DROWNING 
		set TEMP2 PMAXHEALTH
		divvar TEMP2 5
		add OXYGEN_HIT TEMP2
		geta[].extra TEMP3
		sub TEMP3 TEMP2
		seta[].extra TEMP3
		}
	set DROWN_COUNT 0 
	}
ifpinventory GET_SCUBA 0 setp[].airleft 389
}

ife STEPSOUNDFX 29 
 ife player_in_vehicle 0 
  ife FIRE_SUIT 0
   ifn player[].sbs -1
	{
	ifrnd 16 
		{ 
		getplayer[THISACTOR].boot_amount TEMP
		ifvarg TEMP 0 { quote 75 sub TEMP 1 setplayer[THISACTOR].boot_amount TEMP } else 
			{
			palfrom 16 0 0 16
			sound ELECTROCUTE
			randvar TEMP 2048
			setvarvar knockbackang TEMP
			setvar knockback 10
			wackplayer
			switch CHAR
				case 12
				case 13
				case 14
				ifg PARMOUR 0 { getp[].shield_amount TEMP sub TEMP 1 setp[].shield_amount TEMP }
				else addphealth -1
			break
				default
				addphealth -1 
			break
			endswitch
			}
		}
	}

ife player[].fta 99
{
ife player[].ftq 113 set CHEATED 1
ife player[].ftq 70
	{
	setp[].fta 0
	set door_locked 0 set key_icon ACCESSCARD set key_pal 0
	}
ife player[].ftq 71
	{
	setp[].fta 0
	set door_locked 0 set key_icon ACCESSCARD set key_pal 21
	}
ife player[].ftq 72
	{
	setp[].fta 0
	set door_locked 0 set key_icon ACCESSCARD set key_pal 23
	}
ife player[].ftq 9 soundonce SECRETFOUND
ife player[].ftq 8 
	{ 
	ife VOLUME 1
	 ife LEVEL 32
		setp[].fta 0 // manual hack to stop unlocked message showing in tunnel explosion
	}
ife player[].ftq 5 
	{ 
	ife player[].fta 99
		{
		set CHEATED 1
		set ACCESSKEY2 127 
		set PLUGKEY 7 
		set RUNEKEYS 63
		set OLDKEYS 63
		set NORMAL_KEYS 31
		set SCARABKEYS 511
		set ABYSS_KEYS 31
		set SW_KEYS 31
		set SWIPECARDS 64
		set CREDITS 20000
		set GUNSAKIMBO 63
		set JAMES_UPGRADE 32767
		set ZAXTOR_UPGRADE 32767
		set MERLIJN_UPGRADE 32767
		set HIGHWIRE_UPGRADE 32767
		set SANG_UPGRADE 32767
		set RUSTY_UPGRADE 32767
		set GEOFFREY_UPGRADE 32767
		set MIKKO_UPGRADE 32767
		set MICKY_UPGRADE 32767
		set SNOWFALL_UPGRADE 32767
		}
	}
ife player[].ftq 99 
	{ 
	ife player[].fta 99
		{
		set CHEATED 1
		setp[].ammo_amount 0 9999
		setp[].ammo_amount 1 9999
		setp[].ammo_amount 2 9999
		setp[].ammo_amount 3 9999
		setp[].ammo_amount 4 9999
		setp[].ammo_amount 5 9999
		setp[].ammo_amount 6 9999
		setp[].ammo_amount 7 9999
		setp[].ammo_amount 8 9999
		setp[].ammo_amount 9 9999
		setp[].ammo_amount 11 9999
		}
	}
ife player[].ftq 121 
	{ 
	ife player[].fta 99
		{
		set CHEATED 1
		set ACCESSKEY2 127 
		set PLUGKEY 7 
		set RUNEKEYS 63
		set OLDKEYS 63
		set SCARABKEYS 31
		set ABYSS_KEYS 31
		set NORMAL_KEYS 31
		}
	}
}

ife MELEE_RESEARCH[2] 2
ife CURWEAP 0
ifn SWORD_BLOCK 0
{
ifvarvarn SWORD_BLOCK temp_weapon set SWORD_BLOCK 0
	ifg HIT_DAMAGE 0
	{	
	switch sprite[].htpicnum
		case SHOTSPARK1
		case NINEMM_CALIBRE
		case CHAINGUN
		getp[].ang TEMP2
		add TEMP2 1024
		getincangle TEMP4 sprite[].htang TEMP2
		ifand TEMP4 2147483648
		{
		  xorvar TEMP4 4294967295 
		  	add TEMP4 1
		}
		ifl TEMP4 150 // is angle between them less than 100?
			{
			ifrnd 128 sound DEFLECT_BUL1 else sound DEFLECT_BUL2
			sub SPRINTING 6
			ifrnd 8 { sound PISTOL_RICOCHET shoot SHOTSPARK1 }
			shoot SPARK
		    seta[].htextra -1 
			}
		break
		endswitch
	}
}

state ignore_ally_damage

// FIRE DAMAGE
ifg FIRE_DAMAGE 0
{
palfrom 20 20 0 0

ifrnd 16
		{
		espawn 14040
		setactorvar[RETURN].myowner THISACTOR
		}
		

soundonce FLESH_BURNING
ife CHAR 0 soundonce J_HOTHOT
ife CHAR 1 sound Z_LONGTERM_PAIN
switch CHAR
case 1
	 ifrnd 4 addphealth -1 // Zaxtor is covered in fur and more vulnerable
	 addphealth -1
	break
case 12
case 13
case 14
	ifg PARMOUR 0 { getp[].shield_amount TEMP sub TEMP 1 setp[].shield_amount TEMP } // Drain from armour first
	else addphealth -1
	break
default
	addphealth -1
	break
endswitch
sub FIRE_DAMAGE 1
ife CHAR 7 
	{
	getp[].boot_amount TEMP2
	ifg TEMP2 0
		{
		sub FIRE_DAMAGE 1
		sub TEMP2 3
		setp[].boot_amount TEMP2
		}
	}
ifphealthl 1 set FIRE_DAMAGE 0
ifonwater { set FIRE_DAMAGE 0 soundonce STEAM_HISSING spawn BIG_SMOKE }
ifinwater { set FIRE_DAMAGE 0 soundonce STEAM_HISSING spawn BIG_SMOKE }
}

ifg ICE_DAMAGE 0
{
palfrom 20 0 20 0
soundonce SOMETHINGFROZE
ifl ICE_DAMAGE 5 { ifinwater nullop else { /* setp[].palette 0 */ set screen_pal 10 } }
else ifg ICE_DAMAGE 4 { ifn player[].palette 1 set screen_pal 1 }

getp[].posxv TEMP
divvar TEMP 2
setp[].posxv TEMP
getp[].posyv TEMP
divvar TEMP 2
setp[].posyv TEMP

sub ICE_DAMAGE 1

ife CHAR 7 // Mikko's protection suit protects against all elemental damage
	{
	getp[].boot_amount TEMP2
	ifg TEMP2 0
		{
		sub ICE_DAMAGE 1
		sub TEMP2 3
		setp[].boot_amount TEMP2
		}
	}

}

geta[].htextra TEMP
ifg TEMP 0
ifn CHAR -1
{
ife ARTIFACTS_LOADOUT[CHAR] 1 // Good luck amulet?
	{
	ifrnd 2 seta[].htextra -1 // very rare chance of negating all damage
	}
ife ARTIFACTS_LOADOUT[CHAR] 2 // Good luck amulet?
	{
	ifrnd 2 seta[].htextra -1 // very rare chance of negating all damage
	}
ife ARTIFACTS_LOADOUT[CHAR] 5 // lucky golden lighter?
	{
	ifrnd 2 seta[].htextra -1 // very rare chance of negating all damage
	}
ife MELEE_RESEARCH[1] 2 // Chi shield?
	{
	ifl ROUNDHOUSE_KICK 27  { soundonce CHI_PROTECT divvar TEMP 2 seta[].htextra TEMP palfrom 20 0 20 20 }
	ifl SLIDE_KICK 27 { soundonce CHI_PROTECT divvar TEMP 2 seta[].htextra TEMP palfrom 20 0 20 20 }
	ifl SPIN_KICK 20 { soundonce CHI_PROTECT divvar TEMP 2 seta[].htextra TEMP palfrom 20 0 20 20 }
	ifl TWIRL_KICK 20 { soundonce CHI_PROTECT divvar TEMP 2 seta[].htextra TEMP palfrom 20 0 20 20 }
	ifl FLYING_KICK 27 { soundonce CHI_PROTECT divvar TEMP 2 seta[].htextra TEMP palfrom 20 0 20 20 }
	ifl DROP_KICK 27 { soundonce CHI_PROTECT divvar TEMP 2 seta[].htextra TEMP palfrom 20 0 20 20 }
	ifl UPPER_CUT 20 { soundonce CHI_PROTECT divvar TEMP 2 seta[].htextra TEMP palfrom 20 0 20 20 }
	}
	
}

// ARMOUR STUFF

ifg INVINC 2
{
	soundonce INVULN_DRUMS
	setuserdef[].const_visibility 0
	ife INVINC 60 soundonce GO_SLOW
	sub INVINC 1
	ifg HIT_DAMAGE -1 { seta[].htextra -1 set HIT_DAMAGE -1 }
}
else
ifg INVINC 0
{
	stopsound INVULN_DRUMS
	palfrom 40 40 40 40
	sub INVINC 1
}

ife CHAR 4 // Mirror orb?
{
	ifn player[].holoduke_on -1
	{
	stopsound TELEPORTER
	palfrom 5 5 0 5
	ifg sprite[].htextra -1
		{
		geta[].htowner TEMP4
		seta[TEMP4].htextra sprite[].htextra
		palfrom 30 30 0 30
		seta[].htextra -1
		globalsound WHOOSH
		}
	}
}

ife CHAR 9 // Mirror orb?
{
	ifn player[].holoduke_on -1
	{
	stopsound TELEPORTER
	palfrom 5 5 0 5
	ifg sprite[].htextra -1
		{
		geta[].htowner TEMP4
		seta[TEMP4].htextra sprite[].htextra
		palfrom 30 30 0 30
		seta[].htextra -1
		globalsound WHOOSH
		}
	}
}

ife P_HAS_SHIELD 0 ifg P_ENERGYSHIELD 0 set P_ENERGYSHIELD 0

ifg P_HAS_SHIELD 0 // player has energy shield?
ifg totalclock 10
ife camerasprite -1 // cutscene not rolling?
{
ife PERSONEL_RESEARCH[23] 2 set P_MAX_SHIELD 50 else set P_MAX_SHIELD 25
clamp P_ENERGYSHIELD 0 P_MAX_SHIELD
ifg P_ENERGYSHIELD 0
	{
	geta[].htextra TEMP6
	ifg TEMP6 0
		{
	   state HIT_IND_ARM
	   geta[].htang TEMP
	   sub TEMP sprite[].ang
	   set PHITANGLE TEMP
		seta[].htextra -1
		palfrom 4 64 64
		sub P_ENERGYSHIELD TEMP6
		ifl P_ENERGYSHIELD 1
			{
			screensound ESHIELD_BREAK
			palfrom 16 64 64
			set P_ENERGYSHIELD 0
			}
		set P_REC_DELAY 450
		}
	}
ifl P_ENERGYSHIELD P_MAX_SHIELD
	{
	ifg P_REC_DELAY 0
		{
		ife PERSONEL_RESEARCH[24] 2
			{
			geta[THISACTOR].xvel TEMP3
			divvar TEMP3 75
			ifl TEMP3 1 set TEMP3 1
			sub P_REC_DELAY TEMP3
			}
		else
		 sub P_REC_DELAY 1
		}
	else ifl P_REC_DELAY 1
		{
		ifp pstanding nullop else
		soundonce ESHEILD_CHARGING
		add P_ENERGYSHIELD 1
		ife P_ENERGYSHIELD P_MAX_SHIELD
			{
			palfrom 16 64 64
			stopsound ESHEILD_CHARGING
			sound ESHIELD_RECHARGE
			}
		}
	}
}

//ife FIRE_SUIT 1 state MECH_DAMAGE_MODIFIER // Enviro suit protects against damage

ife JUGGERN_SUIT 1 // Juggernaut suit reduces damage by a quarter, removes it if less than 20
	{
	set temp_weapon 44
	setplayer[].ammo_amount 0 999
	setplayer[].curr_weapon 0
	getactor[].htextra TEMP
	ifg TEMP 0
		{
		divvar TEMP 4
		ifl TEMP 20 set TEMP -1
		setactor[].htextra TEMP
		}
	}

state ARMOUR_STUFF // found in PSTATS.CON

  ife player[].heat_on 1
    { 
	ife KICKBACKPIC 1 palfrom 20 20 20 20
	ife HELMET_LOADOUT[CHAR] 2 // using heat vision?
		{
		ifn player[].palette 5 setgamepalette 5
		}
	else
	ife HELMET_LOADOUT[CHAR] 4 // using ghost vision?
		{
		ifn player[].palette 4 setgamepalette 4
		setuserdef[].const_visibility 256
		}
	else // using night vision
		{
		setuserdef[].const_visibility 0
		}
	ife player[].heat_amount 660 set PLAYER_VOICEOVER 40
	ife PERSONEL_RESEARCH[11] 2 // turn off NVG if less than 1% charge and player has recharge item
		{
		ifl player[].heat_amount 48
			state TURNOFF_NVG
		}
	 }
  else
	{
    setuserdef[].const_visibility DEFAULTVISIBILITY
	   ifg player[].heat_amount 0 // if player has heat/night vision
		ife PERSONEL_RESEARCH[11] 2 // if player has research recharging battery
			{
			getp[].heat_amount TEMP2
			ifl TEMP2 640 { add TEMP2 1 setp[].heat_amount TEMP2 }	
			}
	}
	
ifg INVINC 2 setuserdef[].const_visibility 0


ifg BLINDED 0
{
sub BLINDED 1
setuserdef[].const_visibility 4096
}

ifg knockback 0
{
	ifgapzl 24 { set knockback 0 break }
	 sub knockback 1
	 cos xvel knockbackang
     sin yvel knockbackang
     mulvar xvel 352
     mulvar yvel 352
	 setp[].poszv -1536
	 setp[].posxv xvel
	 setp[].posyv yvel
}


ifg knockback2 0 
{
	ifgapzl 24 { set knockback2 0 break } 
	ifceilingdistl 8 { set knockback2 0 sound BODY_DROP6 wackplayer }
	setp[].jumping_counter 1261
	 sub knockback2 1
	 cos xvel knockbackang
     sin yvel knockbackang
     mulvar xvel 512
     mulvar yvel 512
	 setp[].poszv knockbackheight
	 setp[].posxv xvel
	 setp[].posyv yvel
}

// Knockback for sliding
ifg knockback_slide 0
{
     sub knockback_slide 1
     cos xvel knockbackang
     sin yvel knockbackang
     mulvar xvel 512
     mulvar yvel 512
     setp[].poszv knockbackheight
     setp[].posxv xvel
     setp[].posyv yvel
}

// Using Mounted minigun

ifn using_minigun -1
{
getactorvar[using_minigun].stationary_gun_ammo current_sg_ammo
setp[].weapon_pos 10
setp[].kickback_pic 0
setp[].movement_lock 15
ifand BITS_PRESS 4
 ifg current_sg_ammo 0
	{
	flash
	shoot ARMOUR_PIERCING_SHOT
	shoot ARMOUR_PIERCING_SHOT
	shoot ARMOUR_PIERCING_SHOT
	shoot ARMOUR_PIERCING_SHOT
	shoot ARMOUR_PIERCING_SHOT
	ifrnd 2 shoot 13215
	soundonce MINIGUN_FIRE
	shoot RIFLESHELL
	shoot RIFLESHELL
	shoot RIFLESHELL
	ifl firing_count 128 add firing_count 1
	sub current_sg_ammo 3
	ifl current_sg_ammo 0 set current_sg_ammo 0
	setactorvar[using_minigun].stationary_gun_ammo current_sg_ammo
	set GUN_RECOIL 6
	}
else { stopactorsound THISACTOR MINIGUN_FIRE set TEMP6 0 ifg firing_count 0 sub firing_count 1 }
}

// Using Mounted 50cal

ifn using_50cal -1
{
getactorvar[using_50cal].stationary_gun_ammo current_sg_ammo
setp[].weapon_pos 10
setp[].kickback_pic 0
setp[].movement_lock 15

		setp[].posx sprite[using_50cal].x
		setp[].posy sprite[using_50cal].y
		geta[using_50cal].z TEMP4
		sub TEMP4 8192
		setp[].posz TEMP4

ifand BITS_PRESS 4
 ifg current_sg_ammo 0
  ife firing_count 0
	{
	flash
	shoot 22442
	sound FIFTY_T_FIRE
	set GUN_RECOIL 10
	shoot RIFLESHELL
	shoot RIFLESHOT
	set firing_count 5
	sub current_sg_ammo 1
	ifl current_sg_ammo 0 set current_sg_ammo 0
	setactorvar[using_50cal].stationary_gun_ammo current_sg_ammo
	ife firing_count 4
		{
		getp[].horiz TEMP
		add TEMP 3
		setp[].horiz TEMP
		}
	else
	ife firing_count 3
		{
		getp[].horiz TEMP
		sub TEMP 3
		setp[].horiz TEMP
		}
	}
else { ifg firing_count 0 sub firing_count 1 ifl firing_count 0 set firing_count 0 }
}

ifn player[].access_incs 0
ife CUSTOMKEYCARDPOS 0
	{
	getp[].access_spritenum TEMP
	geta[TEMP].pal CKEYCARDPAL
	set KEYCARDTYPE 0
	set CUSTOMKEYCARDPOS 21 
	}
	ifg CUSTOMKEYCARDPOS 0 
		{ setp[].weapon_pos 10 setp[].kickback_pic 0 sub CUSTOMKEYCARDPOS 1 }
		
	ife CUSTOMKEYCARDPOS 9 set PLAYER_VOICEOVER 50
		
ifn EGYPT_ARTIFACTS 0
{
	ifand EGYPT_ARTIFACTS 1 // high jump
	{
	ifg player[].jumping_counter 0 { soundonce NINJA_JUMP setp[].poszv -6536 }
	
	ife player[].jumping_counter 0
	ifvarl player[].falling_counter 61
		{
		  setplayer[THISACTOR].falling_counter 8
		}
	
	}

	ifand EGYPT_ARTIFACTS 2 // air mask
	{
	ifinwater 
		{
		ife player[].scuba_on 1 setp[].scuba_on 0
		setp[].airleft 360
		}
	}

	ifand EGYPT_ARTIFACTS 8 // fall protection feather
	{
	ifg player[].falling_counter 0 
		{ 
		ifand BITS_PRESS 1
			{
			state STOPSTEPSOUNDS
			soundonce WING_FLAP
			setp[].falling_counter 0
			getp[].poszv TEMP
			divvar TEMP 3
			setp[].poszv TEMP
			}
		}
	}
}

ife JUMP_BOOTS 1
{
iffloordistl 16 ifl player[].falling_counter 60 setp[].falling_counter 0
ifg player[].jumping_counter 0 { soundonce J_BOOT_USE setp[].poszv -6536 }
}

state PLAYERSTATS

ife JUGGERN_SUIT 1 set CKNEE 23964

ife INVEN_REPLACE 1 // Vacation stuff
{
set CMEDIKIT 20160
}

ifinwater mulvar GUN_ACCURACY 2


ifp pstanding
 ifp pducking
	{
	ifinwater nullop else
		{
		ife GUN_SIZE 0 nullop else
		ife GUN_SIZE 1 nullop else
		divvar GUN_ACCURACY 2
		}
	}
	else
	ife CROUCH 1 { sub WEAPSWAYY 10 set CROUCH 0 }
	
ife AUTORUN_STATUS -1 getuserdef[].auto_run AUTORUN_STATUS

ife player[].ftq 86 set AUTORUN_STATUS 1 else ife player[].ftq 85 set AUTORUN_STATUS 0
	
ife AUTORUN_STATUS 0
{
ifand BITS_PRESS P_SPRINTING nullop else
	{
	setuserdef[].auto_run 0
	}
}
	
ifand BITS_PRESS P_SPRINTING // sprint key
ife player_in_vehicle 0
ife SCOPE 0
{
	ifp prunning nullop else 
		ife AUTORUN_STATUS 0
		{
		setuserdef[].auto_run 1
		}

	ifand GUNFIREMODE 16384 setp[].runspeed 42100
	else ifand GUNFIREMODE 131072 setp[].runspeed 42100
	else
	ifg SPRINTING 0
	ifp prunning
	{
	setp[].movement_lock 12
	ife SPACE_SUIT 1 soundonce SPACESUIT_THRUSTER
	else
		{
		ife CHAR 0 soundonce JACKET_SPRINT
		ife CHAR 3 soundonce JACKET_SPRINT
		ife CHAR 4 soundonce JACKET_SPRINT
		ife CHAR 5 soundonce JACKET_SPRINT
		ife CHAR 10 soundonce JACKET_SPRINT
		}
	ife PERSONEL_RESEARCH[30] 2 // player has muscle suit
		{
		ife GUN_SIZE 0 nullop else
		ife GUN_SIZE 1 mulvar GUN_ACCURACY 2 else
		ife GUN_SIZE 2 mulvar GUN_ACCURACY 3 else
		ife GUN_SIZE 3 { mulvar GUN_ACCURACY 4 setp[].weapon_pos 10 setp[].kickback_pic 0 }
		}
		else
		{
		ifl GUN_SIZE 2 nullop else
		ife GUN_SIZE 2 mulvar GUN_ACCURACY 2 else
		ife GUN_SIZE 3 mulvar GUN_ACCURACY 3
		}
		
	ife ARTIFACTS_LOADOUT[CHAR] 6 nullop else // don't slow the player's turning speed if they have lightstep boots
	{
	  getp[].oang TEMP
        getp[].ang TEMP2
        getincangle TEMP2 TEMP TEMP2
		ife GUN_SIZE 3 divvar TEMP2 3 else
        divvar TEMP2 2
        add TEMP TEMP2
        setp[].ang TEMP
	}

	getp[].angvel TEMP3
	divvar TEMP3 2
	mulvar TEMP3 -1
	ife skybox 0 setp[].rotscrnang TEMP3
	ifn CONTROL_VR -1 nullop else
	ifinwater ife GOT_FLIPPER 1 nullop else
	ifand EGYPT_ARTIFACTS 4 nullop else
		{
		ife PERSONEL_RESEARCH[30] 2
			{
			ife GUN_SIZE 3 sub SPRINTING 2 else
			sub SPRINTING 1
			}
		else
			{
			ife GUN_SIZE 3 sub SPRINTING 3 else
			ife GUN_SIZE 2 sub SPRINTING 2 else
			sub SPRINTING 1
			}
		}
	ifg AGENT_FATIGUE[CHAR] 10000 ifg SKILL_LEVEL 2 sub SPRINTING 1
	setp[].runspeed SPRINTSPEED
	}
	else 
	 ifg SPRINTING -2
	  ifl SPRINTING 2 
	   { 
	   stopactorsound THISACTOR JACKET_SPRINT
	   ifinwater 
			{
			ife CHAR 0 soundonce J_DROWNING else
			ife CHAR 10 sound BS_GASP else
			ife CHAR 12 sound BS_GASP else
			ife CHAR 20 sound BS_GASP else
			sound DROWNING 
			}
		else 
			{
			ife CHAR 10 sound BS_GASP2 else
			ife CHAR 12 sound BS_GASP2 else
			ife CHAR 20 sound BS_GASP2 else
			sound DUKE_GASP 
			}
           
           ifp ponground  // Don't whack and slow down the player if he's in the air (inertia)
           {
              ife skybox 0 wackplayer else set CUS_WACK 10 // wackplayer messes up skyboxes
	      setp[].runspeed 42100
           }
	   set SPRINTING -20 
	   }
	else ifl SPRINTING -2 
           {
            ifp ponground setp[].runspeed 42100
            set SPRINTING -20
           }
}
else ifl SPRINTING 0 setp[].runspeed 42100
else ifand GUNFIREMODE 16384 setp[].runspeed 42100
else ifand GUNFIREMODE 512 setp[].runspeed 4096
else ifand GUNFIREMODE 131072 setp[].runspeed 42100
else 
	{ 
	
	ifactorsound THISACTOR JACKET_SPRINT 
		{ 
		soundonce JMOVE1 
		stopactorsound THISACTOR JACKET_SPRINT 
		}
	setp[].movement_lock 0 
	setp[].runspeed RUNNINGSPEED 
	ifinwater ife GOT_FLIPPER 1 
		{
		ifp prunning soundonce PLAYER_SWIM
		setp[].runspeed SPRINTSPEED
		}
	}

ife MISSIONSCREEN 5
ife MISSIONUP 1
{
setp[].movement_lock 31
setp[].weapon_pos 10
}

	
ifg WALL_KICK 0
	{
	sub WALL_KICK 1
	setp[].movement_lock 3
	
	}

ifmultiplayer set allow_temp_characters 15
else ife VOLUME 0 ife LEVEL 7 set allow_temp_characters 15
else ife VOLUME 5 set allow_temp_characters 15
else ife VOLUME 6 set allow_temp_characters 15
else 
	{
	ifand BEAT_EPISODES[7] 2 { ifand allow_temp_characters 1 nullop else xorvar allow_temp_characters 1 } // Unlock cultist?
	ifand BEAT_EPISODES[7] 4 { ifand allow_temp_characters 2 nullop else xorvar allow_temp_characters 2 } // Unlock bombshell?
	}

ife CHARSELECT 1 
{ 
set IN_DREAM 0
set MOUSEUP 1
set jib_quote_track 0
set P_HAS_SHIELD 0
set P_ENERGYSHIELD 0

ifl CREDITS 200
ife VOLUME 0 // Give the player 200 credits if he's playing episode 1 and has beat it once already
 ife LEVEL 1
	{
	ifand BEAT_EPISODES[0] 255 set CREDITS 200
	}	
	
ifl CREDITS 200
ife VOLUME 1 // Give the player 200 credits if he's playing episode 1 and has beat it once already
 ife LEVEL 1
	{
	ifand BEAT_EPISODES[0] 255 set CREDITS 200
	}	

ife show_next_char 1
{
		ifg MOUSEX 319
		 ifg MOUSEY 48
		  ifl MOUSEX 400
		   ifl MOUSEY 80
			{
			set CHAR -1
			ifand BITS_PRESS 4
			 ife BUTTON_COUNTER 0
				{
				sound INTERFACE_1
				set BUTTON_COUNTER 10
				set show_next_char 0
				}
			}

ifn allow_temp_characters 0
	{
	ifand allow_temp_characters 1
		{
		ifg MOUSEX 154
		 ifg MOUSEY 21
		  ifl MOUSEX 184
		   ifl MOUSEY 55
			{
			ifn CHAR 9 { sound SELECT set CHARSHADE 20 }
			set CHAR 9 // Cultist
			ifand BITS_PRESS 4
				{ 
				set MOUSEUP 0
				set HUDON 0
				state SELECTEDCHAR
				}
			}
		}
		
	ifand allow_temp_characters 2
		{
		ifg MOUSEX 188
		 ifg MOUSEY 21
		  ifl MOUSEX 220
		   ifl MOUSEY 55
			{
			ifn CHAR 10 { sound SELECT set CHARSHADE 20 }
			set CHAR 10 // Bombshell
			ifand BITS_PRESS 4
				{ 
				set MOUSEUP 0
				set HUDON 0
				state SELECTEDCHAR
				}
			}
		}
		
	ifand allow_temp_characters 4
		{
		ifg MOUSEX 223
		 ifg MOUSEY 21
		  ifl MOUSEX 255
		   ifl MOUSEY 55
			{
			ifn CHAR 11 { sound SELECT set CHARSHADE 20 }
			set CHAR 11 // Maarten
			ifand BITS_PRESS 4
				{ 
				set MOUSEUP 0
				set HUDON 0
				state SELECTEDCHAR
				}
			}
		}
		
	ifand allow_temp_characters 8
		{
		ifg MOUSEX 260
		 ifg MOUSEY 21
		  ifl MOUSEX 290
		   ifl MOUSEY 55
			{
			ifn CHAR 12 { sound SELECT set CHARSHADE 20 }
			set CHAR 12 // JANE
			ifand BITS_PRESS 4
				{ 
				set MOUSEUP 0
				set HUDON 0
				state SELECTEDCHAR
				}
			}
		}
	}
}

ife show_next_char 0
	{
	ifn allow_temp_characters 0
	 {
		ifg MOUSEX 319
		 ifg MOUSEY 48
		  ifl MOUSEX 400
		   ifl MOUSEY 80
			{
			set CHAR -1
			ifand BITS_PRESS 4
			 ife BUTTON_COUNTER 0
				{
				sound INTERFACE_1
				set BUTTON_COUNTER 10
				set show_next_char 1
				}
			}
	 }
	
	ifg MOUSEX 154
	 ifg MOUSEY 21
	  ifl MOUSEX 184
	   ifl MOUSEY 55
		{
		ifn CHAR 0 { sound SELECT set CHARSHADE 20 }
		set CHAR 0 // James
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 188
	 ifg MOUSEY 21
	  ifl MOUSEX 220
	   ifl MOUSEY 55
		{
		ifn CHAR 1 { sound SELECT set CHARSHADE 20 }
		set CHAR 1 // Zaxtor
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 223
	 ifg MOUSEY 21
	  ifl MOUSEX 255
	   ifl MOUSEY 55
		{
		ifn CHAR 2 { sound SELECT set CHARSHADE 20 }
		set CHAR 2 // Merlijn
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 260
	 ifg MOUSEY 21
	  ifl MOUSEX 290
	   ifl MOUSEY 55
		{
		ifn CHAR 3 { sound SELECT set CHARSHADE 20 }
		set CHAR 3 // Highwire
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 155
	 ifg MOUSEY 66
	  ifl MOUSEX 184
	   ifl MOUSEY 103
		{
		ifn CHAR 4 { sound SELECT set CHARSHADE 20 }
		set CHAR 4 // Sang
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 190
	 ifg MOUSEY 66
	  ifl MOUSEX 218
	   ifl MOUSEY 103
		{
		ifn CHAR 5 { sound SELECT set CHARSHADE 20 }
		set CHAR 5 // Rusty
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 225
	 ifg MOUSEY 66
	  ifl MOUSEX 254
	   ifl MOUSEY 103
		{
		ifn CHAR 6 { sound SELECT set CHARSHADE 20 }
		set CHAR 6 // Geoffrey
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 258
	 ifg MOUSEY 66
	  ifl MOUSEX 288
	   ifl MOUSEY 103
		{
		ifn CHAR 7 { sound SELECT set CHARSHADE 20 }
		set CHAR 7 // Mikko
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 295
	 ifg MOUSEY 21
	  ifl MOUSEX 320
	   ifl MOUSEY 55
		ife EP2_NEW_CHARACTERS 1
		{
		ifn CHAR 13 { sound SELECT set CHARSHADE 20 }
		set CHAR 13 // Micky
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
		
	ifg MOUSEX 295
	 ifg MOUSEY 66
	  ifl MOUSEX 320
	   ifl MOUSEY 103
		ife EP3_NEW_CHARACTERS 1
		{
		ifn CHAR 14 { sound SELECT set CHARSHADE 20 }
		set CHAR 14 // Snowfall
		ifand BITS_PRESS 4
			{ 
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR
			ife give_loadout 1 state give_assigned_weapon
			ife CHARSTART 1 state TAKETOROOM
			}
		else
		ifand BITS_PRESS 64
			{
			set MOUSEUP 0
			set HUDON 0
			state SELECTEDCHAR		
			}
		}
	}

	
	action 0
	setp[].weapon_pos 10
	lockplayer 10 setp[].poszv 0 
	
	// delete for testing purposes
	// ifmultiplayer { randvar CHAR 7 set CHARSELECT 0 set MOUSEUP 0 }
	
	ifhitspace ifn CHAR -1 
	{ 
	setp[].horiz 100
	set MOUSEUP 0
	set HUDON 0
	state SELECTEDCHAR
	} 
		
}

ife AUTOAIM_STATUS -1 getplayer[].auto_aim AUTOAIM_STATUS

// player lockon stuff
		ifn hitsprite -1
		 ifg sprite[hitsprite].extra 0
			geta[hitsprite].picnum TEMP6
			switch TEMP6
			case PIGCOP
			case FASCIST	
			case CULTIST
			case TRIAD
			case NINJA
            case LIZMAN
            case LIZTROOP
			case LIZTROOPONTOILET
			case LIZTROOPJUSTSIT
			case ZOMBIE
			case SATYR
            case COMMANDER
            case OCTABRAIN
		    case EGG
            case NEWBEAST
            case BOSS1
            case BOSS2
            case BOSS3
            case BOSS4
			case BOSS5
		    case BRUISER
		    case ZSCIEN
			case ZCHAING
			case ZSOLDIER
			case ZSOLDIER2
			case Z_GRENADEL
			case SHADE
		    case SHARK
		    case MERC
			case MERC2
			case HADESPHERE
			case DOCTORJ
			case MISTERH
			case DARKAVATAR
			case SORCERER
			case FLESHWIZARD
			case ABYSS_DESPOT
			case BERSERKER
			case OGRE
			case PITFIEND
			case APLAYER
			case MAEPHISTO
			case CYBERDEMON
			case CYBERTOUR
			case SPIDERDEMON
		    case DRONE
		    case ROTATEGUN
		    case TANK
		    case RECON
			case HPOWERSUIT
			case LPOWERSUIT
			case GWBOSS
			case PIGBOSS
			case TERMINATOR
			case TERMINATORCRAWLING
			case MS_CORP_MECH
			case VILMOS_ROBOT
			case 3899
			case RIPPER
			case GUARDIAN
			case MJ12_TROOP
			case PE_TROOP
			case PE_ELDER
			case PE_SENTRY
			case SPIRIT
			case MJ12_ASSASSIN
			case CYBERALIEN
			case GORILLA
			case NAZI
			case ANUBIS
			case ANUBIS_MUMMY
			case SIREN
			case ALUDRAN
			case SHAMBLER
			case CHRYSSALID
			 ife CURWEAP 0
			  ife temp_weapon 0
				{
				 ifand BITS_PRESS 64
				 ifcount 13
					{
					ife MELEE_LOCKED_ON -1
						{
						soundonce DUKE_CRACK_FIRST
						state MELEE_LOCKON_QUOTES
						set MELEE_LOCKED_ON hitsprite
						}
					else set MELEE_LOCKED_ON -1
					resetcount
					}
				}
			else
			ifn AUTOAIM_STATUS 0
					{
					setplayer[].auto_aim 0
					}
				break
			default
			ifn AUTOAIM_STATUS 0
				{
				setplayer[].auto_aim AUTOAIM_STATUS
				}
			break
			endswitch

ifg CHARSHADE 0 sub CHARSHADE 1

ifg INEBRIATION 0
	{
	sub INEBRIATION 1
	ifg INEBRIATION 600
		{
		ifp pstanding ifp pducking sub INEBRIATION 2
		palfrom 20 0 0 0
		setp[].weapon_pos 10
		ifrnd 3 { sound VOMIT wackplayer spawn PUKE }
		}
	}

ifl INEBRIATION 0 set INEBRIATION 0
ifl QUICKK 14 add QUICKK 1
ife QUICKK 6 sound KICK_SWING
	
ifl ROLL_LEFT 13
	{
	ifg SCOPE 0 set SCOPE 0
	ifl ROLL_LEFT 13 
	 ifn PERSONEL_RESEARCH[30] 2
		{
		ife ROLL_LEFT 1 soundonce P_ROLL
		setp[].weapon_pos 10
		ife player[].over_shoulder_on 0
			{
			set TEMP ROLL_LEFT
			mulvar TEMP 100
			setp[].rotscrnang TEMP
			}
		}
	ifg FIRE_DAMAGE 10 sub FIRE_DAMAGE 10
	setp[].knee_incs 0
	setp[].quick_kick 0
	add ROLL_LEFT 1
	}
	
ifl ROLL_RIGHT 13
	{
	ifg SCOPE 0 set SCOPE 0
	ifl ROLL_RIGHT 13 
	 ifn PERSONEL_RESEARCH[30] 2
		{
		ife ROLL_RIGHT 1 soundonce P_ROLL
		setp[].weapon_pos 10
			ife player[].over_shoulder_on 0
			{
			set TEMP ROLL_RIGHT
			mulvar TEMP -100
			setp[].rotscrnang TEMP
			}
		}
	ifg FIRE_DAMAGE 10 sub FIRE_DAMAGE 10
	
	setp[].knee_incs 0
	setp[].quick_kick 0
	add ROLL_RIGHT 1
	}
	
ifl ROLL_BACKWARDS 26
	{
	ifl ROLL_BACKWARDS 26 
	 ife player[].over_shoulder_on 0
	  ifn PERSONEL_RESEARCH[30] 2
		{
		ife ROLL_BACKWARDS 7 soundonce P_ROLL
		setp[].weapon_pos 10
		switch ROLL_BACKWARDS
		case 0
			setp[].horiz 150
			break
		case 1
			setp[].horiz 200
			break
		case 2
			setp[].horiz 250
			break
		case 3
			setp[].horiz 299
			break
		case 4
			setp[].rotscrnang 256
			setp[].horiz 299
			break
		case 5
			getp[].ang TEMP4
			sub TEMP4 1024
			setp[].ang TEMP4
			setp[].rotscrnang 512
			setp[].horiz 299
			break
		case 6
			setp[].rotscrnang 768
			setp[].horiz 250
		case 7
			setp[].rotscrnang 1023
			setp[].horiz 200
			break
		case 8
			setp[].rotscrnang 1023
			setp[].horiz 150
			break
		case 9
			setp[].rotscrnang 1023
			setp[].horiz 100
			break
		case 10
			setp[].rotscrnang 1023
			setp[].horiz 50
			break
		case 11
			setp[].rotscrnang 1023
			setp[].horiz 0
			break
		case 12
			setp[].rotscrnang 768
			setp[].horiz -50
			break
		case 13
			getp[].ang TEMP4
			add TEMP4 1024
			setp[].ang TEMP4
			setp[].rotscrnang 512
			setp[].horiz -99
			break
		case 14
			setp[].rotscrnang 256
			setp[].horiz -99
			break
		case 15
			setp[].rotscrnang 0
			setp[].horiz -50
			break
		case 16
		case 17
			setp[].horiz 0
			break
		case 18
		case 19
			setp[].horiz 50
			break
		case 20
		case 21
			setp[].horiz 100
			break
		endswitch
		}
	ifg FIRE_DAMAGE 10 sub FIRE_DAMAGE 1
	setp[].knee_incs 0
	setp[].quick_kick 0
	add ROLL_BACKWARDS 1
	}
	
ifl ROLL_FORWARDS 26
	{
	setp[].weapon_pos 10
	ifl ROLL_FORWARDS 26 
	 ife player[].over_shoulder_on 0
		{
		switch ROLL_FORWARDS
		case 0
			setp[].horiz 100
			break
		case 1
			setp[].horiz 50
			break
		case 2
			setp[].horiz 0
			break
		case 3
			setp[].rotscrnang 0
			setp[].horiz -50
			break
		case 4
			setp[].rotscrnang 256
			setp[].horiz -99
			break
		case 5
			getp[].ang TEMP4
			add TEMP4 1024
			setp[].ang TEMP4
			setp[].rotscrnang 512
			setp[].horiz -99
			break
		case 6
			setp[].rotscrnang 768
			setp[].horiz -50
			break
		case 7
			setp[].rotscrnang 1023
			setp[].horiz 0
			break
		case 8
			setp[].rotscrnang 1023
			setp[].horiz 50
			break
		case 9
			setp[].rotscrnang 1023
			setp[].horiz 100
			break
		case 10
			setp[].rotscrnang 1023
			setp[].horiz 150
			break
		case 11
			setp[].rotscrnang 1023
			setp[].horiz 200
			break
		case 12
			setp[].rotscrnang 768
			setp[].horiz 250
			break
		case 13
			getp[].ang TEMP4
			sub TEMP4 1024
			setp[].ang TEMP4
			setp[].rotscrnang 512
			setp[].horiz 299
			break
		case 14
			setp[].rotscrnang 256
			setp[].horiz 299
			break
		case 15
			setp[].horiz 299
			break
		case 16
			setp[].horiz 275
			break
		case 17
			setp[].horiz 250
			break
		case 18
			setp[].horiz 200
			break
		case 19
			setp[].horiz 150
			break
		case 20
			setp[].horiz 100
			break
		endswitch
		}
	ifg FIRE_DAMAGE 10 sub FIRE_DAMAGE 1
	ife ROLL_FORWARDS 7 soundonce P_ROLL
	setp[].knee_incs 0
	setp[].quick_kick 0
	add ROLL_FORWARDS 1
	}
	
ifl SLIDE_KICK 27
	{
	sub SPRINTING 1
    
    ifl SLIDE_KICK 25 seta[player[].i].yrepeat 35
    else seta[player[].i].yrepeat 36
    
    ifl SLIDE_KICK 19 
        ife skybox 0
            setp[].rotscrnang 48

	setp[].knee_incs 0
	setp[].quick_kick 0
    setp[].hard_landing 0

    // spawn "kick" projectiles in this range
    ifg SLIDE_KICK 4 ifl SLIDE_KICK 18 shoot KNEE
         
	add SLIDE_KICK 1       
    }
ifl ROUNDHOUSE_KICK 27
	{
	getp[].posxv TEMP2 divvar TEMP2 4 setp[].posxv TEMP2
	getp[].posyv TEMP2 divvar TEMP2 4 setp[].posyv TEMP2
	setp[].knee_incs 0
	setp[].quick_kick 0
	
	ife skybox 0 setp[].rotscrnang 64
	ifl ROUNDHOUSE_KICK 17 setp[].weapon_pos 10
	ifg ROUNDHOUSE_KICK 17 ife skybox 0 setp[].rotscrnang -12
	getp[].ang TEMP5
	ife ROUNDHOUSE_KICK 1 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 2 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 3 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 4 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 5 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 6 { sound KICK_SWING shoot KNEE }
	ife ROUNDHOUSE_KICK 7 { add TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 8 { add TEMP5 32 setp[].ang TEMP5 shoot KNEE }
	ife ROUNDHOUSE_KICK 9 { add TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 10 { add TEMP5 32 setp[].ang TEMP5 shoot KNEE  }
	ife ROUNDHOUSE_KICK 11
		{
		 add TEMP5 32 setp[].ang TEMP5
		ife CHAR 0
			{
			ifrnd 32 soundonce J_KUNGFU_1
			else ifrnd 32 soundonce J_KUNGFU_2
			}
		}
	ife ROUNDHOUSE_KICK 12 { add TEMP5 32 setp[].ang TEMP5 shoot KNEE }
	ife ROUNDHOUSE_KICK 13 { add TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 14 { add TEMP5 32 setp[].ang TEMP5 shoot KNEE }
	ife ROUNDHOUSE_KICK 15 { add TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 16 { add TEMP5 32 setp[].ang TEMP5 shoot KNEE }
	ife ROUNDHOUSE_KICK 17 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 18 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 19 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 20 { sub TEMP5 32 setp[].ang TEMP5 }
	ife ROUNDHOUSE_KICK 21 { sub TEMP5 32 setp[].ang TEMP5 }
	add ROUNDHOUSE_KICK 1
	}
ifl KNIFE_ATTACK 27
	{
	ife GOT_KNIFE 3 sub SPRINTING 6 else sub SPRINTING 3
	getp[].posxv TEMP2 divvar TEMP2 4 setp[].posxv TEMP2
	getp[].posyv TEMP2 divvar TEMP2 4 setp[].posyv TEMP2
	setp[].knee_incs 0
	setp[].quick_kick 0
	
	ife GOT_KNIFE 1 set TEMP7 4963 // standard knife
	else ife GOT_KNIFE 2 set TEMP7 12203 // silver knife 
	else ife GOT_KNIFE 3 set TEMP7 12204 // combat shovel
	
	ifl KNIFE_ATTACK 17 setp[].weapon_pos 10
	ife KNIFE_ATTACK 0 
		{
		ife GOT_KNIFE 3 sound SHOVEL_SWING else
		sound KNIFE_SWING 
		}
	ife KNIFE_ATTACK 2 { eshootvar TEMP7 geta[RETURN].ang TEMP8 sub TEMP8 96 seta[RETURN].ang TEMP8 }
	ife KNIFE_ATTACK 4 { eshootvar TEMP7 geta[RETURN].ang TEMP8 sub TEMP8 48 seta[RETURN].ang TEMP8 }
	ife KNIFE_ATTACK 6 { eshootvar TEMP7 geta[RETURN].ang TEMP8 sub TEMP8 16 seta[RETURN].ang TEMP8 }
	ife KNIFE_ATTACK 8 { eshootvar TEMP7 geta[RETURN].ang TEMP8 add TEMP8 16 seta[RETURN].ang TEMP8 }
	ife KNIFE_ATTACK 10 { eshootvar TEMP7 geta[RETURN].ang TEMP8 add TEMP8 48 seta[RETURN].ang TEMP8 }
	ife KNIFE_ATTACK 12 { eshootvar TEMP7 geta[RETURN].ang TEMP8 add TEMP8 96 seta[RETURN].ang TEMP8 }
	add KNIFE_ATTACK 2
	}
ifl SPIN_KICK 20
	{
	lockplayer 5
	setp[].knee_incs 0
	setp[].quick_kick 0
	setp[].weapon_pos 10
	ife skybox 0
		{
		ifl SPIN_KICK 10 setp[].rotscrnang -128 else
		ifl SPIN_KICK 13 setp[].rotscrnang -64 else
		ifl SPIN_KICK 16 setp[].rotscrnang 64
		}
	getp[].ang TEMP5
	ife SPIN_KICK 1 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 2 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 3 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 4 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 5 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 6 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 7 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 8 { sub TEMP5 256 setp[].ang TEMP5 }
	ife SPIN_KICK 10
		{
		ife CHAR 0
			{
			ifrnd 32 soundonce J_KUNGFU_1
			else ifrnd 32 soundonce J_KUNGFU_2
			}
		}
	ife SPIN_KICK 13 sound KICK_SWING 
	ife SPIN_KICK 14 { shoot KNEE shoot KNEE shoot KNEE }
	ife SPIN_KICK 15 { shoot KNEE shoot KNEE shoot KNEE }
	add SPIN_KICK 1
	}
ifl TWIRL_KICK 20
	{
	lockplayer 5
	setp[].knee_incs 0
	setp[].quick_kick 0
	setp[].weapon_pos 10
	ife skybox 0
		{
		ifl TWIRL_KICK 16 setp[].rotscrnang -128 else
		ifl TWIRL_KICK 18 setp[].rotscrnang -64 else
		ifl TWIRL_KICK 20 setp[].rotscrnang 64
		}
	getp[].ang TEMP5
	ife TWIRL_KICK 1 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 2 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 3 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 4 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 5 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 6 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 7 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 8 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 9 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 10 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 11 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 12 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 13 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 14 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 15 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	ife TWIRL_KICK 16 { sub TEMP5 128 setp[].ang TEMP5 shoot KNEE }
	add TWIRL_KICK 1
	}
ifl FLYING_KICK 27
	{
	setp[].knee_incs 0
	setp[].quick_kick 0
	ife skybox 0
		{
		ifl FLYING_KICK 13 setp[].rotscrnang -96 else
		ifl FLYING_KICK 20 setp[].rotscrnang -16 
		}
	ifg FLYING_KICK 4
	 ifl FLYING_KICK 13
	 {
	  shoot KNEE
	  }
	  
		ife FLYING_KICK 8
		{
		ife CHAR 0
			{
			ifrnd 32 soundonce J_KUNGFU_1
			else ifrnd 32 soundonce J_KUNGFU_2
			}
		}
	
	add FLYING_KICK 1
	}
ifl DROP_KICK 27
	{
	setp[].weapon_pos 10
	setp[].knee_incs 0
	setp[].quick_kick 0
	ife skybox 0
		{
		ifl DROP_KICK 13 setp[].rotscrnang -96 else
		ifl DROP_KICK 20 setp[].rotscrnang -16 
		}
	ifg DROP_KICK 4
	 ifl DROP_KICK 13
	 {
	  shoot KNEE
	  shoot KNEE
	  }

		ife DROP_KICK 8
		{
		ife CHAR 0
			{
			ifrnd 32 soundonce J_KUNGFU_1
			else ifrnd 32 soundonce J_KUNGFU_2
			}
		}
	
	add DROP_KICK 1
	}
ifl UPPER_CUT 20
	{
	add UPPER_CUT 1
	setp[].knee_incs 0
	setp[].quick_kick 0
	getp[].horiz TEMP4
	set TEMP5 UPPER_CUT
	mulvar TEMP5 8
	sub TEMP5 40
	setp[].horiz TEMP5
	ife UPPER_CUT 2 ifrnd 16 ifcansee state trigger_showoff
	ife UPPER_CUT 1 
		{
		ife CHAR 0
			{
			ifand CHAR_APP 1 soundonce BIONIC_MOVE
			ifrnd 96 soundonce J_MELEE_1
			else ifrnd 96 soundonce J_MELEE_2
			else ifrnd 96 soundonce J_MELEE_3
			else ifrnd 96 soundonce J_MELEE_4
			}
		ife CHAR 2
			{
			ifrnd 96 soundonce M_MELEE_1
			else ifrnd 96 soundonce M_MELEE_2
			}
		ife CHAR 13
			{
			ifrnd 96 soundonce MC_MELEE_1
			}
		soundonce PUNCH 
		}
	ife UPPER_CUT 12 ifrnd 128 ifn MELEE_LOCKED_ON -1 setactorvar[MELEE_LOCKED_ON].HEADSHOT 1
	ife UPPER_CUT 14 { shoot KNEE shoot KNEE shoot KNEE shoot KNEE shoot KNEE shoot KNEE shoot KNEE shoot KNEE shoot KNEE }
	ife UPPER_CUT 16 wackplayer
	}
	
ife player[].over_shoulder_on NO
{
ife player[].jumping_counter 181
	{
	getp[].horiz TEMP2
	sub TEMP2 10
	setp[].horiz TEMP2
	}
else
ife player[].jumping_counter 361
	{
	getp[].horiz TEMP2
	add TEMP2 10
	setp[].horiz TEMP2
	}
}

ifonwater { ifsound ZAXTOR_SCREAM stopsound ZAXTOR_SCREAM state STOPSTEPSOUNDS }

ifp pfalling state STOPSTEPSOUNDS

ife JUGGERN_SUIT 1
 ifn CHAR 12
  ifn CHAR 13
   ifn CHAR 14
	{
		getp[].posxv TEMP
		mulvar TEMP 10
		ifand BITS_PRESS P_SPRINTING
		 ifg SPRINTING 0 divvar TEMP 12 else divvar TEMP 15
		setp[].posxv TEMP
		getp[].posyv TEMP
		mulvar TEMP 10
		ifand BITS_PRESS P_SPRINTING
		 ifg SPRINTING 0 divvar TEMP 12 else divvar TEMP 15
		setp[].posyv TEMP
		ife player[].jumping_counter 721 
		{
			setp[].jumping_counter 0 
		}	
	}

ife FIRE_SUIT 1
	{
	ifinwater
		{
		setp[].scuba_on 0
		setp[].airleft 390
		soundonce WEARSCUBAGEAR
		}
		getp[].posxv TEMP
		mulvar TEMP 10
		ifand BITS_PRESS P_SPRINTING
		 ifg SPRINTING 0 divvar TEMP 12 else divvar TEMP 15
		setp[].posxv TEMP
		getp[].posyv TEMP
		mulvar TEMP 10
		ifand BITS_PRESS P_SPRINTING
		 ifg SPRINTING 0 divvar TEMP 12 else divvar TEMP 15
		setp[].posyv TEMP
		ife player[].jumping_counter 721 
		{
			setp[].jumping_counter 0 
		}
		setp[].weapon_pos 10
		ife CHAR 0 soundonce JGASMASK 
		ife CHAR 1 soundonce ZGASMASK
		ife CHAR 4 soundonce SGASMASK
		

		ifand BITS_PRESS 4
		ifp pstanding
		{
		espawn 3587
		seta[RETURN].x hitx
		seta[RETURN].y hity
		seta[RETURN].z hitz

		dist xydist THISACTOR RETURN
		ifg xydist 750 nullop else
			{
			shoot MELTA_BEAM
			soundonce MELTA_START
			set INTERNALCOUNT_2 3
			}
		}
			
		  ifg INTERNALCOUNT_2 0
			{
			ife INTERNALCOUNT_2 2 { getp[].horiz TEMP add TEMP 5 setp[].horiz TEMP }
			ife INTERNALCOUNT_2 1 { getp[].horiz TEMP sub TEMP 5 setp[].horiz TEMP }
			sub INTERNALCOUNT_2 1
			}
			
	}
	

	
ifand sector[].floorstat 16384 // electric
{
ifrnd 16 
	{ 
	getp[].boot_amount TEMP
	ifg TEMP 0 { quote 75 sub TEMP 1 setp[].boot_amount TEMP } else 
		{
		palfrom 32 0 0 32
		sound ELECTROCUTE
		randvar TEMP2 2048
		set knockbackang TEMP2
		set knockback 10
		wackplayer
		switch CHAR
			case 12
			case 13
			case 14
				ifg PARMOUR 0 { getp[].shield_amount TEMP sub TEMP 5 setp[].shield_amount TEMP }
				else addphealth -5 
			break
			default
				addphealth -5
			break
		endswitch
		}
	}
}

ifp prunning
state CHECKSTEPSOUNDS

ifp pwalking
state CHECKSTEPSOUNDS

ifaction JFROZEN state PLAYER_FROZECODE
ifaction ZFROZEN state PLAYER_FROZECODE
ifaction PFROZEN state PLAYER_FROZECODE
ifaction RFROZEN state PLAYER_FROZECODE
ifaction SFROZEN state PLAYER_FROZECODE
ifaction RNFROZEN state PLAYER_FROZECODE
ifaction GFROZEN state PLAYER_FROZECODE
ifaction MFROZEN state PLAYER_FROZECODE
ifaction PCFROZEN state PLAYER_FROZECODE
ifaction EAF_FROZEN state PLAYER_FROZECODE
ifaction M2FROZEN state PLAYER_FROZECODE
ifaction LFROZEN state PLAYER_FROZECODE

  ifdead
  {
  setp[].kickback_pic 0
  set SCOPE 0
  set MOUSEUP 0
  set PCINTER 0
  ifstrength 0 nullop else spawn SHOOTME2
  ifsound WIND_FALL_RAPID stopsound WIND_FALL_RAPID
	ifn camerasprite -1 resetplayer
  
  
    ifaction PGROWING
    {
      ifmove PGROWINGPOP
      {
        quote 13
        ifhitspace
        {
          action 0
		  state spawnbackpack
          resetplayer
        }
        break
      }
      else
      {
        ifcount 32
        {
          state squish_sounds
          palfrom 48 64

          state standard_pjibs

          guts JIBS4 20
          guts JIBS6 20
          move PGROWINGPOP
          cstat 32768
          tossweapon

          hitradius 2048 60 70 80 90

        }
        else
          sizeto MAXXSTRETCH MAXYSTRETCH
      }
      break
    }

    ifsquished
      palfrom 32 63 63 63
    else
      fall

    ifactioncount 7
      move 0
    else
      ifactioncount 6
    {
      ifmultiplayer nullop
      else
      {
        ifrnd 32
          { ife CHAR 0 sound JPISSED ife CHAR 1 sound ZPISSED ife CHAR 3 sound RPISSED 
		  ife CHAR 4 sound SDEATH1 ife CHAR 14 sound SF_DEAD1 }
        else
          ifrnd 32
            { ife CHAR 0 sound JSPONGE ife CHAR 1 sound ZPISSED ife CHAR 3 sound ROHSHIT 
			ife CHAR 4 sound SDEATH2 ife CHAR 14 sound SF_DEAD2 }
        else
          ifrnd 32
            { ife CHAR 0 sound JOHSHIT ife CHAR 1 sound ZPISSED ife CHAR 3 sound RPISSED  
			ife CHAR 4 sound SHURT4 ife CHAR 14 sound SF_DEAD3 }
        else
          ifrnd 32
            { ife CHAR 0 sound JOHSHIT ife CHAR 1 sound ZPISSED ife CHAR 3 sound ROHSHIT  
			ife CHAR 4 sound SDISGUST ife CHAR 14 sound SF_DEAD4 }
      }
    }

    ifaction PLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction JLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction SLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction ZLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction RLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction RNLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction GLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction MLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction PCLYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction EAF_LYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }
    ifaction M2LYINGDEAD { ifactioncount 3 move PSTOPED quote 13 ifhitspace { state rescam action 0 resetplayer } break }

    ifaction STHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action SLYINGDEAD espawn 6361 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
    ifaction JTHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action JLYINGDEAD espawn 5358 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
    ifaction J2THROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action JLYINGDEAD espawn 25730 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
    ifaction PTHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action PLYINGDEAD espawn 6424 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
    ifaction ZTHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action ZLYINGDEAD espawn 5610 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
    ifaction RTHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action RLYINGDEAD espawn 6126 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }  
    ifaction RNTHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action RNLYINGDEAD espawn 6703 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }  
    ifaction GTHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action GLYINGDEAD espawn 6455 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break } 
    ifaction MTHROWNBACK 
	{ ifactioncount 6 { spawn BLOODPOOL action MLYINGDEAD espawn 6943 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break } 
    ifaction PCTHROWNBACK 
	{ ifactioncount 8 { spawn BLOODPOOL action PCLYINGDEAD espawn 7782 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
    ifaction EAF_THROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action EAF_LYINGDEAD espawn 9934 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
	ifaction M2THROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action M2LYINGDEAD espawn 26400 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
	ifaction LTHROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action LLYINGDEAD espawn 12876 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
	ifaction MC_THROWNBACK 
	{ ifactioncount 6 { spawn BLOODPOOL action MC_LYINGDEAD espawn 16424 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }
	ifaction SF_THROWNBACK 
	{ ifactioncount 5 { spawn BLOODPOOL action SF_LYINGDEAD espawn 20886 seta[RETURN].pal player[].palookup } else ifactioncount 1 move 0 break }

    ifaction PEXPLODEAD { quote 13 ifhitspace { state spawnbackpack resetplayer action 0 } break }

    ifaction PEXPLODE { ifactioncount 5 { action PEXPLODEAD spawn BLOODPOOL } break }

    ifp pshrunk
    {
      state standard_pjibs
      spawn BLOODPOOL

      state squish_sounds
      ife CHAR 1 sound ZDEATH ife CHAR 2 sound DUKE_DEAD

      cstat 32768         // Hide the sprite

      action PLYINGDEAD
    }
    else
    {
      ifinwater
      {
        action PLYINGDEAD
        spawn WATERBUBBLE
        spawn WATERBUBBLE
      }
      else
      {
        action PEXPLODE
        state standard_pjibs
        cstat 32768
        state squish_sounds
      ife CHAR 1 sound ZDEATH ife CHAR 2 sound DUKE_DEAD
      }
    }
    tossweapon
    break
  }

  ifsquished
  {
    strength -1
    state squish_sounds
    state random_ooz
    break
  }

  ifp pboosted
  {
  getp[].steroids_amount PBOOST
  
  // Diable Steroid speedboost (update as character items are implemented)
  set TEMP2 0
  ife CHAR 3 orvar TEMP2 8 // Skip Highwire
  ife CHAR 7 orvar TEMP2 128 // Skip Mikko
  ife CHAR 13 orvar TEMP2 8192 // Skip Micky
  
  ifand TEMP2 8328
	{
	getp[].posxv TEMP
		mulvar TEMP 10
		ifand BITS_PRESS P_SPRINTING
		 ifg SPRINTING 0 divvar TEMP 12 else divvar TEMP 15
		setp[].posxv TEMP
		getp[].posyv TEMP
		mulvar TEMP 10
		ifand BITS_PRESS P_SPRINTING
		 ifg SPRINTING 0 divvar TEMP 12 else divvar TEMP 15
		setp[].posyv TEMP
	}
  }
  else set PBOOST 0

  geta[].htextra HIT_DAMAGE
  
  ifmove PSHRINKING
  {
  set FAKE_SHRUNK 1
  setp[].weapon_pos 10
  setp[].kickback_pic 0
  
    ife temp_weapon 43
 ifand BITS_PRESS 64
  ife KICKBACKPIC 0
	{
	sound RED_COMPBEEP
	count SHRUNKCOUNT
	}
	
    ife temp_weapon 1
 ifand BITS_PRESS 64
  ife KICKBACKPIC 0
	{
	soundonce RED_COMPBEEP
	count SHRUNKCOUNT
	}
	
  
  
  ife temp_weapon 43
 ifand BITS_PRESS 64
  ife KICKBACKPIC 0
	{
	soundonce RED_COMPBEEP
	count SHRUNKCOUNT
	}
  
    ifcount 32
    {
      ifcount SHRUNKDONECOUNT
      {
	  set FAKE_SHRUNK 0
        move 0
        cstat 257
      }
      else
        ifcount SHRUNKCOUNT
      {
	  soundonce ACTOR_UNSHRINK
        sizeto 42 36
        ifgapzl 24
        {
          strength 0
          state squish_sounds
          palfrom 48 64
          break
        }
      }
      else
        ifp pboosted
          count SHRUNKCOUNT
    }
    else
    {
      ifp pboosted
        count SHRUNKCOUNT
      else
      {
        sizeto 8 9
        spawn FRAMEEFFECT1
      }
    }
  }
  else ifhitweapon
  {  
  set TEMP3 HIT_DAMAGE
  ifl TEMP3 10 set TEMP3 10
  ifg TEMP3 25 ife HELMET_LOADOUT[CHAR] 1 set TEMP3 25
  setp[].pals_time TEMP3
  ifg TEMP3 45 set TEMP3 45
  ifl TEMP3 20 set TEMP3 20
  ifg TEMP3 25 ifn HELMET_LOADOUT[CHAR] 1 wackplayer
  
  setp[].pals 0 TEMP3
  setp[].pals 1 0
  setp[].pals 2 0
 
  state NEWGUNEFFECTS
	
   state HIT_IND
   geta[].htang TEMP
   sub TEMP sprite[].ang
   set PHITANGLE TEMP

    // PLAYER HITWEAPON SHIT

    ifwasweapon 3781
	{
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
	

    ifdead
    {
	palfrom 60 60

      ifwasweapon GROWSPARK
      {
        palfrom 48 48
        action PGROWING
        count 0
        move 0
        sound ACTOR_GROWING
        cstat 0
        break
      }
	  
		set ARMOURTYPE 0
		set MEDIKIT_USING 0
		state drop_tempweapon
		ifmultiplayer nullop else set CREDITS 0
		ifn CONTROL_VR -1 set CONTROL_VR -1
		setp[].kickback_pic 0
		ife on_tripwire 1 set on_tripwire 0
		set STORY_TRIGGER1 0
		set STORY_TRIGGER2 0
		set STORY_TRIGGER3 0
		// getp[].wackedbyactor TEMP
		  ife CHAR 0 action JTHROWNBACK else ife CHAR 1 action ZTHROWNBACK else ife CHAR 3 action RTHROWNBACK else
		ife CHAR 4 action STHROWNBACK else ife CHAR 5 action RNTHROWNBACK else ife CHAR 6 action GTHROWNBACK 
		else ife CHAR 7 action MTHROWNBACK else ife CHAR 9 { sound CULTIST_DIE1 action PCTHROWNBACK } 
		else ife CHAR 10 action EAF_THROWNBACK else ife CHAR 11 action M2THROWNBACK else 
		ife CHAR 12 action LTHROWNBACK else ife CHAR 13 action MC_THROWNBACK else ife CHAR 14 action SF_THROWNBACK
		else action PTHROWNBACK
		tossweapon
	  
    }
    else
    {
       ifphealthl YELLHURTSOUNDSTRENGTH
        {
          ifrnd 74
            { 
			ife CHAR 0 set playsound J_LONGTERM_PAIN2 
			ife CHAR 1 set playsound Z_LONGTERM_PAIN2 
			ife CHAR 2 set playsound MHURT
			ife CHAR 3 set playsound RHURT
			ife CHAR 4 set playsound SHURT 
			ife CHAR 5 set playsound RNHURT
			ife CHAR 9 set playsound CULTIST_PAIN1
			ife CHAR 10 set playsound BS_PAIN1
			ife CHAR 12 set playsound BS_PAIN1
			ife CHAR 13 set playsound MC_HURT
			ife CHAR 14 set playsound SF_PAIN1
			ife CHAR 15 set playsound MC_NS_HURT
			}
          else
            ifrnd 8
              { 
			  ife CHAR 0 set playsound J_LONGTERM_PAIN3 
			ife CHAR 1 set playsound Z_LONGTERM_PAIN3 
			ife CHAR 2 set playsound MHURT
			ife CHAR 3 set playsound RHURT
			ife CHAR 4 set playsound SHURT2 
			ife CHAR 5 set playsound RNHURT2 
			ife CHAR 9 set playsound CULTIST_PAIN2
			ife CHAR 10 set playsound BS_PAIN2
			ife CHAR 12 set playsound BS_PAIN2			
			ife CHAR 13 set playsound MC_HURT2
			ife CHAR 14 set playsound SF_PAIN2
			ife CHAR 15 set playsound MC_NS_HURT2
				}
          else
            { 
			ife CHAR 0 set playsound J_LONGTERM_PAIN4 
			ife CHAR 1 set playsound Z_LONGTERM_PAIN4 
			ife CHAR 2 set playsound MHURT2
			ife CHAR 3 set playsound RHURT2
			ife CHAR 4 set playsound SHURT3 
			ife CHAR 5 set playsound RNHURT3 
			ife CHAR 9 set playsound CULTIST_PAIN3
			ife CHAR 10 set playsound BS_PAIN3
			ife CHAR 12 set playsound BS_PAIN3			
			ife CHAR 13 set playsound MC_HURT3
			ife CHAR 14 set playsound SF_PAIN3
			ife CHAR 15 set playsound MC_NS_HURT3
			}		
			globalsoundvar playsound
			ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR playsound 512
        }
	  else
        ifrnd 128
          { 
		  ife CHAR 0 set playsound JGASP 
		  ife CHAR 1 set playsound Z_LONGTERM_PAIN 
		  ife CHAR 4 set playsound SHURT4
		  ife CHAR 9 set playsound CULTIST_PAIN3
			ife CHAR 10 set playsound BS_PAIN4
			ife CHAR 12 set playsound BS_PAIN4
		  ife CHAR 14 set playsound SF_PAIN4
			globalsoundvar playsound
			ife FAKE_SHRUNK 1 setactorsoundpitch THISACTOR playsound 512
		  }
    }
    ifstrength TOUGH
    {
	ife CHAR 10 sound BS_GRUNT
	else ife CHAR 12 sound BS_GRUNT
	else ife CHAR 20 sound BS_GRUNT
	else
      sound DUKE_GRUNT
    }

    ifwasweapon RPG
    {
      ifrnd 32
        spawn BLOOD 
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon RADIUSEXPLOSION
    {
      ifrnd 32
        spawn BLOOD 
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon FIREEXT
    {
      ifrnd 32
        spawn BLOOD 
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon GROWSPARK
    {
      palfrom 48 52
      sound EXPANDERHIT
      break
    }
    ifwasweapon SHRINKSPARK
    {
	geta[].htowner TEMP
	geta[TEMP].htpicnum TEMP2
	ife ARTIFACTS_LOADOUT[CHAR] 4 ifn TEMP2 1405 { seta[].htextra -1 palfrom 10 0 10 0 soundonce GET_MAGIC } else
			{
		  palfrom 48 0 48
		  move PSHRINKING // used as a var only.
		  sound ACTOR_SHRINKING
		  cstat 0
		  break
		   }
    }
    ifwasweapon SHOTSPARK1 palfrom 24 48
    ifwasweapon FIRELASER palfrom 32 32
    ifwasweapon FREEZEBLAST
    {
      palfrom 48 0 0 48
      ifdead
      {
        sound SOMETHINGFROZE
		seta[].pal 1
        spritepal 1
        move 0
		ife CHAR 0 action JFROZEN
		ife CHAR 1 action ZFROZEN
		ife CHAR 2 action PFROZEN
		ife CHAR 3 action RFROZEN
		ife CHAR 4 action SFROZEN
		ife CHAR 5 action RNFROZEN
		ife CHAR 6 action GFROZEN
		ife CHAR 7 action MFROZEN
		ife CHAR 9 action PCFROZEN
		ife CHAR 10 action EAF_FROZEN
		ife CHAR 11 action M2FROZEN
		ife CHAR 12 action LFROZEN
		ife CHAR 13 action MC_FROZEN
		ife CHAR 14 action SF_FROZEN
        break
      }
    }
    ifwasweapon 7159
    {
      palfrom 48 0 0 48
      ifdead
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
		ife CHAR 0 action JFROZEN
		ife CHAR 1 action ZFROZEN
		ife CHAR 2 action PFROZEN
		ife CHAR 3 action RFROZEN
		ife CHAR 4 action SFROZEN
		ife CHAR 5 action RNFROZEN
		ife CHAR 6 action GFROZEN
		ife CHAR 7 action MFROZEN
		ife CHAR 9 action PCFROZEN
		ife CHAR 10 action EAF_FROZEN
		ife CHAR 11 action M2FROZEN
		ife CHAR 12 action LFROZEN
		ife CHAR 13 action MC_FROZEN
		ife CHAR 14 action SF_FROZEN
        break
      }
    }
    ifwasweapon COOLEXPLOSION1
      { ife CHAR 4 nullop else ife CHAR 6 nullop else palfrom 48 48 0 48 wackplayer }
    ifwasweapon KNEE
      palfrom 16 32

    state random_wall_jibs

    break
  }
  
ife player_in_vehicle 0 
state PLAYERANIMS

ife PLAYERONTHEBIKE 1 state PLAYERANIMS

ifactioncount 3
ife player_in_vehicle 0
ife camerasprite -1
iffloordistl 8
{
	ifaction PCRAWLING state RUNSOUNDS
	ifaction JCRAWLING state RUNSOUNDS
	ifaction J2CRAWLING state RUNSOUNDS
	ifaction SCRAWLING state RUNSOUNDS
	ifaction S2CRAWLING state RUNSOUNDS
	ifaction ZCRAWLING state RUNSOUNDS
	ifaction RCRAWLING state RUNSOUNDS
	ifaction RNCRAWLING state RUNSOUNDS
	ifaction GCRAWLING state RUNSOUNDS
	ifaction MCRAWLING state RUNSOUNDS
	ifaction PCRAWLING state RUNSOUNDS
	ifaction JCRAWLING state RUNSOUNDS
	ifaction M2CRAWLING state RUNSOUNDS
	ifaction LCRAWLING state RUNSOUNDS
	ifaction MC_CRAWLING state RUNSOUNDS
	ifaction MCNS_CRAWLING state RUNSOUNDS
	ifaction SF_CRAWLING state RUNSOUNDS
	ifaction CCRAWLING state RUNSOUNDS
	ifaction PWALK state RUNSOUNDS
	ifaction JWALK state RUNSOUNDS
	ifaction J2WALK state RUNSOUNDS
	ifaction SWALK state RUNSOUNDS
	ifaction S2WALK state RUNSOUNDS
	ifaction ZWALK state RUNSOUNDS
	ifaction RWALK state RUNSOUNDS
	ifaction RNWALK state RUNSOUNDS
	ifaction GWALK state RUNSOUNDS
	ifaction JG_WALK state RUNSOUNDS
	ifaction MWALK state RUNSOUNDS
	ifaction PCWALK state RUNSOUNDS
	ifaction EAF_WALK state RUNSOUNDS
	ifaction M2WALK state RUNSOUNDS
	ifaction LWALK state RUNSOUNDS
	ifaction ES_WALK state RUNSOUNDS
	ifaction SS_WALK state RUNSOUNDS
	ifaction MC_WALK state RUNSOUNDS
	ifaction MCNS_WALK state RUNSOUNDS
	ifaction CWALK state RUNSOUNDS
	ifaction SF_WALK state RUNSOUNDS
	ifaction CIV_AWALK state RUNSOUNDS
	ifaction PRUN state RUNSOUNDS
	ifaction JRUN state RUNSOUNDS
	ifaction J2RUN state RUNSOUNDS
	ifaction SRUN state RUNSOUNDS
	ifaction S2RUN state RUNSOUNDS
	ifaction ZRUN state RUNSOUNDS
	ifaction RRUN state RUNSOUNDS
	ifaction RNRUN state RUNSOUNDS
	ifaction GRUN state RUNSOUNDS
	ifaction MRUN state RUNSOUNDS
	ifaction PCRUN state RUNSOUNDS
	ifaction EAF_RUN state RUNSOUNDS
	ifaction M2RUN state RUNSOUNDS
	ifaction LRUN state RUNSOUNDS
	ifaction ES_RUN state RUNSOUNDS
	ifaction JG_RUN state RUNSOUNDS
	ifaction SS_RUN state RUNSOUNDS
	ifaction MC_RUN state RUNSOUNDS
	ifaction MCNS_RUN state RUNSOUNDS
	ifaction CRUN state RUNSOUNDS
	ifaction SF_RUN state RUNSOUNDS
	ifaction CIV_ARUN state RUNSOUNDS
}
else set FOOTSTEPCOUNT -1

ifand BITS_PRESS P_SPRINTING
{
	ifactioncount 2
	ife player_in_vehicle 0
	ife camerasprite -1
	iffloordistl 8
	{
	ifaction PRUN state RUNSOUNDS
	ifaction JRUN state RUNSOUNDS
	ifaction J2RUN state RUNSOUNDS
	ifaction SRUN state RUNSOUNDS
	ifaction S2RUN state RUNSOUNDS
	ifaction ZRUN state RUNSOUNDS
	ifaction RRUN state RUNSOUNDS
	ifaction RNRUN state RUNSOUNDS
	ifaction GRUN state RUNSOUNDS
	ifaction MRUN state RUNSOUNDS
	ifaction PCRUN state RUNSOUNDS
	ifaction EAF_RUN state RUNSOUNDS
	ifaction M2RUN state RUNSOUNDS
	ifaction LRUN state RUNSOUNDS
	ifaction SF_RUN state RUNSOUNDS
	ifaction ES_RUN state RUNSOUNDS
	ifaction JG_RUN state RUNSOUNDS
	ifaction MC_RUN state RUNSOUNDS
	ifaction MCNS_RUN state RUNSOUNDS
	ifaction CRUN state RUNSOUNDS
	}
	else set FOOTSTEPCOUNT -1
}

enda

defstate MINES_ENEMYLIST
   findnearactor3d SHOOTME PROX_DISTANCE TEMP9 ifn TEMP9 -1 { action ZERO resetcount }
   else ife TEMP9 -1 findnearactor3d SHOOTME3 PROX_DISTANCE TEMP9 ifn TEMP9 -1 { action ZERO resetcount }
ends

action HEART_IDLE 0

useractor notenemy HEARTLEECHFLOAT

	ifaction 0
	{
	seta[].mdflags 16
	 set command 32768
	}


ifaction HEART_IDLE
{
	ifmultiplayer ifn COOP 1
	{
	ifpdistl PROX_DISTANCE action ZERO
	}
	else
	state MINES_ENEMYLIST
}
else
ifaction ZERO
{
ifmultiplayer
 ifn COOP 1
	{
	ifn TEMP5 1 { globalsound UNMAKERF set TEMP5 1 }
	seta[].x player[].posx
	seta[].y player[].posy
	getp[].posz TEMP3
	add TEMP3 -5120
	seta[].z TEMP3
	ifcount 30 
		{ 
		sound HEARTBEAT 
		seta[PLAYER_IDENTITY].htextra 20 
		geta[myowner].extra TEMP4 add TEMP4 10 seta[myowner].extra TEMP4
		palfrom 20 0 20 0 
		add TEMP2 1 
		geta[PLAYER_IDENTITY].extra TEMP4
	    ifg TEMP2 4 { globalsound UNMADE spawn SKULLEXPLOSION hitradius 2048 25 50 75 100 killit } 
		resetcount 
		}
	}
else
	{
	ifn TEMP5 1 { globalsound UNMAKERF set TEMP5 1 }
	seta[].x sprite[TEMP9].x
	seta[].y sprite[TEMP9].y
	geta[TEMP9].z TEMP3
	add TEMP3 -5120
	seta[].z TEMP3
	ifcount 30 
		{ 
		spawn 8433
		sound HEARTBEAT 
		getactorvar[TEMP9].myowner TEMP8
		seta[TEMP8].htextra 50 
		setactorvar[TEMP8].SPIRIT_DAMAGE 10
		addphealth 5
		palfrom 20 0 20 0 
		add TEMP2 1 
		ifl sprite[TEMP8].extra 21 { globalsound UNMADE spawn SKULLEXPLOSION hitradius 2048 25 50 75 100 killit } else
	    ifg TEMP2 4 { globalsound UNMADE spawn SKULLEXPLOSION hitradius 2048 25 50 75 100 killit } 
		resetcount 
		}
	}

}
else
ifaction 0
{
cstat 0
sizeat 26 26
ifpdistg PROX_DISTANCE action HEART_IDLE
}

enda

spriteshadow M_TRAP_THROW
spriteshadow M_TRAP_IDLE

spriteshadow R_TRAP_THROW
spriteshadow R_TRAP_IDLE

spriteshadow MC_TRAP_THROW
spriteshadow MC_TRAP_IDLE

useractor notenemy R_TRAP_IDLE

ifaction 0
{
cstat 0
sizeat 16 16
findnearactor3d SHOOTME 1524 TEMP9 ifn TEMP9 -1 { action RN_TRAP_STICK resetcount }
findnearactor3d SHOOTME3 1524 TEMP8 ifn TEMP8 -1 { set TEMP9 TEMP8 action RN_TRAP_STICK resetcount }
}
else
ifaction RN_TRAP_STICK
{
ifmultiplayer
 ifn COOP 1
	{
	ifn TEMP5 1 { globalsound PB_STIC set TEMP5 1 }
	seta[].x player[].posx
	seta[].y player[].posy
	getp[].posz TEMP3
	add TEMP3 -5120
	seta[].z TEMP3
	ifcount 3 
		{ 
		soundonce PB_KILL
		addphealth -10
		palfrom 20 0 20 0 
		add TEMP2 1 
		guts JIBS6 2
		ifg TEMP2 6 killit 
		resetcount 
		}
	}
else
	{
	ifn TEMP5 1 { globalsound PB_STIC set TEMP5 1 }
	seta[].x sprite[TEMP9].x
	seta[].y sprite[TEMP9].y
	geta[TEMP9].z TEMP3
	add TEMP3 -7120
	seta[].z TEMP3
	ifcount 3 
		{ 
		sound PB_AMB 
		getactorvar[TEMP9].myowner TEMP8
		seta[TEMP8].htextra 25
		guts JIBS6 2
		add TEMP2 1 
		ifl sprite[TEMP8].extra 10 { globalsound ZAX_BOMB_EXPL spawn EXPLOSION2 hitradius 1024 25 50 75 100 killit } 
		else
	    ifg TEMP2 20 { globalsound ZAX_BOMB_EXPL spawn EXPLOSION2 hitradius 1024 25 50 75 100 killit } 
		resetcount 
		}
	}

}

enda

action OK2 0

useractor notenemy M_TRAP_IDLE

ifaction 0
{
cstat 256
sizeat 4 4
	ifspawnedby APLAYER action OK2
	else action OK
}
else
ifaction OK 
{ 
ifmultiplayer ifn COOP 1 { ifpdistl PROX_DISTANCE action ZERO } 
else state MINES_ENEMYLIST 
}

ifaction ZERO
	{
	ifcount 30
		{
		ifmultiplayer nullop else ifpdistl 8192 quake 13
		spawn EXPLOSION2
		globalsound LASERTRIP_EXPLODE
		hitradius 3500 15 50 80 100
		sound THROWING_STARBELT
		shoot 3790
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 256 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 384 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 512 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 640 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 768 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 896 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1024 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1152 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1280 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1408 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1536 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1664 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1792 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1920 seta[RETURN].ang TEMP
		debris SCRAP2 3
		killit
		}
	}
	
ifhitweapon
	{
	ifmultiplayer nullop else ifpdistl 8192 quake 13
		spawn EXPLOSION2
		globalsound LASERTRIP_EXPLODE
		hitradius 3500 15 50 80 100
		sound THROWING_STARBELT
		shoot 3790
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 256 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 384 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 512 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 640 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 768 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 896 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1024 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1152 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1280 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1408 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1536 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1664 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1792 seta[RETURN].ang TEMP
		eshoot 3790 geta[RETURN].ang TEMP add TEMP 1920 seta[RETURN].ang TEMP
	debris SCRAP2 3
	killit
	}


enda

useractor notenemy MC_TRAP_IDLE

ifaction 0
{
cstat 256
sizeat 8 8
	ifspawnedby APLAYER action OK2
	else action OK
}
else
ifaction OK 
{ 
ifmultiplayer ifn COOP 1 { ifpdistl PROX_DISTANCE action ZERO } 
else state MINES_ENEMYLIST 
}

ifaction ZERO
	{
	ifcount 30
		{
		ifmultiplayer nullop else ifpdistl 8192 quake 13
		spawn ENERGY_EXPLOSION
		globalsound LASERTRIP_EXPLODE
		hitradius 1524 15 50 80 100
		setprojectile[7159].WORKSLIKE 102402
		sound GREMGUN_ICE
		shoot FREEZEBLAST
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 256 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 384 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 512 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 640 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 768 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 896 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1024 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1152 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1280 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1408 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1536 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1664 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1792 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1920 seta[RETURN].ang TEMP
		debris SCRAP2 3
		setprojectile[7159].WORKSLIKE 98306
		killit
		}
	}
	
ifhitweapon
	{
	ifmultiplayer nullop else ifpdistl 8192 quake 13
		spawn ENERGY_EXPLOSION
		globalsound LASERTRIP_EXPLODE
		hitradius 3500 15 50 80 100
		sound GREMGUN_ICE
		shoot FREEZEBLAST
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 128 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 256 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 384 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 512 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 640 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 768 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 896 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1024 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1152 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1280 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1408 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1536 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1664 seta[RETURN].ang TEMP
		eshoot FREEZEBLAST geta[RETURN].ang TEMP add TEMP 1792 seta[RETURN].ang TEMP
		eshoot 7159 geta[RETURN].ang TEMP add TEMP 1920 seta[RETURN].ang TEMP
		debris SCRAP2 3
	killit
	}


enda

defstate PROXBOMB_CODE
sizeat 32 32
fall

ifaction 0
{
cstat 256
	ifspawnedby APLAYER action OK2
	else action OK
}
else
ifaction OK 
{ 
ifmultiplayer ifn COOP 1 { ifpdistl PROX_DISTANCE action ZERO } 
else state MINES_ENEMYLIST 
}

ifaction OK2 ifpdistg PROX_DISTANCE { globalsound PROX_TONE spawn 8433 action OK }

ifaction ZERO
	{
	ifactor PROXONFLOOR_2 // Set to instant?
		{
		soundonce PROX_TONE
			ifmultiplayer nullop else ifpdistl 8192 quake 13
			spawn EXPLOSION2
			globalsound PROX_TONE
			globalsound LASERTRIP_EXPLODE
			hitradius 3500 60 100 160 300
			debris SCRAP2 3
			killit
		}
	else // Set to explode after 1 second?
		{
		soundonce PROX_TONE
		ifcount 30
			{
			ifmultiplayer nullop else ifpdistl 8192 quake 13
			spawn EXPLOSION2
			globalsound PROX_TONE
			globalsound LASERTRIP_EXPLODE
			hitradius 3500 60 100 160 300
			debris SCRAP2 3
			killit
			}
		}
	}
	
ifhitweapon
	{
	ifmultiplayer nullop else ifpdistl 8192 quake 13
	spawn EXPLOSION2
	globalsound PROX_TONE
	globalsound LASERTRIP_EXPLODE
	hitradius 3500 60 100 160 300
	debris SCRAP2 3
	killit
	}

ifpdistl 812 
ifaction OK
  {     
  ifspritepal 9 break
  	getp[].ammo_amount 8 TEMP
	 ifl TEMP 10 { add TEMP 1 setp[].ammo_amount 8 TEMP } else break
		setarray PICKED_UP_GUN[8] 30
		  set WEAP_SHOW 130
  state quikget
  palfrom 16 0 32
  killit
  }

ends

useractor notenemy PROXONFLOOR state PROXBOMB_CODE enda
useractor notenemy PROXONFLOOR_2 state PROXBOMB_CODE enda

useractor notenemy DISCBOMBFLOOR2
sizeat 32 32
fall

ifaction 0
{
cstat 256
	ifspawnedby APLAYER action OK2
	else action OK
}
else
ifaction OK 
{ 
ifmultiplayer ifn COOP 1 { ifpdistl PROX_DISTANCE action ZERO } 
else state MINES_ENEMYLIST 
}

ifaction OK2 ifpdistg PROX_DISTANCE { globalsound PROX_TONE action OK }

ifaction ZERO
	{
	soundonce PROX_TONE
	ifcount 30
		{
		ifmultiplayer nullop else ifpdistl 8192 quake 13
		spawn GROUNDEXPLOSION
		globalsound PROX_TONE
		globalsound ZAX_BOMB_EXPL
		hitradius 2048 50 150 250 400
		debris SCRAP2 3
		killit
		}
	}
	
ifhitweapon
	{
	ifmultiplayer nullop else ifpdistl 8192 quake 13
	spawn GROUNDEXPLOSION
	globalsound PROX_TONE
	globalsound ZAX_BOMB_EXPL
	hitradius 2048 50 150 250 400
	debris SCRAP2 3
	killit
	}

ifpdistl 812 
ifaction OK
  {     
  	getp[].ammo_amount 8 TEMP
	 ifl TEMP 10 { add TEMP 1 setp[].ammo_amount 8 TEMP } else break
	 
	 setarray PICKED_UP_GUN[8] 30
	 set WEAP_SHOW 130
	 
  state quikget
  killit
  }

enda

